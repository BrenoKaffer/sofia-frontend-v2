[{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/__tests__/api/ml-endpoints.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/__tests__/api/roulette-history.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/__tests__/api/setup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/__tests__/api/signals-history.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/__tests__/api/strategy-descriptions.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/__tests__/lib/cache.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/__tests__/lib/strategySemantics.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/__tests__/simple.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/__tests__/unit/auth-fallback.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/__tests__/unit/auth-service.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/__tests__/upload_from_builder.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/account/upgrade/page.backup.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/admin/actions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/admin/lessons/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/admin/modules/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/admin/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/admin/users/UsersTable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/admin/users/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/analytics/ml-features/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/analytics/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/action-resolver/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/admin/roles/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/admin/seed/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/admin/users/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/ai-signals/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/analytics/real-time-metrics/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/analytics/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/auth/api-keys/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/auth/debug-token/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/auth/login/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/auth/logout/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/auth/register/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/auth/reset-password/route.backup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/auth/reset-password/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/automation/advanced-metrics/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/automation/auto-entry/toggle/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/automation/emergency-stop/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/automation/initialize/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/automation/metrics/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/automation/risk-metrics/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/automation/sessions/start/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/automation/strategies/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/automation/strategy/register/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/available-options/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/betting/betgorillas/connect/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/betting/betgorillas/disconnect/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/betting/betgorillas/start/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/betting/betgorillas/status/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/betting/betgorillas/stop/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/billing/dunning/cron/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/cache-example/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/checkout-link/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/create-pix/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/create-subscription/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/dynamic-strategies/[...path]/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/dynamic-strategies/templates/[id]/publish/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/dynamic-strategies/templates/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/dynamic-strategies/toggle/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/dynamic-strategies/upload-from-builder/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/forgot-password/debug/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/forgot-password/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/health/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/kpis-estrategias/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/kpis/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/lessons/progress/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/logs/export/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/logs/metrics/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/logs/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/logs/stats/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/metrics/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/ml/features/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/ml/initialize/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/ml/predictions/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/ml/retrain/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/ml/status/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/payments/capture/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/payments/checkout-link/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/payments/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/payments/webhook/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/process-spin/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/public/system/health/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/public/tables/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/rate-limit-example/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/realtime-data/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/redirect-after-payment/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/refunds/request/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/roulette-history/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/roulette-status/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/roulette-tables/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/session-metrics/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/session-templates/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/sessions/[id]/logs/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/sessions/[id]/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/sessions/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/signals-history/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/signals/recent/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/signals/validate/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/strategies/[id]/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/strategies/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/strategy-descriptions/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/strategy-instances/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/system/health/aggregate/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/system/health/private/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/system/health/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/system/status/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/templates/strategies/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/test-registration/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/test/setup/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/user-backup/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/user-preferences/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/user/preferences/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/validate-coupon/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/webhooks/pagarme/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/api/websocket/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/auth/callback/page.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'router' and 'searchParams'. Either include them or remove the dependency array.","line":220,"column":6,"nodeType":"ArrayExpression","endLine":220,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [router, searchParams]","fix":{"range":[9024,9026],"text":"[router, searchParams]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/automation/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/backup/page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'loadBackups' function makes the dependencies of useEffect Hook (at line 222) change on every render. To fix this, wrap the definition of 'loadBackups' in its own useCallback() Hook.","line":56,"column":9,"nodeType":"VariableDeclarator","endLine":95,"endColumn":4,"suggestions":[{"desc":"Wrap the definition of 'loadBackups' in its own useCallback() Hook.","fix":{"range":[1606,2798],"text":"useCallback(async () => {\r\n    try {\r\n      setLoading(true);\r\n      const token = await getToken();\r\n      \r\n      const response = await fetch('/api/user-backup', {\r\n        headers: {\r\n          'Authorization': `Bearer ${token}`,\r\n          'Content-Type': 'application/json',\r\n        },\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error('Erro ao carregar backups');\r\n      }\r\n\r\n      const data = await response.json();\r\n      setBackups(data.backups || []);\r\n      \r\n      // Calcular estatísticas\r\n      const totalSize = data.backups.reduce((sum: number, backup: Backup) => sum + backup.size, 0);\r\n      const timestamps = data.backups.map((b: Backup) => b.timestamp).sort();\r\n      \r\n      setStats({\r\n        total_backups: data.backups.length,\r\n        total_size: totalSize,\r\n        last_backup: timestamps[timestamps.length - 1] || null,\r\n        oldest_backup: timestamps[0] || null\r\n      });\r\n    } catch (error) {\r\n      console.error('Erro ao carregar backups:', error);\r\n      toast({\r\n        title: 'Erro',\r\n        description: 'Não foi possível carregar os backups',\r\n        variant: 'destructive'\r\n      });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  })"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Alert, AlertDescription } from '@/components/ui/alert';\r\nimport { Separator } from '@/components/ui/separator';\r\nimport { Progress } from '@/components/ui/progress';\r\nimport { \r\n  Download, \r\n  Upload, \r\n  Trash2, \r\n  Shield, \r\n  Clock, \r\n  HardDrive,\r\n  AlertTriangle,\r\n  CheckCircle,\r\n  RefreshCw,\r\n  Database\r\n} from 'lucide-react';\r\nimport { DashboardLayout } from '@/components/dashboard/layout';\r\nimport { useAuth } from '@/hooks/use-sofia-auth';\r\nimport { toast } from '@/hooks/use-toast';\r\n\r\ninterface Backup {\r\n  id: string;\r\n  timestamp: string;\r\n  version: string;\r\n  size: number;\r\n  user_id: string;\r\n}\r\n\r\ninterface BackupStats {\r\n  total_backups: number;\r\n  total_size: number;\r\n  last_backup: string | null;\r\n  oldest_backup: string | null;\r\n}\r\n\r\nexport default function BackupPage() {\r\n  const { getToken } = useAuth();\r\n  const [backups, setBackups] = useState<Backup[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [creating, setCreating] = useState(false);\r\n  const [restoring, setRestoring] = useState<string | null>(null);\r\n  const [deleting, setDeleting] = useState<string | null>(null);\r\n  const [stats, setStats] = useState<BackupStats>({\r\n    total_backups: 0,\r\n    total_size: 0,\r\n    last_backup: null,\r\n    oldest_backup: null\r\n  });\r\n\r\n  // Carregar lista de backups\r\n  const loadBackups = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const token = await getToken();\r\n      \r\n      const response = await fetch('/api/user-backup', {\r\n        headers: {\r\n          'Authorization': `Bearer ${token}`,\r\n          'Content-Type': 'application/json',\r\n        },\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error('Erro ao carregar backups');\r\n      }\r\n\r\n      const data = await response.json();\r\n      setBackups(data.backups || []);\r\n      \r\n      // Calcular estatísticas\r\n      const totalSize = data.backups.reduce((sum: number, backup: Backup) => sum + backup.size, 0);\r\n      const timestamps = data.backups.map((b: Backup) => b.timestamp).sort();\r\n      \r\n      setStats({\r\n        total_backups: data.backups.length,\r\n        total_size: totalSize,\r\n        last_backup: timestamps[timestamps.length - 1] || null,\r\n        oldest_backup: timestamps[0] || null\r\n      });\r\n    } catch (error) {\r\n      console.error('Erro ao carregar backups:', error);\r\n      toast({\r\n        title: 'Erro',\r\n        description: 'Não foi possível carregar os backups',\r\n        variant: 'destructive'\r\n      });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Criar novo backup\r\n  const createBackup = async () => {\r\n    try {\r\n      setCreating(true);\r\n      const token = await getToken();\r\n      \r\n      const response = await fetch('/api/user-backup', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Authorization': `Bearer ${token}`,\r\n          'Content-Type': 'application/json',\r\n        },\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error('Erro ao criar backup');\r\n      }\r\n\r\n      const data = await response.json();\r\n      \r\n      toast({\r\n        title: 'Sucesso',\r\n        description: 'Backup criado com sucesso',\r\n      });\r\n      \r\n      await loadBackups();\r\n    } catch (error) {\r\n      console.error('Erro ao criar backup:', error);\r\n      toast({\r\n        title: 'Erro',\r\n        description: 'Não foi possível criar o backup',\r\n        variant: 'destructive'\r\n      });\r\n    } finally {\r\n      setCreating(false);\r\n    }\r\n  };\r\n\r\n  // Restaurar backup\r\n  const restoreBackup = async (backupId: string) => {\r\n    try {\r\n      setRestoring(backupId);\r\n      const token = await getToken();\r\n      \r\n      const response = await fetch('/api/user-backup', {\r\n        method: 'PUT',\r\n        headers: {\r\n          'Authorization': `Bearer ${token}`,\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({ backup_id: backupId }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error('Erro ao restaurar backup');\r\n      }\r\n\r\n      toast({\r\n        title: 'Sucesso',\r\n        description: 'Backup restaurado com sucesso. Recarregue a página para ver as alterações.',\r\n      });\r\n    } catch (error) {\r\n      console.error('Erro ao restaurar backup:', error);\r\n      toast({\r\n        title: 'Erro',\r\n        description: 'Não foi possível restaurar o backup',\r\n        variant: 'destructive'\r\n      });\r\n    } finally {\r\n      setRestoring(null);\r\n    }\r\n  };\r\n\r\n  // Excluir backup\r\n  const deleteBackup = async (backupId: string) => {\r\n    try {\r\n      setDeleting(backupId);\r\n      const token = await getToken();\r\n      \r\n      const response = await fetch(`/api/user-backup?backup_id=${backupId}`, {\r\n        method: 'DELETE',\r\n        headers: {\r\n          'Authorization': `Bearer ${token}`,\r\n          'Content-Type': 'application/json',\r\n        },\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error('Erro ao excluir backup');\r\n      }\r\n\r\n      toast({\r\n        title: 'Sucesso',\r\n        description: 'Backup excluído com sucesso',\r\n      });\r\n      \r\n      await loadBackups();\r\n    } catch (error) {\r\n      console.error('Erro ao excluir backup:', error);\r\n      toast({\r\n        title: 'Erro',\r\n        description: 'Não foi possível excluir o backup',\r\n        variant: 'destructive'\r\n      });\r\n    } finally {\r\n      setDeleting(null);\r\n    }\r\n  };\r\n\r\n  // Formatar tamanho do arquivo\r\n  const formatFileSize = (bytes: number) => {\r\n    if (bytes === 0) return '0 Bytes';\r\n    const k = 1024;\r\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\r\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\r\n  };\r\n\r\n  // Formatar data\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleString('pt-BR');\r\n  };\r\n\r\n  useEffect(() => {\r\n    loadBackups();\r\n  }, [loadBackups]);\r\n\r\n  return (\r\n    <DashboardLayout>\r\n      <div className=\"space-y-6\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <h1 className=\"text-3xl font-bold tracking-tight\">Backup e Restauração</h1>\r\n            <p className=\"text-muted-foreground\">\r\n              Gerencie backups dos seus dados e configurações\r\n            </p>\r\n          </div>\r\n          <Button \r\n            onClick={createBackup} \r\n            disabled={creating}\r\n            className=\"bg-blue-600 hover:bg-blue-700\"\r\n          >\r\n            {creating ? (\r\n              <RefreshCw className=\"mr-2 h-4 w-4 animate-spin\" />\r\n            ) : (\r\n              <Download className=\"mr-2 h-4 w-4\" />\r\n            )}\r\n            {creating ? 'Criando...' : 'Criar Backup'}\r\n          </Button>\r\n        </div>\r\n\r\n        {/* Estatísticas */}\r\n        <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\r\n          <Card>\r\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n              <CardTitle className=\"text-sm font-medium\">Total de Backups</CardTitle>\r\n              <Database className=\"h-4 w-4 text-muted-foreground\" />\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"text-2xl font-bold\">{stats.total_backups}</div>\r\n            </CardContent>\r\n          </Card>\r\n          \r\n          <Card>\r\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n              <CardTitle className=\"text-sm font-medium\">Espaço Utilizado</CardTitle>\r\n              <HardDrive className=\"h-4 w-4 text-muted-foreground\" />\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"text-2xl font-bold\">{formatFileSize(stats.total_size)}</div>\r\n            </CardContent>\r\n          </Card>\r\n          \r\n          <Card>\r\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n              <CardTitle className=\"text-sm font-medium\">Último Backup</CardTitle>\r\n              <Clock className=\"h-4 w-4 text-muted-foreground\" />\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"text-sm font-medium\">\r\n                {stats.last_backup ? formatDate(stats.last_backup) : 'Nenhum'}\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n          \r\n          <Card>\r\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n              <CardTitle className=\"text-sm font-medium\">Status</CardTitle>\r\n              <Shield className=\"h-4 w-4 text-muted-foreground\" />\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"flex items-center space-x-2\">\r\n                <CheckCircle className=\"h-4 w-4 text-green-500\" />\r\n                <span className=\"text-sm font-medium\">Protegido</span>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n\r\n        {/* Informações importantes */}\r\n        <Alert>\r\n          <AlertTriangle className=\"h-4 w-4\" />\r\n          <AlertDescription>\r\n            <strong>Importante:</strong> Os backups incluem suas configurações, preferências, estratégias e histórico recente. \r\n            Recomendamos criar backups regulares antes de fazer alterações importantes.\r\n          </AlertDescription>\r\n        </Alert>\r\n\r\n        {/* Lista de Backups */}\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center space-x-2\">\r\n              <Database className=\"h-5 w-5\" />\r\n              <span>Backups Disponíveis</span>\r\n            </CardTitle>\r\n            <CardDescription>\r\n              Lista de todos os backups criados, ordenados do mais recente para o mais antigo\r\n            </CardDescription>\r\n          </CardHeader>\r\n          <CardContent>\r\n            {loading ? (\r\n              <div className=\"flex items-center justify-center py-8\">\r\n                <RefreshCw className=\"h-6 w-6 animate-spin\" />\r\n                <span className=\"ml-2\">Carregando backups...</span>\r\n              </div>\r\n            ) : backups.length === 0 ? (\r\n              <div className=\"text-center py-8\">\r\n                <Database className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\r\n                <h3 className=\"text-lg font-medium mb-2\">Nenhum backup encontrado</h3>\r\n                <p className=\"text-muted-foreground mb-4\">\r\n                  Crie seu primeiro backup para proteger seus dados\r\n                </p>\r\n                <Button onClick={createBackup} disabled={creating}>\r\n                  <Download className=\"mr-2 h-4 w-4\" />\r\n                  Criar Primeiro Backup\r\n                </Button>\r\n              </div>\r\n            ) : (\r\n              <div className=\"space-y-4\">\r\n                {backups.map((backup) => (\r\n                  <div key={backup.id} className=\"flex items-center justify-between p-4 border rounded-lg\">\r\n                    <div className=\"flex-1\">\r\n                      <div className=\"flex items-center space-x-3\">\r\n                        <div className=\"flex-shrink-0\">\r\n                          <Database className=\"h-8 w-8 text-blue-500\" />\r\n                        </div>\r\n                        <div>\r\n                          <h4 className=\"text-sm font-medium\">{backup.id}</h4>\r\n                          <div className=\"flex items-center space-x-4 text-sm text-muted-foreground\">\r\n                            <span className=\"flex items-center\">\r\n                              <Clock className=\"mr-1 h-3 w-3\" />\r\n                              {formatDate(backup.timestamp)}\r\n                            </span>\r\n                            <span className=\"flex items-center\">\r\n                              <HardDrive className=\"mr-1 h-3 w-3\" />\r\n                              {formatFileSize(backup.size)}\r\n                            </span>\r\n                            <Badge variant=\"outline\">{backup.version}</Badge>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                    \r\n                    <div className=\"flex items-center space-x-2\">\r\n                      <Button\r\n                        variant=\"outline\"\r\n                        size=\"sm\"\r\n                        onClick={() => restoreBackup(backup.id)}\r\n                        disabled={restoring === backup.id}\r\n                      >\r\n                        {restoring === backup.id ? (\r\n                          <RefreshCw className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                        ) : (\r\n                          <Upload className=\"mr-2 h-4 w-4\" />\r\n                        )}\r\n                        {restoring === backup.id ? 'Restaurando...' : 'Restaurar'}\r\n                      </Button>\r\n                      \r\n                      <Button\r\n                        variant=\"outline\"\r\n                        size=\"sm\"\r\n                        onClick={() => deleteBackup(backup.id)}\r\n                        disabled={deleting === backup.id}\r\n                        className=\"text-red-600 hover:text-red-700\"\r\n                      >\r\n                        {deleting === backup.id ? (\r\n                          <RefreshCw className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                        ) : (\r\n                          <Trash2 className=\"mr-2 h-4 w-4\" />\r\n                        )}\r\n                        {deleting === backup.id ? 'Excluindo...' : 'Excluir'}\r\n                      </Button>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Informações adicionais */}\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle>Como funciona o sistema de backup</CardTitle>\r\n          </CardHeader>\r\n          <CardContent className=\"space-y-4\">\r\n            <div className=\"grid gap-4 md:grid-cols-2\">\r\n              <div>\r\n                <h4 className=\"font-medium mb-2\">O que é incluído no backup:</h4>\r\n                <ul className=\"text-sm text-muted-foreground space-y-1\">\r\n                  <li>• Configurações de usuário e preferências</li>\r\n                  <li>• Estratégias personalizadas</li>\r\n                  <li>• Configurações de notificações</li>\r\n                  <li>• Layout do dashboard</li>\r\n                  <li>• Histórico recente de sinais (últimos 100)</li>\r\n                  <li>• Dados de performance</li>\r\n                </ul>\r\n              </div>\r\n              \r\n              <div>\r\n                <h4 className=\"font-medium mb-2\">Recomendações:</h4>\r\n                <ul className=\"text-sm text-muted-foreground space-y-1\">\r\n                  <li>• Crie backups antes de grandes alterações</li>\r\n                  <li>• Mantenha pelo menos 3 backups recentes</li>\r\n                  <li>• Exclua backups antigos para economizar espaço</li>\r\n                  <li>• Teste a restauração periodicamente</li>\r\n                  <li>• Backups são armazenados localmente no servidor</li>\r\n                </ul>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    </DashboardLayout>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/bankroll/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/betting/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/builder-test/page.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":1,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":210,"column":105,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[8195,8247],"text":"Nenhuma estratégia carregada. Use &quot;Nova Estratégia\"."},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[8195,8247],"text":"Nenhuma estratégia carregada. Use &ldquo;Nova Estratégia\"."},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[8195,8247],"text":"Nenhuma estratégia carregada. Use &#34;Nova Estratégia\"."},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[8195,8247],"text":"Nenhuma estratégia carregada. Use &rdquo;Nova Estratégia\"."},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":1,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":210,"column":121,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[8195,8247],"text":"Nenhuma estratégia carregada. Use \"Nova Estratégia&quot;."},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[8195,8247],"text":"Nenhuma estratégia carregada. Use \"Nova Estratégia&ldquo;."},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[8195,8247],"text":"Nenhuma estratégia carregada. Use \"Nova Estratégia&#34;."},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[8195,8247],"text":"Nenhuma estratégia carregada. Use \"Nova Estratégia&rdquo;."},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"﻿\"use client\"\r\nimport React, { useMemo, useState } from \"react\"\r\n\r\n// Config mínimo baseado no JSON fornecido\r\nconst pageConfig = {\r\n  title: \"Builder de Estratégias\",\r\n  description: \"Crie e edite suas estratégias definindo condições de satisfação baseadas no histórico de roleta.\",\r\n  tabs: [\"Estratégias\", \"Templates\", \"Performance\"],\r\n  builder: {\r\n    toolbox: {\r\n      categories: [\r\n        {\r\n          name: \"Gatilhos\",\r\n          nodes: [\r\n            {\r\n              type: \"trigger\" as const,\r\n              label: \"Analisar Janela\",\r\n              defaultConfig: { janela: 30 },\r\n            },\r\n          ],\r\n        },\r\n        {\r\n          name: \"Condições\",\r\n          nodes: [\r\n            { type: \"condition\" as const, subtype: \"repetition\" as const, label: \"Repetição de Evento\", defaultConfig: { evento: \"vermelho\", ocorrencias: 3 } },\r\n            { type: \"condition\" as const, subtype: \"absence\" as const, label: \"Ausência de Evento\", defaultConfig: { evento: \"zero\", rodadasSemOcorrer: 40 } },\r\n            { type: \"condition\" as const, subtype: \"trend\" as const, label: \"Tendência/Frequência\", defaultConfig: { evento: \"vermelho\", janela: 10, frequenciaMinima: 0.7 } },\r\n            { type: \"condition\" as const, subtype: \"pattern\" as const, label: \"Padrão Customizado\", defaultConfig: { sequencia: [\"vermelho\", \"preto\", \"vermelho\"], modo: \"exato\" } },\r\n            { type: \"condition\" as const, subtype: \"break\" as const, label: \"Quebra de Padrão\", defaultConfig: { evento: \"cor\", tamanhoSequencia: 6 } },\r\n            { type: \"condition\" as const, subtype: \"neighbors\" as const, label: \"Vizinhos / Setor\", defaultConfig: { numeroBase: 17, alcanceVizinho: 2, frequencia: 3 } },\r\n          ],\r\n        },\r\n        {\r\n          name: \"Lógica\",\r\n          nodes: [\r\n            { type: \"logic\" as const, label: \"Operador Lógico\", defaultConfig: { operador: \"AND\" } },\r\n          ],\r\n        },\r\n        {\r\n          name: \"Sinal\",\r\n          nodes: [\r\n            { type: \"signal\" as const, label: \"Gerar Sinal\", defaultConfig: { acao: \"emitir_sinal\", mensagem: \"Condição satisfeita\", prioridade: \"normal\" } },\r\n          ],\r\n        },\r\n      ],\r\n    },\r\n    fieldsByType: {\r\n      trigger: [\r\n        { label: \"Janela de Análise\", type: \"number\", key: \"janela\" },\r\n      ],\r\n      \"condition:repetition\": [\r\n        { label: \"Evento\", type: \"select\", key: \"evento\", options: [\"vermelho\", \"preto\", \"par\", \"ímpar\", \"zero\"] },\r\n        { label: \"Ocorrências\", type: \"number\", key: \"ocorrencias\" },\r\n      ],\r\n      \"condition:absence\": [\r\n        { label: \"Evento\", type: \"select\", key: \"evento\", options: [\"zero\", \"vermelho\", \"preto\"] },\r\n        { label: \"Rodadas sem ocorrer\", type: \"number\", key: \"rodadasSemOcorrer\" },\r\n      ],\r\n      \"condition:trend\": [\r\n        { label: \"Evento\", type: \"select\", key: \"evento\", options: [\"vermelho\", \"preto\", \"par\", \"ímpar\"] },\r\n        { label: \"Janela de análise\", type: \"number\", key: \"janela\" },\r\n        { label: \"Frequência mínima\", type: \"slider\", key: \"frequenciaMinima\", min: 0, max: 1, step: 0.05 },\r\n      ],\r\n      \"condition:pattern\": [\r\n        { label: \"Sequência\", type: \"array\", key: \"sequencia\" },\r\n        { label: \"Modo\", type: \"select\", key: \"modo\", options: [\"exato\", \"parcial\"] },\r\n      ],\r\n      logic: [\r\n        { label: \"Operador\", type: \"select\", key: \"operador\", options: [\"AND\", \"OR\", \"NOT\"] },\r\n      ],\r\n      signal: [\r\n        { label: \"Ação\", type: \"select\", key: \"acao\", options: [\"emitir_sinal\", \"notificar\", \"apostar\"] },\r\n        { label: \"Mensagem\", type: \"text\", key: \"mensagem\" },\r\n        { label: \"Prioridade\", type: \"select\", key: \"prioridade\", options: [\"normal\", \"alta\", \"baixa\"] },\r\n      ],\r\n    },\r\n  },\r\n}\r\n\r\ntype NodeType = \"trigger\" | \"condition\" | \"logic\" | \"signal\"\r\ntype ConditionSubtype = \"repetition\" | \"absence\" | \"trend\" | \"pattern\" | \"break\" | \"neighbors\"\r\n\r\ntype StrategyNode = {\r\n  id: string\r\n  type: NodeType\r\n  subtype?: ConditionSubtype\r\n  data: { label: string; config: Record<string, any> }\r\n}\r\n\r\ntype Strategy = {\r\n  id: string\r\n  name: string\r\n  status: \"active\" | \"paused\" | \"draft\" | \"testing\"\r\n  nodes: StrategyNode[]\r\n}\r\n\r\nfunction rid() {\r\n  // Gera um id simples\r\n  if (typeof crypto !== \"undefined\" && \"randomUUID\" in crypto) return crypto.randomUUID()\r\n  return Math.random().toString(36).slice(2)\r\n}\r\n\r\nexport default function BuilderTestPage() {\r\n  const [activeTab, setActiveTab] = useState(pageConfig.tabs[0])\r\n  const [isBuilderOpen, setBuilderOpen] = useState(false)\r\n  const [strategy, setStrategy] = useState<Strategy | null>(null)\r\n  const [selectedNodeId, setSelectedNodeId] = useState<string | null>(null)\r\n\r\n  const nodeTemplates = useMemo(() => {\r\n    return pageConfig.builder.toolbox.categories.flatMap((cat) =>\r\n      cat.nodes.map((n) => ({ ...n, category: cat.name }))\r\n    )\r\n  }, [])\r\n\r\n  const selectedNode = useMemo(\r\n    () => strategy?.nodes.find((n) => n.id === selectedNodeId) || null,\r\n    [strategy, selectedNodeId]\r\n  )\r\n\r\n  function createNewStrategy() {\r\n    setStrategy({ id: rid(), name: \"Nova Estratégia\", status: \"draft\", nodes: [] })\r\n    setSelectedNodeId(null)\r\n    setBuilderOpen(true)\r\n  }\r\n\r\n  function addNode(tpl: any) {\r\n    if (!strategy) return\r\n    const node: StrategyNode = {\r\n      id: rid(),\r\n      type: tpl.type,\r\n      subtype: tpl.subtype,\r\n      data: { label: tpl.label, config: { ...(tpl.defaultConfig || {}) } },\r\n    }\r\n    setStrategy({ ...strategy, nodes: [...strategy.nodes, node] })\r\n    setSelectedNodeId(node.id)\r\n  }\r\n\r\n  function updateNode(id: string, changes: Partial<StrategyNode>) {\r\n    if (!strategy) return\r\n    setStrategy({\r\n      ...strategy,\r\n      nodes: strategy.nodes.map((n) => (n.id === id ? { ...n, ...changes, data: { ...n.data, ...(changes.data || {}) } } : n)),\r\n    })\r\n  }\r\n\r\n  function testStrategy() {\r\n    console.log(\"Teste de estratégia\", strategy)\r\n    alert(\"Teste disparado. Veja console para detalhes.\")\r\n  }\r\n\r\n  function saveStrategy() {\r\n    if (!strategy) return\r\n    try {\r\n      const key = \"builder-test-strategies\"\r\n      const existing = JSON.parse(localStorage.getItem(key) || \"[]\")\r\n      existing.push(strategy)\r\n      localStorage.setItem(key, JSON.stringify(existing))\r\n      alert(\"Estratégia salva (localStorage)\")\r\n      setBuilderOpen(false)\r\n    } catch (e) {\r\n      console.error(e)\r\n      alert(\"Falha ao salvar\")\r\n    }\r\n  }\r\n\r\n  const fields = useMemo(() => {\r\n    if (!selectedNode) return [] as any[]\r\n    const key = selectedNode.type === \"condition\" && selectedNode.subtype ? `condition:${selectedNode.subtype}` : selectedNode.type\r\n    return (pageConfig.builder.fieldsByType as any)[key] || []\r\n  }, [selectedNode])\r\n\r\n  return (\r\n    <div className=\"p-6 space-y-4\">\r\n      <header className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h1 className=\"text-xl font-semibold\">{pageConfig.title}</h1>\r\n          <p className=\"text-sm text-gray-600\">{pageConfig.description}</p>\r\n        </div>\r\n        <button\r\n          className=\"px-3 py-2 rounded bg-blue-600 text-white\"\r\n          onClick={createNewStrategy}\r\n        >\r\n          Nova Estratégia\r\n        </button>\r\n      </header>\r\n\r\n      <nav className=\"flex gap-2 border-b pb-2\">\r\n        {pageConfig.tabs.map((tab) => (\r\n          <button\r\n            key={tab}\r\n            className={`px-3 py-1 rounded ${activeTab === tab ? \"bg-gray-200\" : \"hover:bg-gray-100\"}`}\r\n            onClick={() => setActiveTab(tab)}\r\n          >\r\n            {tab}\r\n          </button>\r\n        ))}\r\n      </nav>\r\n\r\n      <section>\r\n        {activeTab === \"Estratégias\" && (\r\n          <div className=\"space-y-2\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <span className=\"font-medium\">Lista de Estratégias (placeholder)</span>\r\n              <div className=\"flex gap-2 text-sm\">\r\n                <button className=\"px-2 py-1 rounded border\">Editar</button>\r\n                <button className=\"px-2 py-1 rounded border\">Excluir</button>\r\n                <button className=\"px-2 py-1 rounded border\">Ativar</button>\r\n              </div>\r\n            </div>\r\n            <div className=\"rounded border p-3 text-sm text-gray-600\">Nenhuma estratégia carregada. Use \"Nova Estratégia\".</div>\r\n          </div>\r\n        )}\r\n        {activeTab === \"Templates\" && (\r\n          <div className=\"space-y-2\">\r\n            <span className=\"font-medium\">Templates disponíveis</span>\r\n            <div className=\"grid grid-cols-2 gap-2\">\r\n              {nodeTemplates.map((tpl: any) => (\r\n                <div key={tpl.label} className=\"rounded border p-2\">\r\n                  <div className=\"text-sm font-medium\">{tpl.label}</div>\r\n                  <div className=\"text-xs text-gray-600\">{tpl.category}</div>\r\n                  <button className=\"mt-2 px-2 py-1 rounded bg-gray-100\" onClick={() => createNewStrategy()}>Usar template</button>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        )}\r\n        {activeTab === \"Performance\" && (\r\n          <div className=\"space-y-2\">\r\n            <span className=\"font-medium\">Métricas (placeholder)</span>\r\n            <div className=\"rounded border p-3 text-sm text-gray-600\">KPIs e top estratégias aqui.</div>\r\n          </div>\r\n        )}\r\n      </section>\r\n\r\n      {isBuilderOpen && strategy && (\r\n        <div className=\"fixed inset-0 bg-black/30 flex items-center justify-center\">\r\n          <div className=\"bg-white w-[95vw] h-[85vh] rounded shadow flex flex-col\">\r\n            <div className=\"p-3 border-b flex items-center justify-between\">\r\n              <div className=\"font-medium\">Builder: {strategy.name}</div>\r\n              <button className=\"text-sm px-2 py-1 rounded border\" onClick={() => setBuilderOpen(false)}>Fechar</button>\r\n            </div>\r\n            <div className=\"flex flex-1 overflow-hidden\">\r\n              {/* Toolbox */}\r\n              <div className=\"w-64 border-r p-3 overflow-auto\">\r\n                <div className=\"font-medium mb-2\">Componentes</div>\r\n                {pageConfig.builder.toolbox.categories.map((cat) => (\r\n                  <div key={cat.name} className=\"mb-4\">\r\n                    <div className=\"text-sm font-semibold\">{cat.name}</div>\r\n                    <div className=\"mt-2 space-y-2\">\r\n                      {cat.nodes.map((n) => (\r\n                        <button\r\n                          key={n.label}\r\n                          className=\"w-full text-left px-2 py-1 rounded border hover:bg-gray-50\"\r\n                          onClick={() => addNode(n)}\r\n                        >\r\n                          {n.label}\r\n                        </button>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n\r\n              {/* Canvas */}\r\n              <div className=\"flex-1 p-3 overflow-auto\">\r\n                <div className=\"text-sm text-gray-600\">Arraste componentes da Toolbox para começar a montar sua estratégia (aqui, clique para adicionar).</div>\r\n                <div className=\"grid grid-cols-2 md:grid-cols-3 gap-2 mt-3\">\r\n                  {strategy.nodes.map((n) => (\r\n                    <div key={n.id} className={`rounded border p-2 cursor-pointer ${selectedNodeId === n.id ? \"border-blue-600\" : \"\"}`} onClick={() => setSelectedNodeId(n.id)}>\r\n                      <div className=\"text-sm font-medium\">{n.data.label}</div>\r\n                      <div className=\"text-xs text-gray-600\">{n.type}{n.subtype ? `:${n.subtype}` : \"\"}</div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Properties */}\r\n              <div className=\"w-80 border-l p-3 overflow-auto\">\r\n                <div className=\"font-medium\">Propriedades do Nó</div>\r\n                {!selectedNode && (\r\n                  <div className=\"text-sm text-gray-600 mt-2\">Selecione um nó no canvas.</div>\r\n                )}\r\n                {selectedNode && (\r\n                  <div className=\"mt-2 space-y-3\">\r\n                    <div>\r\n                      <div className=\"text-xs text-gray-600\">Tipo</div>\r\n                      <div className=\"text-sm\">{selectedNode.type}{selectedNode.subtype ? `:${selectedNode.subtype}` : \"\"}</div>\r\n                    </div>\r\n                    {fields.map((f: any) => (\r\n                      <div key={f.key} className=\"space-y-1\">\r\n                        <label className=\"text-xs\">{f.label}</label>\r\n                        {f.type === \"number\" && (\r\n                          <input\r\n                            type=\"number\"\r\n                            className=\"w-full border rounded px-2 py-1 text-sm\"\r\n                            value={Number(selectedNode.data.config[f.key] ?? 0)}\r\n                            onChange={(e) => updateNode(selectedNode.id, { data: { config: { ...selectedNode.data.config, [f.key]: Number(e.target.value) } } } as any)}\r\n                          />\r\n                        )}\r\n                        {f.type === \"text\" && (\r\n                          <input\r\n                            type=\"text\"\r\n                            className=\"w-full border rounded px-2 py-1 text-sm\"\r\n                            value={String(selectedNode.data.config[f.key] ?? \"\")}\r\n                            onChange={(e) => updateNode(selectedNode.id, { data: { config: { ...selectedNode.data.config, [f.key]: e.target.value } } } as any)}\r\n                          />\r\n                        )}\r\n                        {f.type === \"select\" && (\r\n                          <select\r\n                            className=\"w-full border rounded px-2 py-1 text-sm\"\r\n                            value={String(selectedNode.data.config[f.key] ?? \"\")}\r\n                            onChange={(e) => updateNode(selectedNode.id, { data: { config: { ...selectedNode.data.config, [f.key]: e.target.value } } } as any)}\r\n                          >\r\n                            {(f.options || []).map((opt: any) => (\r\n                              <option key={opt} value={opt}>{opt}</option>\r\n                            ))}\r\n                          </select>\r\n                        )}\r\n                        {f.type === \"slider\" && (\r\n                          <input\r\n                            type=\"range\"\r\n                            className=\"w-full\"\r\n                            min={f.min}\r\n                            max={f.max}\r\n                            step={f.step}\r\n                            value={Number(selectedNode.data.config[f.key] ?? 0)}\r\n                            onChange={(e) => updateNode(selectedNode.id, { data: { config: { ...selectedNode.data.config, [f.key]: Number(e.target.value) } } } as any)}\r\n                          />\r\n                        )}\r\n                        {f.type === \"array\" && (\r\n                          <input\r\n                            type=\"text\"\r\n                            className=\"w-full border rounded px-2 py-1 text-sm\"\r\n                            value={(selectedNode.data.config[f.key] || []).join(\", \")}\r\n                            onChange={(e) => updateNode(selectedNode.id, { data: { config: { ...selectedNode.data.config, [f.key]: e.target.value.split(\",\").map(s => s.trim()) } } } as any)}\r\n                          />\r\n                        )}\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"p-3 border-t flex items-center gap-2 justify-end\">\r\n              <button className=\"px-3 py-2 rounded border\" onClick={testStrategy}>Testar Estratégia</button>\r\n              <button className=\"px-3 py-2 rounded bg-green-600 text-white\" onClick={saveStrategy}>Salvar</button>\r\n              <button className=\"px-3 py-2 rounded border\" onClick={() => setBuilderOpen(false)}>Cancelar</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/builder/page-backup-custom-canvas.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/builder/page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'deleteNode'. Either include it or remove the dependency array.","line":367,"column":6,"nodeType":"ArrayExpression","endLine":367,"endColumn":36,"suggestions":[{"desc":"Update the dependencies array to be: [selectedNode, selectedEdgeId, deleteNode]","fix":{"range":[18699,18729],"text":"[selectedNode, selectedEdgeId, deleteNode]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'edgeColor'. Either include it or remove the dependency array.","line":1515,"column":6,"nodeType":"ArrayExpression","endLine":1515,"endColumn":35,"suggestions":[{"desc":"Update the dependencies array to be: [connections, edgeColor, selectedEdgeId]","fix":{"range":[67752,67781],"text":"[connections, edgeColor, selectedEdgeId]"}}]},{"ruleId":"react/no-unescaped-entities","severity":1,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":1953,"column":53,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[91358,91460],"text":"MVP: ação = &quot;Emitir Sinal\"; a seleção de números é opcional e serve para visualização/futuras apostas."},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[91358,91460],"text":"MVP: ação = &ldquo;Emitir Sinal\"; a seleção de números é opcional e serve para visualização/futuras apostas."},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[91358,91460],"text":"MVP: ação = &#34;Emitir Sinal\"; a seleção de números é opcional e serve para visualização/futuras apostas."},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[91358,91460],"text":"MVP: ação = &rdquo;Emitir Sinal\"; a seleção de números é opcional e serve para visualização/futuras apostas."},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":1,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":1953,"column":66,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[91358,91460],"text":"MVP: ação = \"Emitir Sinal&quot;; a seleção de números é opcional e serve para visualização/futuras apostas."},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[91358,91460],"text":"MVP: ação = \"Emitir Sinal&ldquo;; a seleção de números é opcional e serve para visualização/futuras apostas."},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[91358,91460],"text":"MVP: ação = \"Emitir Sinal&#34;; a seleção de números é opcional e serve para visualização/futuras apostas."},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[91358,91460],"text":"MVP: ação = \"Emitir Sinal&rdquo;; a seleção de números é opcional e serve para visualização/futuras apostas."},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":1,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":2698,"column":135,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[129873,130062],"text":"\r\n                              Escolha um tipo para ver campos específicos. Se importou de JSON e o tipo não foi reconhecido, mantenha &quot;Genérico (importado)\".\r\n                            "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[129873,130062],"text":"\r\n                              Escolha um tipo para ver campos específicos. Se importou de JSON e o tipo não foi reconhecido, mantenha &ldquo;Genérico (importado)\".\r\n                            "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[129873,130062],"text":"\r\n                              Escolha um tipo para ver campos específicos. Se importou de JSON e o tipo não foi reconhecido, mantenha &#34;Genérico (importado)\".\r\n                            "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[129873,130062],"text":"\r\n                              Escolha um tipo para ver campos específicos. Se importou de JSON e o tipo não foi reconhecido, mantenha &rdquo;Genérico (importado)\".\r\n                            "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":1,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":2698,"column":156,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[129873,130062],"text":"\r\n                              Escolha um tipo para ver campos específicos. Se importou de JSON e o tipo não foi reconhecido, mantenha \"Genérico (importado)&quot;.\r\n                            "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[129873,130062],"text":"\r\n                              Escolha um tipo para ver campos específicos. Se importou de JSON e o tipo não foi reconhecido, mantenha \"Genérico (importado)&ldquo;.\r\n                            "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[129873,130062],"text":"\r\n                              Escolha um tipo para ver campos específicos. Se importou de JSON e o tipo não foi reconhecido, mantenha \"Genérico (importado)&#34;.\r\n                            "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[129873,130062],"text":"\r\n                              Escolha um tipo para ver campos específicos. Se importou de JSON e o tipo não foi reconhecido, mantenha \"Genérico (importado)&rdquo;.\r\n                            "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport React, { useState, useMemo, useRef, useCallback, useEffect } from 'react'\r\nimport { DashboardLayout } from '@/components/dashboard/layout'\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Input } from '@/components/ui/input'\r\nimport { Badge } from '@/components/ui/badge'\r\nimport { Label } from '@/components/ui/label'\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'\r\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from '@/components/ui/dialog'\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'\r\nimport { Separator } from '@/components/ui/separator'\r\nimport { ScrollArea } from '@/components/ui/scroll-area'\r\nimport { Slider } from '@/components/ui/slider'\r\nimport { Textarea } from '@/components/ui/textarea'\r\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '@/components/ui/tooltip'\r\nimport { Accordion, AccordionItem, AccordionTrigger, AccordionContent } from '@/components/ui/accordion'\r\nimport { Collapsible, CollapsibleTrigger, CollapsibleContent } from '@/components/ui/collapsible'\r\nimport { Switch } from '@/components/ui/switch'\r\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger, DropdownMenuSeparator } from '@/components/ui/dropdown-menu'\r\n  import { Play, Save, RotateCcw, Layers, Trash2, Puzzle, X, Info, CheckCircle, XCircle, AlertTriangle, Download, ChevronRight, MoreVertical, Edit3 } from 'lucide-react'\r\n  import { AlertDialog, AlertDialogContent, AlertDialogHeader, AlertDialogTitle, AlertDialogDescription, AlertDialogFooter, AlertDialogCancel, AlertDialogAction } from '@/components/ui/alert-dialog'\r\nimport { toast } from 'sonner'\r\nimport { builderSpec, CURRENT_SCHEMA_VERSION } from '../config/builderSpec'\r\nimport ReactFlow, { Background, Controls, MiniMap, MarkerType, Connection as RFConnection, Edge as RFEdge, Node as RFNode } from 'reactflow'\r\nimport { parseHistoryInput, evaluateConditionNode, evaluateLogicNode } from '../lib/strategySemantics'\r\nimport { compileBuilderToJS } from '../../lib/builder-compiler'\r\nimport { useFeatureFlag, FEATURE_FLAGS } from '@/lib/feature-flags'\r\nimport { useAuth } from '@/contexts/auth-context'\r\nimport { useUserStatus } from '@/hooks/useUserStatus'\r\nimport { useUpgrade } from '@/contexts/upgrade-context'\r\n\r\ntype NodeType = 'trigger' | 'condition' | 'logic' | 'signal'\r\n\r\ninterface StrategyNode {\r\n  id: string\r\n  type: NodeType\r\n  subtype?: string\r\n  position: { x: number; y: number }\r\n  data: {\r\n    label: string\r\n    conditionType?: string\r\n    config: Record<string, any>\r\n  }\r\n}\r\n\r\ninterface Connection {\r\n  id: string\r\n  source: string\r\n  target: string\r\n  type: 'success' | 'failure' | 'condition'\r\n}\r\n\r\ninterface TemplateGraph {\r\n  schemaVersion: string\r\n  nodes: StrategyNode[]\r\n  connections: Connection[]\r\n  selectionMode?: 'automatic' | 'hybrid' | 'manual'\r\n  gating?: { enabled: boolean } | undefined\r\n}\r\n\r\ninterface StrategyTemplateFile {\r\n  type: 'sofia_strategy_template'\r\n  schemaVersion: string\r\n  templateId?: string\r\n  name: string\r\n  description?: string\r\n  author?: {\r\n    displayName: string\r\n    contact?: string\r\n  }\r\n  tags?: string[]\r\n  metadata?: Record<string, any>\r\n  graph: TemplateGraph\r\n  createdAt?: string\r\n  updatedAt?: string\r\n}\r\n\r\n// Ajuda contextual para campos genéricos\r\nconst FIELD_HELP: Record<string, { label?: string; description: string; example?: string }> = {\r\n  allowedPairs: { label: 'Pares permitidos', description: 'Lista de pares que contam como padrão de espelho.', example: '12,21,13,31,23,32' },\r\n  allowConsecutive: { label: 'Permitir consecutivos', description: 'Aceita pares iguais em sequência sem intervalo.', example: 'true' },\r\n  allowSequence: { label: 'Permitir sequência', description: 'Aceita que os pares formem uma sequência ordenada.', example: 'true' },\r\n  allowAlternating: { label: 'Permitir alternância', description: 'Aceita padrão alternando entre dois pares.', example: 'true' },\r\n  minMultipleCount: { label: 'Múltiplos mínimos', description: 'Quantidade mínima de vezes que o padrão deve aparecer.', example: '2' },\r\n  minStrength: { label: 'Força mínima', description: 'Pontuação mínima para considerar o padrão presente.', example: '3' },\r\n  window: { label: 'Janela', description: 'Quantidade de rodadas analisadas.', example: '5' },\r\n  janela: { label: 'Janela de análise', description: 'Quantidade de rodadas consideradas antes de avaliar a estratégia.', example: '30' },\r\n  operador: { label: 'Operador lógico', description: 'Combina condições: AND (todas), OR (uma), NOT (inverte).', example: 'AND' },\r\n  acao: { label: 'Ação', description: 'O que fazer quando a condição é satisfeita.', example: 'emitir_sinal' },\r\n  mensagem: { label: 'Mensagem', description: 'Texto mostrado quando o sinal é emitido.', example: 'Condição satisfeita' },\r\n  prioridade: { label: 'Prioridade', description: 'Importância do sinal para ordenação/envio.', example: 'alta' },\r\n  numeroAlvo: { label: 'Número alvo', description: 'Aceita valores de 0 a 36. Deixe vazio para considerar qualquer número.', example: '17' },\r\n  modo: { label: 'Modo', description: \"Define a regra: 'ocorreu' busca presença no histórico; 'ausente' valida ausência nas últimas N rodadas.\", example: 'ocorreu' },\r\n  numero: { label: 'Número', description: 'Escolha de 0 a 36; usado em Número Específico e como alvo quando evento = número.', example: '12' },\r\n  eixo: { label: 'Eixo', description: 'Dimensão de alternância: cor (vermelho/preto) ou paridade (par/ímpar).', example: 'cor' },\r\n  comprimento: { label: 'Comprimento', description: 'Quantidade de rodadas consecutivas que devem alternar sem interrupções.', example: '4' },\r\n  raio: { label: 'Raio', description: 'Distância circular na roda europeia; mede vizinhos em ambos os lados do número base seguindo a ordem do cilindro.', example: '2' },\r\n  numeros: { label: 'Números (lista)', description: 'Lista de números da roleta. Valores fora de 0–36 serão ignorados.', example: '0, 12, 23, 34' },\r\n  sequencia: { label: 'Sequência', description: 'Sequência de números analisada em ordem. Use vírgulas ou espaços; somente 0–36.', example: '5 9 14 21' },\r\n  includeZero: { label: 'Incluir Zero', description: 'Inclui o 0 nas verificações de vizinhos e setor quando habilitado.', example: 'true' },\r\n  frequenciaMinima: { label: 'Frequência mínima', description: 'Limite mínimo para considerar uma tendência, setor ou grupo \"quente\". Em algumas condições é proporção (0–1); em outras é contagem.', example: '0.7' },\r\n  inicio: { label: 'Início', description: 'Tamanho mínimo do histórico para ativar a condição de janela temporal.', example: '10' },\r\n  fim: { label: 'Fim', description: 'Tamanho máximo do histórico para ativar a condição de janela temporal.', example: '50' },\r\n  setor: { label: 'Setor', description: 'Setor da roleta europeia: Voisins, Tiers ou Orphelins.', example: 'Voisins' }\r\n}\r\n\r\n// Rótulos em português para selects, mantendo valores internos originais\r\nconst SELECT_LABELS_PT: Record<string, Record<string, string>> = {\r\n  selectionMode: { automatic: 'automático', hybrid: 'híbrido', manual: 'manual' },\r\n  operador: { AND: 'E', OR: 'OU', NOT: 'NÃO' },\r\n  acao: { emitir_sinal: 'emitir sinal' },\r\n  prioridade: { normal: 'normal' }\r\n}\r\n\r\n// Mapeamento de cores reais da roleta europeia\r\nconst RED_NUMBERS = [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36]\r\nconst BLACK_NUMBERS = [2,4,6,8,10,11,13,15,17,20,22,24,26,28,29,31,33,35]\r\nconst GREEN_NUMBERS = [0]\r\n\r\nfunction inferConditionSubtype(n: any): string | undefined {\r\n  const t = (n.type || 'condition')\r\n  if (t !== 'condition') return undefined\r\n  const label = String(n?.data?.label || n?.label || '').toLowerCase()\r\n  const cfg = n?.data?.config || n?.config || {}\r\n  if (typeof cfg.numero === 'number' && typeof cfg.modo === 'string') return 'specific-number'\r\n  if (typeof cfg.numero === 'number' && typeof cfg.ocorrencias === 'number') return 'repeat-number'\r\n  if (Array.isArray(cfg.sequencia)) return cfg.modo ? 'pattern' : 'sequence'\r\n  if (label.includes('espelho') || label.includes('mirror') || cfg.allowedPairs) return 'pattern'\r\n  if (label.includes('irmão') || label.includes('siblings')) return 'neighbors'\r\n  if (label.includes('janela')) return 'time-window'\r\n  return undefined\r\n}\r\n\r\nfunction getConditionValidationMessages(n: StrategyNode): string[] {\r\n  if (!n || n.type !== 'condition') return []\r\n  const subtype = String(n.subtype || n.data.conditionType || '').toLowerCase()\r\n  const cfg = n.data?.config || {}\r\n  const msgs: string[] = []\r\n  const isValidNumber = (x: any) => typeof x === 'number' && x >= 0 && x <= 36\r\n  if (subtype.includes('specific-number')) {\r\n    if (!isValidNumber(cfg.numero)) msgs.push('Defina um número válido (0–36).')\r\n  }\r\n  if (subtype.includes('repeat-number')) {\r\n    if (!isValidNumber(cfg.numero)) msgs.push('Número base ausente (0–36).')\r\n    if (typeof cfg.ocorrencias !== 'number' || cfg.ocorrencias <= 0) msgs.push('Informe ocorrências (>0).')\r\n  }\r\n  if (subtype.includes('neighbors')) {\r\n    if (!isValidNumber(cfg.numero)) msgs.push('Número base inválido (0–36).')\r\n    if (typeof cfg.raio !== 'number' || cfg.raio <= 0) msgs.push('Raio deve ser >= 1.')\r\n  }\r\n  if (subtype.includes('pattern')) {\r\n    const hasPairs = Array.isArray(cfg.allowedPairs) ? cfg.allowedPairs.length > 0 : !!cfg.allowedPairs\r\n    const hasSeq = Array.isArray(cfg.sequencia) ? cfg.sequencia.length > 1 : false\r\n    if (!hasPairs && !hasSeq) msgs.push('Defina pares ou uma sequência para o padrão.')\r\n  }\r\n  if (subtype.includes('sequence')) {\r\n    if (!Array.isArray(cfg.sequencia) || cfg.sequencia.length < 2) msgs.push('Sequência deve ter ao menos 2 elementos.')\r\n  }\r\n  if (subtype.includes('window')) {\r\n    const w = cfg.janela ?? cfg.window\r\n    if (typeof w !== 'number' || w <= 0) msgs.push('Janela deve ser um número > 0.')\r\n  }\r\n  return msgs\r\n}\r\n\r\nexport default function BuilderPage() {\r\n  const { user } = useAuth()\r\n  const { userProfile, loading } = useUserStatus(user?.id)\r\n  const { openUpgradeModal } = useUpgrade()\r\n\r\n  useEffect(() => {\r\n    if (!loading && userProfile) {\r\n      // Check new fields\r\n      const isPro = \r\n        (userProfile.plan === 'pro') || \r\n        (userProfile.role === 'admin' || userProfile.role === 'superadmin')\r\n        \r\n      if (!isPro) {\r\n        openUpgradeModal('Builder de Estratégias')\r\n      }\r\n    }\r\n  }, [loading, userProfile, openUpgradeModal])\r\n\r\n  const [activeTab, setActiveTab] = useState('estratégias')\r\n  const [isBuilderOpen, setIsBuilderOpen] = useState(false)\r\n  const [draftStrategyName, setDraftStrategyName] = useState('')\r\n\r\n\r\n  const [nodes, setNodes] = useState<StrategyNode[]>([])\r\n  const [connections, setConnections] = useState<Connection[]>([])\r\n  const [selectedNode, setSelectedNode] = useState<StrategyNode | null>(null)\r\n  const [selectedEdgeId, setSelectedEdgeId] = useState<string | null>(null)\r\n  const [draggedTpl, setDraggedTpl] = useState<{\r\n    type: NodeType\r\n    subtype?: string\r\n    label: string\r\n    defaultConfig?: Record<string, any>\r\n  } | null>(null)\r\n\r\n  const [strategies, setStrategies] = useState<Array<{ id: string; name: string; description?: string; status: 'active' | 'paused'; nodes: StrategyNode[]; connections: Connection[]; createdAt: number; updatedAt: number; selectionMode?: 'automatic' | 'hybrid' | 'manual'; gating?: { enabled: boolean } }>>([])\r\n  const [currentStrategyId, setCurrentStrategyId] = useState<string | null>(null)\r\n  const [currentTemplateId, setCurrentTemplateId] = useState<string | null>(null)\r\n  const [confirmDeleteId, setConfirmDeleteId] = useState<string | null>(null)\r\n  const [templates, setTemplates] = useState<any[]>([])\r\n  const [templateQuery, setTemplateQuery] = useState('')\r\n\r\n  const canvasRef = useRef<HTMLDivElement | null>(null)\r\n  const importInputRef = useRef<HTMLInputElement | null>(null)\r\n  const nodeRefs = useRef<Record<string, HTMLDivElement | null>>({})\r\n  const builderRef = useRef<HTMLDivElement | null>(null)\r\n  const [isTesting, setIsTesting] = useState(false)\r\n  const [isTestReportOpen, setIsTestReportOpen] = useState(false)\r\nconst [testReport, setTestReport] = useState<{ errors: string[]; logs: Array<{ step: number; nodeId: string; label: string; action: string }>; results: Array<{ nodeId: string; label: string; type: NodeType; subtype?: string; pass?: boolean }>; signals: Array<{ nodeId: string; label: string; acao: string; mensagem?: string; prioridade?: string }>; summary: { visited: number; totalNodes: number; totalConnections: number; durationMs: number; source?: string; sampleSize?: number; effectiveWindow?: number }; resolver?: { mode: string; derivedNumbers: number[]; telemetry: any; gated?: boolean; gateReasons?: string[] }; compiled?: { activation: any; signal: any } }>({\r\n    errors: [],\r\n    logs: [],\r\n    results: [],\r\n    signals: [],\r\n    summary: { visited: 0, totalNodes: 0, totalConnections: 0, durationMs: 0 }\r\n  })\r\n  const [isFullscreen, setIsFullscreen] = useState(false)\r\n  const [simulatedHistoryInput, setSimulatedHistoryInput] = useState('')\r\n  const [serverToken, setServerToken] = useState('')\r\n  const [validationSignalId, setValidationSignalId] = useState<string>('')\r\n  const [validationResult, setValidationResult] = useState<'hit' | 'miss'>('miss')\r\n  const [validationWinningNumber, setValidationWinningNumber] = useState<number | ''>('')\r\n  const [validationNetPayout, setValidationNetPayout] = useState<number | ''>('')\r\n  const [serverValidationResponse, setServerValidationResponse] = useState<any>(null)\r\n  const [isValidatingServer, setIsValidatingServer] = useState(false)\r\n  const [selectionMode, setSelectionMode] = useState<'automatic' | 'hybrid' | 'manual'>('automatic')\r\n  const [gatingEnabled, setGatingEnabled] = useState<boolean>(false)\r\n  const [historySource, setHistorySource] = useState<'manual' | 'real'>('manual')\r\n  // Estado de saúde do backend\r\n  const [backendHealth, setBackendHealth] = useState<{ status: 'healthy' | 'degraded' | 'unhealthy'; metrics?: { responseTime?: number }; services?: any } | null>(null)\r\n  const [isHealthLoading, setIsHealthLoading] = useState<boolean>(false)\r\n  const [realHistoryLimit, setRealHistoryLimit] = useState<number>(60)\r\n\r\n  // Carregar preferências do Builder na inicialização\r\n  useEffect(() => {\r\n    try {\r\n      const saved = localStorage.getItem('builder-preferences')\r\n      if (saved) {\r\n        const prefs = JSON.parse(saved)\r\n        if (prefs && typeof prefs === 'object') {\r\n          if (['automatic', 'hybrid', 'manual'].includes(prefs.selectionMode)) {\r\n            setSelectionMode(prefs.selectionMode)\r\n          }\r\n          if (typeof prefs.gatingEnabled === 'boolean') {\r\n            setGatingEnabled(prefs.gatingEnabled)\r\n          }\r\n          if (typeof prefs.realHistoryLimit === 'number') {\r\n            setRealHistoryLimit(Math.max(1, Math.min(500, prefs.realHistoryLimit)))\r\n          }\r\n          if (prefs.historySource === 'manual' || prefs.historySource === 'real') {\r\n            setHistorySource(prefs.historySource)\r\n          }\r\n        }\r\n      }\r\n    } catch {}\r\n  }, [])\r\n\r\n  // Persistir preferências do Builder ao alterar\r\n  useEffect(() => {\r\n    try {\r\n      const prefs = {\r\n        selectionMode,\r\n        gatingEnabled,\r\n        realHistoryLimit,\r\n        historySource,\r\n      }\r\n      localStorage.setItem('builder-preferences', JSON.stringify(prefs))\r\n    } catch {}\r\n  }, [selectionMode, gatingEnabled, realHistoryLimit, historySource])\r\n\r\n  useEffect(() => {\r\n    const handler = () => setIsFullscreen(Boolean(document.fullscreenElement))\r\n    document.addEventListener('fullscreenchange', handler)\r\n    return () => document.removeEventListener('fullscreenchange', handler)\r\n  }, [])\r\n\r\n  // Carrega estratÃ©gias do servidor ao iniciar\r\n  useEffect(() => {\r\n    refreshStrategies()\r\n  }, [])\r\n\r\n  // Busca saúde do backend ao abrir o Builder e atualiza a cada 60s\r\n  useEffect(() => {\r\n    let intervalId: any = null\r\n    if (isBuilderOpen) {\r\n      refreshBackendHealth()\r\n      intervalId = setInterval(refreshBackendHealth, 60000)\r\n    }\r\n    return () => {\r\n      if (intervalId) clearInterval(intervalId)\r\n    }\r\n  }, [isBuilderOpen])\r\n\r\n  async function refreshBackendHealth() {\r\n    try {\r\n      setIsHealthLoading(true)\r\n      const resp = await fetch('/api/system/health', {\r\n        method: 'GET',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        cache: 'no-store'\r\n      })\r\n      const data = await resp.json().catch(() => ({}))\r\n      if (resp.ok) {\r\n        setBackendHealth({ status: data.status || 'healthy', metrics: data.metrics, services: data.services })\r\n      } else {\r\n        setBackendHealth({ status: 'unhealthy' })\r\n      }\r\n    } catch (e) {\r\n      setBackendHealth({ status: 'unhealthy' })\r\n    } finally {\r\n      setIsHealthLoading(false)\r\n    }\r\n  }\r\n\r\n  // Revalidate automático: foco/visibilidade/online/intervalo\r\n  useEffect(() => {\r\n    let lastCall = 0\r\n    const minIntervalMs = 15000\r\n    const safeRefresh = () => {\r\n      const now = Date.now()\r\n      if (now - lastCall < minIntervalMs) return\r\n      lastCall = now\r\n      refreshStrategies()\r\n    }\r\n\r\n    const onFocus = () => safeRefresh()\r\n    const onVisibility = () => {\r\n      if (document.visibilityState === 'visible') safeRefresh()\r\n    }\r\n    const onOnline = () => safeRefresh()\r\n\r\n    window.addEventListener('focus', onFocus)\r\n    document.addEventListener('visibilitychange', onVisibility)\r\n    window.addEventListener('online', onOnline)\r\n\r\n    const intervalId = setInterval(safeRefresh, 120000)\r\n\r\n    return () => {\r\n      window.removeEventListener('focus', onFocus)\r\n      document.removeEventListener('visibilitychange', onVisibility)\r\n      window.removeEventListener('online', onOnline)\r\n      clearInterval(intervalId)\r\n    }\r\n  }, [])\r\n\r\n  // Atalho para excluir nÃ³ ou conexÃ£o selecionada\r\n  useEffect(() => {\r\n    const onKeyDown = (e: KeyboardEvent) => {\r\n      const tag = (document.activeElement as HTMLElement)?.tagName?.toLowerCase()\r\n      if (tag === 'input' || tag === 'textarea') return\r\n      if (e.key === 'Delete' || e.key === 'Backspace') {\r\n        if (selectedNode) {\r\n          deleteNode(selectedNode.id)\r\n        } else if (selectedEdgeId) {\r\n          setConnections(prev => prev.filter(c => c.id !== selectedEdgeId))\r\n          setSelectedEdgeId(null)\r\n        }\r\n      }\r\n    }\r\n    window.addEventListener('keydown', onKeyDown)\r\n    return () => window.removeEventListener('keydown', onKeyDown)\r\n  }, [selectedNode, selectedEdgeId])\r\n\r\n  async function refreshStrategies() {\r\n    try {\r\n      const resp = await fetch('/api/strategies')\r\n      if (!resp.ok) {\r\n        const data = await resp.json().catch(() => ({}))\r\n        toast.message('Falha ao carregar do servidor.', { description: String((data as any)?.error || resp.statusText) })\r\n        return\r\n      }\r\n      const data = await resp.json()\r\n      const rawList = Array.isArray(data) ? data : (data?.strategies || [])\r\n      // Garanta que cada estratégia tenha arrays válidos para evitar crashes no render\r\n      const list = rawList.map((s: any) => ({\r\n        ...s,\r\n        nodes: Array.isArray(s?.nodes) ? s.nodes : (Array.isArray(s?.graph?.nodes) ? s.graph.nodes : []),\r\n        connections: Array.isArray(s?.connections) ? s.connections : (Array.isArray(s?.graph?.connections) ? s.graph.connections : [])\r\n      }))\r\n      setStrategies(list)\r\n      toast.success('Estratégias carregadas do servidor.')\r\n    } catch (e: any) {\r\n      toast.message('Erro de rede ao carregar estratégias.', { description: e?.message || String(e) })\r\n    }\r\n  }\r\n\r\n  async function refreshTemplates() {\r\n    try {\r\n      const resp = await fetch('/api/dynamic-strategies/templates', { cache: 'no-store' })\r\n      if (!resp.ok) {\r\n        const data = await resp.json().catch(() => ({}))\r\n        toast.message('Falha ao carregar templates.', { description: String((data as any)?.error || resp.statusText) })\r\n        return\r\n      }\r\n      const data = await resp.json()\r\n      const list = Array.isArray((data as any)?.templates) ? (data as any).templates : []\r\n      setTemplates(list)\r\n      toast.success('Templates carregados.')\r\n    } catch (e: any) {\r\n      toast.message('Erro de rede ao carregar templates.', { description: e?.message || String(e) })\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    refreshTemplates()\r\n  }, [])\r\n\r\n  function buildTemplateFileFromTemplate(tpl: any): StrategyTemplateFile {\r\n    const payload = tpl?.builder_payload || tpl\r\n    const rawNodes = Array.isArray(payload?.nodes) ? payload.nodes : []\r\n    const rawConnections = Array.isArray(payload?.connections) ? payload.connections : []\r\n    const nodes = normalizeNodes(rawNodes)\r\n    const connections = rawConnections.map((c: any, i: number) => ({\r\n      id: String(c?.id || `c_${Date.now()}_${i}`),\r\n      source: String(c?.source || ''),\r\n      target: String(c?.target || ''),\r\n      type: (c?.type as 'success' | 'failure' | 'condition') || 'success'\r\n    })).filter((c: Connection) => c.source && c.target)\r\n    const graph: TemplateGraph = {\r\n      schemaVersion: String(payload?.schemaVersion || payload?.schema_version || CURRENT_SCHEMA_VERSION),\r\n      nodes,\r\n      connections,\r\n      selectionMode: (payload as any)?.selectionMode,\r\n      gating: (payload as any)?.gating\r\n    }\r\n    const createdAt = tpl?.created_at || tpl?.createdAt\r\n    const updatedAt = tpl?.updated_at || tpl?.updatedAt\r\n    const file: StrategyTemplateFile = {\r\n      type: 'sofia_strategy_template',\r\n      schemaVersion: graph.schemaVersion,\r\n      templateId: tpl?.id ? String(tpl.id) : undefined,\r\n      name: String(tpl?.name || 'Template do Builder'),\r\n      description: typeof tpl?.description === 'string' ? tpl.description : undefined,\r\n      graph,\r\n      createdAt: createdAt ? new Date(createdAt).toISOString() : undefined,\r\n      updatedAt: updatedAt ? new Date(updatedAt).toISOString() : undefined\r\n    }\r\n    return file\r\n  }\r\n\r\n  const toggleFullscreen = useCallback(() => {\r\n    const el = builderRef.current || canvasRef.current\r\n    if (!el) return\r\n    if (!document.fullscreenElement) {\r\n      el.requestFullscreen?.().catch(() => { })\r\n    } else {\r\n      document.exitFullscreen?.()\r\n    }\r\n  }, [])\r\n\r\n  function exportStrategies() {\r\n    const payload = strategies.map(s => ({\r\n      id: s.id,\r\n      name: s.name,\r\n      description: s.description,\r\n      status: s.status,\r\n      graph: {\r\n        nodes: s.nodes.map(n => ({ id: n.id, type: n.type, subtype: n.subtype, data: n.data, position: n.position })),\r\n        connections: s.connections.map(c => ({ id: c.id, source: c.source, target: c.target, type: c.type }))\r\n      },\r\n      meta: { createdAt: s.createdAt, updatedAt: s.updatedAt }\r\n    }))\r\n    const json = JSON.stringify(payload, null, 2)\r\n    if (typeof navigator !== 'undefined' && (navigator as any).clipboard) {\r\n      ; (navigator as any).clipboard.writeText(json)\r\n        .then(() => toast.success('Exportado: JSON copiado para área de transferência'))\r\n        .catch(() => toast.error('Falha ao copiar JSON'))\r\n    } else {\r\n      toast.message('JSON:', { description: json })\r\n    }\r\n  }\r\n\r\n  function exportTemplateFile(tpl: any) {\r\n    try {\r\n      const file = buildTemplateFileFromTemplate(tpl)\r\n      const json = JSON.stringify(file, null, 2)\r\n      const blob = new Blob([json], { type: 'application/json' })\r\n      const url = URL.createObjectURL(blob)\r\n      const safeName = String(tpl?.name || 'template')\r\n        .toLowerCase()\r\n        .replace(/[^a-z0-9]+/g, '-')\r\n        .replace(/^-+|-+$/g, '')\r\n      const idPart = tpl?.id || tpl?.template_key || 'local'\r\n      const a = document.createElement('a')\r\n      a.href = url\r\n      a.download = `sofia-template-${safeName}-${idPart}.json`\r\n      document.body.appendChild(a)\r\n      a.click()\r\n      a.remove()\r\n      URL.revokeObjectURL(url)\r\n      toast.success('Template exportado como arquivo JSON')\r\n    } catch {\r\n      toast.error('Falha ao exportar template')\r\n    }\r\n  }\r\n\r\n  function exportStrategyFile(strategyId: string) {\r\n    const s = strategies.find(st => st.id === strategyId)\r\n    if (!s) return\r\n    const payload = {\r\n      id: s.id,\r\n      name: s.name,\r\n      description: s.description,\r\n      status: s.status,\r\n      graph: {\r\n        nodes: s.nodes.map(n => ({ id: n.id, type: n.type, subtype: n.subtype, data: n.data, position: n.position })),\r\n        connections: s.connections.map(c => ({ id: c.id, source: c.source, target: c.target, type: c.type }))\r\n      },\r\n      meta: { createdAt: s.createdAt, updatedAt: s.updatedAt }\r\n    }\r\n    const json = JSON.stringify(payload, null, 2)\r\n    const blob = new Blob([json], { type: 'application/json' })\r\n    const url = URL.createObjectURL(blob)\r\n    const safeName = (s.name || 'estrategia').toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-+|-+$/g, '')\r\n    const a = document.createElement('a')\r\n    a.href = url\r\n    a.download = `estrategia-${safeName}-${s.id}.json`\r\n    document.body.appendChild(a)\r\n    a.click()\r\n    a.remove()\r\n    URL.revokeObjectURL(url)\r\n    toast.success('Download iniciado')\r\n  }\r\n\r\n  async function handleImportFile(e: React.ChangeEvent<HTMLInputElement>) {\r\n    const file = e.target.files?.[0]\r\n    if (!file) return\r\n    try {\r\n      const text = await file.text()\r\n      const parsed = JSON.parse(text)\r\n      const list = (Array.isArray(parsed) ? parsed : [parsed]).map((p: any) => {\r\n        const id = p?.id || p?.templateId || `s_${Date.now()}_${Math.random().toString(36).slice(2, 6)}`\r\n        const rawNodes = ((p?.graph?.nodes ?? p?.nodes) ?? [])\r\n        const rawConns = ((p?.graph?.connections ?? p?.connections ?? p?.edges) ?? [])\r\n        const nodes = rawNodes.map((n: any, idx: number) => {\r\n          const type: NodeType = (n.type as NodeType) || 'condition'\r\n          const computedSubtype = n.subtype || inferConditionSubtype(n)\r\n          const position = n.position || { x: 40 + (idx % 4) * 160, y: 40 + Math.floor(idx / 4) * 120 }\r\n          const baseData = n.data ? { ...n.data } : { label: n.label || `${type || 'nó'} ${idx + 1}`, config: n.config || {} }\r\n          if (type === 'condition' && !baseData.conditionType) {\r\n            ;(baseData as any).conditionType = computedSubtype\r\n          }\r\n          return {\r\n            id: n.id || `n_${Date.now()}_${idx}_${Math.random().toString(36).slice(2, 6)}`,\r\n            type,\r\n            subtype: computedSubtype,\r\n            position,\r\n            data: baseData\r\n          }\r\n        })\r\n        const connections = rawConns.map((c: any, idx: number) => ({\r\n          id: c.id || `e_${Date.now()}_${idx}_${Math.random().toString(36).slice(2, 6)}`,\r\n          source: c.source,\r\n          target: c.target,\r\n          type: (c.type as 'success' | 'failure' | 'condition') || 'success'\r\n        }))\r\n        return {\r\n          id,\r\n          name: p.name,\r\n          description: p.description,\r\n          status: (p.status as 'active' | 'paused') ?? 'paused',\r\n          nodes,\r\n          connections,\r\n          createdAt: p?.meta?.createdAt ?? p?.createdAt ?? Date.now(),\r\n          updatedAt: p?.meta?.updatedAt ?? p?.updatedAt ?? Date.now(),\r\n          selectionMode: (p?.selectionMode as 'automatic' | 'hybrid' | 'manual') ?? (p?.graph?.selectionMode as 'automatic' | 'hybrid' | 'manual') ?? undefined,\r\n          gating: (p?.gating && typeof p.gating === 'object')\r\n            ? p.gating\r\n            : (p?.graph?.gating && typeof p.graph.gating === 'object')\r\n              ? p.graph.gating\r\n              : undefined,\r\n        }\r\n      })\r\n      setStrategies(list)\r\n      // Abrir automaticamente a primeira estratÃ©gia importada no canvas\r\n      if (list.length > 0) {\r\n        const first = list[0]\r\n        setCurrentStrategyId(first.id)\r\n        setNodes(normalizeNodes(first.nodes))\r\n        setConnections([...first.connections])\r\n        setSelectedNode(null)\r\n        setIsBuilderOpen(true)\r\n      }\r\n      toast.success('Importado com sucesso')\r\n    } catch (err) {\r\n      toast.error('Falha ao importar JSON')\r\n    } finally {\r\n      e.target.value = ''\r\n    }\r\n  }\r\n\r\n  const conditionTemplates = useMemo(() => (\r\n    builderSpec.builderModal.columns.toolbox.categories\r\n      .flatMap(c => c.nodes)\r\n      .filter(n => n.type === 'condition')\r\n  ), [])\r\n\r\n  function createNewStrategy() {\r\n    const id = `s_${Date.now()}_${Math.random().toString(36).slice(2, 6)}`\r\n    setCurrentStrategyId(id)\r\n    setCurrentTemplateId(null)\r\n    setNodes([])\r\n    setConnections([])\r\n    setSelectedNode(null)\r\n    setDraftStrategyName('')\r\n    setIsBuilderOpen(true)\r\n    toast.success('Rascunho iniciado. Adicione nós para montar sua estratégia.')\r\n  }\r\n\r\n  function duplicateTemplate(tpl: any) {\r\n    const id = `s_${Date.now()}_${Math.random().toString(36).slice(2, 6)}`\r\n    const payload = tpl?.builder_payload || tpl\r\n    const rawNodes = Array.isArray(payload?.nodes) ? payload.nodes : []\r\n    const rawConnections = Array.isArray(payload?.connections) ? payload.connections : []\r\n    setCurrentStrategyId(id)\r\n    setCurrentTemplateId(null)\r\n    const positionedNodes = rawNodes.map((n: any, idx: number) => ({\r\n      ...n,\r\n      id: n?.id || `n_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`,\r\n      position: n?.position || { x: 120 + idx * 160, y: 120 },\r\n      data: { ...(n?.data || {}), label: n?.data?.label || n?.type || 'Nó' }\r\n    }))\r\n    const conns = rawConnections.map((c: any, i: number) => ({\r\n      id: c?.id || `c_${Date.now()}_${i}`,\r\n      source: c?.source,\r\n      target: c?.target,\r\n      type: c?.type || 'condition'\r\n    }))\r\n    setNodes(positionedNodes)\r\n    setConnections(conns)\r\n    setSelectedNode(null)\r\n    setDraftStrategyName(`${tpl?.name || 'Template'} (cópia)`)\r\n    setIsBuilderOpen(true)\r\n    toast.success('Cópia criada. Edite e salve sua estratégia.')\r\n  }\r\n\r\n  function editTemplate(tpl: any) {\r\n    const templateId = String(tpl?.id || '').trim()\r\n    const payload = tpl?.builder_payload || tpl\r\n    const rawNodes = Array.isArray(payload?.nodes) ? payload.nodes : []\r\n    const rawConnections = Array.isArray(payload?.connections) ? payload.connections : []\r\n\r\n    if (!templateId || rawNodes.length === 0) {\r\n      toast.message('Template inválido para edição.', { description: 'Template sem ID ou sem nós.' })\r\n      return\r\n    }\r\n\r\n    const positionedNodes = rawNodes.map((n: any, idx: number) => ({\r\n      ...n,\r\n      id: n?.id || `n_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`,\r\n      position: n?.position || { x: 120 + idx * 160, y: 120 },\r\n      data: { ...(n?.data || {}), label: n?.data?.label || n?.type || 'Nó' }\r\n    }))\r\n    const conns = rawConnections.map((c: any, i: number) => ({\r\n      id: c?.id || `c_${Date.now()}_${i}`,\r\n      source: c?.source,\r\n      target: c?.target,\r\n      type: c?.type || 'condition'\r\n    }))\r\n\r\n    setCurrentStrategyId(null)\r\n    setCurrentTemplateId(templateId)\r\n    setNodes(positionedNodes)\r\n    setConnections(conns)\r\n    setSelectedNode(null)\r\n\r\n    const rawSelectionMode = String((payload as any)?.selectionMode || '').toLowerCase()\r\n    if (rawSelectionMode === 'automatic' || rawSelectionMode === 'hybrid' || rawSelectionMode === 'manual') {\r\n      setSelectionMode(rawSelectionMode as 'automatic' | 'hybrid' | 'manual')\r\n    } else {\r\n      setSelectionMode('automatic')\r\n    }\r\n    setGatingEnabled(Boolean((payload as any)?.gating?.enabled))\r\n    setDraftStrategyName(tpl?.name || '')\r\n    setIsBuilderOpen(true)\r\n    toast.success('Template carregado para edição.')\r\n  }\r\n\r\n  function normalizeNodes(arr: any[]): StrategyNode[] {\r\n    const GRID_X = 160\r\n    const GRID_Y = 120\r\n    return (Array.isArray(arr) ? arr : []).map((n: any, idx: number) => {\r\n      const hasPos = n && n.position && Number.isFinite(n.position.x) && Number.isFinite(n.position.y)\r\n      const fallbackPos = { x: 120 + (idx % 5) * GRID_X, y: 120 + Math.floor(idx / 5) * GRID_Y }\r\n      return {\r\n        id: String(n?.id || `n_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`),\r\n        type: (n?.type as NodeType) || 'condition',\r\n        subtype: n?.subtype,\r\n        position: hasPos ? n.position : fallbackPos,\r\n        data: { ...(n?.data || {}), label: n?.data?.label || n?.type || 'Nó' }\r\n      }\r\n    })\r\n  }\r\n\r\n  async function duplicateAndSaveTemplate(tpl: any) {\r\n    const id = `s_${Date.now()}_${Math.random().toString(36).slice(2, 6)}`\r\n    setCurrentTemplateId(null)\r\n    const payload = tpl?.builder_payload || tpl\r\n    const rawNodes = Array.isArray(payload?.nodes) ? payload.nodes : []\r\n    const rawConnections = Array.isArray(payload?.connections) ? payload.connections : []\r\n    const positionedNodes = rawNodes.map((n: any, idx: number) => ({\r\n      ...n,\r\n      id: n?.id || `n_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`,\r\n      position: n?.position || { x: 120 + idx * 160, y: 120 },\r\n      data: { ...(n?.data || {}), label: n?.data?.label || n?.type || 'Nó' }\r\n    }))\r\n    const conns = rawConnections.map((c: any, i: number) => ({\r\n      id: c?.id || `c_${Date.now()}_${i}`,\r\n      source: c?.source,\r\n      target: c?.target,\r\n      type: c?.type || 'condition'\r\n    }))\r\n    const record = {\r\n      id,\r\n      name: `${tpl?.name || 'Template'} (cópia)`,\r\n      description: tpl?.description || '',\r\n      status: 'active' as const,\r\n      nodes: positionedNodes,\r\n      connections: conns,\r\n      createdAt: Date.now(),\r\n      updatedAt: Date.now(),\r\n      source: 'builder',\r\n      template_key: tpl?.template_key || tpl?.name || undefined\r\n    }\r\n    try {\r\n      const resp = await fetch('/api/strategies', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(record)\r\n      })\r\n      if (!resp.ok) {\r\n        const data = await resp.json().catch(() => ({}))\r\n        toast.message('Falha ao salvar cópia.', { description: String((data as any)?.error || resp.statusText) })\r\n        return\r\n      }\r\n      toast.success('Cópia salva com sucesso.')\r\n\r\n      try {\r\n        const regResp = await fetch('/api/automation/strategy/register', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({\r\n            strategy_id: id,\r\n            rules: { nodes: positionedNodes, connections: conns },\r\n            status: record.status,\r\n            source: 'Builder/Templates'\r\n          })\r\n        })\r\n        const regData = await regResp.json().catch(() => ({}))\r\n        if (!regResp.ok || regData.success === false) {\r\n          toast.message('Cópia salva, mas falha ao registrar no Engine.', { description: String((regData as any)?.error || regResp.statusText) })\r\n        } else {\r\n          toast.success('Estratégia registrada no Engine.')\r\n        }\r\n      } catch (err: any) {\r\n        toast.message('Cópia salva, mas erro ao registrar no Engine.', { description: err?.message || String(err) })\r\n      }\r\n\r\n      await refreshStrategies()\r\n    } catch (e: any) {\r\n      toast.message('Erro de rede ao salvar cópia.', { description: e?.message || String(e) })\r\n    }\r\n  }\r\n\r\n  async function publishTemplate(tpl: any) {\r\n    const id = String(tpl?.id || '').trim()\r\n    if (!id) {\r\n      toast.message('Template inválido para publicação.', { description: 'ID do template ausente.' })\r\n      return\r\n    }\r\n    try {\r\n      const resp = await fetch(`/api/dynamic-strategies/templates/${id}/publish`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' }\r\n      })\r\n      const data = await resp.json().catch(() => ({}))\r\n      if (!resp.ok || (data as any)?.success === false) {\r\n        toast.message('Falha ao publicar template.', { description: String((data as any)?.error || resp.statusText) })\r\n        return\r\n      }\r\n      toast.success('Template publicado como estratégia dinâmica.')\r\n      await refreshTemplates()\r\n    } catch (e: any) {\r\n      toast.message('Erro de rede ao publicar template.', { description: e?.message || String(e) })\r\n    }\r\n  }\r\n\r\n  function addNodeFromTemplate(tpl: { type: NodeType; subtype?: string; label: string; defaultConfig?: Record<string, any> }, position: { x: number; y: number }) {\r\n    const id = `n_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`\r\n    const node: StrategyNode = {\r\n      id,\r\n      type: tpl.type,\r\n      subtype: tpl.subtype,\r\n      position,\r\n      data: {\r\n        label: tpl.label,\r\n        conditionType: tpl.subtype,\r\n        config: { ...(tpl.defaultConfig || {}) }\r\n      }\r\n    }\r\n    setNodes(prev => [...prev, node])\r\n    setSelectedNode(node)\r\n  }\r\n\r\n  function updateNode(nodeId: string, updates: Partial<StrategyNode>) {\r\n    setNodes(prev => prev.map(n => (n.id === nodeId ? { ...n, ...updates, data: { ...n.data, ...(updates.data || {}) } } : n)))\r\n    if (selectedNode?.id === nodeId) {\r\n      setSelectedNode(prev => (prev ? { ...prev, ...updates, data: { ...prev.data, ...(updates.data || {}) } } : prev))\r\n    }\r\n  }\r\n\r\n  function deleteNode(nodeId: string) {\r\n    setNodes(prev => prev.filter(n => n.id !== nodeId))\r\n    setConnections(prev => prev.filter(c => c.source !== nodeId && c.target !== nodeId))\r\n    if (selectedNode?.id === nodeId) setSelectedNode(null)\r\n  }\r\n\r\n  function handleCanvasDrop(e: React.DragEvent<HTMLDivElement>) {\r\n    e.preventDefault()\r\n    if (!draggedTpl || !canvasRef.current) return\r\n    const rect = canvasRef.current.getBoundingClientRect()\r\n    const pos = { x: e.clientX - rect.left, y: e.clientY - rect.top }\r\n    addNodeFromTemplate(draggedTpl, pos)\r\n    setDraggedTpl(null)\r\n  }\r\n\r\n  async function saveStrategy() {\r\n    const id = currentStrategyId || `s_${Date.now()}_${Math.random().toString(36).slice(2, 6)}`\r\n    const preferredName = (draftStrategyName || '').trim()\r\n    const name = preferredName ? preferredName : (nodes[0]?.data.label ? `Estratégia: ${nodes[0].data.label}` : `Estratégia ${strategies.length + 1}`)\r\n    \r\n    // ValidaÃ§Ã£o: schemaVersion Ã© obrigatÃ³rio\r\n    if (!CURRENT_SCHEMA_VERSION) {\r\n      toast.message('Erro interno: versão do schema não definida.', { description: 'Contate o suporte técnico.' })\r\n      return\r\n    }\r\n    \r\n    // ValidaÃ§Ã£o: aÃ§Ã£o 'apostar' com seleÃ§Ã£o manual exige pelo menos um nÃºmero\r\n    const invalidSignal = nodes.find(n => (\r\n      n.type === 'signal' &&\r\n      String((n.data?.config?.acao || '')).toLowerCase() === 'apostar' &&\r\n      String((n.data?.config?.selectionMode || '')).toLowerCase() === 'manual' &&\r\n      (!Array.isArray(n.data?.config?.numeros) || (n.data?.config?.numeros || []).length === 0)\r\n    ))\r\n    if (invalidSignal) {\r\n      toast.message('Seleção de números obrigatória para ação \"apostar\".', { description: 'Defina pelo menos um número (0–36) quando o modo é manual.' })\r\n      return\r\n    }\r\n\r\n    // Guardrails: validar números (0–36) e duplicatas na seleção manual\r\n    const badSignalNums = nodes.find(n => {\r\n      if (n.type !== 'signal') return false\r\n      const acao = String((n.data?.config?.acao || '')).toLowerCase()\r\n      const mode = String((n.data?.config?.selectionMode || '')).toLowerCase()\r\n      const arr = Array.isArray(n.data?.config?.numeros) ? n.data.config.numeros : []\r\n      if (acao !== 'apostar' || mode !== 'manual') return false\r\n      const outOfRange = arr.some(x => !Number.isFinite(x) || x < 0 || x > 36)\r\n      const hasDup = new Set(arr).size !== arr.length\r\n      return outOfRange || hasDup\r\n    })\r\n    if (badSignalNums) {\r\n      toast.message('Números inválidos na seleção.', { description: 'Use apenas 0–36 e evite duplicados.' })\r\n      return\r\n    }\r\n\r\n    // Guardrail: stake deve ser > 0\r\n    const badStake = nodes.find(n => (n.type === 'signal' && !(Number(n.data?.config?.stake) > 0)))\r\n    if (badStake) {\r\n      toast.message('Stake inválida.', { description: 'Informe um valor de stake maior que 0.' })\r\n      return\r\n    }\r\n\r\n    // Guardrail: protecaoLimite deve ser inteiro >= 0\r\n    const badProtecao = nodes.find(n => {\r\n      if (n.type !== 'signal') return false\r\n      const lim = Number(n.data?.config?.protecaoLimite)\r\n      return Number.isNaN(lim) || lim < 0 || !Number.isInteger(lim)\r\n    })\r\n    if (badProtecao) {\r\n      toast.message('Limite de proteção inválido.', { description: 'Use um inteiro maior ou igual a 0.' })\r\n      return\r\n    }\r\n\r\n    // Guardrail: ausência com evento = número requer alvo 0–36\r\n    const badAbsenceNumero = nodes.find(n => {\r\n      const subtype = String(n.subtype || n.data?.conditionType || '').toLowerCase()\r\n      if (n.type !== 'condition' || subtype !== 'absence') return false\r\n      const ev = String(n.data?.config?.evento || '').toLowerCase()\r\n      if (ev !== 'numero') return false\r\n      const alvo = Number(n.data?.config?.numeroAlvo ?? n.data?.config?.numero)\r\n      return !Number.isFinite(alvo) || alvo < 0 || alvo > 36\r\n    })\r\n    if (badAbsenceNumero) {\r\n      toast.message('Número alvo inválido para ausência.', { description: 'Quando evento = número, defina um alvo entre 0 e 36.' })\r\n      return\r\n    }\r\n\r\n    const existingIndex = strategies.findIndex(s => s.id === id)\r\n    const record = {\r\n      schemaVersion: CURRENT_SCHEMA_VERSION,\r\n      id,\r\n      name,\r\n      description: 'Criada via Builder',\r\n      status: existingIndex >= 0 ? strategies[existingIndex].status : 'paused',\r\n      nodes: [...nodes],\r\n      connections: [...connections],\r\n      createdAt: existingIndex >= 0 ? strategies[existingIndex].createdAt : Date.now(),\r\n      updatedAt: Date.now(),\r\n      selectionMode,\r\n      gating: { enabled: !!gatingEnabled },\r\n    }\r\n    setStrategies(prev => existingIndex >= 0 ? prev.map(s => (s.id === id ? record : s)) : [...prev, record])\r\n    setCurrentStrategyId(null)\r\n    setIsBuilderOpen(false)\r\n    setDraftStrategyName('')\r\n    try {\r\n      const resp = await fetch('/api/strategies', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(record)\r\n      })\r\n      if (resp.ok) {\r\n        toast.success('Estratégia salva (local + servidor).')\r\n        // Emitir evento local para atualizaÃ§Ã£o em tempo real\r\n        try {\r\n          const bc = new BroadcastChannel('strategies')\r\n          bc.postMessage({ type: 'strategy_saved', strategy: record })\r\n          bc.close()\r\n        } catch (_) {\r\n          // Sem suporte a BroadcastChannel, segue sem realtime\r\n        }\r\n        // Registrar no StrategyEngine\r\n        try {\r\n          const reg = await fetch('/api/automation/strategy/register', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({\r\n              strategy_id: record.id,\r\n              rules: { nodes: record.nodes, connections: record.connections },\r\n              status: record.status,\r\n              source: 'builder'\r\n            })\r\n          })\r\n          if (reg.ok) {\r\n            toast.success('Registrada no StrategyEngine.')\r\n          } else {\r\n            const data = await reg.json().catch(() => ({}))\r\n            toast.message('Registrada parcialmente. Falha no StrategyEngine.', { description: String((data as any)?.error || reg.statusText) })\r\n          }\r\n        } catch (e: any) {\r\n          toast.message('Registrada parcialmente. Erro de rede no StrategyEngine.', { description: e?.message || String(e) })\r\n        }\r\n        // Publicar no backend (dinÃ¢micas)\r\n        try {\r\n          const pub = await fetch('/api/dynamic-strategies/upload-from-builder', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({\r\n              name: record.name,\r\n              description: record.description || 'Estratégia criada via Builder',\r\n              nodes: record.nodes,\r\n              connections: record.connections\r\n            })\r\n          })\r\n          const pubData = await pub.json().catch(() => ({}))\r\n          if (pub.ok && (pubData as any)?.success) {\r\n            toast.success('Publicada no backend.')\r\n          } else {\r\n            toast.message('Registrada. Falha ao publicar no backend.', { description: String((pubData as any)?.error || pub.statusText) })\r\n          }\r\n        } catch (e: any) {\r\n          toast.message('Registrada. Erro de rede ao publicar no backend.', { description: e?.message || String(e) })\r\n        }\r\n      } else {\r\n        const data = await resp.json().catch(() => ({}))\r\n        toast.message('Salvo localmente. Falha no servidor.', { description: String((data as any)?.error || resp.statusText) })\r\n      }\r\n    } catch (e: any) {\r\n      toast.message('Salvo localmente. Erro de rede ao salvar no servidor.', { description: e?.message || String(e) })\r\n    }\r\n  }\r\n\r\n  async function saveAsTemplate() {\r\n    const preferredName = (draftStrategyName || '').trim()\r\n    const name = preferredName\r\n      ? preferredName\r\n      : (nodes[0]?.data.label ? `Template: ${nodes[0].data.label}` : `Template ${templates.length + 1}`)\r\n\r\n    if (!name) {\r\n      toast.message('Nome inválido para template.', { description: 'Defina um nome para salvar como template.' })\r\n      return\r\n    }\r\n\r\n    if (!Array.isArray(nodes) || nodes.length === 0) {\r\n      toast.message('Nenhum nó no canvas.', { description: 'Adicione nós antes de salvar como template.' })\r\n      return\r\n    }\r\n\r\n    if (!CURRENT_SCHEMA_VERSION) {\r\n      toast.message('Erro interno: versão do schema não definida.', { description: 'Contate o suporte técnico.' })\r\n      return\r\n    }\r\n\r\n    const builderPayload = {\r\n      schemaVersion: CURRENT_SCHEMA_VERSION,\r\n      nodes: [...nodes],\r\n      connections: [...connections],\r\n      selectionMode,\r\n      gating: { enabled: !!gatingEnabled }\r\n    }\r\n\r\n    const description = 'Template criado via Builder'\r\n    const existingId = currentTemplateId ? String(currentTemplateId).trim() : ''\r\n\r\n    try {\r\n      const commonBody = {\r\n        name,\r\n        description,\r\n        builder_payload: builderPayload\r\n      }\r\n\r\n      const resp = await fetch('/api/dynamic-strategies/templates', {\r\n        method: existingId ? 'PUT' : 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(existingId ? { id: existingId, ...commonBody } : commonBody)\r\n      })\r\n      const data = await resp.json().catch(() => ({}))\r\n      if (!resp.ok || !(data as any)?.ok) {\r\n        toast.message('Falha ao salvar template.', { description: String((data as any)?.error || resp.statusText) })\r\n        return\r\n      }\r\n      const saved = (data as any)?.template\r\n      if (saved && saved.id) {\r\n        setCurrentTemplateId(String(saved.id))\r\n      }\r\n      toast.success(existingId ? 'Template atualizado com sucesso.' : 'Template salvo com sucesso.')\r\n      await refreshTemplates()\r\n    } catch (e: any) {\r\n      toast.message('Erro de rede ao salvar template.', { description: e?.message || String(e) })\r\n    }\r\n  }\r\n\r\n  function editStrategy(strategyId: string) {\r\n    const s = strategies.find(st => st.id === strategyId)\r\n    if (!s) return\r\n    setCurrentStrategyId(strategyId)\r\n    setCurrentTemplateId(null)\r\n    setNodes(normalizeNodes(s.nodes))\r\n    setConnections(Array.isArray(s.connections) ? [...s.connections] : [])\r\n    setSelectedNode(null)\r\n    setDraftStrategyName(s.name || '')\r\n    setSelectionMode((s.selectionMode as 'automatic' | 'hybrid' | 'manual') || 'automatic')\r\n    setGatingEnabled(Boolean(s.gating?.enabled))\r\n    setIsBuilderOpen(true)\r\n  }\r\n\r\n  async function toggleStrategyStatus(strategyId: string) {\r\n    const s = strategies.find(st => st.id === strategyId)\r\n    if (!s) return\r\n    const newStatus = s.status === 'active' ? 'paused' : 'active'\r\n    // Atualiza UI de forma otimista\r\n    setStrategies(prev => prev.map(x => x.id === strategyId ? { ...x, status: newStatus, updatedAt: Date.now() } : x))\r\n    try {\r\n      const resp = await fetch(`/api/strategies/${strategyId}`,\r\n        {\r\n          method: 'PUT',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({\r\n            name: s.name,\r\n            description: s.description,\r\n            status: newStatus,\r\n            nodes: s.nodes,\r\n            connections: s.connections,\r\n            selectionMode: s.selectionMode,\r\n            gating: s.gating,\r\n          })\r\n        }\r\n      )\r\n      const data = await resp.json().catch(() => ({}))\r\n      if (resp.ok && (data as any)?.strategy) {\r\n        const server = (data as any).strategy\r\n        setStrategies(prev => prev.map(x => x.id === strategyId ? server : x))\r\n        toast.success(newStatus === 'active' ? 'Estratégia ativada.' : 'Estratégia pausada.')\r\n      } else {\r\n        toast.message('Falha ao atualizar status no servidor.', { description: String((data as any)?.error || resp.statusText) })\r\n      }\r\n    } catch (e: any) {\r\n      toast.message('Erro de rede ao alterar status.', { description: e?.message || String(e) })\r\n    }\r\n  }\r\n\r\n  async function deleteStrategyRecord(strategyId: string) {\r\n    try {\r\n      const resp = await fetch(`/api/strategies/${strategyId}`, { method: 'DELETE' })\r\n      const data = await resp.json().catch(() => ({}))\r\n      if (resp.ok && (data as any)?.ok) {\r\n        setStrategies(prev => prev.filter(s => s.id !== strategyId))\r\n        if (currentStrategyId === strategyId) setCurrentStrategyId(null)\r\n        toast.success('Estratégia excluída do servidor.')\r\n      } else {\r\n        toast.message('Falha ao excluir no servidor.', { description: String((data as any)?.error || resp.statusText) })\r\n      }\r\n    } catch (e: any) {\r\n      toast.message('Erro de rede ao excluir estratégia.', { description: e?.message || String(e) })\r\n    }\r\n  }\r\n\r\n  async function publishStrategy(strategyId: string) {\r\n    const s = strategies.find(st => st.id === strategyId)\r\n    if (!s) {\r\n      toast.message('Estratégia não encontrada para publicar.')\r\n      return\r\n    }\r\n    try {\r\n      const resp = await fetch('/api/dynamic-strategies/upload-from-builder', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          name: s.name,\r\n          description: s.description || 'Estratégia criada via Builder',\r\n          nodes: s.nodes,\r\n          connections: s.connections\r\n        })\r\n      })\r\n      const data = await resp.json().catch(() => ({}))\r\n      if (resp.ok && (data as any)?.success) {\r\n        toast.success('Estratégia publicada para o backend.')\r\n      } else {\r\n        toast.message('Falha ao publicar estratégia.', { description: String((data as any)?.error || resp.statusText) })\r\n      }\r\n    } catch (e: any) {\r\n      toast.message('Erro de rede ao publicar estratégia.', { description: e?.message || String(e) })\r\n    }\r\n  }\r\n\r\n  function loadCompiled(js: string) {\r\n    const transformed = js.replace(/export\\s*\\{\\s*METADATA,\\s*checkStrategy,\\s*generateSignal\\s*\\}/, 'return { METADATA, checkStrategy, generateSignal }')\r\n    // eslint-disable-next-line no-new-func\r\n    const factory = new Function(transformed)\r\n    return factory()\r\n  }\r\n\r\n  function testStrategy() {\r\n    if (isTesting) return\r\n    setIsTesting(true)\r\n    const start = Date.now()\r\n    const hist = parseHistoryInput(simulatedHistoryInput)\r\n    const effectiveWindow = (() => {\r\n      let eff = 0\r\n      for (const n of nodes) {\r\n        if (n.type !== 'condition') continue\r\n        const cfg: Record<string, any> = (n.data?.config || {})\r\n        const subtype = String(n.subtype || n.data.conditionType || '').toLowerCase()\r\n        const janela = Number(cfg.janela ?? cfg.window ?? 0)\r\n        const comprimento = Number(cfg.comprimento ?? 0)\r\n        const raio = Number(cfg.raio ?? 0)\r\n        if (subtype === 'absence' || subtype === 'setordominante' || subtype === 'dozen_hot' || subtype === 'column_hot' || subtype === 'sector') {\r\n          eff = Math.max(eff, janela)\r\n        }\r\n        if (subtype === 'alternation' || subtype === 'sequence_custom') {\r\n          eff = Math.max(eff, comprimento)\r\n        }\r\n        if (subtype === 'neighbors' || subtype === 'mirror') {\r\n          eff = Math.max(eff, Math.max(raio * 2, 12))\r\n        }\r\n        eff = Math.max(eff, janela, comprimento)\r\n      }\r\n      return eff || 0\r\n    })()\r\n\r\n    function validateGraphLocal(): string[] {\r\n      const errors: string[] = []\r\n      const nodeIds = new Set(nodes.map(n => n.id))\r\n      const triggers = nodes.filter(n => n.type === 'trigger')\r\n\r\n      if (nodes.length === 0) errors.push('Nenhum nó no grafo.')\r\n      if (triggers.length === 0) errors.push('Adicione pelo menos um nó de disparo (trigger).')\r\n\r\n      connections.forEach(c => {\r\n        if (!nodeIds.has(c.source)) errors.push(`Conexão '${c.id}' tem fonte inexistente: ${c.source}`)\r\n        if (!nodeIds.has(c.target)) errors.push(`Conexão '${c.id}' tem alvo inexistente: ${c.target}`)\r\n        if (!['success', 'failure', 'condition'].includes(c.type)) errors.push(`Conexão '${c.id}' tem tipo inválido: ${c.type}`)\r\n      })\r\n\r\n      triggers.forEach(t => {\r\n        const out = connections.filter(c => c.source === t.id)\r\n        if (out.length === 0) errors.push(`Trigger '${t.data.label || t.id}' não possui saída.`)\r\n      })\r\n\r\n      nodes.filter(n => n.type !== 'trigger').forEach(n => {\r\n        const incoming = connections.some(c => c.target === n.id)\r\n        if (!incoming) errors.push(`Nó '${n.data.label || n.id}' sem conexão de entrada.`)\r\n      })\r\n\r\n      const visited = new Set<string>()\r\n      const queue = [...triggers.map(t => t.id)]\r\n      while (queue.length) {\r\n        const current = queue.shift()!\r\n        if (visited.has(current)) continue\r\n        visited.add(current)\r\n        connections.filter(c => c.source === current).forEach(c => queue.push(c.target))\r\n      }\r\n      const unreachable = nodes.filter(n => !visited.has(n.id))\r\n      if (unreachable.length > 0) {\r\n        const preview = unreachable.slice(0, 3).map(n => n.data.label || n.id).join(', ')\r\n        errors.push(`Há nós não alcançáveis a partir dos triggers (${unreachable.length}): ${preview}${unreachable.length > 3 ? '…' : ''}`)\r\n      }\r\n\r\n      return errors\r\n    }\r\n\r\n    function dryRunLocal() {\r\n      const logs: Array<{ step: number; nodeId: string; label: string; action: string }> = []\r\n      let step = 1\r\n      const triggers = nodes.filter(n => n.type === 'trigger')\r\n      const maxSteps = Math.max(50, nodes.length * 5)\r\n      const visitedCount = new Set<string>()\r\n      const nextQueue = [...triggers.map(t => t.id)]\r\n      const nodeResult: Record<string, boolean> = {}\r\n      const history = parseHistoryInput(simulatedHistoryInput)\r\n      const results: Array<{ nodeId: string; label: string; type: NodeType; subtype?: string; pass?: boolean }> = []\r\n      const signals: Array<{ nodeId: string; label: string; acao: string; mensagem?: string; prioridade?: string }> = []\r\n\r\n      while (nextQueue.length && step <= maxSteps) {\r\n        const nodeId = nextQueue.shift()!\r\n        const node = nodes.find(n => n.id === nodeId)\r\n        if (!node) continue\r\n        visitedCount.add(nodeId)\r\n        logs.push({ step, nodeId, label: node.data.label || nodeId, action: `visit:${node.type}` })\r\n        step++\r\n        const outs = connections.filter(c => c.source === nodeId)\r\n        if (outs.length === 0) continue\r\n\r\n        if (node.type === 'condition') {\r\n          const pass = evaluateConditionNode(node, history)\r\n          nodeResult[nodeId] = pass\r\n          results.push({ nodeId, label: node.data.label || nodeId, type: node.type, subtype: node.subtype || node.data.conditionType, pass })\r\n          const edge = outs.find(c => c.type === (pass ? 'success' : 'failure')) || outs[0]\r\n          if (edge) {\r\n            logs.push({ step, nodeId, label: node.data.label || nodeId, action: `branch:${pass ? 'success' : 'failure'}&rarr;${edge.target}` })\r\n            step++\r\n            if (!visitedCount.has(edge.target)) nextQueue.push(edge.target)\r\n          }\r\n        } else if (node.type === 'logic') {\r\n          const pass = evaluateLogicNode(node, connections, nodeResult)\r\n          nodeResult[nodeId] = pass\r\n          results.push({ nodeId, label: node.data.label || nodeId, type: node.type, subtype: node.subtype || node.data.conditionType, pass })\r\n          const edge = outs.find(c => c.type === (pass ? 'success' : 'failure')) || outs[0]\r\n          if (edge) {\r\n            logs.push({ step, nodeId, label: node.data.label || nodeId, action: `logic:${pass ? 'success' : 'failure'}&rarr;${edge.target}` })\r\n            step++\r\n            if (!visitedCount.has(edge.target)) nextQueue.push(edge.target)\r\n          }\r\n        } else if (node.type === 'signal') {\r\n          results.push({ nodeId, label: node.data.label || nodeId, type: node.type, subtype: node.subtype || node.data.conditionType })\r\n          const cfg = (node.data?.config || {})\r\n          const payload = { nodeId, label: node.data.label || nodeId, acao: String(cfg.acao || 'emitir_sinal'), mensagem: cfg.mensagem, prioridade: cfg.prioridade }\r\n          signals.push(payload)\r\n          logs.push({ step, nodeId, label: node.data.label || nodeId, action: `signal:${payload.acao}:${payload.prioridade || 'normal'}` })\r\n          step++\r\n          const edge = outs[0]\r\n          if (edge) {\r\n            logs.push({ step, nodeId, label: node.data.label || nodeId, action: `next&rarr;${edge.target}` })\r\n            step++\r\n            if (!visitedCount.has(edge.target)) nextQueue.push(edge.target)\r\n          }\r\n        } else {\r\n          results.push({ nodeId, label: node.data.label || nodeId, type: node.type, subtype: node.subtype || node.data.conditionType })\r\n          const edge = outs[0]\r\n          if (edge) {\r\n            logs.push({ step, nodeId, label: node.data.label || nodeId, action: `next&rarr;${edge.target}` })\r\n            step++\r\n            if (!visitedCount.has(edge.target)) nextQueue.push(edge.target)\r\n          }\r\n        }\r\n      }\r\n\r\n      return { logs, visited: visitedCount.size, results, signals }\r\n    }\r\n\r\n    const errors = validateGraphLocal()\r\n    if (errors.length > 0) {\r\n      setTestReport({\r\n        errors,\r\n        logs: [],\r\n        results: [],\r\n        signals: [],\r\n        summary: { visited: 0, totalNodes: nodes.length, totalConnections: connections.length, durationMs: Date.now() - start, source: historySource, sampleSize: Array.isArray(hist) ? hist.length : 0, effectiveWindow }\r\n      })\r\n      setIsTesting(false)\r\n      setIsTestReportOpen(true)\r\n      toast.error('Falhas na validação do grafo.')\r\n      return\r\n    }\r\n\r\n    const result = dryRunLocal()\r\n    setTestReport({\r\n      errors: [],\r\n      logs: result.logs,\r\n      results: result.results,\r\n      signals: result.signals,\r\n      summary: { visited: result.visited, totalNodes: nodes.length, totalConnections: connections.length, durationMs: Date.now() - start, source: historySource, sampleSize: Array.isArray(hist) ? hist.length : 0, effectiveWindow }\r\n    })\r\n    // Executar compilador JS e avaliar checkStrategy/generateSignal\r\n    try {\r\n      const preferredName = (draftStrategyName || '').trim()\r\n      const payload = {\r\n        name: preferredName || (nodes[0]?.data?.label ? `Estratégia: ${nodes[0].data.label}` : 'Estratégia Teste'),\r\n        selectionMode: selectionMode,\r\n        nodes,\r\n        connections,\r\n        min_spins: 1,\r\n        gating: gatingEnabled ? { enabled: true } : {}\r\n      }\r\n      const js = compileBuilderToJS(payload)\r\n      const mod = loadCompiled(js)\r\n      const activation = mod.checkStrategy(hist, { selectionMode, gating: gatingEnabled ? { enabled: true } : {} })\r\n      const signal = mod.generateSignal(hist, { selectionMode, gating: gatingEnabled ? { enabled: true } : {} })\r\n      setTestReport(prev => ({ ...prev, compiled: { activation, signal } }))\r\n    } catch (e) {\r\n      console.warn('Falha ao compilar/avaliar estratégia no cliente:', e)\r\n    }\r\n    setIsTesting(false)\r\n    setIsTestReportOpen(true)\r\n    toast.success('Teste concluído.')\r\n    // Derivação automática/híbrida (assíncrona)\r\n    fetch('/api/action-resolver', {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({\r\n        nodes,\r\n        connections,\r\n        historyInput: simulatedHistoryInput,\r\n        selectionMode,\r\n        gating: gatingEnabled ? { enabled: true } : {}\r\n      })\r\n    }).then(async (resp) => {\r\n      try {\r\n        const data = await resp.json().catch(() => ({}))\r\n        if (resp.ok && (data as any)?.success) {\r\n          const resolverData = {\r\n            mode: String((data as any).mode || ''),\r\n            derivedNumbers: Array.isArray((data as any).derivedNumbers) ? (data as any).derivedNumbers : [],\r\n            telemetry: (data as any).telemetry,\r\n            gated: Boolean((data as any).gated ?? (data as any)?.telemetry?.gatingApplied?.gated ?? false),\r\n            gateReasons: Array.isArray((data as any).gateReasons) ? (data as any).gateReasons : ((data as any)?.telemetry?.gatingApplied?.reasons || []),\r\n          }\r\n          setTestReport(prev => ({ ...prev, resolver: resolverData }))\r\n        }\r\n      } catch {}\r\n    }).catch(() => {})\r\n  }\r\n\r\n  async function testStrategyWithRealHistory() {\r\n    if (isTesting || isValidatingServer) return\r\n    try {\r\n      setIsTesting(true)\r\n      setHistorySource('real')\r\n      const limit = Math.max(1, Math.min(500, Number(realHistoryLimit) || 60))\r\n      const url = `/api/roulette-history?limit=${limit}`\r\n      const headers: HeadersInit = serverToken ? { 'Authorization': `Bearer ${serverToken}` } : {}\r\n      const resp = await fetch(url, { headers })\r\n      const data = await resp.json().catch(() => ({}))\r\n      if (!resp.ok || !(data as any)?.success || !Array.isArray((data as any).data)) {\r\n        const msg = String((data as any)?.message || (data as any)?.error || resp.statusText)\r\n        toast.message('Falha ao obter histórico real.', { description: msg })\r\n        setHistorySource('manual')\r\n        setIsTesting(false)\r\n        return\r\n      }\r\n      const spins = ((data as any).data as any[]).map((d: any) => Number(d.number)).filter((n: number) => Number.isFinite(n))\r\n      if (spins.length === 0) {\r\n        toast.message('Histórico real vazio.')\r\n        setHistorySource('manual')\r\n        setIsTesting(false)\r\n        return\r\n      }\r\n      setSimulatedHistoryInput(spins.join(','))\r\n      // Executa teste com histórico real\r\n      testStrategy()\r\n    } catch (e: any) {\r\n      toast.message('Erro de rede ao obter histórico.', { description: e?.message || String(e) })\r\n      setHistorySource('manual')\r\n      setIsTesting(false)\r\n    }\r\n  }\r\n\r\n  // Botão único de teste: tenta histórico real quando possível e faz fallback para teste local\r\n  async function unifiedTest() {\r\n    if (isTesting || isValidatingServer) return\r\n    const limit = Math.max(1, Math.min(500, Number(realHistoryLimit) || 60))\r\n    if (serverToken) {\r\n      try {\r\n        const headers: HeadersInit = { 'Authorization': `Bearer ${serverToken}` }\r\n        const resp = await fetch(`/api/roulette-history?limit=${limit}`, { headers })\r\n        const data = await resp.json().catch(() => ({}))\r\n        const ok = resp.ok && (data as any)?.success && Array.isArray((data as any).data)\r\n        const spins = ok ? (((data as any).data as any[]).map((d: any) => Number(d.number)).filter((n: number) => Number.isFinite(n))) : []\r\n        if (ok && spins.length > 0) {\r\n          setSimulatedHistoryInput(spins.join(','))\r\n          setHistorySource('real')\r\n          return testStrategy()\r\n        }\r\n        toast.message('Histórico real indisponível. Executando teste local.')\r\n      } catch {\r\n        toast.message('Falha ao consultar histórico real. Executando teste local.')\r\n      }\r\n    }\r\n    setHistorySource('manual')\r\n    return testStrategy()\r\n  }\r\n\r\n  async function validateSignalOnServer() {\r\n    if (isValidatingServer) return\r\n    const signalId = validationSignalId || (testReport.signals[0]?.nodeId || '')\r\n    if (!signalId) {\r\n      toast.message('Selecione um sinal para validar.')\r\n      return\r\n    }\r\n    if (!serverToken) {\r\n      toast.message('Informe o token para validação.')\r\n      return\r\n    }\r\n    try {\r\n      setIsValidatingServer(true)\r\n      const body: any = {\r\n        signal_id: signalId,\r\n        result: validationResult,\r\n      }\r\n      if (typeof validationWinningNumber === 'number') body.winning_number = validationWinningNumber\r\n      if (typeof validationNetPayout === 'number') body.net_payout = validationNetPayout\r\n      const resp = await fetch('/api/signals/validate', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': `Bearer ${serverToken}`,\r\n        },\r\n        body: JSON.stringify(body),\r\n      })\r\n      const data = await resp.json().catch(() => ({}))\r\n      if (!resp.ok) {\r\n        setServerValidationResponse({ ok: false, status: resp.status, error: String((data as any)?.error || resp.statusText) })\r\n        toast.message('Falha na validação no servidor.', { description: String((data as any)?.error || resp.statusText) })\r\n      } else {\r\n        setServerValidationResponse({ ok: true, status: resp.status, data })\r\n        toast.success('Validação no servidor concluída.')\r\n      }\r\n    } catch (e: any) {\r\n      setServerValidationResponse({ ok: false, status: 0, error: e?.message || String(e) })\r\n      toast.message('Erro de rede na validação.', { description: e?.message || String(e) })\r\n    } finally {\r\n      setIsValidatingServer(false)\r\n    }\r\n  }\r\n\r\n  function exportTestReport() {\r\n    try {\r\n      const data = JSON.stringify(testReport, null, 2)\r\n      const blob = new Blob([data], { type: 'application/json' })\r\n      const url = URL.createObjectURL(blob)\r\n      const a = document.createElement('a')\r\n      a.href = url\r\n      a.download = `test-report-${Date.now()}.json`\r\n      a.click()\r\n      URL.revokeObjectURL(url)\r\n      toast.success('Relatório exportado (.json).')\r\n    } catch (e: any) {\r\n      toast.message('Falha ao exportar relatório.', { description: e?.message || String(e) })\r\n    }\r\n  }\r\n\r\n  // React Flow mapping and handlers\r\n  const typeColorMap = useMemo(() => ({\r\n    trigger: '#a855f7',\r\n    condition: '#3b82f6',\r\n    logic: '#64748b',\r\n    signal: '#16a34a',\r\n  }), [])\r\n\r\n  const rfNodes = useMemo(() => (\r\n    nodes.map(n => ({\r\n      id: n.id,\r\n      position: n.position,\r\n      data: { label: n.data.label },\r\n      style: { border: `1px solid ${typeColorMap[n.type]}`, borderRadius: 6, padding: 8, background: 'white' },\r\n    }))\r\n  ), [nodes, typeColorMap])\r\n\r\n  const edgeColor: Record<'success' | 'failure' | 'condition', string> = {\r\n    success: '#16a34a',\r\n    failure: '#dc2626',\r\n    condition: '#3b82f6',\r\n  }\r\n\r\n  const rfEdges = useMemo(() => (\r\n    connections.map(c => {\r\n      const iconLabel = c.type === 'success' ? '✔' : c.type === 'failure' ? '✖' : '∴'\r\n      const dash = c.type === 'failure' ? '6 3' : c.type === 'condition' ? '2 2' : ''\r\n      const isSelected = selectedEdgeId === c.id\r\n      return {\r\n        id: c.id,\r\n        source: c.source,\r\n        target: c.target,\r\n        markerEnd: { type: MarkerType.ArrowClosed },\r\n        style: { stroke: edgeColor[c.type], strokeWidth: isSelected ? 3.5 : 2, opacity: isSelected ? 1 : 0.9, ...(dash ? { strokeDasharray: dash } : {}) },\r\n        label: iconLabel,\r\n        labelStyle: { fill: edgeColor[c.type], fontWeight: isSelected ? 700 : 600, fontSize: isSelected ? 13 : 12 },\r\n      }\r\n    })\r\n  ), [connections, selectedEdgeId])\r\n\r\n  const handleConnect = useCallback((params: RFConnection) => {\r\n    const id = `c_${Date.now()}_${Math.random().toString(36).slice(2, 6)}`\r\n    if (!params.source || !params.target) return\r\n    setConnections(prev => [...prev, { id, source: params.source as string, target: params.target as string, type: 'success' }])\r\n  }, [])\r\n\r\n  const onEdgesDelete = useCallback((edges: RFEdge[]) => {\r\n    setConnections(prev => prev.filter(c => !edges.some(e => e.id === c.id)))\r\n  }, [])\r\n\r\n  const onNodeDragStop = useCallback((_: any, node: RFNode) => {\r\n    setNodes(prev => prev.map(n => (n.id === node.id ? { ...n, position: node.position } : n)))\r\n  }, [])\r\n\r\n  const onNodeClick = useCallback((_: any, node: RFNode) => {\r\n    const found = nodes.find(n => n.id === node.id) || null\r\n    setSelectedNode(found)\r\n    setSelectedEdgeId(null)\r\n  }, [nodes])\r\n\r\n  const onEdgeClick = useCallback((_: any, edge: RFEdge) => {\r\n    setSelectedEdgeId(edge.id)\r\n    setSelectedNode(null)\r\n  }, [])\r\n\r\n  function renderConnections() {\r\n    const canvas = canvasRef.current\r\n    if (!canvas) return null\r\n    const canvasRect = canvas.getBoundingClientRect()\r\n    const lines = connections.map((c) => {\r\n      const srcEl = nodeRefs.current[c.source]\r\n      const tgtEl = nodeRefs.current[c.target]\r\n      if (!srcEl || !tgtEl) return null\r\n      const srcRect = srcEl.getBoundingClientRect()\r\n      const tgtRect = tgtEl.getBoundingClientRect()\r\n      const x1 = (srcRect.left - canvasRect.left) + srcRect.width / 2\r\n      const y1 = (srcRect.top - canvasRect.top) + srcRect.height / 2\r\n      const x2 = (tgtRect.left - canvasRect.left) + tgtRect.width / 2\r\n      const y2 = (tgtRect.top - canvasRect.top) + tgtRect.height / 2\r\n      return { x1, y1, x2, y2, type: c.type, id: c.id }\r\n    }).filter(Boolean) as Array<{ x1: number; y1: number; x2: number; y2: number; type: 'success' | 'failure' | 'condition'; id: string }>\r\n\r\n    const color = { success: '#16a34a', failure: '#dc2626', condition: '#3b82f6' }\r\n\r\n    return (\r\n      <svg className=\"absolute inset-0 pointer-events-none\">\r\n        <defs>\r\n          <marker id=\"arrow-success\" viewBox=\"0 0 10 10\" refX=\"6\" refY=\"5\" markerWidth=\"6\" markerHeight=\"6\" orient=\"auto\">\r\n            <path d=\"M 0 0 L 10 5 L 0 10 z\" fill={color.success}></path>\r\n          </marker>\r\n          <marker id=\"arrow-failure\" viewBox=\"0 0 10 10\" refX=\"6\" refY=\"5\" markerWidth=\"6\" markerHeight=\"6\" orient=\"auto\">\r\n            <path d=\"M 0 0 L 10 5 L 0 10 z\" fill={color.failure}></path>\r\n          </marker>\r\n          <marker id=\"arrow-condition\" viewBox=\"0 0 10 10\" refX=\"6\" refY=\"5\" markerWidth=\"6\" markerHeight=\"6\" orient=\"auto\">\r\n            <path d=\"M 0 0 L 10 5 L 0 10 z\" fill={color.condition}></path>\r\n          </marker>\r\n        </defs>\r\n        {lines.map((l) => {\r\n          const dx = l.x2 - l.x1\r\n          const dy = l.y2 - l.y1\r\n          const len = Math.hypot(dx, dy)\r\n          const endOffset = 22\r\n          const startOffset = 18\r\n          const ratioEnd = len > 0 ? (len - endOffset) / len : 1\r\n          const ex = l.x1 + dx * ratioEnd\r\n          const ey = l.y1 + dy * ratioEnd\r\n          const sx = l.x1 + (dx / (len || 1)) * startOffset\r\n          const sy = l.y1 + (dy / (len || 1)) * startOffset\r\n          const markerId = l.type === 'success' ? 'arrow-success' : l.type === 'failure' ? 'arrow-failure' : 'arrow-condition'\r\n          return (\r\n            <line\r\n              key={l.id}\r\n              x1={sx}\r\n              y1={sy}\r\n              x2={ex}\r\n              y2={ey}\r\n              stroke={color[l.type]}\r\n              strokeWidth={2}\r\n              markerEnd={`url(#${markerId})`}\r\n            />\r\n          )\r\n        })}\r\n      </svg>\r\n    )\r\n  }\r\n\r\n  function renderFields() {\r\n    if (!selectedNode) return null\r\n    const typeKey = selectedNode.type === 'condition'\r\n      ? `condition:${selectedNode.subtype || selectedNode.data.conditionType || ''}`\r\n      : selectedNode.type\r\n    const fields = builderSpec.builderModal.columns.propertiesPanel.fieldsByType[typeKey] || []\r\n\r\n    if (fields.length > 0) {\r\n      return fields.map((f) => {\r\n        const val = selectedNode.data.config[f.key ?? '']\r\n        if (f.type === 'select') {\r\n          return (\r\n            <div key={f.key}>\r\n              <div className=\"flex items-center justify-between\">\r\n                <Label className=\"text-xs\">{f.label}</Label>\r\n                {FIELD_HELP[f.key || '']?.description ? (\r\n                  <TooltipProvider>\r\n                    <Tooltip>\r\n                      <TooltipTrigger asChild>\r\n                        <Info className=\"h-3 w-3 text-muted-foreground cursor-help\" />\r\n                      </TooltipTrigger>\r\n                      <TooltipContent>\r\n                        {FIELD_HELP[f.key || '']!.description}{FIELD_HELP[f.key || '']!.example ? ` &bull; Ex.: ${FIELD_HELP[f.key || '']!.example}` : ''}\r\n                      </TooltipContent>\r\n                    </Tooltip>\r\n                  </TooltipProvider>\r\n                ) : null}\r\n              </div>\r\n              <Select\r\n                value={String(val ?? '')}\r\n                onValueChange={(v) => updateNode(selectedNode.id, {\r\n                  data: { \r\n                    ...selectedNode.data,\r\n                    config: { ...(selectedNode.data.config || {}), [f.key!]: v } \r\n                  }\r\n                })}\r\n              >\r\n                <SelectTrigger className=\"h-8\">\r\n                  <SelectValue placeholder=\"Selecione\" />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  {(f.options || []).map((opt) => {\r\n                    const labelMap = SELECT_LABELS_PT[f.key || ''] || {}\r\n                    const label = labelMap[opt] || opt\r\n                    return <SelectItem key={opt} value={opt}>{label}</SelectItem>\r\n                  })}\r\n                </SelectContent>\r\n              </Select>\r\n            </div>\r\n          )\r\n        }\r\n        if (f.type === 'number') {\r\n          // Oculta \"NÃºmero alvo\" salvo quando o evento selecionado Ã© 'numero' na condiÃ§Ã£o de ausÃªncia\r\n          if (f.key === 'numeroAlvo' && typeKey === 'condition:absence') {\r\n            const evento = String((selectedNode.data.config || {}).evento || '').toLowerCase()\r\n            if (evento !== 'numero') {\r\n              return null\r\n            }\r\n          }\r\n          return (\r\n            <div key={f.key}>\r\n              <div className=\"flex items-center justify-between\">\r\n                <Label className=\"text-xs\">{f.label}</Label>\r\n                {FIELD_HELP[f.key || '']?.description ? (\r\n                  <TooltipProvider>\r\n                    <Tooltip>\r\n                      <TooltipTrigger asChild>\r\n                        <Info className=\"h-3 w-3 text-muted-foreground cursor-help\" />\r\n                      </TooltipTrigger>\r\n                      <TooltipContent>\r\n                        {FIELD_HELP[f.key || '']!.description}{FIELD_HELP[f.key || '']!.example ? ` &bull; Ex.: ${FIELD_HELP[f.key || '']!.example}` : ''}\r\n                      </TooltipContent>\r\n                    </Tooltip>\r\n                  </TooltipProvider>\r\n                ) : null}\r\n              </div>\r\n              <Input\r\n                type=\"number\"\r\n                min={f.key === 'numero' || f.key === 'numeroAlvo' ? 0 : undefined}\r\n                max={f.key === 'numero' || f.key === 'numeroAlvo' ? 36 : undefined}\r\n                step={f.key === 'stake' ? 0.01 : undefined}\r\n                value={String(val ?? '')}\r\n                onChange={(e) => {\r\n                  const raw = Number(e.target.value)\r\n                  const isComprimento = (f.key === 'comprimento' && typeKey === 'condition:alternation')\r\n                  const isJanelaSetor = (f.key === 'janela' && typeKey === 'condition:setorDominante')\r\n                  const isFreqSetor = (f.key === 'frequenciaMinima' && typeKey === 'condition:setorDominante')\r\n                  const isNumeroField = (f.key === 'numero' || f.key === 'numeroAlvo')\r\n                  const isOcorrencias = (f.key === 'ocorrencias')\r\n                  const isJanelaGeneric = (f.key === 'janela' || f.key === 'inicio' || f.key === 'fim')\r\n                  const isProtecaoOrLimite = (f.key === 'protecaoLimite' || f.key === 'limiteRodadas')\r\n                  const janelaAtual = Number((selectedNode.data.config || {}).janela ?? 1)\r\n                  let next = raw\r\n                  next = isComprimento ? Math.max(2, next) : next\r\n                  next = isJanelaSetor ? Math.max(1, next) : next\r\n                  next = isFreqSetor ? Math.max(1, Math.min(next, Math.max(1, janelaAtual))) : next\r\n                  next = isNumeroField ? Math.max(0, Math.min(36, next)) : next\r\n                  next = isOcorrencias ? Math.max(1, next) : next\r\n                  next = isJanelaGeneric ? Math.max(1, next) : next\r\n                  if (String(f.key) === 'protecaoLimite') {\r\n                    next = Math.min(10, Math.max(0, Math.floor(next)))\r\n                  } else {\r\n                    next = isProtecaoOrLimite ? Math.max(0, next) : next\r\n                  }\r\n                  updateNode(selectedNode.id, {\r\n                    data: { \r\n                      ...selectedNode.data,\r\n                      config: { ...(selectedNode.data.config || {}), [f.key!]: next } \r\n                    }\r\n                  })\r\n                }}\r\n              />\r\n              {f.key === 'numeroAlvo' ? (\r\n                <div className=\"text-[10px] text-muted-foreground mt-1\">Aceita 0–36. Opcional: deixe vazio para qualquer número.</div>\r\n              ) : null}\r\n              {f.key === 'comprimento' && typeKey === 'condition:alternation' ? (\r\n                <div className=\"text-[10px] mt-1\">\r\n                  {Number(val) < 2 ? (\r\n                    <span className=\"text-red-600\">Comprimento mínimo é 2.</span>\r\n                  ) : (\r\n                    (() => {\r\n                      const eixo = String((selectedNode.data.config || {}).eixo || 'cor').toLowerCase()\r\n                      const comp = Number((selectedNode.data.config || {}).comprimento || 0)\r\n                      const history = parseHistoryInput(simulatedHistoryInput)\r\n                      const slice = history.slice(-Math.max(comp, 0))\r\n                      const hasZero = slice.some(t => t === 0 || t === 'zero')\r\n                      if ((eixo === 'cor' || eixo === 'paridade') && hasZero && comp >= 2) {\r\n                        return <span className=\"text-muted-foreground\">Zero nas últimas {comp} rodadas interrompe a alternância.</span>\r\n                      }\r\n                      return null\r\n                    })()\r\n                  )}\r\n                </div>\r\n              ) : null}\r\n            </div>\r\n          )\r\n        }\r\n        if (f.type === 'slider') {\r\n          return (\r\n            <div key={f.key}>\r\n              <div className=\"flex items-center justify-between\">\r\n                <Label className=\"text-xs\">{f.label}</Label>\r\n                {FIELD_HELP[f.key || '']?.description ? (\r\n                  <TooltipProvider>\r\n                    <Tooltip>\r\n                      <TooltipTrigger asChild>\r\n                        <Info className=\"h-3 w-3 text-muted-foreground cursor-help\" />\r\n                      </TooltipTrigger>\r\n                      <TooltipContent>\r\n                        {FIELD_HELP[f.key || '']!.description}{FIELD_HELP[f.key || '']!.example ? ` &bull; Ex.: ${FIELD_HELP[f.key || '']!.example}` : ''}\r\n                      </TooltipContent>\r\n                    </Tooltip>\r\n                  </TooltipProvider>\r\n                ) : null}\r\n              </div>\r\n              <div className=\"flex items-center gap-2\">\r\n                <Slider\r\n                  min={f.min ?? 0}\r\n                  max={f.max ?? 100}\r\n                  step={f.step ?? 1}\r\n                  value={[Number(val ?? 0)]}\r\n                  onValueChange={(arr) => updateNode(selectedNode.id, {\r\n                    data: { \r\n                      ...selectedNode.data,\r\n                      config: { ...(selectedNode.data.config || {}), [f.key!]: arr[0] } \r\n                    }\r\n                  })}\r\n                />\r\n                <Input\r\n                  type=\"number\"\r\n                  className=\"h-8 w-16\"\r\n                  min={f.min ?? 0}\r\n                  max={f.max ?? 100}\r\n                  step={f.step ?? 1}\r\n                  value={String(val ?? '')}\r\n                  onChange={(e) => {\r\n                    let v = Number(e.target.value)\r\n                    const min = f.min ?? 0\r\n                    const max = f.max ?? 100\r\n                    if (!Number.isFinite(v)) return\r\n                    v = Math.max(min, Math.min(max, v))\r\n                    updateNode(selectedNode.id, {\r\n                      data: { \r\n                        ...selectedNode.data,\r\n                        config: { ...(selectedNode.data.config || {}), [f.key!]: v } \r\n                      }\r\n                    })\r\n                  }}\r\n                />\r\n              </div>\r\n              <div className=\"text-[10px] text-muted-foreground mt-1\">{`${f.min ?? 0}–${f.max ?? 100}${f.step ? ` (passo ${f.step})` : ''}`}</div>\r\n            </div>\r\n          )\r\n        }\r\n        if (f.type === 'array') {\r\n          // Seletor visual para nÃºmeros do nÃ³ Signal\r\n          if (selectedNode.type === 'signal' && f.key === 'numeros') {\r\n            const cfg = selectedNode.data.config || {}\r\n            const selectedNums: number[] = Array.isArray(cfg.numeros) ? cfg.numeros : []\r\n            const mode = String(cfg.selectionMode || 'manual').toLowerCase()\r\n            // No MVP, o seletor de números deve estar sempre disponível\r\n            const toggleNumber = (num: number) => {\r\n              let next = Array.isArray(selectedNums) ? [...selectedNums] : []\r\n              if (next.includes(num)) next = next.filter(n => n !== num)\r\n              else next.push(num)\r\n              next = next.filter(n => Number.isFinite(n) && n >= 0 && n <= 36).sort((a, b) => a - b)\r\n              updateNode(selectedNode.id, { data: { \r\n                ...selectedNode.data,\r\n                config: { ...(selectedNode.data.config || {}), numeros: next } \r\n              } })\r\n            }\r\n            const setSelection = (arr: number[]) => {\r\n              const uniq = Array.from(new Set(arr.filter(n => Number.isFinite(n) && n >= 0 && n <= 36))).sort((a,b)=>a-b)\r\n              updateNode(selectedNode.id, { data: { \r\n                ...selectedNode.data,\r\n                config: { ...(selectedNode.data.config || {}), numeros: uniq } \r\n              } })\r\n              // Se o usuário começar a selecionar números e o modo for automático, mudar para manual\r\n              if (uniq.length > 0 && selectionMode === 'automatic') {\r\n                setSelectionMode('manual')\r\n              }\r\n            }\r\n            const invertSelection = () => {\r\n              const all = Array.from({ length: 37 }, (_, i) => i)\r\n              const next = all.filter(n => !selectedNums.includes(n))\r\n              setSelection(next)\r\n            }\r\n            const selectNone = () => { setSelection([]); }\r\n            const selectReds = () => setSelection(RED_NUMBERS)\r\n            const selectBlacks = () => setSelection(BLACK_NUMBERS)\r\n            const selectZero = () => setSelection([0])\r\n            const selectEven = () => setSelection(Array.from({ length: 36 }, (_, i) => i + 1).filter(n => n % 2 === 0))\r\n            const selectOdd = () => setSelection(Array.from({ length: 36 }, (_, i) => i + 1).filter(n => n % 2 === 1))\r\n            const selectLow = () => setSelection(Array.from({ length: 18 }, (_, i) => i + 1))\r\n            const selectHigh = () => setSelection(Array.from({ length: 18 }, (_, i) => i + 19))\r\n            const selectDozen = (k: number) => {\r\n              const start = (k - 1) * 12 + 1\r\n              const arr = Array.from({ length: 12 }, (_, i) => start + i)\r\n              setSelection(arr)\r\n            }\r\n            const selectColumn = (k: number) => {\r\n              const arr = Array.from({ length: 36 }, (_, i) => i + 1).filter(n => {\r\n                const mod = n % 3\r\n                if (k === 1) return mod === 1\r\n                if (k === 2) return mod === 2\r\n                return mod === 0\r\n              })\r\n              setSelection(arr)\r\n            }\r\n            const EUROPEAN_WHEEL = [0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,30,8,23,10,5,24,16,33,1,20,14,31,9,22,18,29,7,28,12,35,3,26]\r\n            const wheelIndexOf = (n: number) => EUROPEAN_WHEEL.indexOf(n)\r\n            const circularDistanceLocal = (a: number, b: number): number => {\r\n              const ia = wheelIndexOf(a)\r\n              const ib = wheelIndexOf(b)\r\n              if (ia < 0 || ib < 0) return 999\r\n              const len = EUROPEAN_WHEEL.length\r\n              const diff = Math.abs(ia - ib)\r\n              return Math.min(diff, len - diff)\r\n            }\r\n            const addNeighbors = (radius: number) => {\r\n              if (!selectedNums.length) return\r\n              const next = new Set(selectedNums)\r\n              selectedNums.forEach(seed => {\r\n                EUROPEAN_WHEEL.forEach(n => {\r\n                  if (circularDistanceLocal(n, seed) <= radius) next.add(n)\r\n                })\r\n              })\r\n              setSelection(Array.from(next))\r\n            }\r\n            const redsCount = selectedNums.filter(n => RED_NUMBERS.includes(n)).length\r\n            const blacksCount = selectedNums.filter(n => BLACK_NUMBERS.includes(n)).length\r\n            const zeroCount = selectedNums.includes(0) ? 1 : 0\r\n            const evenCount = selectedNums.filter(n => n !== 0 && n % 2 === 0).length\r\n            const oddCount = selectedNums.filter(n => n % 2 === 1).length\r\n            const dozen1Count = selectedNums.filter(n => n >= 1 && n <= 12).length\r\n            const dozen2Count = selectedNums.filter(n => n >= 13 && n <= 24).length\r\n            const dozen3Count = selectedNums.filter(n => n >= 25 && n <= 36).length\r\n            const col1Count = selectedNums.filter(n => n >= 1 && n <= 36 && n % 3 === 1).length\r\n            const col2Count = selectedNums.filter(n => n >= 1 && n <= 36 && n % 3 === 2).length\r\n            const col3Count = selectedNums.filter(n => n >= 1 && n <= 36 && n % 3 === 0).length\r\n            return (\r\n              <div key={f.key}>\r\n                <Label className=\"text-xs\">{f.label}</Label>\r\n                <div className=\"mt-1 pr-1\">\r\n                  <div className=\"flex flex-wrap gap-1 mb-2\">\r\n                    <Button size=\"sm\" variant=\"outline\" onClick={selectNone}>Limpar</Button>\r\n                    <Separator orientation=\"vertical\" className=\"h-6\" />\r\n                    <Button size=\"sm\" variant=\"outline\" onClick={selectReds}>Vermelhos</Button>\r\n                    <Button size=\"sm\" variant=\"outline\" onClick={selectBlacks}>Pretos</Button>\r\n                    <Button size=\"sm\" variant=\"outline\" onClick={selectZero}>Zero</Button>\r\n                    <Separator orientation=\"vertical\" className=\"h-6\" />\r\n                    <Button size=\"sm\" variant=\"outline\" onClick={selectEven}>Pares</Button>\r\n                    <Button size=\"sm\" variant=\"outline\" onClick={selectOdd}>Ímpares</Button>\r\n                    <Button size=\"sm\" variant=\"outline\" onClick={selectLow}>Baixos 1-18</Button>\r\n                    <Button size=\"sm\" variant=\"outline\" onClick={selectHigh}>Altos 19-36</Button>\r\n                    <Separator orientation=\"vertical\" className=\"h-6\" />\r\n                    <Button size=\"sm\" variant=\"outline\" onClick={() => selectDozen(1)}>Dúzia 1</Button>\r\n                    <Button size=\"sm\" variant=\"outline\" onClick={() => selectDozen(2)}>Dúzia 2</Button>\r\n                    <Button size=\"sm\" variant=\"outline\" onClick={() => selectDozen(3)}>Dúzia 3</Button>\r\n                    <Separator orientation=\"vertical\" className=\"h-6\" />\r\n                    <Button size=\"sm\" variant=\"outline\" onClick={() => selectColumn(1)}>Coluna 1</Button>\r\n                    <Button size=\"sm\" variant=\"outline\" onClick={() => selectColumn(2)}>Coluna 2</Button>\r\n                    <Button size=\"sm\" variant=\"outline\" onClick={() => selectColumn(3)}>Coluna 3</Button>\r\n                    <Separator orientation=\"vertical\" className=\"h-6\" />\r\n                    <Button size=\"sm\" variant=\"outline\" onClick={invertSelection}>Inverter</Button>\r\n                    <Button size=\"sm\" variant=\"outline\" disabled={!selectedNums.length} onClick={() => addNeighbors(1)}>+ Vizinhos ±1</Button>\r\n                    <Button size=\"sm\" variant=\"outline\" disabled={!selectedNums.length} onClick={() => addNeighbors(2)}>+ Vizinhos ±2</Button>\r\n                  </div>\r\n                  {/* Seletor circular estilo roleta europeia */}\r\n                  <div className=\"relative mx-auto\" style={{ width: 240, height: 240 }}>\r\n                    {EUROPEAN_WHEEL.map((num, i) => {\r\n                      const active = selectedNums.includes(num)\r\n                      const isRed = RED_NUMBERS.includes(num)\r\n                      const isGreen = GREEN_NUMBERS.includes(num)\r\n                      const isBlack = BLACK_NUMBERS.includes(num)\r\n                      const style = isRed\r\n                        ? (active ? 'bg-red-600 hover:bg-red-700 text-white border-red-700' : 'text-red-600 border-red-400 hover:bg-white/10')\r\n                        : isGreen\r\n                        ? (active ? 'bg-green-600 hover:bg-green-700 text-white border-green-700' : 'text-green-600 border-green-300 hover:bg-green-50')\r\n                        : (active ? 'bg-black hover:bg-black text-white border-black' : 'text-white border-white hover:bg-white/10 font-normal')\r\n                      const N = EUROPEAN_WHEEL.length\r\n                      const angle = (2 * Math.PI * i) / N - Math.PI / 2\r\n                      const r = 100\r\n                      const cx = 120\r\n                      const cy = 120\r\n                      const left = cx + r * Math.cos(angle) - 14\r\n                      const top = cy + r * Math.sin(angle) - 14\r\n                      return (\r\n                        <Button\r\n                          key={`wheel-n-${num}`}\r\n                          size=\"sm\"\r\n                          variant={active ? 'default' : 'outline'}\r\n                          className={`h-7 w-7 p-0 absolute ${style}`}\r\n                          style={{ left, top }}\r\n                          onClick={() => toggleNumber(num)}\r\n                        >\r\n                          {num}\r\n                        </Button>\r\n                      )\r\n                    })}\r\n                    {/* Centro decorativo */}\r\n                    <div className=\"absolute rounded-full border border-white/30\" style={{ left: 90, top: 90, width: 60, height: 60 }} />\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"text-[10px] text-muted-foreground mt-2\">Selecionados: {selectedNums.length ? `[${selectedNums.join(', ')}]` : '(nenhum)'}</div>\r\n                <div className=\"mt-2 text-[10px] text-muted-foreground\">\r\n                  <div>Resumo: total {selectedNums.length}; Vermelhos {redsCount}; Pretos {blacksCount}; Zero {zeroCount}</div>\r\n                  <div>Par {evenCount}; Ímpar {oddCount}; Dúzias [ {dozen1Count}, {dozen2Count}, {dozen3Count} ]</div>\r\n                  <div>Colunas [ {col1Count}, {col2Count}, {col3Count} ]</div>\r\n                  <div className=\"mt-1\">MVP: ação = \"Emitir Sinal\"; a seleção de números é opcional e serve para visualização/futuras apostas.</div>\r\n                </div>\r\n              </div>\r\n            )\r\n          }\r\n\r\n          // Seletor visual para números em nós de condição\r\n          if (selectedNode.type === 'condition' && (f.key === 'numero' || f.key === 'numeroAlvo')) {\r\n            const cfg = selectedNode.data.config || {}\r\n            const subtype = String(selectedNode.subtype || '').toLowerCase()\r\n            const evento = String(cfg.evento || '').toLowerCase()\r\n            \r\n            // Só mostrar o picker para condições que usam números específicos\r\n            const shouldShowPicker = (\r\n              subtype === 'specific-number' ||\r\n              subtype === 'repeat-number' ||\r\n              subtype === 'neighbors' ||\r\n              (subtype === 'absence' && evento === 'numero')\r\n            )\r\n            \r\n            if (!shouldShowPicker) {\r\n              return (\r\n                <div key={f.key}>\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <Label className=\"text-xs\">{f.label}</Label>\r\n                    {FIELD_HELP[f.key || '']?.description ? (\r\n                      <TooltipProvider>\r\n                        <Tooltip>\r\n                          <TooltipTrigger asChild>\r\n                            <Info className=\"h-3 w-3 text-muted-foreground cursor-help\" />\r\n                          </TooltipTrigger>\r\n                          <TooltipContent>\r\n                            {FIELD_HELP[f.key || '']!.description}{FIELD_HELP[f.key || '']!.example ? ` • Ex.: ${FIELD_HELP[f.key || '']!.example}` : ''}\r\n                          </TooltipContent>\r\n                        </Tooltip>\r\n                      </TooltipProvider>\r\n                    ) : null}\r\n                  </div>\r\n                  <Input\r\n                    type=\"number\"\r\n                    min={0}\r\n                    max={36}\r\n                    step={1}\r\n                    value={val ?? ''}\r\n                    onChange={(e) => {\r\n                      const next = e.target.value === '' ? undefined : Math.max(0, Math.min(36, Math.round(Number(e.target.value))))\r\n                      updateNode(selectedNode.id, {\r\n                        data: {\r\n                          ...selectedNode.data,\r\n                          config: { ...(selectedNode.data.config || {}), [f.key!]: next }\r\n                        }\r\n                      })\r\n                    }}\r\n                  />\r\n                </div>\r\n              )\r\n            }\r\n\r\n            const currentNumber = typeof val === 'number' ? val : undefined\r\n            \r\n            const selectNumber = (num: number) => {\r\n              updateNode(selectedNode.id, {\r\n                data: {\r\n                  ...selectedNode.data,\r\n                  config: { ...(selectedNode.data.config || {}), [f.key!]: num }\r\n                }\r\n              })\r\n            }\r\n\r\n            const clearSelection = () => {\r\n              updateNode(selectedNode.id, {\r\n                data: {\r\n                  ...selectedNode.data,\r\n                  config: { ...(selectedNode.data.config || {}), [f.key!]: undefined }\r\n                }\r\n              })\r\n            }\r\n\r\n            return (\r\n              <div key={f.key}>\r\n                <div className=\"flex items-center justify-between\">\r\n                  <Label className=\"text-xs\">{f.label}</Label>\r\n                  {FIELD_HELP[f.key || '']?.description ? (\r\n                    <TooltipProvider>\r\n                      <Tooltip>\r\n                        <TooltipTrigger asChild>\r\n                          <Info className=\"h-3 w-3 text-muted-foreground cursor-help\" />\r\n                        </TooltipTrigger>\r\n                        <TooltipContent>\r\n                          {FIELD_HELP[f.key || '']!.description}{FIELD_HELP[f.key || '']!.example ? ` • Ex.: ${FIELD_HELP[f.key || '']!.example}` : ''}\r\n                        </TooltipContent>\r\n                      </Tooltip>\r\n                    </TooltipProvider>\r\n                  ) : null}\r\n                </div>\r\n                \r\n                <div className=\"mt-1 pr-1\">\r\n                  <div className=\"flex flex-wrap gap-1 mb-2\">\r\n                    <Button size=\"sm\" variant=\"outline\" onClick={clearSelection}>Limpar</Button>\r\n                    <Separator orientation=\"vertical\" className=\"h-6\" />\r\n                    <Button size=\"sm\" variant=\"outline\" onClick={() => selectNumber(0)}>Zero</Button>\r\n                    <Button size=\"sm\" variant=\"outline\" onClick={() => selectNumber(RED_NUMBERS[Math.floor(Math.random() * RED_NUMBERS.length)])}>Vermelho Aleatório</Button>\r\n                    <Button size=\"sm\" variant=\"outline\" onClick={() => selectNumber(BLACK_NUMBERS[Math.floor(Math.random() * BLACK_NUMBERS.length)])}>Preto Aleatório</Button>\r\n                  </div>\r\n                  \r\n                  <div className=\"grid grid-cols-9 gap-1\">\r\n                    {Array.from({ length: 37 }, (_, i) => i).map((num) => {\r\n                      const active = currentNumber === num\r\n                      const isRed = RED_NUMBERS.includes(num)\r\n                      const isGreen = GREEN_NUMBERS.includes(num)\r\n                      const isBlack = BLACK_NUMBERS.includes(num)\r\n                      const style = isRed\r\n                        ? (active ? 'bg-red-600 hover:bg-red-700 text-white border-red-700' : 'text-red-600 border-red-400 hover:bg-white/10')\r\n                        : isGreen\r\n                        ? (active ? 'bg-green-600 hover:bg-green-700 text-white border-green-700' : 'text-green-600 border-green-300 hover:bg-green-50')\r\n                        : (active ? 'bg-black hover:bg-black text-white border-black' : 'text-white border-white hover:bg-white/10 font-normal')\r\n                      return (\r\n                        <Button\r\n                          key={`cond-n-${num}`}\r\n                          size=\"sm\"\r\n                          variant={active ? 'default' : 'outline'}\r\n                          className={`h-7 w-7 p-0 ${style}`}\r\n                          onClick={() => selectNumber(num)}\r\n                        >\r\n                          {num}\r\n                        </Button>\r\n                      )\r\n                    })}\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"text-[10px] text-muted-foreground mt-2\">\r\n                  Selecionado: {typeof currentNumber === 'number' ? currentNumber : '(nenhum)'}\r\n                </div>\r\n              </div>\r\n            )\r\n          }\r\n\r\n          // Fallback genérico para arrays\r\n          return (\r\n            <div key={f.key}>\r\n              <div className=\"flex items-center justify-between\">\r\n                <Label className=\"text-xs\">{f.label}</Label>\r\n                {FIELD_HELP[f.key || '']?.description ? (\r\n                  <TooltipProvider>\r\n                    <Tooltip>\r\n                      <TooltipTrigger asChild>\r\n                        <Info className=\"h-3 w-3 text-muted-foreground cursor-help\" />\r\n                      </TooltipTrigger>\r\n                      <TooltipContent>\r\n                        {FIELD_HELP[f.key || '']!.description}{FIELD_HELP[f.key || '']!.example ? ` • Ex.: ${FIELD_HELP[f.key || '']!.example}` : ''}\r\n                      </TooltipContent>\r\n                    </Tooltip>\r\n                  </TooltipProvider>\r\n                ) : null}\r\n              </div>\r\n              <Textarea\r\n                value={Array.isArray(val) ? ((val as any[]).length ? `[${(val as any[]).join(', ')}]` : '') : String(val ?? '')}\r\n                onChange={(e) => {\r\n                  const cleaned = e.target.value.replace(/[\\[\\]]/g, '')\r\n                  const parts = cleaned.split(/[\\s,;]+/).map(s => s.trim()).filter(Boolean)\r\n                  const nums = parts.map(p => Number(p)).filter(n => Number.isFinite(n) && n >= 0 && n <= 36)\r\n                  updateNode(selectedNode.id, {\r\n                    data: {\r\n                      ...selectedNode.data,\r\n                      config: { ...(selectedNode.data.config || {}), [f.key!]: nums }\r\n                    }\r\n                  })\r\n                }}\r\n              />\r\n              <div className=\"text-[10px] text-muted-foreground mt-1\">Separe itens por vírgula ou espaço. Apenas números 0–36 são aceitos.</div>\r\n            </div>\r\n          )\r\n        }\r\n        if (f.type === 'checkbox') {\r\n          return (\r\n            <div key={f.key}>\r\n              <div className=\"flex items-center justify-between\">\r\n                <Label className=\"text-xs\">{f.label}</Label>\r\n                {FIELD_HELP[f.key || '']?.description ? (\r\n                  <TooltipProvider>\r\n                    <Tooltip>\r\n                      <TooltipTrigger asChild>\r\n                        <Info className=\"h-3 w-3 text-muted-foreground cursor-help\" />\r\n                      </TooltipTrigger>\r\n                      <TooltipContent>\r\n                        {FIELD_HELP[f.key || '']!.description}{FIELD_HELP[f.key || '']!.example ? ` • Ex.: ${FIELD_HELP[f.key || '']!.example}` : ''}\r\n                      </TooltipContent>\r\n                    </Tooltip>\r\n                  </TooltipProvider>\r\n                ) : null}\r\n              </div>\r\n              <Switch\r\n                checked={Boolean(val)}\r\n                onCheckedChange={(checked) => updateNode(selectedNode.id, {\r\n                  data: {\r\n                    ...selectedNode.data,\r\n                    config: { ...(selectedNode.data.config || {}), [f.key!]: checked }\r\n                  }\r\n                })}\r\n              />\r\n            </div>\r\n          )\r\n        }\r\n        return (\r\n          <div key={f.key}>\r\n            <div className=\"flex items-center justify-between\">\r\n              <Label className=\"text-xs\">{f.label}</Label>\r\n              {FIELD_HELP[f.key || '']?.description ? (\r\n                <TooltipProvider>\r\n                  <Tooltip>\r\n                    <TooltipTrigger asChild>\r\n                      <Info className=\"h-3 w-3 text-muted-foreground cursor-help\" />\r\n                    </TooltipTrigger>\r\n                    <TooltipContent>\r\n                      {FIELD_HELP[f.key || '']!.description}{FIELD_HELP[f.key || '']!.example ? ` • Ex.: ${FIELD_HELP[f.key || '']!.example}` : ''}\r\n                    </TooltipContent>\r\n                  </Tooltip>\r\n                </TooltipProvider>\r\n              ) : null}\r\n            </div>\r\n            <Input\r\n              value={String(val ?? '')}\r\n              onChange={(e) => updateNode(selectedNode.id, {\r\n                data: {\r\n                  ...selectedNode.data,\r\n                  config: { ...(selectedNode.data.config || {}), [f.key!]: e.target.value }\r\n                }\r\n              })}\r\n            />\r\n          </div>\r\n        )\r\n      })\r\n    }\r\n\r\n    return Object.entries(selectedNode.data.config).map(([key, value]) => {\r\n      const help = FIELD_HELP[key]\r\n      const label = help?.label || key\r\n      const isBool = typeof value === 'boolean' || String(value).toLowerCase() === 'true' || String(value).toLowerCase() === 'false'\r\n      const isNumber = typeof value === 'number' || (/^-?\\d+(\\.\\d+)?$/.test(String(value)))\r\n      const isArray = Array.isArray(value)\r\n\r\n      return (\r\n        <div key={key}>\r\n          <div className=\"flex items-center justify-between\">\r\n            <Label className=\"text-xs\">{label}</Label>\r\n            {help?.description ? (\r\n              <TooltipProvider>\r\n                <Tooltip>\r\n                  <TooltipTrigger asChild>\r\n                    <Info className=\"h-3 w-3 text-muted-foreground cursor-help\" />\r\n                  </TooltipTrigger>\r\n                  <TooltipContent>\r\n                    {help.description}{help.example ? ` &bull; Ex.: ${help.example}` : ''}\r\n                  </TooltipContent>\r\n                </Tooltip>\r\n              </TooltipProvider>\r\n            ) : null}\r\n          </div>\r\n\r\n          {isBool ? (\r\n            <Switch\r\n              checked={String(value).toLowerCase() === 'true'}\r\n              onCheckedChange={(checked) => updateNode(selectedNode.id, {\r\n                data: {\r\n                  ...selectedNode.data,\r\n                  config: { ...selectedNode.data.config, [key]: checked }\r\n                }\r\n              })}\r\n            />\r\n          ) : isNumber ? (\r\n            <Input\r\n              type=\"number\"\r\n              min={key === 'numero' || key === 'numeroAlvo' ? 0 : undefined}\r\n              max={key === 'numero' || key === 'numeroAlvo' ? 36 : undefined}\r\n              step={key === 'stake' ? 0.01 : undefined}\r\n              value={String(value)}\r\n              onChange={(e) => {\r\n                const raw = Number(e.target.value)\r\n                const isNumeroField = (key === 'numero' || key === 'numeroAlvo')\r\n                const isComprimento = (key === 'comprimento')\r\n                const isJanelaGeneric = (key === 'janela' || key === 'inicio' || key === 'fim')\r\n                const isOcorrencias = (key === 'ocorrencias')\r\n                const isProtecaoOrLimite = (key === 'protecaoLimite' || key === 'limiteRodadas')\r\n                let next = raw\r\n                next = isNumeroField ? Math.max(0, Math.min(36, next)) : next\r\n                next = isComprimento ? Math.max(2, next) : next\r\n                next = isJanelaGeneric ? Math.max(1, next) : next\r\n                next = isOcorrencias ? Math.max(1, next) : next\r\n                if (key === 'protecaoLimite') {\r\n                  next = Math.min(10, Math.max(0, Math.floor(next)))\r\n                } else {\r\n                  next = isProtecaoOrLimite ? Math.max(0, next) : next\r\n                }\r\n                updateNode(selectedNode.id, {\r\n                  data: {\r\n                    ...selectedNode.data,\r\n                    config: { ...selectedNode.data.config, [key]: next }\r\n                  }\r\n                })\r\n              }}\r\n            />\r\n          ) : isArray ? (\r\n            <Textarea\r\n              value={Array.isArray(value) ? ((value as any[]).length ? `[${(value as any[]).join(', ')}]` : '') : String(value ?? '')}\r\n              onChange={(e) => {\r\n                const cleaned = e.target.value.replace(/[\\[\\]]/g, '')\r\n                const parts = cleaned.split(/[\\s,;]+/).map(s => s.trim()).filter(Boolean)\r\n                const nums = parts.map(p => Number(p)).filter(n => Number.isFinite(n) && n >= 0 && n <= 36)\r\n                updateNode(selectedNode.id, {\r\n                  data: { \r\n                    ...selectedNode.data,\r\n                    config: { ...selectedNode.data.config, [key]: nums } \r\n                  }\r\n                })\r\n              }}\r\n            />\r\n          ) : (\r\n            <Input\r\n              value={String(value)}\r\n              onChange={(e) => updateNode(selectedNode.id, {\r\n                data: { \r\n                  ...selectedNode.data,\r\n                  config: { ...selectedNode.data.config, [key]: e.target.value } \r\n                }\r\n              })}\r\n            />\r\n          )}\r\n          {help?.example ? <div className=\"text-[10px] text-muted-foreground mt-1\">Ex.: {help.example}</div> : null}\r\n        </div>\r\n      )\r\n    })\r\n  }\r\n\r\n  return (\r\n    <DashboardLayout>\r\n      <div className=\"space-y-4\">\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between\">\r\n            <div>\r\n              <CardTitle>{((builderSpec.layout.sections.header.elements.find((e: any) => e.type === 'title') as any)?.value) ?? 'Builder'}</CardTitle>\r\n              <p className=\"text-sm text-muted-foreground\">{builderSpec.page.description}</p>\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <input\r\n                ref={importInputRef}\r\n                type=\"file\"\r\n                accept=\"application/json\"\r\n                className=\"hidden\"\r\n                onChange={handleImportFile}\r\n              />\r\n              {/* Removido export geral para priorizar download individual por estratÃ©gia */}\r\n              <Button variant=\"outline\" onClick={() => importInputRef.current?.click()}>\r\n                <RotateCcw className=\"mr-2 h-4 w-4\" />\r\n                Importar JSON\r\n              </Button>\r\n\r\n              <Button onClick={createNewStrategy}>\r\n                <Puzzle className=\"mr-2 h-4 w-4\" />\r\n                {((builderSpec.layout.sections.header.elements.find((e: any) => e.type === 'button') as any)?.label) ?? 'Nova Estratégia'}\r\n              </Button>\r\n            </div>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <Tabs value={activeTab} onValueChange={setActiveTab}>\r\n              <TabsList>\r\n                {(((builderSpec.layout.sections.header.elements.find((e: any) => e.type === 'tabs') as any)?.options) ?? ['Estratégias', 'Templates', 'Performance']).map((opt: string) => (\r\n                  <TabsTrigger key={opt.toLowerCase()} value={opt.toLowerCase()}>{opt}</TabsTrigger>\r\n                ))}\r\n              </TabsList>\r\n              <TabsContent value=\"estratégias\">\r\n                {strategies.length === 0 ? (\r\n                    <div className=\"p-3 border rounded-md bg-muted/20\">\r\n                      <div className=\"text-sm text-muted-foreground\">Nenhuma estratégia salva ainda. Use o botão no topo para criar uma nova.</div>\r\n                    </div>\r\n                  ) : (\r\n                  <div className=\"space-y-4\">\r\n                    <div className=\"space-y-2\">\r\n                      {strategies.map(s => (\r\n                        <Card key={s.id}>\r\n                          <CardContent className=\"py-3 flex items-center justify-between\">\r\n                            <div>\r\n                              <div className=\"font-medium\">{s.name}</div>\r\n                              <div className=\"text-xs text-muted-foreground\">\r\n                                {s.status === 'active' ? 'Ativa' : 'Pausada'} &bull; {Array.isArray(s.nodes) ? s.nodes.length : 0} nós &bull; atualizado {new Date(s.updatedAt).toLocaleString()}\r\n                              </div>\r\n                            </div>\r\n                            <div className=\"flex items-center\">\r\n                              <DropdownMenu>\r\n                                <DropdownMenuTrigger asChild>\r\n                                  <Button variant=\"ghost\" size=\"icon\" aria-label=\"Mais ações\">\r\n                                    <MoreVertical className=\"h-5 w-5\" />\r\n                                  </Button>\r\n                                </DropdownMenuTrigger>\r\n                                <DropdownMenuContent align=\"end\">\r\n                                  <DropdownMenuItem onClick={() => editStrategy(s.id)}>\r\n                                    Editar\r\n                                  </DropdownMenuItem>\r\n                                  <DropdownMenuItem onClick={() => exportStrategyFile(s.id)}>\r\n                                    <Save className=\"mr-2 h-4 w-4\" /> Baixar JSON\r\n                                  </DropdownMenuItem>\r\n                                  <DropdownMenuSeparator />\r\n                                  <DropdownMenuItem className=\"text-destructive\" onClick={() => setConfirmDeleteId(s.id)}>\r\n                                    <Trash2 className=\"mr-2 h-4 w-4\" /> Excluir\r\n                                  </DropdownMenuItem>\r\n                                </DropdownMenuContent>\r\n                              </DropdownMenu>\r\n                            </div>\r\n                          </CardContent>\r\n                        </Card>\r\n                      ))}\r\n                    </div>\r\n\r\n                    <Separator />\r\n                    <div>\r\n                      <div className=\"text-sm font-medium mb-2\">Templates disponíveis</div>\r\n                      {templates.length === 0 ? (\r\n                        <div className=\"p-3 border rounded-md bg-muted/20\">\r\n                          <div className=\"text-sm font-medium mb-1\">Nenhum template disponível</div>\r\n                          <div className=\"text-xs text-muted-foreground mb-2\">Carregue templates ou crie uma nova estratégia.</div>\r\n                          <div className=\"flex gap-2\">\r\n                            <Button onClick={createNewStrategy}>\r\n                              <Puzzle className=\"mr-2 h-4 w-4\" /> Nova Estratégia\r\n                            </Button>\r\n                            <Button variant=\"secondary\" onClick={refreshTemplates}>\r\n                              <RotateCcw className=\"mr-2 h-4 w-4\" /> Carregar Templates\r\n                            </Button>\r\n                          </div>\r\n                        </div>\r\n                      ) : (\r\n                        <div className=\"space-y-2\">\r\n                          {templates.map((tpl: any) => (\r\n                            <Card key={tpl.id || tpl.template_key || tpl.name}>\r\n                              <CardContent className=\"py-3 flex items-center justify-between\">\r\n                                <div>\r\n                                  <div className=\"font-medium flex items-center\">\r\n                                    {tpl.name}\r\n                                    <Badge variant=\"outline\" className=\"ml-2\">Template</Badge>\r\n                                  </div>\r\n                                  <div className=\"text-xs text-muted-foreground\">\r\n                                    {tpl.description || 'Template do Builder'}\r\n                                  </div>\r\n                                  <div className=\"text-[11px] text-muted-foreground mt-1\">\r\n                                    {tpl.is_published\r\n                                      ? `Publicado como: ${tpl.published_strategy_slug || 'estratégia dinâmica'}`\r\n                                      : 'Ainda não publicado como estratégia dinâmica'}\r\n                                  </div>\r\n                                </div>\r\n                                <div className=\"flex items-center gap-2\">\r\n                                  <Button variant=\"outline\" onClick={() => editTemplate(tpl)}>\r\n                                    <Edit3 className=\"mr-2 h-4 w-4\" /> Editar Template\r\n                                  </Button>\r\n                                  <Button variant=\"outline\" onClick={() => duplicateTemplate(tpl)}>\r\n                                    <Puzzle className=\"mr-2 h-4 w-4\" /> Duplicar Estratégia\r\n                                  </Button>\r\n                                  <Button variant=\"outline\" onClick={() => exportTemplateFile(tpl)}>\r\n                                    <Download className=\"mr-2 h-4 w-4\" /> Baixar Template\r\n                                  </Button>\r\n                                  <Button\r\n                                    onClick={() => publishTemplate(tpl)}\r\n                                    disabled={tpl.is_published}\r\n                                  >\r\n                                    {tpl.is_published ? 'Publicado' : 'Publicar'}\r\n                                  </Button>\r\n                                </div>\r\n                              </CardContent>\r\n                            </Card>\r\n                          ))}\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </TabsContent>\r\n              <TabsContent value=\"templates\">\r\n                {templates.length === 0 ? (\r\n                    <div className=\"p-3 border rounded-md bg-muted/20\">\r\n                      <div className=\"text-sm font-medium mb-1\">Nenhum template disponível</div>\r\n                      <div className=\"text-xs text-muted-foreground mb-2\">Carregue templates ou crie uma nova estratégia.</div>\r\n                      <div className=\"flex gap-2\">\r\n                        <Button onClick={createNewStrategy}>\r\n                          <Puzzle className=\"mr-2 h-4 w-4\" /> Nova Estratégia\r\n                        </Button>\r\n                        <Button variant=\"secondary\" onClick={refreshTemplates}>\r\n                          <RotateCcw className=\"mr-2 h-4 w-4\" /> Carregar Templates\r\n                        </Button>\r\n                      </div>\r\n                    </div>\r\n                  ) : (\r\n                  <div className=\"space-y-3\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <Input\r\n                        placeholder=\"Buscar template por nome...\"\r\n                        value={templateQuery}\r\n                        onChange={(e) => setTemplateQuery(e.target.value)}\r\n                      />\r\n                    </div>\r\n                    {(templates.filter((tpl: any) => (tpl.name || '').toLowerCase().includes(templateQuery.toLowerCase()))).map((tpl: any) => (\r\n                      <Card key={tpl.id || tpl.template_key || tpl.name}>\r\n                        <CardContent className=\"py-3 flex items-center justify-between\">\r\n                          <div>\r\n                            <div className=\"font-medium flex items-center\">\r\n                              {tpl.name}\r\n                              <Badge variant=\"outline\" className=\"ml-2\">Template</Badge>\r\n                            </div>\r\n                            <div className=\"text-xs text-muted-foreground\">\r\n                              {tpl.description || 'Template do Builder'}\r\n                            </div>\r\n                            <div className=\"text-[11px] text-muted-foreground mt-1\">\r\n                              {tpl.is_published\r\n                                ? `Publicado como: ${tpl.published_strategy_slug || 'estratégia dinâmica'}`\r\n                                : 'Ainda não publicado como estratégia dinâmica'}\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <Button variant=\"outline\" onClick={() => editTemplate(tpl)}>\r\n                              <Edit3 className=\"mr-2 h-4 w-4\" /> Editar Template\r\n                            </Button>\r\n                            <Button variant=\"outline\" onClick={() => duplicateTemplate(tpl)}>\r\n                              <Puzzle className=\"mr-2 h-4 w-4\" /> Duplicar Estratégia\r\n                            </Button>\r\n                            <Button variant=\"outline\" onClick={() => exportTemplateFile(tpl)}>\r\n                              <Download className=\"mr-2 h-4 w-4\" /> Baixar Template\r\n                            </Button>\r\n                            <Button\r\n                              onClick={() => publishTemplate(tpl)}\r\n                              disabled={tpl.is_published}\r\n                            >\r\n                              {tpl.is_published ? 'Publicado' : 'Publicar'}\r\n                            </Button>\r\n                          </div>\r\n                        </CardContent>\r\n                      </Card>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </TabsContent>\r\n              <TabsContent value=\"performance\">\r\n                <div className=\"text-sm text-muted-foreground\">Métricas agregadas e top estratégias.</div>\r\n              </TabsContent>\r\n            </Tabs>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <AlertDialog open={!!confirmDeleteId} onOpenChange={(open) => { if (!open) setConfirmDeleteId(null) }}>\r\n          <AlertDialogContent>\r\n            <AlertDialogHeader>\r\n              <AlertDialogTitle>Excluir estratégia?</AlertDialogTitle>\r\n              <AlertDialogDescription>Esta ação é permanente. Confirme para excluir.</AlertDialogDescription>\r\n            </AlertDialogHeader>\r\n            <AlertDialogFooter>\r\n              <AlertDialogCancel>Cancelar</AlertDialogCancel>\r\n              <AlertDialogAction\r\n                className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\r\n                onClick={() => {\r\n                  if (confirmDeleteId) {\r\n                    deleteStrategyRecord(confirmDeleteId)\r\n                    setConfirmDeleteId(null)\r\n                  }\r\n                }}\r\n              >\r\n                Excluir\r\n              </AlertDialogAction>\r\n            </AlertDialogFooter>\r\n          </AlertDialogContent>\r\n        </AlertDialog>\r\n\r\n        <Dialog open={isBuilderOpen} onOpenChange={setIsBuilderOpen}>\r\n          <DialogContent className=\"max-w-6xl\">\r\n            <DialogHeader>\r\n              <DialogTitle>{builderSpec.page.title}</DialogTitle>\r\n              <DialogDescription>Monte sua estratégia arrastando componentes, configurando propriedades e salvando quando pronto.</DialogDescription>\r\n            </DialogHeader>\r\n            <Input\r\n              value={draftStrategyName}\r\n              onChange={(e) => setDraftStrategyName(e.target.value)}\r\n              placeholder=\"Defina o nome da estratégia\"\r\n              className=\"h-8 m-0\"\r\n            />\r\n            <div className={`flex gap-4 ${isFullscreen ? 'h-[100vh]' : ''} min-h-0`} ref={builderRef}>\r\n              <Card className=\"w-64\">\r\n                <CardHeader>\r\n                  <CardTitle className=\"text-base\">{builderSpec.builderModal.columns.toolbox.title}</CardTitle>\r\n                </CardHeader>\r\n                <CardContent>\r\n                  <ScrollArea className={`${isFullscreen ? 'h-[calc(100vh-140px)]' : 'h-[480px]'} pr-2`}>\r\n                    <div className=\"space-y-6\">\r\n                      {builderSpec.builderModal.columns.toolbox.categories.map((cat) => (\r\n                        <div key={cat.name}>\r\n                          <div className=\"text-xs font-medium text-muted-foreground mb-2\">{cat.name}</div>\r\n                          <div className=\"space-y-2\">\r\n                            {cat.nodes.map((n) => (\r\n                              <div\r\n                                key={(n.subtype || n.label) + n.type}\r\n                                className=\"p-2 border rounded-sm cursor-move hover:bg-muted\"\r\n                                draggable\r\n                                onDragStart={() => setDraggedTpl({ type: n.type as NodeType, subtype: n.subtype, label: n.label, defaultConfig: n.defaultConfig })}\r\n                                onClick={() => addNodeFromTemplate({ type: n.type as NodeType, subtype: n.subtype, label: n.label, defaultConfig: n.defaultConfig }, { x: 40, y: 40 })}\r\n                              >\r\n                                <div className=\"text-sm\">{n.label}</div>\r\n                                <div className=\"text-[11px] text-muted-foreground\">{n.description}</div>\r\n                              </div>\r\n                            ))}\r\n                          </div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  </ScrollArea>\r\n                </CardContent>\r\n              </Card>\r\n\r\n              <Card className=\"flex-1\">\r\n                <CardHeader>\r\n                  <CardTitle className=\"text-base\">Canvas</CardTitle>\r\n                </CardHeader>\r\n                <CardContent>\r\n                  <div\r\n                    ref={canvasRef}\r\n                    className={`relative ${isFullscreen ? 'h-[100vh]' : 'h-[520px]'} border rounded-sm bg-background`}\r\n                    onDragOver={(e) => e.preventDefault()}\r\n                    onDrop={handleCanvasDrop}\r\n                  >\r\n                    <Button className=\"absolute right-2 top-2 z-10\" size=\"sm\" variant=\"outline\" onClick={toggleFullscreen}>\r\n                      {isFullscreen ? 'Sair de tela cheia' : 'Tela cheia'}\r\n                    </Button>\r\n                    <ReactFlow\r\n                      nodes={rfNodes}\r\n                      edges={rfEdges}\r\n                      fitView\r\n                      onConnect={handleConnect}\r\n                      onEdgesDelete={onEdgesDelete}\r\n                      onNodeDragStop={onNodeDragStop}\r\n                      onNodeClick={onNodeClick}\r\n                      onEdgeClick={onEdgeClick}\r\n                      style={{ width: '100%', height: '100%' }}\r\n                    >\r\n                      <Background />\r\n                      <Controls />\r\n                    </ReactFlow>\r\n                    <div className=\"absolute bottom-2 left-2 z-10 p-2 rounded bg-white/90 shadow text-[11px] space-y-1\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <CheckCircle className=\"h-3.5 w-3.5 text-green-600\" />\r\n                        <div className=\"h-[0px] w-10 border-t-2 border-green-600\" />\r\n                        <span>success</span>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <XCircle className=\"h-3.5 w-3.5 text-red-600\" />\r\n                        <div className=\"h-[0px] w-10 border-t-2 border-red-600 border-dashed\" />\r\n                        <span>failure</span>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <AlertTriangle className=\"h-3.5 w-3.5 text-blue-600\" />\r\n                        <div className=\"h-[0px] w-10 border-t-2 border-blue-600 border-dotted\" />\r\n                        <span>condition</span>\r\n                      </div>\r\n                    </div>\r\n                    {nodes.length === 0 ? (\r\n                      <div className=\"absolute inset-0 pointer-events-none flex items-center justify-center text-muted-foreground\">\r\n                        <div className=\"flex flex-col items-center gap-2\">\r\n                          <Layers className=\"h-8 w-8\" />\r\n                          <div className=\"text-sm text-center max-w-[360px]\">{builderSpec.builderModal.columns.canvas.emptyStateText}</div>\r\n                        </div>\r\n                      </div>\r\n                    ) : null}\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n\r\n              <Card className={`w-80 ${isFullscreen ? 'h-[100vh]' : ''} overflow-hidden`}>\r\n                <CardHeader>\r\n                  <CardTitle className=\"text-base\">{builderSpec.builderModal.columns.propertiesPanel.title}</CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <ScrollArea className={`${isFullscreen ? 'h-[calc(100vh-140px)]' : 'h-[520px]'} pr-2`}>\r\n            {selectedEdgeId ? (\r\n              <div className=\"space-y-3\">\r\n                <div className=\"text-sm\">Editar conexão</div>\r\n                <div className=\"text-xs text-muted-foreground\">\r\n                  De: {nodes.find(n => n.id === (connections.find(c => c.id === selectedEdgeId)?.source))?.data.label || connections.find(c => c.id === selectedEdgeId)?.source}\r\n                  {' '}&rarr;{' '}\r\n                  Para: {nodes.find(n => n.id === (connections.find(c => c.id === selectedEdgeId)?.target))?.data.label || connections.find(c => c.id === selectedEdgeId)?.target}\r\n                </div>\r\n                <div>\r\n                  <Label className=\"text-xs\">Tipo da conexão</Label>\r\n                  <Select\r\n                    value={connections.find(c => c.id === selectedEdgeId)?.type || 'success'}\r\n                    onValueChange={(val) =>\r\n                      setConnections(prev => prev.map(c => c.id === selectedEdgeId ? { ...c, type: val as 'success' | 'failure' | 'condition' } : c))\r\n                    }\r\n                  >\r\n                    <SelectTrigger className=\"h-8\">\r\n                      <SelectValue placeholder=\"Selecione\" />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      <SelectItem value=\"success\">\r\n                        <div className=\"flex items-center gap-2\"><CheckCircle className=\"h-3.5 w-3.5 text-green-600\" /> success</div>\r\n                      </SelectItem>\r\n                      <SelectItem value=\"failure\">\r\n                        <div className=\"flex items-center gap-2\"><XCircle className=\"h-3.5 w-3.5 text-red-600\" /> failure</div>\r\n                      </SelectItem>\r\n                      <SelectItem value=\"condition\">\r\n                        <div className=\"flex items-center gap-2\"><AlertTriangle className=\"h-3.5 w-3.5 text-blue-600\" /> condition</div>\r\n                      </SelectItem>\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n                <div className=\"flex gap-2\">\r\n                  <Button variant=\"destructive\" onClick={() => {\r\n                    setConnections(prev => prev.filter(c => c.id !== selectedEdgeId))\r\n                    setSelectedEdgeId(null)\r\n                  }}>\r\n                    <Trash2 className=\"mr-2 h-4 w-4\" /> Excluir conexão\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n            ) : !selectedNode ? (\r\n              <div className=\"text-sm text-muted-foreground\">Selecione um nó ou conexão para editar.</div>\r\n            ) : (\r\n              <div className=\"space-y-3\">\r\n                <div className=\"space-y-2\">\r\n                  <div>\r\n                    <Label className=\"text-xs\">Rótulo</Label>\r\n                    <Input\r\n                      value={selectedNode.data.label}\r\n                      onChange={(e) => updateNode(selectedNode.id, { data: { ...selectedNode.data, label: e.target.value } })}\r\n                    />\r\n                  </div>\r\n                  <div className=\"flex gap-2\">\r\n                    <Button variant=\"destructive\" size=\"sm\" className=\"h-7 px-2\" onClick={() => deleteNode(selectedNode.id)}>\r\n                      <Trash2 className=\"mr-1 h-3 w-3\" /> Excluir\r\n                    </Button>\r\n                  </div>\r\n                </div>\r\n\r\n                {selectedNode.type === 'condition' && (\r\n                  <Collapsible>\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <Label className=\"text-xs\">Tipo de condição</Label>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <TooltipProvider>\r\n                          <Tooltip>\r\n                            <TooltipTrigger asChild>\r\n                              <Info className=\"h-3 w-3 text-muted-foreground cursor-help\" />\r\n                            </TooltipTrigger>\r\n                            <TooltipContent>\r\n                              Escolha um tipo para ver campos específicos. Se importou de JSON e o tipo não foi reconhecido, mantenha \"Genérico (importado)\".\r\n                            </TooltipContent>\r\n                          </Tooltip>\r\n                        </TooltipProvider>\r\n                        <CollapsibleTrigger asChild>\r\n                          <Button variant=\"ghost\" size=\"sm\" className=\"px-2 h-6\">\r\n                            <ChevronRight className=\"mr-1 h-3 w-3\" /> Alterar\r\n                          </Button>\r\n                        </CollapsibleTrigger>\r\n                      </div>\r\n                    </div>\r\n                    <CollapsibleContent className=\"mt-2\">\r\n                      <Select\r\n                        value={selectedNode.subtype || selectedNode.data.conditionType || 'generic'}\r\n                        onValueChange={(val) => {\r\n                          const tplNode = conditionTemplates.find(n => String(n.subtype || '') === val)\r\n                          updateNode(selectedNode.id, {\r\n                            subtype: val,\r\n                            data: {\r\n                              ...selectedNode.data,\r\n                              conditionType: val,\r\n                              config: tplNode?.defaultConfig ? { ...tplNode.defaultConfig } : { ...selectedNode.data.config }\r\n                            }\r\n                          })\r\n                        }}\r\n                      >\r\n                        <SelectTrigger className=\"h-8\">\r\n                          <SelectValue placeholder=\"Selecione\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent>\r\n                          <SelectItem value=\"generic\">Genérico (importado)</SelectItem>\r\n                          {conditionTemplates.map(n => (\r\n                            <SelectItem key={String(n.subtype || n.label)} value={String(n.subtype || '')}>{n.label}</SelectItem>\r\n                          ))}\r\n                        </SelectContent>\r\n                      </Select>\r\n                    </CollapsibleContent>\r\n                  </Collapsible>\r\n                )}\r\n\r\n                {selectedNode.type === 'condition' ? (\r\n                  (() => {\r\n                    const msgs = getConditionValidationMessages(selectedNode)\r\n                    return msgs.length ? (\r\n                      <div className=\"mt-2 rounded border border-yellow-300 bg-yellow-50 text-yellow-800 text-xs p-2 space-y-1\">\r\n                        {msgs.map((m, i) => (\r\n                          <div key={`${m}-${i}`} className=\"flex items-center gap-1\">\r\n                            <AlertTriangle className=\"h-3 w-3\" /> {m}\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                    ) : null\r\n                  })()\r\n                ) : null}\r\n\r\n                {renderFields()}\r\n              </div>\r\n            )}\r\n            </ScrollArea>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n      <Separator className=\"my-4\" />\r\n      <DialogFooter className=\"sm:justify-between\">\r\n        <div className=\"flex items-center gap-3\">\r\n          <div className=\"flex items-center gap-2 mt-5\">\r\n            <Switch checked={gatingEnabled} onCheckedChange={setGatingEnabled} />\r\n            <Label className=\"text-xs\">Limites (gating)</Label>\r\n          </div>\r\n          <div className=\"space-y-1 mt-5\">\r\n            <Label className=\"text-xs\">Amostra real (giros)</Label>\r\n            <Input\r\n              type=\"number\"\r\n              min={1}\r\n              max={500}\r\n              value={realHistoryLimit}\r\n              onChange={(e) => {\r\n                const val = Math.floor(Number(e.target.value) || 0)\r\n                setRealHistoryLimit(val)\r\n              }}\r\n              onBlur={() => setRealHistoryLimit((prev) => Math.max(1, Math.min(500, Math.floor(prev || 0))))}\r\n              className={`h-8 w-[120px] ${realHistoryLimit < 1 || realHistoryLimit > 500 ? 'border-red-500' : ''}`}\r\n            />\r\n            <p className=\"text-[10px] text-muted-foreground\">1–500; usado ao testar com histórico real.</p>\r\n          </div>\r\n          <TooltipProvider>\r\n            <Tooltip>\r\n              <TooltipTrigger asChild>\r\n                <Button variant=\"secondary\" onClick={unifiedTest} disabled={isTesting || isValidatingServer} className=\"mt-5\">\r\n                  <Play className=\"mr-2 h-4 w-4\" /> {isTesting ? 'Testando...' : 'Testar'}\r\n                </Button>\r\n              </TooltipTrigger>\r\n              <TooltipContent>Executa o teste (usa histórico real quando disponível)</TooltipContent>\r\n            </Tooltip>\r\n          </TooltipProvider>\r\n        </div>\r\n        <div className=\"flex items-center gap-2 mt-5\">\r\n          <Button variant=\"outline\" onClick={saveAsTemplate}>\r\n            <Save className=\"mr-2 h-4 w-4\" /> Salvar como Template\r\n          </Button>\r\n          <Button onClick={saveStrategy}>\r\n            <Save className=\"mr-2 h-4 w-4\" /> Salvar Estratégia\r\n          </Button>\r\n        </div>\r\n      </DialogFooter>\r\n    </DialogContent>\r\n        </Dialog >\r\n    <Dialog open={isTestReportOpen} onOpenChange={setIsTestReportOpen}>\r\n      <DialogContent className=\"sm:max-w-3xl\">\r\n        <DialogHeader>\r\n          <DialogTitle>Relatório de Teste</DialogTitle>\r\n          <DialogDescription>Resumo visual da execução local</DialogDescription>\r\n        </DialogHeader>\r\n        <div className=\"space-y-3\">\r\n          {testReport.errors.length > 0 ? (\r\n            <div className=\"space-y-2\">\r\n              <Label className=\"text-xs\">Erros</Label>\r\n              <ul className=\"list-disc pl-4 text-sm\">\r\n                {testReport.errors.map((e, i) => <li key={i}>{e}</li>)}\r\n              </ul>\r\n            </div>\r\n          ) : (\r\n            <>\r\n              <div className=\"grid grid-cols-2 gap-2 text-sm\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Layers className=\"h-4 w-4 text-muted-foreground\" />\r\n                  Nós: {testReport.summary.visited} / {testReport.summary.totalNodes}\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Puzzle className=\"h-4 w-4 text-muted-foreground\" />\r\n                  Conexões: {testReport.summary.totalConnections}\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <RotateCcw className=\"h-4 w-4 text-muted-foreground\" />\r\n                  Duração: {Math.round(testReport.summary.durationMs)} ms\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Badge variant=\"outline\">Origem: {String((testReport.summary as any).source || 'manual')}</Badge>\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Badge variant=\"outline\">Amostra: {Number((testReport.summary as any).sampleSize || 0)} giros</Badge>\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Badge variant=\"outline\">Janela efetiva: {Number((testReport.summary as any).effectiveWindow || 0)}</Badge>\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                  {testReport.signals.length > 0 ? (\r\n                    <CheckCircle className=\"h-4 w-4 text-green-600\" />\r\n                  ) : (\r\n                    <XCircle className=\"h-4 w-4 text-red-600\" />\r\n                  )}\r\n                  Resultado: {testReport.signals.length > 0 ? 'Sinal gerado' : 'Nenhum sinal gerado'}\r\n                </div>\r\n              </div>\r\n\r\n              <Separator />\r\n\r\n              <div className=\"space-y-2\">\r\n                <Label className=\"text-xs\">Fluxo lógico</Label>\r\n                <div className=\"flex items-center flex-wrap gap-2 text-sm\">\r\n                  {testReport.results.map((r, idx) => (\r\n                    <React.Fragment key={r.nodeId}>\r\n                      <div className=\"inline-flex items-center gap-1 rounded border px-2 py-1\">\r\n                        {r.pass === undefined ? (\r\n                          <AlertTriangle className=\"h-3 w-3 text-yellow-600\" />\r\n                        ) : r.pass ? (\r\n                          <CheckCircle className=\"h-3 w-3 text-green-600\" />\r\n                        ) : (\r\n                          <XCircle className=\"h-3 w-3 text-red-600\" />\r\n                        )}\r\n                        <span className=\"font-medium\">{r.label}</span>\r\n                      </div>\r\n                      {idx < testReport.results.length - 1 && (\r\n                        <ChevronRight className=\"h-3 w-3 text-muted-foreground\" />\r\n                      )}\r\n                    </React.Fragment>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n\r\n              <Separator />\r\n\r\n              <div className=\"space-y-2\">\r\n                <Label className=\"text-xs\">Condições avaliadas</Label>\r\n                <ScrollArea className=\"h-24\">\r\n                  <ul className=\"text-sm space-y-1\">\r\n                    {testReport.results.filter(r => r.type === 'condition').map((r) => (\r\n                      <li key={r.nodeId} className=\"flex items-center gap-2\">\r\n                        {r.pass ? (\r\n                          <CheckCircle className=\"h-3 w-3 text-green-600\" />\r\n                        ) : (\r\n                          <XCircle className=\"h-3 w-3 text-red-600\" />\r\n                        )}\r\n                        <span className=\"font-medium\">{r.label}</span>\r\n                        <span className=\"text-muted-foreground\">{r.subtype ? `(${r.subtype})` : ''}</span>\r\n                      </li>\r\n                    ))}\r\n                    {testReport.results.filter(r => r.type === 'condition').length === 0 && (\r\n                      <li className=\"text-muted-foreground\">Nenhuma condição foi avaliada.</li>\r\n                    )}\r\n                  </ul>\r\n                </ScrollArea>\r\n              </div>\r\n\r\n              <Separator />\r\n\r\n              <div className=\"space-y-2\">\r\n                <Label className=\"text-xs\">Sinais gerados</Label>\r\n                <ScrollArea className=\"h-24\">\r\n                  <ul className=\"text-sm space-y-1\">\r\n                    {testReport.signals.length === 0 ? (\r\n                      <li className=\"text-muted-foreground\">Nenhum sinal gerado.</li>\r\n                    ) : testReport.signals.map((s) => (\r\n                      <li key={s.nodeId}>\r\n                        <strong>{s.label}</strong> &bull; ação: {s.acao} &bull; prioridade: {s.prioridade || 'normal'} {s.mensagem ? `&bull; ${s.mensagem}` : ''}\r\n                      </li>\r\n                    ))}\r\n                  </ul>\r\n                </ScrollArea>\r\n              </div>\r\n\r\n              <Separator />\r\n\r\n              {/* Derivação (automatic/hybrid) */}\r\n              {testReport.resolver ? (\r\n                <div className=\"space-y-2\">\r\n                  <Label className=\"text-xs\">Derivação (automatic/hybrid)</Label>\r\n                  <div className=\"text-sm\">Modo: {testReport.resolver.mode || '(desconhecido)'}</div>\r\n                  <div className=\"text-sm\">Números derivados: {testReport.resolver.derivedNumbers?.length ? `[${testReport.resolver.derivedNumbers.join(', ')}]` : '(nenhum)'}</div>\r\n                  \r\n                  {/* Enhanced telemetry display */}\r\n                  {(testReport.resolver as any)?.telemetry?.source_chain && (\r\n                    <div className=\"space-y-1\">\r\n                      <Label className=\"text-xs\">Cadeia de origem</Label>\r\n                      <div className=\"text-xs bg-muted p-2 rounded font-mono\">\r\n                        {(testReport.resolver as any).telemetry.source_chain}\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                  \r\n                  {(testReport.resolver as any)?.telemetry?.reasoning && (\r\n                    <div className=\"space-y-1\">\r\n                      <Label className=\"text-xs\">Raciocínio</Label>\r\n                      <div className=\"text-xs bg-muted p-2 rounded\">\r\n                        {(testReport.resolver as any).telemetry.reasoning}\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                  \r\n                  <div className=\"text-xs text-muted-foreground\">Fontes: {(Array.isArray(testReport.resolver.telemetry?.derivedBy) ? testReport.resolver.telemetry.derivedBy.length : 0)} regras aplicadas</div>\r\n                  <div className=\"text-sm\">Gating: {testReport.resolver.gated ? 'aplicado' : 'não aplicado'}</div>\r\n                  <div className=\"text-sm\">Motivos: {Array.isArray((testReport.resolver as any).gateReasons) && (testReport.resolver as any).gateReasons.length ? (testReport.resolver as any).gateReasons.join(', ') : '(nenhum)'}</div>\r\n                   {(testReport.resolver as any)?.telemetry?.gatingApplied ? (\r\n                     <div className=\"text-xs text-muted-foreground\">\r\n                       Pré: {(testReport.resolver as any).telemetry.gatingApplied.preCount} &bull; Pós: {(testReport.resolver as any).telemetry.gatingApplied.postCount}\r\n                       <br />\r\n                       Regras: maxAuto={(testReport.resolver as any).telemetry.gatingApplied.rules?.maxNumbersAuto}, maxHybrid={(testReport.resolver as any).telemetry.gatingApplied.rules?.maxNumbersHybrid}, minManual={(testReport.resolver as any).telemetry.gatingApplied.rules?.minManualHybrid}, excluirZero={(testReport.resolver as any).telemetry.gatingApplied.rules?.excludeZero ? 'sim' : 'não'}\r\n                     </div>\r\n                   ) : null}\r\n\r\n                  {Array.isArray((testReport.resolver as any)?.telemetry?.derivedBy) && (testReport.resolver as any).telemetry.derivedBy.length ? (\r\n                    <div className=\"space-y-1\">\r\n                      <Label className=\"text-xs\">Fontes detalhadas</Label>\r\n                      <ScrollArea className=\"h-24\">\r\n                        <ul className=\"text-sm space-y-1\">\r\n                          {(testReport.resolver as any).telemetry.derivedBy.map((d: any, idx: number) => {\r\n                            const node = nodes.find((n: any) => n.id === d.nodeId)\r\n                            const label = node?.data?.label || d.nodeId\r\n                            const count = Array.isArray(d.params?.numbers) ? d.params.numbers.length : 0\r\n                            const preview = Array.isArray(d.params?.numbers) && d.params.numbers.length ? `[${d.params.numbers.slice(0, 18).join(', ')}${d.params.numbers.length > 18 ? '…' : ''}]` : '(nenhum)'\r\n                            return (\r\n                              <li key={`${d.nodeId}-${idx}`}>\r\n                                <strong>{label}</strong> &bull; tipo: {d.subtype || '(?)'} &bull; razão: {d.reason || '(?)'} &bull; qtd: {count} &bull; nums: {preview}\r\n                              </li>\r\n                            )\r\n                          })}\r\n                        </ul>\r\n                      </ScrollArea>\r\n                    </div>\r\n                  ) : null}\r\n                </div>\r\n              ) : null}\r\n\r\n              <Separator />\r\n\r\n              {testReport.compiled ? (\r\n                <div className=\"space-y-2\">\r\n                  <Label className=\"text-xs\">Compilação (cliente)</Label>\r\n                  <div className=\"text-sm\">\r\n                    Ativação: {\r\n                      typeof testReport.compiled.activation === 'boolean'\r\n                        ? (testReport.compiled.activation ? 'ativa' : 'inativa')\r\n                        : (\r\n                            testReport.compiled.activation && typeof testReport.compiled.activation === 'object' && 'shouldActivate' in (testReport.compiled.activation as any)\r\n                              ? ((testReport.compiled.activation as any).shouldActivate ? 'ativa' : 'inativa')\r\n                              : JSON.stringify(testReport.compiled.activation)\r\n                          )\r\n                    }\r\n                  </div>\r\n                  <div className=\"text-sm\">\r\n                    Números sinal: {\r\n                      Array.isArray((testReport.compiled as any)?.signal?.derivedNumbers) && (testReport.compiled as any).signal.derivedNumbers.length\r\n                        ? `[${(testReport.compiled as any).signal.derivedNumbers.join(', ')}]`\r\n                        : '(nenhum)'\r\n                    }\r\n                  </div>\r\n                  {(testReport.compiled as any)?.signal?.telemetry ? (\r\n                    <div className=\"text-xs text-muted-foreground\">\r\n                      Telemetria: lógica {Array.isArray((testReport.compiled as any).signal.telemetry?.logicTrace) ? (testReport.compiled as any).signal.telemetry.logicTrace.length : 0}, decisão {Array.isArray((testReport.compiled as any).signal.telemetry?.decisionTrace) ? (testReport.compiled as any).signal.telemetry.decisionTrace.length : 0}\r\n                    </div>\r\n                  ) : null}\r\n                </div>\r\n              ) : null}\r\n\r\n              <Separator />\r\n\r\n              <Accordion type=\"single\" collapsible>\r\n                <AccordionItem value=\"advanced\">\r\n                  <AccordionTrigger>Validação avançada</AccordionTrigger>\r\n                  <AccordionContent>\r\n                    <div className=\"grid grid-cols-2 gap-2\">\r\n                      <div>\r\n                        <Label className=\"text-[10px]\">Token (Bearer)</Label>\r\n                        <Input\r\n                          placeholder=\"Cole o token\"\r\n                          value={serverToken}\r\n                          onChange={(e) => setServerToken(e.target.value)}\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <Label className=\"text-[10px]\">Sinal</Label>\r\n                        <Select\r\n                          value={validationSignalId || (testReport.signals[0]?.nodeId || '')}\r\n                          onValueChange={(val) => setValidationSignalId(val)}\r\n                        >\r\n                          <SelectTrigger className=\"h-8\">\r\n                            <SelectValue placeholder=\"Selecione um sinal\" />\r\n                          </SelectTrigger>\r\n                          <SelectContent>\r\n                            {testReport.signals.map((s) => (\r\n                              <SelectItem key={s.nodeId} value={s.nodeId}>{s.label}</SelectItem>\r\n                            ))}\r\n                          </SelectContent>\r\n                        </Select>\r\n                      </div>\r\n                      <div>\r\n                        <Label className=\"text-[10px]\">Resultado</Label>\r\n                        <Select\r\n                          value={validationResult}\r\n                          onValueChange={(val) => setValidationResult(val as 'hit' | 'miss')}\r\n                        >\r\n                          <SelectTrigger className=\"h-8\">\r\n                            <SelectValue />\r\n                          </SelectTrigger>\r\n                          <SelectContent>\r\n                  <SelectItem value=\"hit\">acerto</SelectItem>\r\n                  <SelectItem value=\"miss\">erro</SelectItem>\r\n                          </SelectContent>\r\n                        </Select>\r\n                      </div>\r\n                      <div>\r\n                        <Label className=\"text-[10px]\">Número vencedor (0-36)</Label>\r\n                        <Input\r\n                          type=\"number\"\r\n                          min={0}\r\n                          max={36}\r\n                          value={validationWinningNumber}\r\n                          onChange={(e) => {\r\n                            const v = e.target.value\r\n                            setValidationWinningNumber(v === '' ? '' : Math.max(0, Math.min(36, Number(v))))\r\n                          }}\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <Label className=\"text-[10px]\">Pagamento líquido (opcional)</Label>\r\n                        <Input\r\n                          type=\"number\"\r\n                          step=\"0.01\"\r\n                          value={validationNetPayout}\r\n                          onChange={(e) => {\r\n                            const v = e.target.value\r\n                            setValidationNetPayout(v === '' ? '' : Number(v))\r\n                          }}\r\n                        />\r\n                      </div>\r\n                      <div className=\"flex items-end\">\r\n                        <Button onClick={validateSignalOnServer} disabled={isValidatingServer || !serverToken || (testReport.signals.length === 0)}>\r\n                          {isValidatingServer ? 'Validando...' : 'Validar no servidor'}\r\n                        </Button>\r\n                      </div>\r\n                    </div>\r\n                    {serverValidationResponse ? (\r\n                      <div className=\"text-xs\">\r\n                        {serverValidationResponse.ok ? (\r\n                          <div>\r\n                            <div>Servidor: OK ({serverValidationResponse.status})</div>\r\n                            <pre className=\"text-[10px] bg-muted p-2 rounded overflow-x-auto\">{JSON.stringify(serverValidationResponse.data, null, 2)}</pre>\r\n                          </div>\r\n                        ) : (\r\n                          <div>\r\n                            <div>Servidor: Falha ({serverValidationResponse.status})</div>\r\n                            <div className=\"text-destructive\">{serverValidationResponse.error}</div>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    ) : null}\r\n                  </AccordionContent>\r\n                </AccordionItem>\r\n\r\n                <AccordionItem value=\"logs\">\r\n                  <AccordionTrigger>Logs da execução</AccordionTrigger>\r\n                  <AccordionContent>\r\n                    <ScrollArea className=\"h-48\">\r\n                      <ul className=\"text-sm space-y-1\">\r\n                        {testReport.logs.map((l) => (\r\n                          <li key={`${l.step}-${l.nodeId}`}>\r\n                            <code>#{l.step}</code> &bull; <strong>{l.label}</strong> &bull; {l.action}\r\n                          </li>\r\n                        ))}\r\n                      </ul>\r\n                    </ScrollArea>\r\n                  </AccordionContent>\r\n                </AccordionItem>\r\n              </Accordion>\r\n            </>\r\n          )}\r\n        </div>\r\n        <DialogFooter>\r\n          <div className=\"flex items-center gap-2\">\r\n            <Button variant=\"outline\" onClick={exportTestReport}>\r\n              <Download className=\"mr-2 h-4 w-4\" /> Exportar relatório (.json)\r\n            </Button>\r\n            <Button onClick={() => setIsTestReportOpen(false)}>Fechar</Button>\r\n          </div>\r\n        </DialogFooter>\r\n      </DialogContent>\r\n    </Dialog>\r\n      </div>\r\n    </DashboardLayout>\r\n  )\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/checkout-pagarme/page.backup.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/checkout-teste/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/checkout-v2/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/checkout/[planCode]/[affiliateCode]/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/checkout/cancel/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/checkout/page.backup.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'userProfile?.fullName' and 'userProfile?.name'. Either include them or remove the dependency array.","line":178,"column":6,"nodeType":"ArrayExpression","endLine":178,"endColumn":61,"suggestions":[{"desc":"Update the dependencies array to be: [isAuthenticated, userProfile?.email, userProfile?.cpf, userProfile?.fullName, userProfile?.name]","fix":{"range":[5191,5246],"text":"[isAuthenticated, userProfile?.email, userProfile?.cpf, userProfile?.fullName, userProfile?.name]"}}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":494,"column":7,"nodeType":"JSXOpeningElement","endLine":498,"endColumn":9},{"ruleId":"react/no-unescaped-entities","severity":1,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":1004,"column":35,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[40579,40615],"text":"\n                            Cupom &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[40579,40615],"text":"\n                            Cupom &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[40579,40615],"text":"\n                            Cupom &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[40579,40615],"text":"\n                            Cupom &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":1,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":1004,"column":53,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[40632,40670],"text":"&quot; aplicado!\n                          "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[40632,40670],"text":"&ldquo; aplicado!\n                          "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[40632,40670],"text":"&#34; aplicado!\n                          "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[40632,40670],"text":"&rdquo; aplicado!\n                          "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":1167,"column":21,"nodeType":"JSXOpeningElement","endLine":1171,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport { CreditCard, Shield, Check, AlertCircle, Lock, Star, Smartphone, Copy, ChevronDown, Tag } from 'lucide-react';\nimport { useSofiaAuth } from '@/hooks/use-sofia-auth';\nimport { z } from 'zod';\nimport QRCode from 'qrcode';\n\n// Interfaces para tipagem\ninterface FormData {\n  email: string;\n  emailConfirm: string;\n  cardNumber: string;\n  expiryDate: string;\n  cvv: string;\n  cardName: string;\n  fullName: string;\n  cpf: string;\n  phone: string;\n  coupon: string;\n}\n\ninterface PixData {\n  qr_code: string;\n  qr_code_url: string;\n  expires_at: string;\n  pix_key?: string;\n  amount?: number;\n  order_id?: string;\n}\n\ninterface Validations {\n  [key: string]: string;\n}\n\ninterface CouponData {\n  code: string;\n  description: string;\n  discount: number;\n  type: 'percentage' | 'fixed';\n}\n\ninterface CouponCalculation {\n  original_amount: number;\n  discount_amount: number;\n  final_amount: number;\n  savings_percentage: number;\n}\n\n// Renderização local do QR para evitar latência de imagens externas\nfunction QrCanvas({ code, className = '' }: { code: string; className?: string }) {\n  const canvasRef = useRef<HTMLCanvasElement | null>(null);\n  const [ready, setReady] = useState(false);\n\n  useEffect(() => {\n    if (!code || !canvasRef.current) return;\n    setReady(false);\n    QRCode.toCanvas(canvasRef.current, code, { width: 256, margin: 1 })\n      .then(() => setReady(true))\n      .catch(() => setReady(false));\n  }, [code]);\n\n  return (\n    <div className={`w-full h-full flex items-center justify-center ${className}`}>\n      {!ready && (\n        <div className=\"text-gray-500 text-center\">\n          <Smartphone className=\"w-12 h-12 mx-auto mb-2\" />\n          <p className=\"text-sm\">Gerando QR Code…</p>\n        </div>\n      )}\n      <canvas ref={canvasRef} className=\"block\" style={{ display: ready ? 'block' : 'none' }} />\n    </div>\n  );\n}\n\nexport default function CheckoutPage() {\n  // Hook de autenticação\n  const { userProfile, isAuthenticated } = useSofiaAuth();\n\n  const [formData, setFormData] = useState<FormData>({\n    email: '',\n    emailConfirm: '',\n    cardNumber: '',\n    expiryDate: '',\n    cvv: '',\n    cardName: '',\n    fullName: '',\n    cpf: '',\n    phone: '',\n    coupon: ''\n  });\n\n  const [paymentMethod, setPaymentMethod] = useState<'credit_card' | 'pix'>('credit_card');\n  const [pixData, setPixData] = useState<PixData | null>(null);\n  const [showCoupon, setShowCoupon] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [loadingMessage, setLoadingMessage] = useState('');\n  const [success, setSuccess] = useState(false);\n  const [error, setError] = useState('');\n  const [processingStep, setProcessingStep] = useState('');\n  const [validations, setValidations] = useState<Validations>({});\n  const [couponData, setCouponData] = useState<CouponData | null>(null);\n  const [couponCalculation, setCouponCalculation] = useState<CouponCalculation | null>(null);\n  const [couponLoading, setCouponLoading] = useState(false);\n  const [couponError, setCouponError] = useState('');\n  const [checkingPix, setCheckingPix] = useState(false);\n\n  // Validar cupom de desconto\n  const validateCoupon = async (couponCode: string) => {\n    if (!couponCode.trim()) {\n      setCouponData(null);\n      setCouponCalculation(null);\n      setCouponError('');\n      return;\n    }\n\n    setCouponLoading(true);\n    setCouponError('');\n\n    try {\n      const response = await fetch('/api/validate-coupon', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          coupon: couponCode,\n          amount: 19700 // R$ 197,00 em centavos\n        })\n      });\n\n      const result = await response.json();\n\n      if (result.success) {\n        setCouponData(result.coupon);\n        setCouponCalculation(result.calculation);\n        setCouponError('');\n      } else {\n        setCouponData(null);\n        setCouponCalculation(null);\n        setCouponError(result.error);\n      }\n    } catch (error) {\n      setCouponError('Erro ao validar cupom');\n      setCouponData(null);\n      setCouponCalculation(null);\n    } finally {\n      setCouponLoading(false);\n    }\n  };\n\n  // Debounce para validação de cupom\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      if (formData.coupon) {\n        validateCoupon(formData.coupon);\n      }\n    }, 500);\n\n    return () => clearTimeout(timer);\n  }, [formData.coupon]);\n\n  // Preencher dados automaticamente quando usuário estiver logado (sem sobrescrever o que o usuário digitar)\n  useEffect(() => {\n    if (!isAuthenticated) return;\n    setFormData(prev => {\n      // Se o usuário já começou a digitar, não sobrescrever\n      if (prev.email || prev.cpf || prev.fullName) return prev;\n      return {\n        ...prev,\n        email: userProfile?.email || prev.email,\n        emailConfirm: userProfile?.email || prev.emailConfirm,\n        cpf: userProfile?.cpf || prev.cpf,\n        fullName: userProfile?.fullName || userProfile?.name || prev.fullName\n        // cardName não é preenchido automaticamente para evitar problemas com abreviações\n      };\n    });\n  }, [isAuthenticated, userProfile?.email, userProfile?.cpf]);\n  const formatCardNumber = (value: string): string => {\n    const v = value.replace(/\\s+/g, '').replace(/[^0-9]/gi, '');\n    const matches = v.match(/\\d{4,16}/g);\n    const match = matches && matches[0] || '';\n    const parts = [];\n    for (let i = 0, len = match.length; i < len; i += 4) {\n      parts.push(match.substring(i, i + 4));\n    }\n    if (parts.length) {\n      return parts.join(' ');\n    } else {\n      return v;\n    }\n  };\n\n  // Formatação de data de expiração\n  const formatExpiryDate = (value: string): string => {\n    const v = value.replace(/\\s+/g, '').replace(/[^0-9]/gi, '');\n    if (v.length >= 2) {\n      return v.substring(0, 2) + '/' + v.substring(2, 4);\n    }\n    return v;\n  };\n\n  // Formatação de CPF\n  const formatCPF = (value: string): string => {\n    const v = value.replace(/\\D/g, '');\n    if (v.length <= 11) {\n      return v.replace(/(\\d{3})(\\d{3})(\\d{3})(\\d{2})/, '$1.$2.$3-$4');\n    }\n    return v.substring(0, 11).replace(/(\\d{3})(\\d{3})(\\d{3})(\\d{2})/, '$1.$2.$3-$4');\n  };\n\n  // Formatação de telefone brasileiro\n  const formatPhone = (value: string): string => {\n    const v = value.replace(/\\D/g, '').substring(0, 11);\n    if (v.length <= 10) {\n      return v.replace(/(\\d{2})(\\d{4})(\\d{0,4})/, '($1) $2-$3');\n    }\n    return v.replace(/(\\d{2})(\\d{5})(\\d{0,4})/, '($1) $2-$3');\n  };\n\n  // Validação de CPF com algoritmo dos dígitos verificadores\n  const validateCPF = (cpf: string): boolean => {\n    const cleanCPF = cpf.replace(/\\D/g, '');\n    \n    if (cleanCPF.length !== 11) return false;\n    \n    // Verifica se todos os dígitos são iguais\n    if (/^(\\d)\\1{10}$/.test(cleanCPF)) return false;\n    \n    // Validação do primeiro dígito verificador\n    let sum = 0;\n    for (let i = 0; i < 9; i++) {\n      sum += parseInt(cleanCPF.charAt(i)) * (10 - i);\n    }\n    let remainder = (sum * 10) % 11;\n    if (remainder === 10 || remainder === 11) remainder = 0;\n    if (remainder !== parseInt(cleanCPF.charAt(9))) return false;\n    \n    // Validação do segundo dígito verificador\n    sum = 0;\n    for (let i = 0; i < 10; i++) {\n      sum += parseInt(cleanCPF.charAt(i)) * (11 - i);\n    }\n    remainder = (sum * 10) % 11;\n    if (remainder === 10 || remainder === 11) remainder = 0;\n    if (remainder !== parseInt(cleanCPF.charAt(10))) return false;\n    \n    return true;\n  };\n\n  // Validação de cartão de crédito usando algoritmo de Luhn\n  const validateCardNumber = (cardNumber: string): boolean => {\n    const cleanNumber = cardNumber.replace(/\\s/g, '');\n    if (cleanNumber.length < 13 || cleanNumber.length > 19) return false;\n    \n    let sum = 0;\n    let isEven = false;\n    \n    for (let i = cleanNumber.length - 1; i >= 0; i--) {\n      let digit = parseInt(cleanNumber.charAt(i));\n      \n      if (isEven) {\n        digit *= 2;\n        if (digit > 9) {\n          digit -= 9;\n        }\n      }\n      \n      sum += digit;\n      isEven = !isEven;\n    }\n    \n    return sum % 10 === 0;\n  };\n\n  // Validações com Zod\n  const getSchema = () => {\n    const commonShape = {\n      email: z.string().email({ message: 'Email inválido' }),\n      emailConfirm: z.string().email({ message: 'Confirmação inválida' }),\n      fullName: z.string().min(5, { message: 'Nome completo é obrigatório' }),\n      cpf: z.string().refine((v) => validateCPF(v), { message: 'CPF inválido' }),\n      phone: z.string().refine((v) => v.replace(/\\D/g, '').length >= 10 && v.replace(/\\D/g, '').length <= 11, { message: 'Telefone inválido' }),\n      coupon: z.string().optional().default('')\n    } as const;\n\n    const shape = paymentMethod === 'credit_card'\n      ? {\n          ...commonShape,\n          cardNumber: z.string().refine((v) => validateCardNumber(v), { message: 'Número do cartão inválido' }),\n          expiryDate: z.string().refine((v) => {\n            if (v.length < 5) return false;\n            const [month, year] = v.split('/');\n            const currentDate = new Date();\n            const currentYear = currentDate.getFullYear() % 100;\n            const currentMonth = currentDate.getMonth() + 1;\n            const expMonth = parseInt(month);\n            const expYear = parseInt(year);\n            if (expMonth < 1 || expMonth > 12) return false;\n            if (expYear < currentYear || (expYear === currentYear && expMonth < currentMonth)) return false;\n            return true;\n          }, { message: 'Data de expiração inválida' }),\n          cvv: z.string().min(3, { message: 'CVV deve ter pelo menos 3 dígitos' }),\n          cardName: z.string().min(3, { message: 'Nome do titular é obrigatório' }).regex(/^[a-zA-ZÀ-ÿ\\s]+$/, { message: 'Nome deve conter apenas letras' })\n        }\n      : {\n          ...commonShape,\n          cardNumber: z.string().optional().default(''),\n          expiryDate: z.string().optional().default(''),\n          cvv: z.string().optional().default(''),\n          cardName: z.string().optional().default('')\n        };\n\n    return z.object(shape).superRefine((data, ctx) => {\n      if (data.email.toLowerCase() !== data.emailConfirm.toLowerCase()) {\n        ctx.addIssue({ code: 'custom', message: 'Emails não conferem', path: ['emailConfirm'] });\n      }\n    });\n  };\n\n  const validateForm = () => {\n    const schema = getSchema();\n    const parsed = schema.safeParse(formData);\n    const newValidations: Record<string, string> = {};\n    if (!parsed.success) {\n      for (const issue of parsed.error.issues) {\n        const key = (issue.path[0] as string) || 'form';\n        newValidations[key] = issue.message;\n      }\n    }\n    setValidations(newValidations);\n    return parsed.success;\n  };\n\n  // Handler para mudanças no formulário\n  const handleInputChange = (field: keyof FormData, value: string): void => {\n    let formattedValue = value;\n\n    if (field === 'cardNumber') {\n      formattedValue = formatCardNumber(value);\n    } else if (field === 'expiryDate') {\n      formattedValue = formatExpiryDate(value);\n    } else if (field === 'cpf') {\n      formattedValue = formatCPF(value);\n    } else if (field === 'phone') {\n      formattedValue = formatPhone(value);\n    } else if (field === 'cvv') {\n      formattedValue = value.replace(/\\D/g, '').substring(0, 4);\n    } else if (field === 'cardName') {\n      // Permitir apenas letras, espaços e acentos\n      formattedValue = value.replace(/[^a-zA-ZÀ-ÿ\\s]/g, '').toUpperCase();\n    } else if (field === 'email') {\n      // Converter para minúsculas\n      formattedValue = value.toLowerCase();\n    } else if (field === 'emailConfirm') {\n      formattedValue = value.toLowerCase();\n    } else if (field === 'coupon') {\n      // Converter para maiúsculas e remover espaços\n      formattedValue = value.toUpperCase().replace(/\\s/g, '');\n    }\n\n    setFormData(prev => ({ ...prev, [field]: formattedValue }));\n\n    // Limpar validação do campo quando o usuário digita\n    if (validations[field]) {\n      setValidations(prev => ({ ...prev, [field]: '' }));\n    }\n  };\n\n  // Simulação de integração com Pagar.me\n  const handleSubmit = async () => {\n    if (!validateForm()) return;\n\n    setLoading(true);\n    setError('');\n    setProcessingStep('Validando dados...');\n\n    try {\n      // Calcular valor final considerando cupom\n      const finalAmount = couponCalculation ? couponCalculation.final_amount : 19700;\n\n      const baseData = {\n        customer: {\n          email: formData.email,\n          document_number: formData.cpf.replace(/\\D/g, ''),\n          name: paymentMethod === 'credit_card' ? formData.cardName : 'Cliente PIX',\n          type: 'individual'\n        },\n        amount: finalAmount,\n        ...(couponData && { coupon: couponData.code })\n      };\n\n      if (paymentMethod === 'credit_card') {\n        setProcessingStep('Processando pagamento...');\n        setLoadingMessage('Validando cartão de crédito');\n\n        const subscriptionData = {\n          ...baseData,\n          plan: {\n            amount: finalAmount,\n            interval: 'month',\n            interval_count: 1,\n            name: 'Plano SaaS Mensal'\n          },\n          card: {\n            number: formData.cardNumber.replace(/\\s/g, ''),\n            holder_name: formData.cardName,\n            exp_month: formData.expiryDate.split('/')[0],\n            exp_year: '20' + formData.expiryDate.split('/')[1],\n            cvv: formData.cvv\n          },\n          payment_method: 'credit_card'\n        };\n\n        setLoadingMessage('Criando assinatura...');\n        // Chamar API real para criar assinatura\n        const response = await fetch('/api/create-subscription', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify(subscriptionData)\n        });\n\n        const result = await response.json();\n\n        if (result.success) {\n          const status = result.status || result.order?.charges?.[0]?.status;\n          if (status === 'paid') {\n            setProcessingStep('Pagamento aprovado!');\n            setLoadingMessage('Redirecionando...');\n            // Encaminha para página de sucesso, que consulta detalhes\n            window.location.href = `/checkout/success?order_id=${result.order_id}&mode=card`;\n          } else {\n            const msg = status === 'not_authorized' ? 'Pagamento não autorizado' : status === 'failed' ? 'Pagamento falhou' : 'Pagamento pendente';\n            setError(`${msg}. Seu acesso ao dashboard será liberado somente após aprovação.`);\n            setProcessingStep('');\n            setLoadingMessage('');\n          }\n        } else {\n          throw new Error(result.error || 'Erro ao processar pagamento');\n        }\n      } else if (paymentMethod === 'pix') {\n        setProcessingStep('Gerando PIX...');\n        setLoadingMessage('Criando código de pagamento');\n\n        const pixData = {\n          ...baseData,\n          payment_method: 'pix',\n          pix_expiration_date: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString() // 24h\n        };\n\n        // Chamar API real para gerar PIX\n        const response = await fetch('/api/create-pix', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify(pixData)\n        });\n\n        const result = await response.json();\n\n        if (result.success && result.qr_code_url) {\n          setProcessingStep('PIX gerado com sucesso!');\n          setLoadingMessage('');\n          setTimeout(() => {\n            setPixData({\n              qr_code: result.qr_code_url, // URL da imagem para exibição\n              qr_code_url: result.qr_code, // Código PIX oficial para copiar\n              expires_at: result.expires_at,\n              pix_key: result.pix_key,\n              amount: result.amount,\n              order_id: result.order_id\n            });\n          }, 1000);\n        } else {\n          throw new Error(result.error || 'Erro ao gerar PIX');\n        }\n      }\n\n    } catch (err) {\n      setError('Erro ao processar pagamento. Tente novamente.');\n      setProcessingStep('');\n      setLoadingMessage('');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Componente para ícones de cartão (bandeiras reais)\n  const CardIcons = () => (\n    <div className=\"mt-2 flex justify-end\">\n      <img \n        src=\"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ1dzeybZgprwWRyK-12bqIACT_B4BQG6dNPQ&s\" \n        alt=\"Bandeiras de Cartão\" \n        className=\"h-5 w-auto\"\n      />\n    </div>\n  );\n\n  // Copiar código PIX\n  const copyPixCode = () => {\n    if (pixData) {\n      navigator.clipboard.writeText(pixData.qr_code_url);\n      // Aqui você poderia mostrar um toast de sucesso\n      console.log('Código PIX copiado:', pixData.qr_code_url);\n    }\n  };\n\n  // Polling de status do PIX\n  useEffect(() => {\n    if (!pixData?.order_id) return;\n    let stopped = false;\n    const checkStatus = async () => {\n      try {\n        const res = await fetch(`/api/create-pix?order_id=${pixData.order_id}`, { method: 'PUT' });\n        const json = await res.json();\n        if (json.success && json.status === 'paid') {\n          if (!stopped) {\n            stopped = true;\n            window.location.href = `/checkout/success?order_id=${pixData.order_id}&mode=pix`;\n          }\n        }\n      } catch (e) {\n        console.warn('Falha ao verificar status PIX', e);\n      }\n    };\n    // Checa imediatamente e a cada 10s\n    checkStatus();\n    const id = setInterval(checkStatus, 10000);\n    return () => { stopped = true; clearInterval(id); };\n  }, [pixData?.order_id]);\n\n  if (success && paymentMethod === 'credit_card') {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 flex items-center justify-center p-4\">\n        <div className=\"max-w-md w-full bg-white rounded-2xl shadow-xl p-8 text-center\">\n          <div className=\"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6 animate-pulse\">\n            <Check className=\"w-10 h-10 text-green-600\" />\n          </div>\n          <h2 className=\"text-2xl font-bold text-gray-800 mb-4\">🎉 Assinatura Ativada!</h2>\n          <p className=\"text-gray-600 mb-6\">\n            Parabéns! Sua assinatura foi processada com sucesso. Você receberá um email de confirmação em breve.\n          </p>\n          \n          {/* Mostrar informações do pagamento */}\n          <div className=\"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-4\">\n            <div className=\"text-sm text-gray-600 space-y-2\">\n              <div className=\"flex justify-between\">\n                <span>Plano:</span>\n                <span className=\"font-medium\">Professional</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span>Valor:</span>\n                <span className=\"font-medium\">\n                  {couponCalculation ? \n                    `R$ ${(couponCalculation.final_amount / 100).toFixed(2)}/mês` : \n                    'R$ 197,00/mês'\n                  }\n                </span>\n              </div>\n              {couponData && (\n                <div className=\"flex justify-between text-green-600\">\n                  <span>Cupom aplicado:</span>\n                  <span className=\"font-medium\">{couponData.code}</span>\n                </div>\n              )}\n              <div className=\"flex justify-between\">\n                <span>Próxima cobrança:</span>\n                <span className=\"font-medium\">\n                  {new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toLocaleDateString('pt-BR')}\n                </span>\n              </div>\n            </div>\n          </div>\n          \n          <div className=\"bg-green-50 rounded-lg p-4 mb-6 border border-green-200\">\n            <div className=\"flex items-center mb-2\">\n              <div className=\"w-5 h-5 bg-green-500 rounded-full flex items-center justify-center mr-2\">\n                <Check className=\"w-3 h-3 text-white\" />\n              </div>\n              <p className=\"text-sm font-medium text-green-800\">Investimento Inteligente!</p>\n            </div>\n            <p className=\"text-sm text-green-700\">\n              Não se preocupe com o valor - ele se paga em poucas operações bem-sucedidas! \n              Você agora tem acesso às melhores estratégias para multiplicar seus ganhos.\n            </p>\n          </div>\n\n          <div className=\"space-y-3\">\n            <button\n              onClick={() => {\n                // Simular delay de redirecionamento\n                setLoadingMessage('Redirecionando para o dashboard...');\n                setTimeout(() => {\n                  window.location.href = '/dashboard';\n                }, 1500);\n              }}\n              className=\"w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-3 px-6 rounded-lg font-semibold hover:from-blue-700 hover:to-indigo-700 transition-all\"\n            >\n              🚀 Acessar Dashboard\n            </button>\n            \n            <button\n              onClick={() => window.location.href = '/profile'}\n              className=\"w-full bg-gray-100 text-gray-700 py-2 px-6 rounded-lg font-medium hover:bg-gray-200 transition-all text-sm\"\n            >\n              Ver detalhes da assinatura\n            </button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // Tela de PIX gerado\n  if (pixData) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 flex items-center justify-center p-4\">\n        <div className=\"max-w-md w-full bg-white rounded-2xl shadow-xl p-8 text-center\">\n          <div className=\"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6\">\n            <Smartphone className=\"w-8 h-8 text-green-600\" />\n          </div>\n          <h2 className=\"text-2xl font-bold text-gray-800 mb-4\">Pague com PIX</h2>\n          <p className=\"text-gray-600 mb-6\">\n            Escaneie o QR Code com seu banco ou copie o código PIX\n          </p>\n\n          {/* QR Code real da API */}\n          <div className=\"bg-gray-100 p-6 rounded-lg mb-6\">\n            <div className=\"w-48 h-48 mx-auto bg-white rounded-lg flex items-center justify-center\">\n              {pixData.qr_code ? (\n                <QrCanvas code={pixData.qr_code_url} />\n              ) : (\n                <div className=\"text-gray-500 text-center\">\n                  <Smartphone className=\"w-12 h-12 mx-auto mb-2\" />\n                  <p className=\"text-sm\">Carregando QR Code...</p>\n                </div>\n              )}\n            </div>\n          </div>\n\n          <div className=\"bg-gray-50 rounded-lg p-4 mb-6 text-left\">\n            <p className=\"text-sm text-gray-600 mb-2\">Código PIX:</p>\n            <div className=\"flex items-center justify-between bg-white p-3 rounded border\">\n              <span className=\"text-sm font-mono text-gray-700 truncate\">\n                {pixData.qr_code_url.substring(0, 40)}...\n              </span>\n              <button\n                onClick={copyPixCode}\n                className=\"ml-2 p-1 text-green-600 hover:bg-green-50 rounded\"\n              >\n                <Copy className=\"w-4 h-4\" />\n              </button>\n            </div>\n          </div>\n\n          <div className=\"text-center text-sm text-gray-600 mb-6\">\n            <p className=\"font-semibold text-gray-800 text-lg\">R$ 197,00</p>\n            <p>Válido até: {new Date(pixData.expires_at).toLocaleString('pt-BR')}</p>\n          </div>\n\n          {/* Botões de ação para status */}\n          <div className=\"grid grid-cols-2 gap-3 mb-6\">\n            <button\n              onClick={async () => {\n                if (!pixData?.order_id || checkingPix) return;\n                setCheckingPix(true);\n                const controller = new AbortController();\n                const timeoutId = setTimeout(() => controller.abort(), 7000);\n                try {\n                  const res = await fetch(`/api/create-pix?order_id=${pixData.order_id}`, { method: 'PUT', signal: controller.signal });\n                  const json = await res.json();\n                  if (json.success && json.status === 'paid') {\n                    window.location.href = `/checkout/success?order_id=${pixData.order_id}&mode=pix`;\n                  }\n                } catch {}\n                finally {\n                  clearTimeout(timeoutId);\n                  setCheckingPix(false);\n                }\n              }}\n              disabled={checkingPix}\n              className={`w-full ${checkingPix ? 'bg-green-500' : 'bg-green-600'} text-white py-3 px-6 rounded-lg font-semibold hover:bg-green-700 transition-all`}\n            >\n              {checkingPix ? 'Verificando…' : 'Já paguei, verificar'}\n            </button>\n            <button\n              onClick={() => {\n                setPixData(null);\n                setPaymentMethod('credit_card');\n              }}\n              className=\"w-full bg-gray-100 text-gray-700 py-3 px-6 rounded-lg font-semibold hover:bg-gray-200 transition-all\"\n            >\n              Voltar para cartão\n            </button>\n          </div>\n\n          <button\n            onClick={() => {\n              setPixData(null);\n              setPaymentMethod('credit_card');\n            }}\n            className=\"w-full bg-gray-100 text-gray-700 py-3 px-6 rounded-lg font-semibold hover:bg-gray-200 transition-all\"\n          >\n            Voltar para outras opções\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100\">\n      <div className=\"container mx-auto px-4 py-8\">\n        <div className=\"max-w-4xl mx-auto\">\n          {/* Header */}\n          <div className=\"text-center mb-8\">\n            <h1 className=\"text-3xl font-bold text-gray-800 mb-2\">Assine Agora</h1>\n            <p className=\"text-gray-600\">Comece sua jornada com nosso SaaS</p>\n          </div>\n\n          <div className=\"grid md:grid-cols-2 gap-8\">\n            {/* Resumo do Plano */}\n            <div className=\"bg-white rounded-2xl shadow-xl p-8\">\n              <div className=\"flex items-center mb-6\">\n                <div className=\"w-12 h-12 bg-gradient-to-r from-green-600 to-emerald-600 rounded-xl flex items-center justify-center\">\n                  <Star className=\"w-6 h-6 text-white\" />\n                </div>\n                <div className=\"ml-4\">\n                  <h3 className=\"text-xl font-bold text-gray-800\">Plano Professional</h3>\n                  <p className=\"text-gray-600\">Acesso completo à plataforma</p>\n                </div>\n              </div>\n\n              <div className=\"border-t border-gray-200 pt-6 mb-6\">\n                <div className=\"flex justify-between items-center mb-4\">\n                  {couponCalculation ? (\n                    <div className=\"space-y-2\">\n                      <div className=\"flex items-center space-x-2\">\n                        <span className=\"text-lg text-gray-500 line-through\">R$ {(couponCalculation.original_amount / 100).toFixed(2)}</span>\n                        <span className=\"text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full font-medium\">\n                          -{Math.round(couponCalculation.savings_percentage)}%\n                        </span>\n                      </div>\n                      <span className=\"text-3xl font-bold text-green-600\">R$ {(couponCalculation.final_amount / 100).toFixed(2)}</span>\n                    </div>\n                  ) : (\n                    <span className=\"text-3xl font-bold text-gray-800\">R$ 197</span>\n                  )}\n                  <span className=\"text-gray-600\">/mês</span>\n                </div>\n                <p className=\"text-sm text-gray-600 mb-4\">Cobrança recorrente mensal</p>\n              </div>\n\n              <div className=\"space-y-4\">\n                {[\n                  'Acesso ilimitado a todas as funcionalidades',\n                  'Suporte prioritário 24/7',\n                  'API completa para integrações',\n                  'Relatórios avançados e analytics',\n                  'Backup automático diário',\n                  'SSL gratuito e segurança avançada'\n                ].map((feature, index) => (\n                  <div key={index} className=\"flex items-center\">\n                    <Check className=\"w-5 h-5 text-green-600 mr-3 flex-shrink-0\" />\n                    <span className=\"text-gray-700\">{feature}</span>\n                  </div>\n                ))}\n              </div>\n\n              <div className=\"mt-8 p-4 bg-green-50 rounded-lg\">\n                <div className=\"flex items-center\">\n                  <Shield className=\"w-5 h-5 text-green-600 mr-2\" />\n                  <span className=\"text-sm text-green-800 font-medium\">Garantia de 30 dias</span>\n                </div>\n                <p className=\"text-sm text-green-700 mt-1\">\n                  Cancele a qualquer momento nos primeiros 30 dias\n                </p>\n              </div>\n\n              {/* Selos de Segurança */}\n              <div className=\"mt-6 space-y-4\">\n                <div className=\"border-t border-gray-200 pt-4\">\n                  <h4 className=\"text-sm font-medium text-gray-700 mb-3\">Segurança & Confiança</h4>\n\n                  {/* Primeira linha de selos */}\n                  <div className=\"grid grid-cols-2 gap-3 mb-3\">\n                    <div className=\"flex items-center p-2 bg-green-50 rounded border border-green-200 text-xs\">\n                      <Shield className=\"w-4 h-4 text-green-600 mr-2\" />\n                      <span className=\"text-green-700 font-medium\">SSL Seguro</span>\n                    </div>\n                    <div className=\"flex items-center p-2 bg-green-50 rounded border border-green-200 text-xs\">\n                      <Lock className=\"w-4 h-4 text-green-600 mr-2\" />\n                      <span className=\"text-green-700 font-medium\">PCI Compliant</span>\n                    </div>\n                  </div>\n\n                  {/* Segunda linha de selos */}\n                  <div className=\"grid grid-cols-2 gap-3 mb-3\">\n                    <div className=\"flex items-center p-2 bg-green-50 rounded border border-green-200 text-xs\">\n                      <Check className=\"w-4 h-4 text-green-600 mr-2\" />\n                      <span className=\"text-green-700 font-medium\">Compra Segura</span>\n                    </div>\n                    <div className=\"flex items-center p-2 bg-green-50 rounded border border-green-200 text-xs\">\n                      <Shield className=\"w-4 h-4 text-green-600 mr-2\" />\n                      <span className=\"text-green-700 font-medium\">Reembolso 100%</span>\n                    </div>\n                  </div>\n\n                  {/* Bancos parceiros */}\n                  <div className=\"text-center\">\n                    <p className=\"text-xs text-gray-600 mb-2\">Bancos Parceiros:</p>\n                    <div className=\"flex justify-center space-x-2 text-xs text-gray-500\">\n                      <span className=\"px-2 py-1 bg-gray-100 rounded\">Bradesco</span>\n                      <span className=\"px-2 py-1 bg-gray-100 rounded\">Itaú</span>\n                      <span className=\"px-2 py-1 bg-gray-100 rounded\">Santander</span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            {/* Formulário de Pagamento */}\n            <div className=\"bg-white rounded-2xl shadow-xl p-8\">\n              <div className=\"flex items-center mb-6\">\n                <CreditCard className=\"w-6 h-6 text-gray-600 mr-2\" />\n                <h3 className=\"text-xl font-bold text-gray-800\">Informações de Pagamento</h3>\n              </div>\n\n              {error && (\n                <div className=\"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg flex items-center\">\n                  <AlertCircle className=\"w-5 h-5 text-red-600 mr-2\" />\n                  <span className=\"text-red-700\">{error}</span>\n                </div>\n              )}\n\n              <div className=\"space-y-6\">\n                {/* Opções de Pagamento */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-3\">\n                    Escolha a forma de pagamento\n                  </label>\n                  <div className=\"grid grid-cols-2 gap-3\">\n                    <button\n                      type=\"button\"\n                      onClick={() => setPaymentMethod('credit_card')}\n                      className={`p-4 border-2 rounded-lg flex items-center justify-center transition-all ${paymentMethod === 'credit_card'\n                          ? 'border-green-500 bg-green-50 text-green-700'\n                          : 'border-gray-300 bg-white text-gray-700 hover:border-gray-400 hover:bg-gray-50'\n                        }`}\n                    >\n                      <CreditCard className=\"w-5 h-5 mr-2\" />\n                      <span className=\"font-medium\">Cartão</span>\n                    </button>\n                    <button\n                      type=\"button\"\n                      onClick={() => setPaymentMethod('pix')}\n                      className={`p-4 border-2 rounded-lg flex items-center justify-center transition-all ${paymentMethod === 'pix'\n                          ? 'border-green-500 bg-green-50 text-green-700'\n                          : 'border-gray-300 bg-white text-gray-700 hover:border-gray-400 hover:bg-gray-50'\n                        }`}\n                    >\n                      <Smartphone className=\"w-5 h-5 mr-2\" />\n                      <span className=\"font-medium\">PIX</span>\n                    </button>\n                  </div>\n                </div>\n\n                {/* Nome completo */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Nome completo\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.fullName}\n                    onChange={(e) => handleInputChange('fullName', e.target.value)}\n                    className={`w-full px-4 py-3 border rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500 transition-all ${validations.fullName ? 'border-red-300' : 'border-gray-300'\n                      }`}\n                    placeholder=\"Seu nome completo\"\n                  />\n                  {validations.fullName && (\n                    <p className=\"mt-1 text-sm text-red-600\">{validations.fullName}</p>\n                  )}\n                </div>\n\n                {/* Email */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Email\n                  </label>\n                  <input\n                    type=\"email\"\n                    value={formData.email}\n                    onChange={(e) => handleInputChange('email', e.target.value)}\n                    className={`w-full px-4 py-3 border rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500 transition-all ${validations.email ? 'border-red-300' : 'border-gray-300'\n                      }`}\n                    placeholder=\"seu@email.com\"\n                  />\n                  {validations.email && (\n                    <p className=\"mt-1 text-sm text-red-600\">{validations.email}</p>\n                  )}\n                </div>\n\n                {/* Confirmar Email */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Confirmar Email\n                  </label>\n                  <input\n                    type=\"email\"\n                    value={formData.emailConfirm}\n                    onChange={(e) => handleInputChange('emailConfirm', e.target.value)}\n                    className={`w-full px-4 py-3 border rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500 transition-all ${validations.emailConfirm ? 'border-red-300' : 'border-gray-300'\n                      }`}\n                    placeholder=\"repita seu@email.com\"\n                  />\n                  {validations.emailConfirm && (\n                    <p className=\"mt-1 text-sm text-red-600\">{validations.emailConfirm}</p>\n                  )}\n                </div>\n\n                {/* CPF */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    CPF\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.cpf}\n                    onChange={(e) => handleInputChange('cpf', e.target.value)}\n                    className={`w-full px-4 py-3 border rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500 transition-all ${validations.cpf ? 'border-red-300' : 'border-gray-300'\n                      }`}\n                    placeholder=\"000.000.000-00\"\n                  />\n                  {validations.cpf && (\n                    <p className=\"mt-1 text-sm text-red-600\">{validations.cpf}</p>\n                  )}\n                </div>\n\n                {/* Telefone */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Telefone\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.phone}\n                    onChange={(e) => handleInputChange('phone', e.target.value)}\n                    className={`w-full px-4 py-3 border rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500 transition-all ${validations.phone ? 'border-red-300' : 'border-gray-300'\n                      }`}\n                    placeholder=\"(11) 99999-9999\"\n                  />\n                  {validations.phone && (\n                    <p className=\"mt-1 text-sm text-red-600\">{validations.phone}</p>\n                  )}\n                </div>\n\n                {/* Campo de Cupom */}\n                <div>\n                  <button\n                    type=\"button\"\n                    onClick={() => setShowCoupon(!showCoupon)}\n                    className=\"flex items-center text-green-600 hover:text-green-700 font-medium mb-2\"\n                  >\n                    <Tag className=\"w-4 h-4 mr-2\" />\n                    Tenho um cupom de desconto\n                    <ChevronDown className={`w-4 h-4 ml-2 transition-transform ${showCoupon ? 'rotate-180' : ''}`} />\n                  </button>\n\n                  {showCoupon && (\n                    <div className=\"space-y-3\">\n                      <div className=\"relative\">\n                        <input\n                          type=\"text\"\n                          value={formData.coupon}\n                          onChange={(e) => handleInputChange('coupon', e.target.value.toUpperCase())}\n                          className={`w-full px-4 py-3 border rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500 transition-all ${\n                            couponError ? 'border-red-300' : couponData ? 'border-green-300' : 'border-gray-300'\n                          }`}\n                          placeholder=\"Digite seu código do cupom\"\n                        />\n                        {couponLoading && (\n                          <div className=\"absolute right-3 top-1/2 transform -translate-y-1/2\">\n                            <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-green-600\"></div>\n                          </div>\n                        )}\n                      </div>\n\n                      {/* Feedback do cupom */}\n                      {couponError && (\n                        <div className=\"flex items-center text-red-600 text-sm\">\n                          <AlertCircle className=\"w-4 h-4 mr-2\" />\n                          {couponError}\n                        </div>\n                      )}\n\n                      {couponData && couponCalculation && (\n                        <div className=\"p-3 bg-green-50 border border-green-200 rounded-lg\">\n                          <div className=\"flex items-center text-green-700 text-sm font-medium mb-2\">\n                            <Check className=\"w-4 h-4 mr-2\" />\n                            Cupom \"{couponData.code}\" aplicado!\n                          </div>\n                          <div className=\"text-sm text-green-600\">\n                            <p>{couponData.description}</p>\n                            <div className=\"flex justify-between mt-2\">\n                              <span>Desconto:</span>\n                              <span className=\"font-medium\">\n                                {couponData.type === 'percentage' \n                                  ? `${couponData.discount}%` \n                                  : `R$ ${(couponData.discount / 100).toFixed(2)}`\n                                }\n                              </span>\n                            </div>\n                            <div className=\"flex justify-between\">\n                              <span>Valor original:</span>\n                              <span>R$ {(couponCalculation.original_amount / 100).toFixed(2)}</span>\n                            </div>\n                            <div className=\"flex justify-between font-medium text-green-700\">\n                              <span>Valor final:</span>\n                              <span>R$ {(couponCalculation.final_amount / 100).toFixed(2)}</span>\n                            </div>\n                          </div>\n                        </div>\n                      )}\n                    </div>\n                  )}\n                </div>\n\n                {/* Campos específicos para cartão de crédito */}\n                {paymentMethod === 'credit_card' && (\n                  <>\n                    {/* Número do Cartão */}\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                        Número do Cartão\n                      </label>\n                      <div className=\"relative\">\n                        <input\n                          type=\"text\"\n                          value={formData.cardNumber}\n                          onChange={(e) => handleInputChange('cardNumber', e.target.value)}\n                          className={`w-full px-4 py-3 border rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500 transition-all ${validations.cardNumber ? 'border-red-300' : 'border-gray-300'\n                            }`}\n                          placeholder=\"1234 5678 9012 3456\"\n                          maxLength={19}\n                        />\n                      </div>\n                      <CardIcons />\n                      {validations.cardNumber && (\n                        <p className=\"mt-1 text-sm text-red-600\">{validations.cardNumber}</p>\n                      )}\n                    </div>\n\n                    {/* Nome no Cartão */}\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                        Nome no Cartão\n                      </label>\n                      <input\n                        type=\"text\"\n                        value={formData.cardName}\n                        onChange={(e) => handleInputChange('cardName', e.target.value)}\n                        className={`w-full px-4 py-3 border rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500 transition-all ${validations.cardName ? 'border-red-300' : 'border-gray-300'\n                          }`}\n                        placeholder=\"Nome como aparece no cartão\"\n                      />\n                      {validations.cardName && (\n                        <p className=\"mt-1 text-sm text-red-600\">{validations.cardName}</p>\n                      )}\n                    </div>\n\n                    {/* Data de Expiração e CVV */}\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                          Expiração\n                        </label>\n                        <input\n                          type=\"text\"\n                          value={formData.expiryDate}\n                          onChange={(e) => handleInputChange('expiryDate', e.target.value)}\n                          className={`w-full px-4 py-3 border rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500 transition-all ${validations.expiryDate ? 'border-red-300' : 'border-gray-300'\n                            }`}\n                          placeholder=\"MM/AA\"\n                          maxLength={5}\n                        />\n                        {validations.expiryDate && (\n                          <p className=\"mt-1 text-sm text-red-600\">{validations.expiryDate}</p>\n                        )}\n                      </div>\n\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                          CVV\n                        </label>\n                        <input\n                          type=\"text\"\n                          value={formData.cvv}\n                          onChange={(e) => handleInputChange('cvv', e.target.value)}\n                          className={`w-full px-4 py-3 border rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500 transition-all ${validations.cvv ? 'border-red-300' : 'border-gray-300'\n                            }`}\n                          placeholder=\"123\"\n                          maxLength={4}\n                        />\n                        {validations.cvv && (\n                          <p className=\"mt-1 text-sm text-red-600\">{validations.cvv}</p>\n                        )}\n                      </div>\n                    </div>\n                  </>\n                )}\n\n                {/* Botão de Pagamento */}\n                <button\n                  onClick={handleSubmit}\n                  disabled={loading}\n                  className=\"w-full bg-gradient-to-r from-green-600 to-emerald-600 text-white py-4 px-6 rounded-lg font-semibold hover:from-green-700 hover:to-emerald-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center\"\n                >\n                  {loading ? (\n                    <div className=\"flex flex-col items-center space-y-2\">\n                      <div className=\"flex items-center\">\n                        <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2\"></div>\n                        {processingStep || 'Processando...'}\n                      </div>\n                      {loadingMessage && (\n                        <span className=\"text-sm opacity-80\">{loadingMessage}</span>\n                      )}\n                    </div>\n                  ) : (\n                    <>\n                      <Lock className=\"w-5 h-5 mr-2\" />\n                      {paymentMethod === 'credit_card' ? 'Confirmar Assinatura' : 'Gerar PIX'} - \n                      {couponCalculation ? \n                        ` R$ ${(couponCalculation.final_amount / 100).toFixed(2)}/mês` : \n                        ' R$ 197/mês'\n                      }\n                    </>\n                  )}\n                </button>\n\n                {/* Informações de Segurança */}\n                 <div className=\"text-center text-sm text-gray-600\">\n                   <div className=\"flex items-center justify-center mb-2\">\n                     <Shield className=\"w-4 h-4 text-green-600 mr-1\" />\n                     <span>Pagamento seguro e criptografado</span>\n                   </div>\n                   <p>\n                     Ao continuar, você concorda com nossos{' '}\n                     <a href=\"#\" className=\"text-green-600 hover:underline\">\n                       Termos de Serviço\n                     </a>\n                   </p>\n                 </div>\n               </div>\n             </div>\n           </div>\n           \n           {/* Rodapé com logo da Pagar.me */}\n           <div className=\"mt-12 border-t border-gray-200 pt-8\">\n             <div className=\"max-w-4xl mx-auto text-center\">\n               <div className=\"flex flex-col items-center space-y-4\">\n                 <div className=\"flex items-center space-x-2 text-xs text-gray-600\">\n                    <span>Powered by</span>\n                    <img\n                      src=\"https://assets.decocache.com/payme/ab015445-0855-45b7-9abb-0df413196ca2/pagarme-logo-main.svg\"\n                      alt=\"Pagar.me\"\n                      className=\"h-4 w-auto\"\n                    />\n                  </div>\n                 <div className=\"flex items-center space-x-4 text-xs text-gray-500\">\n                   <a href=\"#\" className=\"hover:text-gray-700 transition-colors\">Legal</a>\n                   <span>|</span>\n                   <a href=\"#\" className=\"hover:text-gray-700 transition-colors\">Returns</a>\n                   <span>|</span>\n                   <a href=\"#\" className=\"hover:text-gray-700 transition-colors\">Contact</a>\n                 </div>\n                 <p className=\"text-xs text-gray-500\">\n                   © 2025 Umbrella Tecnologia. - Todos os direitos reservados.\n                 </p>\n               </div>\n             </div>\n           </div>\n         </div>\n       </div>\n     </div>\n   );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/checkout/page.snapshot.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/checkout/page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'userProfile?.fullName' and 'userProfile?.name'. Either include them or remove the dependency array.","line":521,"column":6,"nodeType":"ArrayExpression","endLine":521,"endColumn":61,"suggestions":[{"desc":"Update the dependencies array to be: [isAuthenticated, userProfile?.email, userProfile?.cpf, userProfile?.fullName, userProfile?.name]","fix":{"range":[22163,22218],"text":"[isAuthenticated, userProfile?.email, userProfile?.cpf, userProfile?.fullName, userProfile?.name]"}}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":574,"column":7,"nodeType":"JSXOpeningElement","endLine":574,"endColumn":162},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":855,"column":25,"nodeType":"JSXOpeningElement","endLine":855,"endColumn":147},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":861,"column":31,"nodeType":"JSXOpeningElement","endLine":861,"endColumn":141},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":923,"column":25,"nodeType":"JSXOpeningElement","endLine":923,"endColumn":142},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":930,"column":31,"nodeType":"JSXOpeningElement","endLine":930,"endColumn":141},{"ruleId":"react/no-unescaped-entities","severity":1,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":960,"column":144,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[53637,53644],"text":"Cupom &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[53637,53644],"text":"Cupom &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[53637,53644],"text":"Cupom &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[53637,53644],"text":"Cupom &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":1,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":960,"column":162,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[53661,53672],"text":"&quot; aplicado!"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[53661,53672],"text":"&ldquo; aplicado!"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[53661,53672],"text":"&#34; aplicado!"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[53661,53672],"text":"&rdquo; aplicado!"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":1050,"column":107,"nodeType":"JSXOpeningElement","endLine":1050,"endColumn":252}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { CreditCard, Shield, Check, AlertCircle, Lock, Star, Smartphone, Copy, ChevronDown, Tag } from 'lucide-react';\nimport { useSofiaAuth } from '@/hooks/use-sofia-auth';\nimport { z } from 'zod';\nimport QRCode from 'qrcode';\n\n// Tipos\ninterface FormData {\n  email: string;\n  emailConfirm: string;\n  cardNumber: string;\n  expiryDate: string;\n  cvv: string;\n  cardName: string;\n  fullName: string;\n  cpf: string;\n  phone: string;\n  coupon: string;\n}\n\ninterface PixData {\n  qr_code: string;\n  qr_code_url: string;\n  expires_at: string;\n  pix_key?: string;\n  amount?: number;\n  order_id?: string;\n}\n\ninterface Validations { [key: string]: string }\n\ninterface CouponData {\n  code: string;\n  description: string;\n  discount: number;\n  type: 'percentage' | 'fixed';\n}\n\ninterface CouponCalculation {\n  original_amount: number;\n  discount_amount: number;\n  final_amount: number;\n  savings_percentage: number;\n}\n\n// Componente simples de Skeleton\nfunction Skeleton({ className = '' }: { className?: string }) {\n  return <div className={`animate-pulse bg-gray-200 rounded ${className}`} />;\n}\n\n// Renderização local do QR para evitar latência de imagens externas\nfunction QrCanvas({ code, className = '' }: { code: string; className?: string }) {\n  const canvasRef = useRef<HTMLCanvasElement | null>(null);\n  const [ready, setReady] = useState(false);\n\n  useEffect(() => {\n    if (!code || !canvasRef.current) return;\n    setReady(false);\n    QRCode.toCanvas(canvasRef.current, code, { width: 256, margin: 1 })\n      .then(() => setReady(true))\n      .catch(() => setReady(false));\n  }, [code]);\n\n  return (\n    <div className={`w-full h-full flex items-center justify-center ${className}`}>\n      {!ready && <Skeleton className=\"w-48 h-48\" />}\n      <canvas ref={canvasRef} className=\"block\" style={{ display: ready ? 'block' : 'none' }} />\n    </div>\n  );\n}\n\n// Configuração simples de moedas para visualização (conversão estimada)\nconst currencyMap = {\n  BRL: { label: 'Brasil (BRL)', currency: 'BRL', locale: 'pt-BR', rate: 1 },\n  USD: { label: 'Estados Unidos (USD)', currency: 'USD', locale: 'en-US', rate: 0.19 },\n  EUR: { label: 'Europa (EUR)', currency: 'EUR', locale: 'en-GB', rate: 0.18 },\n  MXN: { label: 'México (MXN)', currency: 'MXN', locale: 'es-MX', rate: 3.4 },\n} as const;\n\ntype CurrencyKey = keyof typeof currencyMap;\n\nfunction formatPrice(amountCentsBRL: number, currencyKey: CurrencyKey): string {\n  const cfg = currencyMap[currencyKey];\n  const converted = amountCentsBRL * cfg.rate;\n  return new Intl.NumberFormat(cfg.locale, { style: 'currency', currency: cfg.currency }).format(converted / 100);\n}\n\n// Países (seleção compacta com bandeira real e regras básicas)\nconst countryMap = {\n  BR: { label: 'Brasil', flagUrl: 'https://flagcdn.com/24x18/br.png', currency: 'BRL' as CurrencyKey, locale: 'pt-BR', localeKey: 'pt', phonePlaceholder: '(11) 99999-9999', showCPF: true },\n  US: { label: 'Estados Unidos', flagUrl: 'https://flagcdn.com/24x18/us.png', currency: 'USD' as CurrencyKey, locale: 'en-US', localeKey: 'en', phonePlaceholder: '(555) 555-5555', showCPF: false },\n  EU: { label: 'Europe', flagUrl: 'https://flagcdn.com/24x18/eu.png', currency: 'EUR' as CurrencyKey, locale: 'en-GB', localeKey: 'en', phonePlaceholder: '+44 7123 456789', showCPF: false },\n  MX: { label: 'México', flagUrl: 'https://flagcdn.com/24x18/mx.png', currency: 'MXN' as CurrencyKey, locale: 'es-MX', localeKey: 'es', phonePlaceholder: '+52 55 1234 5678', showCPF: false },\n} as const;\n\ntype CountryKey = keyof typeof countryMap;\n\nfunction formatPhoneByCountry(value: string, country: CountryKey): string {\n  const digits = value.replace(/\\D/g, '');\n  if (country === 'BR') {\n    const v = digits.substring(0, 11);\n    if (v.length <= 10) return v.replace(/(\\d{2})(\\d{4})(\\d{0,4})/, '($1) $2-$3');\n    return v.replace(/(\\d{2})(\\d{5})(\\d{0,4})/, '($1) $2-$3');\n  }\n  if (country === 'US') {\n    const v = digits.substring(0, 10);\n    return v.replace(/(\\d{3})(\\d{3})(\\d{0,4})/, '($1) $2-$3');\n  }\n  if (country === 'MX') {\n    const v = digits.substring(0, 13);\n    return v.replace(/(\\d{2})(\\d{2})(\\d{4})(\\d{0,4})/, '+52 $1 $2 $3 $4');\n  }\n  // EU genérico\n  const v = digits.substring(0, 15);\n  return v.replace(/(\\d{2})(\\d{3})(\\d{3})(\\d{0,6})/, '+$1 $2 $3 $4');\n}\n\nexport default function CheckoutPage() {\n  const router = useRouter();\n  const { userProfile, isAuthenticated } = useSofiaAuth();\n\n  const [formData, setFormData] = useState<FormData>({\n    email: '',\n    emailConfirm: '',\n    cardNumber: '',\n    expiryDate: '',\n    cvv: '',\n    cardName: '',\n    fullName: '',\n    cpf: '',\n    phone: '',\n    coupon: ''\n  });\n\n  const [paymentMethod, setPaymentMethod] = useState<'credit_card' | 'pix'>('credit_card');\n  const [pixData, setPixData] = useState<PixData | null>(null);\n  const [showCoupon, setShowCoupon] = useState(false);\n  const [clientReady, setClientReady] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [loadingMessage, setLoadingMessage] = useState('');\n  const [success, setSuccess] = useState(false);\n  const [error, setError] = useState('');\n  const [processingStep, setProcessingStep] = useState('');\n  const [validations, setValidations] = useState<Validations>({});\n  const [couponData, setCouponData] = useState<CouponData | null>(null);\n  const [couponCalculation, setCouponCalculation] = useState<CouponCalculation | null>(null);\n  const [couponLoading, setCouponLoading] = useState(false);\n  const [couponError, setCouponError] = useState('');\n  const [country, setCountry] = useState<CountryKey>('BR');\n  const [currency, setCurrency] = useState<CurrencyKey>('BRL');\n  const [countryMenuOpen, setCountryMenuOpen] = useState(false);\n  const [phoneMenuOpen, setPhoneMenuOpen] = useState(false);\n  const [localeKey, setLocaleKey] = useState<'pt'|'en'|'es'>('pt');\n\n  // i18n simples por país\n  const i18n = {\n    pt: {\n      step_personal: 'Dados pessoais',\n      step_payment: 'Pagamento',\n      step_confirm: 'Confirmar',\n      payment_info: 'Informações de pagamento',\n      choose_payment_method: 'Escolha a forma de pagamento',\n      card: 'Cartão',\n      pix: 'PIX',\n      full_name: 'Nome completo',\n      email: 'Email',\n      email_confirm: 'Confirmar Email',\n      cpf: 'CPF',\n      phone: 'Telefone',\n      have_coupon: 'Tenho um cupom de desconto',\n      coupon_placeholder: 'Digite seu código do cupom',\n      discount: 'Desconto:',\n      original_value: 'Valor original:',\n      final_value: 'Valor final:',\n      value: 'Valor:',\n      plan_label: 'Plano:',\n      secure_payment: 'Pagamento seguro & criptografado',\n      cta_activate: 'Ativar assinatura',\n      per_month: '/mês',\n      recurring_billing: 'Cobrança recorrente mensal',\n      billing_note: 'Cobrança em BRL; valores convertidos para exibição.',\n      activate_title: 'Ative sua assinatura',\n      activate_subtitle_main: 'Plano Professional com acesso completo',\n      plan_title: 'Plano Professional',\n      plan_subtitle: 'Acesso completo à plataforma',\n      feature_unlimited: 'Acesso ilimitado a todas as funcionalidades',\n      feature_priority_support: 'Suporte prioritário 24/7',\n      feature_api: 'API completa para integrações',\n      feature_reports: 'Relatórios avançados e analytics',\n      feature_backup: 'Backup automático diário',\n      feature_ssl: 'SSL gratuito e segurança avançada',\n      guarantee_title: 'Garantia de 30 dias',\n      guarantee_desc: 'Cancele a qualquer momento nos primeiros 30 dias',\n      security_title: 'Segurança & Confiança',\n      badge_ssl: 'SSL Seguro',\n      badge_pci: 'PCI Compliant',\n      badge_secure_purchase: 'Compra Segura',\n      badge_refund: 'Reembolso 100%',\n      pix_pay_title: 'Pague com PIX',\n      pix_instructions: 'Escaneie o QR Code com seu banco ou copie o código PIX',\n      pix_code_label: 'Código PIX:',\n      valid_until: 'Válido até',\n      pix_already_paid: 'Já paguei, verificar',\n      back_to_card: 'Voltar para cartão',\n      back_to_options: 'Voltar para outras opções',\n      full_name_placeholder: 'Seu nome completo',\n      email_placeholder: 'seu@email.com',\n      email_confirm_placeholder: 'repita seu@email.com',\n      card_number_placeholder: '1234 5678 9012 3456',\n      card_name_placeholder: 'Nome como aparece no cartão',\n      expiry_placeholder: 'MM/AA',\n      cvv_placeholder: '123',\n      invalid_email: 'Email inválido',\n      invalid_email_confirm: 'Confirmação inválida',\n      full_name_required: 'Nome completo é obrigatório',\n      invalid_cpf: 'CPF inválido',\n      invalid_phone: 'Telefone inválido',\n      emails_mismatch: 'Emails não conferem',\n      pix_customer_name: 'Cliente PIX',\n      generating_pix: 'Gerando PIX...',\n      creating_payment_code: 'Criando código de pagamento',\n      pix_generated_success: 'PIX gerado com sucesso!',\n      pix_generate_error: 'Erro ao gerar PIX',\n      cta_generate_pix: 'Gerar PIX',\n      redirecting_dashboard: 'Redirecionando para o dashboard...',\n      btn_access_dashboard: 'Acessar Dashboard',\n      btn_view_subscription: 'Ver detalhes da assinatura'\n    },\n    en: {\n      step_personal: 'Personal data',\n      step_payment: 'Payment',\n      step_confirm: 'Confirm',\n      payment_info: 'Payment information',\n      choose_payment_method: 'Choose payment method',\n      card: 'Card',\n      pix: 'PIX',\n      full_name: 'Full name',\n      email: 'Email',\n      email_confirm: 'Confirm Email',\n      cpf: 'CPF',\n      phone: 'Phone',\n      have_coupon: 'I have a discount coupon',\n      coupon_placeholder: 'Type your coupon code',\n      discount: 'Discount:',\n      original_value: 'Original value:',\n      final_value: 'Final value:',\n      value: 'Value:',\n      plan_label: 'Plan:',\n      secure_payment: 'Secure & encrypted payment',\n      cta_activate: 'Activate subscription',\n      per_month: '/month',\n      recurring_billing: 'Monthly recurring billing',\n      billing_note: 'Charged in BRL; values converted for display.',\n      activate_title: 'Activate your subscription',\n      activate_subtitle_main: 'Professional plan with full platform access',\n      plan_title: 'Professional Plan',\n      plan_subtitle: 'Full access to the platform',\n      feature_unlimited: 'Unlimited access to all features',\n      feature_priority_support: 'Priority support 24/7',\n      feature_api: 'Full API for integrations',\n      feature_reports: 'Advanced reports and analytics',\n      feature_backup: 'Daily automatic backup',\n      feature_ssl: 'Free SSL and advanced security',\n      guarantee_title: '30-day guarantee',\n      guarantee_desc: 'Cancel anytime within the first 30 days',\n      security_title: 'Security & Trust',\n      badge_ssl: 'Secure SSL',\n      badge_pci: 'PCI Compliant',\n      badge_secure_purchase: 'Secure Purchase',\n      badge_refund: '100% Refund',\n      pix_pay_title: 'Pay with PIX',\n      pix_instructions: 'Scan the QR Code with your bank or copy the PIX code',\n      pix_code_label: 'PIX Code:',\n      valid_until: 'Valid until',\n      pix_already_paid: 'I already paid, verify',\n      back_to_card: 'Back to card',\n      back_to_options: 'Back to other options',\n      full_name_placeholder: 'Your full name',\n      email_placeholder: 'your@email.com',\n      email_confirm_placeholder: 'repeat your@email.com',\n      card_number_placeholder: '1234 5678 9012 3456',\n      card_name_placeholder: 'Name as on card',\n      expiry_placeholder: 'MM/YY',\n      cvv_placeholder: '123',\n      invalid_email: 'Invalid email',\n      invalid_email_confirm: 'Invalid confirmation',\n      full_name_required: 'Full name is required',\n      invalid_cpf: 'Invalid CPF',\n      invalid_phone: 'Invalid phone',\n      emails_mismatch: 'Emails do not match',\n      pix_customer_name: 'PIX Customer',\n      generating_pix: 'Generating PIX...',\n      creating_payment_code: 'Creating payment code',\n      pix_generated_success: 'PIX generated successfully!',\n      pix_generate_error: 'Error generating PIX',\n      cta_generate_pix: 'Generate PIX',\n      redirecting_dashboard: 'Redirecting to dashboard...',\n      btn_access_dashboard: 'Access Dashboard',\n      btn_view_subscription: 'View subscription details'\n    },\n    es: {\n      step_personal: 'Datos personales',\n      step_payment: 'Pago',\n      step_confirm: 'Confirmar',\n      payment_info: 'Información de pago',\n      choose_payment_method: 'Elegir método de pago',\n      card: 'Tarjeta',\n      pix: 'PIX',\n      full_name: 'Nombre completo',\n      email: 'Email',\n      email_confirm: 'Confirmar Email',\n      cpf: 'CPF',\n      phone: 'Teléfono',\n      have_coupon: 'Tengo un cupón de descuento',\n      coupon_placeholder: 'Escribe tu código de cupón',\n      discount: 'Descuento:',\n      original_value: 'Valor original:',\n      final_value: 'Valor final:',\n      value: 'Valor:',\n      plan_label: 'Plan:',\n      secure_payment: 'Pago seguro y encriptado',\n      cta_activate: 'Activar suscripción',\n      per_month: '/mes',\n      recurring_billing: 'Facturación recurrente mensual',\n      billing_note: 'Cobro en BRL; valores convertidos para mostrar.',\n      activate_title: 'Activa tu suscripción',\n      activate_subtitle_main: 'Plan Profesional con acceso completo a la plataforma',\n      plan_title: 'Plan Profesional',\n      plan_subtitle: 'Acceso completo a la plataforma',\n      feature_unlimited: 'Acceso ilimitado a todas las funcionalidades',\n      feature_priority_support: 'Soporte prioritario 24/7',\n      feature_api: 'API completa para integraciones',\n      feature_reports: 'Informes avanzados y analíticas',\n      feature_backup: 'Copia de seguridad automática diaria',\n      feature_ssl: 'SSL gratuito y seguridad avanzada',\n      guarantee_title: 'Garantía de 30 días',\n      guarantee_desc: 'Cancela en cualquier momento durante los primeros 30 días',\n      security_title: 'Seguridad y Confianza',\n      badge_ssl: 'SSL Seguro',\n      badge_pci: 'PCI Compliant',\n      badge_secure_purchase: 'Compra Segura',\n      badge_refund: 'Reembolso 100%',\n      pix_pay_title: 'Paga con PIX',\n      pix_instructions: 'Escanea el código QR con tu banco o copia el código PIX',\n      pix_code_label: 'Código PIX:',\n      valid_until: 'Válido hasta',\n      pix_already_paid: 'Ya pagué, verificar',\n      back_to_card: 'Volver a tarjeta',\n      back_to_options: 'Volver a otras opciones',\n      full_name_placeholder: 'Tu nombre completo',\n      email_placeholder: 'tu@email.com',\n      email_confirm_placeholder: 'repite tu@email.com',\n      card_number_placeholder: '1234 5678 9012 3456',\n      card_name_placeholder: 'Nombre como aparece en la tarjeta',\n      expiry_placeholder: 'MM/AA',\n      cvv_placeholder: '123',\n      invalid_email: 'Email inválido',\n      invalid_email_confirm: 'Confirmación inválida',\n      full_name_required: 'El nombre completo es obligatorio',\n      invalid_cpf: 'CPF inválido',\n      invalid_phone: 'Teléfono inválido',\n      emails_mismatch: 'Los emails no coinciden',\n      pix_customer_name: 'Cliente PIX',\n      generating_pix: 'Generando PIX...',\n      creating_payment_code: 'Creando código de pago',\n      pix_generated_success: '¡PIX generado con éxito!',\n      pix_generate_error: 'Error al generar PIX',\n      cta_generate_pix: 'Generar PIX',\n      redirecting_dashboard: 'Redirigiendo al panel...',\n      btn_access_dashboard: 'Acceder al Panel',\n      btn_view_subscription: 'Ver detalles de la suscripción'\n    }\n  } as const;\n\n  const tr = (key: keyof typeof i18n.pt) => i18n[localeKey][key];\n\n  // Helpers de formatação\n  const formatCardNumber = (value: string): string => {\n    const v = value.replace(/\\s+/g, '').replace(/[^0-9]/gi, '');\n    const matches = v.match(/\\d{4,16}/g);\n    const match = (matches && matches[0]) || '';\n    const parts: string[] = [];\n    for (let i = 0, len = match.length; i < len; i += 4) parts.push(match.substring(i, i + 4));\n    return parts.length ? parts.join(' ') : v;\n  };\n\n  const formatExpiryDate = (value: string): string => {\n    const v = value.replace(/\\s+/g, '').replace(/[^0-9]/gi, '');\n    if (v.length >= 2) return v.substring(0, 2) + '/' + v.substring(2, 4);\n    return v;\n  };\n\n  const formatCPF = (value: string): string => {\n    const v = value.replace(/\\D/g, '');\n    if (v.length <= 11) return v.replace(/(\\d{3})(\\d{3})(\\d{3})(\\d{2})/, '$1.$2.$3-$4');\n    return v.substring(0, 11).replace(/(\\d{3})(\\d{3})(\\d{3})(\\d{2})/, '$1.$2.$3-$4');\n  };\n\n  const formatPhone = (value: string): string => {\n    const v = value.replace(/\\D/g, '').substring(0, 11);\n    if (v.length <= 10) return v.replace(/(\\d{2})(\\d{4})(\\d{0,4})/, '($1) $2-$3');\n    return v.replace(/(\\d{2})(\\d{5})(\\d{0,4})/, '($1) $2-$3');\n  };\n\n  const validateCPF = (cpf: string): boolean => {\n    const cleanCPF = cpf.replace(/\\D/g, '');\n    if (cleanCPF.length !== 11) return false;\n    if (/^(\\d)\\1{10}$/.test(cleanCPF)) return false;\n    let sum = 0;\n    for (let i = 0; i < 9; i++) sum += parseInt(cleanCPF.charAt(i)) * (10 - i);\n    let remainder = (sum * 10) % 11; if (remainder === 10 || remainder === 11) remainder = 0;\n    if (remainder !== parseInt(cleanCPF.charAt(9))) return false;\n    sum = 0;\n    for (let i = 0; i < 10; i++) sum += parseInt(cleanCPF.charAt(i)) * (11 - i);\n    remainder = (sum * 10) % 11; if (remainder === 10 || remainder === 11) remainder = 0;\n    return remainder === parseInt(cleanCPF.charAt(10));\n  };\n\n  const validateCardNumber = (cardNumber: string): boolean => {\n    const cleanNumber = cardNumber.replace(/\\s/g, '');\n    if (cleanNumber.length < 13 || cleanNumber.length > 19) return false;\n    let sum = 0; let isEven = false;\n    for (let i = cleanNumber.length - 1; i >= 0; i--) {\n      let digit = parseInt(cleanNumber.charAt(i));\n      if (isEven) { digit *= 2; if (digit > 9) digit -= 9; }\n      sum += digit; isEven = !isEven;\n    }\n    return sum % 10 === 0;\n  };\n\n  const getSchema = () => {\n    const commonShape = {\n      email: z.string().email({ message: tr('invalid_email') }),\n      emailConfirm: z.string().email({ message: tr('invalid_email_confirm') }),\n      fullName: z.string().min(5, { message: tr('full_name_required') }),\n      cpf: country === 'BR'\n        ? z.string().refine((v) => validateCPF(v), { message: tr('invalid_cpf') })\n        : z.string().optional().default(''),\n      phone: z.string().refine((v) => {\n        const len = v.replace(/\\D/g, '').length;\n        if (country === 'BR') return len >= 10 && len <= 11;\n        if (country === 'US') return len === 10;\n        if (country === 'MX') return len >= 10 && len <= 13;\n        return len >= 10 && len <= 15;\n      }, { message: tr('invalid_phone') }),\n      coupon: z.string().optional().default('')\n    } as const;\n\n    const shape = paymentMethod === 'credit_card'\n      ? {\n          ...commonShape,\n          cardNumber: z.string().refine((v) => validateCardNumber(v), { message: 'Número do cartão inválido' }),\n          expiryDate: z.string().refine((v) => {\n            if (v.length < 5) return false;\n            const [month, year] = v.split('/');\n            const currentDate = new Date();\n            const currentYear = currentDate.getFullYear() % 100;\n            const currentMonth = currentDate.getMonth() + 1;\n            const expMonth = parseInt(month); const expYear = parseInt(year);\n            if (expMonth < 1 || expMonth > 12) return false;\n            if (expYear < currentYear || (expYear === currentYear && expMonth < currentMonth)) return false;\n            return true;\n          }, { message: 'Data de expiração inválida' }),\n          cvv: z.string().min(3, { message: 'CVV deve ter pelo menos 3 dígitos' }),\n          cardName: z.string().min(3, { message: 'Nome do titular é obrigatório' }).regex(/^[a-zA-ZÀ-ÿ\\s]+$/, { message: 'Nome deve conter apenas letras' })\n        }\n      : {\n          ...commonShape,\n          cardNumber: z.string().optional().default(''),\n          expiryDate: z.string().optional().default(''),\n          cvv: z.string().optional().default(''),\n          cardName: z.string().optional().default('')\n        };\n\n    return z.object(shape).superRefine((data, ctx) => {\n      if (data.email.toLowerCase() !== data.emailConfirm.toLowerCase()) {\n        ctx.addIssue({ code: 'custom', message: tr('emails_mismatch'), path: ['emailConfirm'] });\n      }\n    });\n  };\n\n  const validateForm = () => {\n    const parsed = getSchema().safeParse(formData);\n    const newValidations: Record<string, string> = {};\n    if (!parsed.success) for (const issue of parsed.error.issues) { const key = (issue.path[0] as string) || 'form'; newValidations[key] = issue.message; }\n    setValidations(newValidations);\n    return parsed.success;\n  };\n\n  const handleInputChange = (field: keyof FormData, value: string): void => {\n    let formattedValue = value;\n    if (field === 'cardNumber') formattedValue = formatCardNumber(value);\n    else if (field === 'expiryDate') formattedValue = formatExpiryDate(value);\n    else if (field === 'cpf') formattedValue = formatCPF(value);\n    else if (field === 'phone') formattedValue = formatPhoneByCountry(value, country);\n    else if (field === 'cvv') formattedValue = value.replace(/\\D/g, '').substring(0, 4);\n    else if (field === 'cardName') formattedValue = value.replace(/[^a-zA-ZÀ-ÿ\\s]/g, '').toUpperCase();\n    else if (field === 'email') formattedValue = value.toLowerCase();\n    else if (field === 'emailConfirm') formattedValue = value.toLowerCase();\n    else if (field === 'coupon') formattedValue = value.toUpperCase().replace(/\\s/g, '');\n    setFormData(prev => ({ ...prev, [field]: formattedValue }));\n    if (validations[field]) setValidations(prev => ({ ...prev, [field]: '' }));\n  };\n\n  // Preencher com dados do usuário logado\n  useEffect(() => {\n    if (!isAuthenticated) return;\n    setFormData(prev => {\n      if (prev.email || prev.cpf || prev.fullName) return prev;\n      return {\n        ...prev,\n        email: userProfile?.email || prev.email,\n        emailConfirm: userProfile?.email || prev.emailConfirm,\n        cpf: userProfile?.cpf || prev.cpf,\n        fullName: userProfile?.fullName || userProfile?.name || prev.fullName,\n      };\n    });\n  }, [isAuthenticated, userProfile?.email, userProfile?.cpf]);\n\n  // Controlar skeleton de montagem do cliente\n  useEffect(() => {\n    const t = setTimeout(() => setClientReady(true), 100);\n    return () => clearTimeout(t);\n  }, []);\n\n  // Alteração de país com recarga e skeleton\n  const handleCountryChange = (newCountry: CountryKey) => {\n    setCountry(newCountry);\n    setCurrency(countryMap[newCountry].currency);\n    setLocaleKey(countryMap[newCountry].localeKey as 'pt'|'en'|'es');\n    setCountryMenuOpen(false);\n    setClientReady(false);\n    setTimeout(() => {\n      router.refresh();\n      setClientReady(true);\n    }, 300);\n  };\n\n  // Validar cupom com debounce\n  const validateCoupon = async (couponCode: string) => {\n    if (!couponCode.trim()) { setCouponData(null); setCouponCalculation(null); setCouponError(''); return; }\n    setCouponLoading(true); setCouponError('');\n    try {\n      const response = await fetch('/api/validate-coupon', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ coupon: couponCode, amount: 19700 }) });\n      const result = await response.json();\n      if (result.success) { setCouponData(result.coupon); setCouponCalculation(result.calculation); setCouponError(''); }\n      else { setCouponData(null); setCouponCalculation(null); setCouponError(result.error); }\n    } catch { setCouponError('Erro ao validar cupom'); setCouponData(null); setCouponCalculation(null); }\n    finally { setCouponLoading(false); }\n  };\n\n  useEffect(() => { const timer = setTimeout(() => { if (formData.coupon) validateCoupon(formData.coupon); }, 500); return () => clearTimeout(timer); }, [formData.coupon]);\n\n  // PIX status polling\n  useEffect(() => {\n    if (!pixData?.order_id) return;\n    let stopped = false;\n    const checkStatus = async () => {\n      try {\n        const res = await fetch(`/api/create-pix?order_id=${pixData.order_id}`, { method: 'PUT' });\n        const json = await res.json();\n        if (json.success && json.status === 'paid') { if (!stopped) { stopped = true; window.location.href = `/checkout/success?order_id=${pixData.order_id}&mode=pix`; } }\n      } catch {}\n    };\n    checkStatus(); const id = setInterval(checkStatus, 5000);\n    return () => { stopped = true; clearInterval(id); };\n  }, [pixData?.order_id]);\n\n  const CardIcons = () => (\n    <div className=\"mt-2 flex justify-end\">\n      <img src=\"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ1dzeybZgprwWRyK-12bqIACT_B4BQG6dNPQ&s\" alt=\"Bandeiras de Cartão\" className=\"h-5 w-auto\" />\n    </div>\n  );\n\n  const copyPixCode = () => { if (pixData) navigator.clipboard.writeText(pixData.qr_code_url); };\n  const [checkingPix, setCheckingPix] = useState(false);\n  const [pixCheckMessage, setPixCheckMessage] = useState<string>('');\n\n  const handleSubmit = async () => {\n    if (!validateForm()) return;\n    setLoading(true); setError(''); setProcessingStep('Validando dados...');\n    try {\n      const finalAmount = couponCalculation ? couponCalculation.final_amount : 19700;\n      const baseData = {\n        customer: {\n          email: formData.email,\n          document_number: formData.cpf.replace(/\\D/g, ''),\n          // Para PIX usar sempre o nome completo informado pelo usuário\n          name: paymentMethod === 'credit_card' ? formData.cardName : formData.fullName,\n          type: 'individual',\n          // Enviar telefone bruto; a API vai normalizar country/area/number\n          phone: formData.phone,\n          // Usar email como código único do cliente\n          code: formData.email\n        },\n        amount: finalAmount,\n        ...(couponData && { coupon: couponData.code })\n      };\n      if (paymentMethod === 'credit_card') {\n        setProcessingStep('Processando pagamento...'); setLoadingMessage('Validando cartão de crédito');\n        const subscriptionData = { ...baseData, plan: { amount: finalAmount, interval: 'month', interval_count: 1, name: 'Plano SaaS Mensal' }, card: { number: formData.cardNumber.replace(/\\s/g, ''), holder_name: formData.cardName, exp_month: formData.expiryDate.split('/')[0], exp_year: '20' + formData.expiryDate.split('/')[1], cvv: formData.cvv }, payment_method: 'credit_card' };\n        setLoadingMessage('Criando assinatura...');\n        const response = await fetch('/api/create-subscription', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(subscriptionData) });\n        const result = await response.json();\n        if (result.success) {\n          const status = result.status || result.order?.charges?.[0]?.status;\n          if (status === 'paid') { setProcessingStep('Pagamento aprovado!'); setLoadingMessage('Redirecionando...'); window.location.href = `/checkout/success?order_id=${result.order_id}&mode=card`; }\n          else { const msg = status === 'not_authorized' ? 'Pagamento não autorizado' : status === 'failed' ? 'Pagamento falhou' : 'Pagamento pendente'; setError(`${msg}. Seu acesso ao dashboard será liberado somente após aprovação.`); setProcessingStep(''); setLoadingMessage(''); }\n        } else { throw new Error(result.error || 'Erro ao processar pagamento'); }\n      } else {\n  setProcessingStep(tr('generating_pix')); setLoadingMessage(tr('creating_payment_code'));\n        const pixDataPayload = { ...baseData, payment_method: 'pix', pix_expiration_date: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString() };\n        const response = await fetch('/api/create-pix', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(pixDataPayload) });\n        const result = await response.json();\n        if (result.success && result.qr_code_url) {\n          setProcessingStep(tr('pix_generated_success'));\n          setLoadingMessage('');\n          setTimeout(() => {\n            setPixData({\n              qr_code: result.qr_code_url,\n              qr_code_url: result.qr_code,\n              expires_at: result.expires_at,\n              pix_key: result.pix_key,\n              amount: result.amount,\n              order_id: result.order_id\n            });\n          }, 1000);\n        }\n  else { throw new Error(result.error || tr('pix_generate_error')); }\n      }\n    } catch { setError('Erro ao processar pagamento. Tente novamente.'); setProcessingStep(''); setLoadingMessage(''); }\n    finally { setLoading(false); }\n  };\n\n  if (success && paymentMethod === 'credit_card') {\n    return (\n      <div className=\"min-h-screen bg-neutral-50 flex items-center justify-center p-4\">\n        <div className=\"max-w-md w-full bg-white rounded-2xl shadow-xl p-8 text-center\">\n          <div className=\"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6 animate-pulse\">\n            <Check className=\"w-10 h-10 text-green-600\" />\n          </div>\n          <h2 className=\"text-2xl font-bold text-gray-800 mb-4\">🎉 Assinatura Ativada!</h2>\n          <p className=\"text-gray-600 mb-6\">Parabéns! Sua assinatura foi processada com sucesso. Você receberá um email de confirmação em breve.</p>\n          <div className=\"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-4\">\n            <div className=\"text-sm text-gray-600 space-y-2\">\n            <div className=\"flex justify-between\"><span>{tr('plan_label')}</span><span className=\"font-medium\">{tr('plan_title')}</span></div>\n            <div className=\"flex justify-between\"><span>{tr('value')}</span><span className=\"font-medium\">{couponCalculation ? `${formatPrice(couponCalculation.final_amount, currency)}${tr('per_month')}` : `${formatPrice(19700, currency)}${tr('per_month')}`}</span></div>\n              {couponData && (<div className=\"flex justify-between text-green-600\"><span>Cupom aplicado:</span><span className=\"font-medium\">{couponData.code}</span></div>)}\n              <div className=\"flex justify-between\"><span>Próxima cobrança:</span><span className=\"font-medium\">{new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toLocaleDateString('pt-BR')}</span></div>\n            </div>\n          </div>\n          <div className=\"bg-green-50 rounded-lg p-4 mb-6 border border-green-200\">\n            <div className=\"flex items-center mb-2\"><div className=\"w-5 h-5 bg-green-500 rounded-full flex items-center justify-center mr-2\"><Check className=\"w-3 h-3 text-white\" /></div><p className=\"text-sm font-medium text-green-800\">Investimento Inteligente!</p></div>\n            <p className=\"text-sm text-green-700\">Não se preocupe com o valor - ele se paga em poucas operações bem-sucedidas! Você agora tem acesso às melhores estratégias para multiplicar seus ganhos.</p>\n          </div>\n          <div className=\"space-y-3\">\n            <button onClick={() => { setLoadingMessage(tr('redirecting_dashboard')); setTimeout(() => { window.location.href = '/dashboard'; }, 1500); }} className=\"w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-3 px-6 rounded-lg font-semibold hover:from-blue-700 hover:to-indigo-700 transition-all\">🚀 {tr('btn_access_dashboard')}</button>\n            <button onClick={() => window.location.href = '/profile' } className=\"w-full bg-gray-100 text-gray-700 py-2 px-6 rounded-lg font-medium hover:bg-gray-200 transition-all text-sm\">{tr('btn_view_subscription')}</button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (pixData) {\n    return (\n      <div className=\"min-h-screen bg-neutral-50 flex items-center justify-center p-4\">\n        <div className=\"max-w-md w-full bg-white rounded-2xl shadow-xl p-8 text-center\">\n          <div className=\"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6\"><Smartphone className=\"w-8 h-8 text-green-600\" /></div>\n          <h2 className=\"text-2xl font-bold text-gray-800 mb-4\">{tr('pix_pay_title')}</h2>\n          <p className=\"text-gray-600 mb-6\">{tr('pix_instructions')}</p>\n          <div className=\"bg-gray-100 p-6 rounded-lg mb-6\">\n            <div className=\"w-48 h-48 mx-auto bg-white rounded-lg flex items-center justify-center\">\n              {pixData.qr_code_url ? (\n                <QrCanvas code={pixData.qr_code_url} />\n              ) : (\n                <Skeleton className=\"w-40 h-40\" />\n              )}\n            </div>\n          </div>\n          <div className=\"bg-gray-50 rounded-lg p-4 mb-6 text-left\">\n            <p className=\"text-sm text-gray-600 mb-2\">{tr('pix_code_label')}</p>\n            <div className=\"flex items-center justify-between bg-white p-3 rounded border\"><span className=\"text-sm font-mono text-gray-700 truncate\">{pixData.qr_code_url.substring(0, 40)}...</span><button onClick={copyPixCode} className=\"ml-2 p-1 text-green-600 hover:bg-green-50 rounded\"><Copy className=\"w-4 h-4\" /></button></div>\n          </div>\n            <div className=\"text-center text-sm text-gray-600 mb-6\"><p className=\"font-semibold text-gray-800 text-lg\">{formatPrice(19700, currency)}</p><p>{tr('valid_until')}: {new Date(pixData.expires_at).toLocaleString(countryMap[country].locale)}</p></div>\n          {pixCheckMessage && (\n            <div className=\"mb-3 p-3 bg-yellow-50 border border-yellow-200 rounded text-sm text-yellow-800\">\n              {pixCheckMessage}\n            </div>\n          )}\n          <div className=\"grid grid-cols-2 gap-3 mb-6\">\n            <button\n              onClick={async () => {\n                if (!pixData?.order_id || checkingPix) return;\n                setCheckingPix(true);\n                setPixCheckMessage('Verificando pagamento...');\n                const controller = new AbortController();\n                const timeoutId = setTimeout(() => controller.abort(), 7000);\n                try {\n                  const res = await fetch(`/api/create-pix?order_id=${pixData.order_id}`, { method: 'PUT', signal: controller.signal });\n                  const json = await res.json();\n                  if (json.success && json.status === 'paid') {\n                    setPixCheckMessage('Pagamento confirmado! Redirecionando...');\n                    window.location.href = `/checkout/success?order_id=${pixData.order_id}&mode=pix`;\n                  } else if (json.success) {\n                    setPixCheckMessage('Pagamento ainda não compensado. Aguarde alguns segundos e tente novamente.');\n                  } else {\n                    setPixCheckMessage('Não foi possível verificar o pagamento agora. Tente novamente.');\n                  }\n                } catch {\n                  setPixCheckMessage('Erro ao verificar pagamento. Tente novamente.');\n                }\n                finally {\n                  clearTimeout(timeoutId);\n                  setCheckingPix(false);\n                }\n              }}\n              disabled={checkingPix}\n              className={`w-full ${checkingPix ? 'bg-green-500' : 'bg-green-600'} text-white py-3 px-6 rounded-lg font-semibold hover:bg-green-700 transition-all`}\n            >\n              {checkingPix ? 'Verificando…' : tr('pix_already_paid')}\n            </button>\n            <button onClick={() => { setPixData(null); setPaymentMethod('credit_card'); }} className=\"w-full bg-gray-100 text-gray-700 py-3 px-6 rounded-lg font-semibold hover:bg-gray-200 transition-all\">{tr('back_to_card')}</button>\n          </div>\n          <button onClick={() => { setPixData(null); setPaymentMethod('credit_card'); }} className=\"w-full bg-gray-100 text-gray-700 py-3 px-6 rounded-lg font-semibold hover:bg-gray-200 transition-all\">{tr('back_to_options')}</button>\n        </div>\n      </div>\n    );\n  }\n\n  // Preço exibido no CTA: usa cálculo do cupom quando disponível;\n  // caso contrário, aplica um desconto de demonstração de 10% para \"SOFIA10\".\n  const displayAmount = couponCalculation ? couponCalculation.final_amount : (formData.coupon.trim().toUpperCase() === 'SOFIA10' ? Math.round(19700 * 0.9) : 19700);\n\n  return (\n    <div className=\"min-h-screen bg-neutral-50\">\n      <div className=\"container mx-auto px-4 py-8\">\n        <div className=\"max-w-6xl mx-auto\">\n          <div className=\"text-center mb-8\">\n            <h1 className=\"text-3xl font-bold text-gray-800 mb-2\">{tr('activate_title')}</h1>\n            <p className=\"text-gray-600\">{tr('activate_subtitle_main')}</p>\n          </div>\n\n          <div className=\"grid md:grid-cols-3 gap-8\">\n            {/* Coluna esquerda (30%) - sticky */}\n            <div className=\"md:col-span-1\">\n              <div className=\"bg-white rounded-2xl shadow-xl p-8 md:sticky md:top-8\">\n                <div className=\"flex items-center mb-6\">\n                  <div className=\"w-12 h-12 bg-gradient-to-r from-green-600 to-emerald-600 rounded-xl flex items-center justify-center\">\n                    <Star className=\"w-6 h-6 text-white\" />\n                  </div>\n                  <div className=\"ml-4\">\n                    <h3 className=\"text-xl font-bold text-gray-800\">{tr('plan_title')}</h3>\n                    <p className=\"text-gray-600\">{tr('plan_subtitle')}</p>\n                  </div>\n                </div>\n\n                <div className=\"border-t border-gray-200 pt-6 mb-6\">\n                  <div className=\"flex justify-between items-center mb-4\">\n                    {couponLoading ? (\n                      <div className=\"space-y-2 w-full\">\n                        <Skeleton className=\"h-4 w-24\" />\n                        <Skeleton className=\"h-8 w-32\" />\n                      </div>\n                    ) : couponCalculation ? (\n                      <div className=\"space-y-2\">\n                        <div className=\"flex items-center space-x-2\">\n                          <span className=\"text-lg text-gray-500 line-through\">{formatPrice(couponCalculation.original_amount, currency)}</span>\n                          <span className=\"text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full font-medium\">-{Math.round(couponCalculation.savings_percentage)}%</span>\n                        </div>\n                        <span className=\"text-3xl font-bold text-green-600\">{formatPrice(couponCalculation.final_amount, currency)}</span>\n                      </div>\n                    ) : (\n                      <span className=\"text-3xl font-bold text-gray-800\">{formatPrice(19700, currency)}</span>\n                    )}\n                    <span className=\"text-gray-600\">{tr('per_month')}</span>\n                  </div>\n                  <p className=\"text-sm text-gray-600 mb-4\">{tr('recurring_billing')}</p>\n                </div>\n\n                <div className=\"space-y-4\">\n                  {[\n                    tr('feature_unlimited'),\n                    tr('feature_priority_support'),\n                    tr('feature_api'),\n                    tr('feature_reports'),\n                    tr('feature_backup'),\n                    tr('feature_ssl')\n                  ].map((feature, index) => (\n                    <div key={index} className=\"flex items-center\">\n                      <Check className=\"w-5 h-5 text-green-600 mr-3 flex-shrink-0\" />\n                      <span className=\"text-gray-700\">{feature}</span>\n                    </div>\n                  ))}\n                </div>\n\n                <div className=\"mt-8 p-4 bg-green-50 rounded-lg\">\n                  <div className=\"flex items-center\"><Shield className=\"w-5 h-5 text-green-600 mr-2\" /><span className=\"text-sm text-green-800 font-medium\">{tr('guarantee_title')}</span></div>\n                  <p className=\"text-sm text-green-700 mt-1\">{tr('guarantee_desc')}</p>\n                </div>\n\n                <div className=\"mt-6 space-y-4\">\n                  <div className=\"border-t border-gray-200 pt-4\">\n                    <h4 className=\"text-sm font-medium text-gray-700 mb-3\">{tr('security_title')}</h4>\n                    <div className=\"grid grid-cols-2 gap-3 mb-3\">\n                      <div className=\"flex items-center p-2 bg-green-50 rounded border border-green-200 text-xs\"><Shield className=\"w-4 h-4 text-green-600 mr-2\" /><span className=\"text-green-700 font-medium\">{tr('badge_ssl')}</span></div>\n                      <div className=\"flex items-center p-2 bg-green-50 rounded border border-green-200 text-xs\"><Lock className=\"w-4 h-4 text-green-600 mr-2\" /><span className=\"text-green-700 font-medium\">{tr('badge_pci')}</span></div>\n                    </div>\n                    <div className=\"grid grid-cols-2 gap-3 mb-3\">\n                      <div className=\"flex items-center p-2 bg-green-50 rounded border border-green-200 text-xs\"><Check className=\"w-4 h-4 text-green-600 mr-2\" /><span className=\"text-green-700 font-medium\">{tr('badge_secure_purchase')}</span></div>\n                      <div className=\"flex items-center p-2 bg-green-50 rounded border border-green-200 text-xs\"><Shield className=\"w-4 h-4 text-green-600 mr-2\" /><span className=\"text-green-700 font-medium\">{tr('badge_refund')}</span></div>\n                    </div>\n                    <div className=\"text-center\">\n                      <p className=\"text-xs text-gray-600 mb-2\">Bancos Parceiros:</p>\n                      <div className=\"flex justify-center space-x-2 text-xs text-gray-500\"><span className=\"px-2 py-1 bg-gray-100 rounded\">Bradesco</span><span className=\"px-2 py-1 bg-gray-100 rounded\">Itaú</span><span className=\"px-2 py-1 bg-gray-100 rounded\">Santander</span></div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            {/* Coluna direita (70%) - formulário dominante */}\n            <div className=\"md:col-span-2\">\n              <div className=\"bg-white rounded-2xl shadow-xl p-8\">\n                {/* Skeleton inicial durante montagem do cliente */}\n                {!clientReady ? (\n                  <div className=\"space-y-6\">\n                    <Skeleton className=\"h-6 w-48\" />\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <Skeleton className=\"h-12 w-full\" />\n                      <Skeleton className=\"h-12 w-full\" />\n                    </div>\n                    <Skeleton className=\"h-12 w-full\" />\n                    <Skeleton className=\"h-12 w-full\" />\n                    <Skeleton className=\"h-12 w-full\" />\n                    <Skeleton className=\"h-12 w-full\" />\n                    <Skeleton className=\"h-12 w-full\" />\n                  </div>\n                ) : (\n                 <>\n                  {/* Barra superior com passos e seletor compacto de país */}\n                  <div className=\"flex items-center justify-between mb-6\">\n                    <ol className=\"flex items-center text-sm text-gray-600\">\n                      <li className=\"flex items-center\"><span className=\"w-6 h-6 rounded-full bg-green-600 text-white flex items-center justify-center text-xs mr-2\">1</span>{tr('step_personal')}</li>\n                      <span className=\"mx-4\">›</span>\n                      <li className=\"flex items-center\"><span className=\"w-6 h-6 rounded-full bg-gray-200 text-gray-700 flex items-center justify-center text-xs mr-2\">2</span>{tr('step_payment')}</li>\n                      <span className=\"mx-4\">›</span>\n                      <li className=\"flex items-center\"><span className=\"w-6 h-6 rounded-full bg-gray-200 text-gray-700 flex items-center justify-center text-xs mr-2\">3</span>{tr('step_confirm')}</li>\n                    </ol>\n                    <div className=\"relative\">\n                      <button type=\"button\" onClick={() => setCountryMenuOpen(!countryMenuOpen)} className=\"text-xs text-gray-800 hover:text-gray-900 border border-gray-300 rounded-lg px-3 py-1.5 bg-white flex items-center\">\n                        <img src={countryMap[country].flagUrl} alt={countryMap[country].label} className=\"inline-block w-4 h-3 rounded-sm mr-2\" />{countryMap[country].label}\n                      </button>\n                      {countryMenuOpen && (\n                        <div className=\"absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 z-20\">\n                          {(['BR','US','EU','MX'] as CountryKey[]).map((c) => (\n                            <button key={c} type=\"button\" onClick={() => handleCountryChange(c)} className={`w-full text-left px-3 py-2 text-sm hover:bg-gray-50 flex items-center text-gray-800 ${country===c?'bg-gray-100 text-gray-900 font-medium':''}`}>\n                              <img src={countryMap[c].flagUrl} alt={countryMap[c].label} className=\"inline-block w-4 h-3 rounded-sm mr-2\" />{countryMap[c].label}\n                            </button>\n                          ))}\n                          <div className=\"px-3 py-2 text-[11px] text-gray-600 border-t border-gray-200\">{tr('billing_note')}</div>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"flex items-center mb-6\"><CreditCard className=\"w-6 h-6 text-gray-600 mr-2\" /><h3 className=\"text-xl font-bold text-gray-800\">{tr('payment_info')}</h3></div>\n\n                  {error && (<div className=\"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg flex items-center\"><AlertCircle className=\"w-5 h-5 text-red-600 mr-2\" /><span className=\"text-red-700\">{error}</span></div>)}\n\n                  <div className=\"space-y-6\">\n                  {/* Opções de pagamento */}\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-3\">{tr('choose_payment_method')}</label>\n                    <div className=\"grid grid-cols-2 gap-3\">\n                      <button type=\"button\" onClick={() => setPaymentMethod('credit_card')} className={`p-4 border-2 rounded-lg flex items-center justify-center transition-all ${paymentMethod === 'credit_card' ? 'border-green-500 bg-green-50 text-green-700' : 'border-gray-300 bg-white text-gray-700 hover:border-gray-400 hover:bg-gray-50'}`}>\n                        <CreditCard className=\"w-5 h-5 mr-2\" /><span className=\"font-medium\">{tr('card')}</span>\n                      </button>\n                      <button type=\"button\" onClick={() => setPaymentMethod('pix')} className={`p-4 border-2 rounded-lg flex items-center justify-center transition-all ${paymentMethod === 'pix' ? 'border-green-500 bg-green-50 text-green-700' : 'border-gray-300 bg-white text-gray-700 hover:border-gray-400 hover:bg-gray-50'}`}>\n                        <Smartphone className=\"w-5 h-5 mr-2\" /><span className=\"font-medium\">{tr('pix')}</span>\n                    </button>\n                  </div>\n                </div>\n\n                  {/* Nome completo */}\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{tr('full_name')}</label>\n                      <input type=\"text\" value={formData.fullName} onChange={(e) => handleInputChange('fullName', e.target.value)} className={`w-full px-4 py-4 border rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500 transition-all ${validations.fullName ? 'border-red-300' : 'border-gray-300'}`} placeholder={tr('full_name_placeholder')} />\n                    {validations.fullName && (<p className=\"mt-1 text-sm text-red-600\">{validations.fullName}</p>)}\n                  </div>\n\n                  {/* Email */}\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{tr('email')}</label>\n                      <input type=\"email\" value={formData.email} onChange={(e) => handleInputChange('email', e.target.value)} className={`w-full px-4 py-4 border rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500 transition-all ${validations.email ? 'border-red-300' : 'border-gray-300'}`} placeholder={tr('email_placeholder')} />\n                    {validations.email && (<p className=\"mt-1 text-sm text-red-600\">{validations.email}</p>)}\n                  </div>\n\n                  {/* Confirmar Email */}\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{tr('email_confirm')}</label>\n                      <input type=\"email\" value={formData.emailConfirm} onChange={(e) => handleInputChange('emailConfirm', e.target.value)} className={`w-full px-4 py-4 border rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500 transition-all ${validations.emailConfirm ? 'border-red-300' : 'border-gray-300'}`} placeholder={tr('email_confirm_placeholder')} />\n                    {validations.emailConfirm && (<p className=\"mt-1 text-sm text-red-600\">{validations.emailConfirm}</p>)}\n                  </div>\n\n                  {/* CPF (apenas Brasil) */}\n                  {country === 'BR' && (\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\">{tr('cpf')}</label>\n                      <input type=\"text\" value={formData.cpf} onChange={(e) => handleInputChange('cpf', e.target.value)} className={`w-full px-4 py-4 border rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500 transition-all ${validations.cpf ? 'border-red-300' : 'border-gray-300'}`} placeholder=\"000.000.000-00\" />\n                      {validations.cpf && (<p className=\"mt-1 text-sm text-red-600\">{validations.cpf}</p>)}\n                    </div>\n                  )}\n\n                  {/* Telefone com seletor de país inline */}\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">{tr('phone')}</label>\n                    <div className=\"relative\">\n                      <button type=\"button\" onClick={() => setPhoneMenuOpen(!phoneMenuOpen)} className=\"absolute left-2 top-1/2 -translate-y-1/2 text-xs text-gray-800 hover:text-gray-900 border border-gray-300 rounded-md px-2 py-1 bg-white flex items-center z-10\">\n                        <img src={countryMap[country].flagUrl} alt={countryMap[country].label} className=\"inline-block w-4 h-3 rounded-sm\" />\n                      </button>\n                      <input type=\"text\" value={formData.phone} onChange={(e) => handleInputChange('phone', e.target.value)} className={`w-full pl-12 pr-4 py-4 border rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500 transition-all ${validations.phone ? 'border-red-300' : 'border-gray-300'}`} placeholder={countryMap[country].phonePlaceholder} />\n                      {phoneMenuOpen && (\n                        <div className=\"absolute left-2 top-full mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 z-20\">\n                          {(['BR','US','EU','MX'] as CountryKey[]).map((c) => (\n                            <button key={c} type=\"button\" onClick={() => { handleCountryChange(c); setPhoneMenuOpen(false); }} className={`w-full text-left px-3 py-2 text-sm hover:bg-gray-50 flex items-center text-gray-800 ${country===c?'bg-gray-100 text-gray-900 font-medium':''}`}> \n                              <img src={countryMap[c].flagUrl} alt={countryMap[c].label} className=\"inline-block w-4 h-3 rounded-sm mr-2\" />{countryMap[c].label}\n                            </button>\n                          ))}\n                          <div className=\"px-3 py-2 text-[11px] text-gray-600 border-t border-gray-200\">{tr('billing_note')}</div>\n                        </div>\n                      )}\n                    </div>\n                    {validations.phone && (<p className=\"mt-1 text-sm text-red-600\">{validations.phone}</p>)}\n                  </div>\n\n                  {/* Cupom por link */}\n                  <div>\n                    <button type=\"button\" onClick={() => setShowCoupon(!showCoupon)} className=\"flex items-center text-green-600 hover:text-green-700 font-medium mb-2\">\n                      <Tag className=\"w-4 h-4 mr-2\" />{tr('have_coupon')}<ChevronDown className={`w-4 h-4 ml-2 transition-transform ${showCoupon ? 'rotate-180' : ''}`} />\n                    </button>\n                    {showCoupon && (\n                      <div className=\"space-y-3\">\n                        <div className=\"relative\">\n                          <input type=\"text\" value={formData.coupon} onChange={(e) => handleInputChange('coupon', e.target.value.toUpperCase())} className={`w-full px-4 py-4 border rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500 transition-all ${couponError ? 'border-red-300' : couponData ? 'border-green-300' : 'border-gray-300'}`} placeholder={tr('coupon_placeholder')} />\n                          {couponLoading && (<div className=\"absolute right-3 top-1/2 transform -translate-y-1/2\"><div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-green-600\"></div></div>)}\n                        </div>\n                        {couponLoading && (\n                          <div className=\"space-y-2\">\n                            <Skeleton className=\"h-4 w-40\" />\n                            <Skeleton className=\"h-4 w-56\" />\n                          </div>\n                        )}\n                        {couponError && (<div className=\"flex items-center text-red-600 text-sm\"><AlertCircle className=\"w-4 h-4 mr-2\" />{couponError}</div>)}\n                        {couponData && couponCalculation && (\n                          <div className=\"p-3 bg-green-50 border border-green-200 rounded-lg\">\n                            <div className=\"flex items-center text-green-700 text-sm font-medium mb-2\"><Check className=\"w-4 h-4 mr-2\" />Cupom \"{couponData.code}\" aplicado!</div>\n                            <div className=\"text-sm text-green-600\">\n                              <p>{couponData.description}</p>\n                              <div className=\"flex justify-between mt-2\"><span>{tr('discount')}</span><span className=\"font-medium\">{couponData.type === 'percentage' ? `${couponData.discount}%` : `R$ ${(couponData.discount / 100).toFixed(2)}`}</span></div>\n                              <div className=\"flex justify-between\"><span>{tr('original_value')}</span><span>{formatPrice(couponCalculation.original_amount, currency)}</span></div>\n                              <div className=\"flex justify-between font-medium text-green-700\"><span>{tr('final_value')}</span><span>{formatPrice(couponCalculation.final_amount, currency)}</span></div>\n                            </div>\n                          </div>\n                        )}\n                      </div>\n                    )}\n                  </div>\n\n                  {paymentMethod === 'credit_card' && (\n                    <>\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">Número do Cartão</label>\n                        <div className=\"relative\">\n                      <input type=\"text\" value={formData.cardNumber} onChange={(e) => handleInputChange('cardNumber', e.target.value)} className={`w-full px-4 py-4 border rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500 transition-all ${validations.cardNumber ? 'border-red-300' : 'border-gray-300'}`} placeholder={tr('card_number_placeholder')} maxLength={19} />\n                        </div>\n                        <CardIcons />\n                        {validations.cardNumber && (<p className=\"mt-1 text-sm text-red-600\">{validations.cardNumber}</p>)}\n                      </div>\n\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">Nome no Cartão</label>\n                      <input type=\"text\" value={formData.cardName} onChange={(e) => handleInputChange('cardName', e.target.value)} className={`w-full px-4 py-4 border rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500 transition-all ${validations.cardName ? 'border-red-300' : 'border-gray-300'}`} placeholder={tr('card_name_placeholder')} />\n                        {validations.cardName && (<p className=\"mt-1 text-sm text-red-600\">{validations.cardName}</p>)}\n                      </div>\n\n                      <div className=\"grid grid-cols-2 gap-4\">\n                        <div>\n                          <label className=\"block text-sm font-medium text-gray-700 mb-2\">Expiração</label>\n                      <input type=\"text\" value={formData.expiryDate} onChange={(e) => handleInputChange('expiryDate', e.target.value)} className={`w-full px-4 py-4 border rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500 transition-all ${validations.expiryDate ? 'border-red-300' : 'border-gray-300'}`} placeholder={tr('expiry_placeholder')} maxLength={5} />\n                          {validations.expiryDate && (<p className=\"mt-1 text-sm text-red-600\">{validations.expiryDate}</p>)}\n                        </div>\n                        <div>\n                          <label className=\"block text-sm font-medium text-gray-700 mb-2\">CVV</label>\n                      <input type=\"text\" value={formData.cvv} onChange={(e) => handleInputChange('cvv', e.target.value)} className={`w-full px-4 py-4 border rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500 transition-all ${validations.cvv ? 'border-red-300' : 'border-gray-300'}`} placeholder={tr('cvv_placeholder')} maxLength={4} />\n                          {validations.cvv && (<p className=\"mt-1 text-sm text-red-600\">{validations.cvv}</p>)}\n                        </div>\n                      </div>\n                    </>\n                  )}\n\n                  <button onClick={handleSubmit} disabled={loading} className=\"w-full bg-gradient-to-r from-green-600 to-emerald-600 text-white py-4 px-6 rounded-lg font-semibold hover:from-green-700 hover:to-emerald-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center\">\n                    {loading ? (\n                      <div className=\"flex flex-col items-center space-y-2\"><div className=\"flex items-center\"><div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2\"></div>{processingStep || 'Processando...'}</div>{loadingMessage && (<span className=\"text-sm opacity-80\">{loadingMessage}</span>)}\n                      </div>\n                    ) : (\n                      <>\n                        <Lock className=\"w-5 h-5 mr-2\" />{paymentMethod === 'credit_card' ? tr('cta_activate') : tr('cta_generate_pix')} – {formatPrice(displayAmount, currency)}{tr('per_month')}\n                      </>\n                    )}\n                  </button>\n\n                  <div className=\"text-center text-sm text-gray-600\">\n                    <div className=\"flex items-center justify-center mb-2\"><Shield className=\"w-4 h-4 text-green-600 mr-1\" /><span>{tr('secure_payment')}</span></div>\n                    <p>\n                      Ao continuar, você concorda com nossos\n                      {\" \"}\n                      <a\n                        href=\"https://policies.google.com/terms\"\n                        target=\"_blank\"\n                        rel=\"noopener noreferrer\"\n                        className=\"text-green-600 hover:underline\"\n                      >\n                        Termos de Serviço\n                      </a>\n                      {\" \"}e {\" \"}\n                      <a\n                        href=\"https://policies.google.com/privacy\"\n                        target=\"_blank\"\n                        rel=\"noopener noreferrer\"\n                        className=\"text-green-600 hover:underline\"\n                      >\n                        Política de Privacidade\n                      </a>\n                    </p>\n                  </div>\n                  </div>\n                 </>\n                )}\n              </div>\n            </div>\n          </div>\n\n          <div className=\"mt-12 border-t border-gray-200 pt-8\">\n            <div className=\"max-w-6xl mx-auto text-center\">\n              <div className=\"flex flex-col items-center space-y-4\">\n                <div className=\"flex items-center space-x-2 text-xs text-gray-600\"><span>Powered by</span><img src=\"https://assets.decocache.com/payme/ab015445-0855-45b7-9abb-0df413196ca2/pagarme-logo-main.svg\" alt=\"Pagar.me\" className=\"h-4 w-auto\" /></div>\n                <div className=\"flex items-center space-x-4 text-xs text-gray-500\">\n                  <a\n                    href=\"https://policies.google.com/privacy\"\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    className=\"hover:text-gray-700 transition-colors\"\n                  >\n                    Política de Privacidade\n                  </a>\n                  <span>|</span>\n                  <a\n                    href=\"https://policies.google.com/terms\"\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    className=\"hover:text-gray-700 transition-colors\"\n                  >\n                    Termos de Serviço\n                  </a>\n                </div>\n                <p className=\"text-xs text-gray-500\">© 2025 Umbrella Tecnologia. - Todos os direitos reservados.</p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Seletor sem modal removido, usando dropdown compacto no topo */}\n\n      {/* Sticky CTA no mobile */}\n      <div className=\"fixed bottom-0 inset-x-0 md:hidden bg-white/95 backdrop-blur border-t border-gray-200 p-3 z-50\">\n        <button onClick={handleSubmit} disabled={loading} className=\"w-full bg-gradient-to-r from-green-600 to-emerald-600 text-white py-3 px-6 rounded-lg font-semibold hover:from-green-700 hover:to-emerald-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center\">\n          {loading ? (\n            <div className=\"flex items-center\"><div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2\"></div>{processingStep || 'Processando...'}</div>\n          ) : (\n            <>\n              <Lock className=\"w-5 h-5 mr-2\" />{paymentMethod === 'credit_card' ? tr('cta_activate') : tr('cta_generate_pix')} – {formatPrice(displayAmount, currency)}{tr('per_month')}\n            </>\n          )}\n        </button>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/checkout/page.v1.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'userProfile?.fullName' and 'userProfile?.name'. Either include them or remove the dependency array.","line":239,"column":6,"nodeType":"ArrayExpression","endLine":239,"endColumn":61,"suggestions":[{"desc":"Update the dependencies array to be: [isAuthenticated, userProfile?.email, userProfile?.cpf, userProfile?.fullName, userProfile?.name]","fix":{"range":[9520,9575],"text":"[isAuthenticated, userProfile?.email, userProfile?.cpf, userProfile?.fullName, userProfile?.name]"}}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":279,"column":7,"nodeType":"JSXOpeningElement","endLine":279,"endColumn":162},{"ruleId":"react/no-unescaped-entities","severity":1,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":608,"column":144,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[35812,35819],"text":"Cupom &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[35812,35819],"text":"Cupom &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[35812,35819],"text":"Cupom &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[35812,35819],"text":"Cupom &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":1,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":608,"column":162,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[35836,35847],"text":"&quot; aplicado!"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[35836,35847],"text":"&ldquo; aplicado!"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[35836,35847],"text":"&#34; aplicado!"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[35836,35847],"text":"&rdquo; aplicado!"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":678,"column":107,"nodeType":"JSXOpeningElement","endLine":678,"endColumn":252}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport { CreditCard, Shield, Check, AlertCircle, Lock, Star, Smartphone, Copy, ChevronDown, Tag } from 'lucide-react';\nimport { useSofiaAuth } from '@/hooks/use-sofia-auth';\nimport { z } from 'zod';\nimport QRCode from 'qrcode';\n\n// Tipos\ninterface FormData {\n  email: string;\n  emailConfirm: string;\n  cardNumber: string;\n  expiryDate: string;\n  cvv: string;\n  cardName: string;\n  fullName: string;\n  cpf: string;\n  phone: string;\n  coupon: string;\n}\n\ninterface PixData {\n  qr_code: string;\n  qr_code_url: string;\n  expires_at: string;\n  pix_key?: string;\n  amount?: number;\n  order_id?: string;\n}\n\ninterface Validations { [key: string]: string }\n\ninterface CouponData {\n  code: string;\n  description: string;\n  discount: number;\n  type: 'percentage' | 'fixed';\n}\n\ninterface CouponCalculation {\n  original_amount: number;\n  discount_amount: number;\n  final_amount: number;\n  savings_percentage: number;\n}\n\n// Componente simples de Skeleton\nfunction Skeleton({ className = '' }: { className?: string }) {\n  return <div className={`animate-pulse bg-gray-200 rounded ${className}`} />;\n}\n\n// Renderização local do QR para evitar latência de imagens externas\nfunction QrCanvas({ code, className = '' }: { code: string; className?: string }) {\n  const canvasRef = useRef<HTMLCanvasElement | null>(null);\n  const [ready, setReady] = useState(false);\n\n  useEffect(() => {\n    if (!code || !canvasRef.current) return;\n    setReady(false);\n    QRCode.toCanvas(canvasRef.current, code, { width: 256, margin: 1 })\n      .then(() => setReady(true))\n      .catch(() => setReady(false));\n  }, [code]);\n\n  return (\n    <div className={`w-full h-full flex items-center justify-center ${className}`}>\n      {!ready && <Skeleton className=\"w-48 h-48\" />}\n      <canvas ref={canvasRef} className=\"block\" style={{ display: ready ? 'block' : 'none' }} />\n    </div>\n  );\n}\n\nexport default function CheckoutPageV1() {\n  const { userProfile, isAuthenticated } = useSofiaAuth();\n\n  const [formData, setFormData] = useState<FormData>({\n    email: '',\n    emailConfirm: '',\n    cardNumber: '',\n    expiryDate: '',\n    cvv: '',\n    cardName: '',\n    fullName: '',\n    cpf: '',\n    phone: '',\n    coupon: ''\n  });\n\n  const [paymentMethod, setPaymentMethod] = useState<'credit_card' | 'pix'>('credit_card');\n  const [pixData, setPixData] = useState<PixData | null>(null);\n  const [showCoupon, setShowCoupon] = useState(false);\n  const [clientReady, setClientReady] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [loadingMessage, setLoadingMessage] = useState('');\n  const [success, setSuccess] = useState(false);\n  const [error, setError] = useState('');\n  const [processingStep, setProcessingStep] = useState('');\n  const [validations, setValidations] = useState<Validations>({});\n  const [couponData, setCouponData] = useState<CouponData | null>(null);\n  const [couponCalculation, setCouponCalculation] = useState<CouponCalculation | null>(null);\n  const [couponLoading, setCouponLoading] = useState(false);\n  const [checkingPix, setCheckingPix] = useState(false);\n  const [couponError, setCouponError] = useState('');\n\n  // Helpers de formatação\n  const formatCardNumber = (value: string): string => {\n    const v = value.replace(/\\s+/g, '').replace(/[^0-9]/gi, '');\n    const matches = v.match(/\\d{4,16}/g);\n    const match = (matches && matches[0]) || '';\n    const parts: string[] = [];\n    for (let i = 0, len = match.length; i < len; i += 4) parts.push(match.substring(i, i + 4));\n    return parts.length ? parts.join(' ') : v;\n  };\n\n  const formatExpiryDate = (value: string): string => {\n    const v = value.replace(/\\s+/g, '').replace(/[^0-9]/gi, '');\n    if (v.length >= 2) return v.substring(0, 2) + '/' + v.substring(2, 4);\n    return v;\n  };\n\n  const formatCPF = (value: string): string => {\n    const v = value.replace(/\\D/g, '');\n    if (v.length <= 11) return v.replace(/(\\d{3})(\\d{3})(\\d{3})(\\d{2})/, '$1.$2.$3-$4');\n    return v.substring(0, 11).replace(/(\\d{3})(\\d{3})(\\d{3})(\\d{2})/, '$1.$2.$3-$4');\n  };\n\n  const formatPhone = (value: string): string => {\n    const v = value.replace(/\\D/g, '').substring(0, 11);\n    if (v.length <= 10) return v.replace(/(\\d{2})(\\d{4})(\\d{0,4})/, '($1) $2-$3');\n    return v.replace(/(\\d{2})(\\d{5})(\\d{0,4})/, '($1) $2-$3');\n  };\n\n  const validateCPF = (cpf: string): boolean => {\n    const cleanCPF = cpf.replace(/\\D/g, '');\n    if (cleanCPF.length !== 11) return false;\n    if (/^(\\d)\\1{10}$/.test(cleanCPF)) return false;\n    let sum = 0;\n    for (let i = 0; i < 9; i++) sum += parseInt(cleanCPF.charAt(i)) * (10 - i);\n    let remainder = (sum * 10) % 11; if (remainder === 10 || remainder === 11) remainder = 0;\n    if (remainder !== parseInt(cleanCPF.charAt(9))) return false;\n    sum = 0;\n    for (let i = 0; i < 10; i++) sum += parseInt(cleanCPF.charAt(i)) * (11 - i);\n    remainder = (sum * 10) % 11; if (remainder === 10 || remainder === 11) remainder = 0;\n    return remainder === parseInt(cleanCPF.charAt(10));\n  };\n\n  const validateCardNumber = (cardNumber: string): boolean => {\n    const cleanNumber = cardNumber.replace(/\\s/g, '');\n    if (cleanNumber.length < 13 || cleanNumber.length > 19) return false;\n    let sum = 0; let isEven = false;\n    for (let i = cleanNumber.length - 1; i >= 0; i--) {\n      let digit = parseInt(cleanNumber.charAt(i));\n      if (isEven) { digit *= 2; if (digit > 9) digit -= 9; }\n      sum += digit; isEven = !isEven;\n    }\n    return sum % 10 === 0;\n  };\n\n  const getSchema = () => {\n    const commonShape = {\n      email: z.string().email({ message: 'Email inválido' }),\n      emailConfirm: z.string().email({ message: 'Confirmação inválida' }),\n      fullName: z.string().min(5, { message: 'Nome completo é obrigatório' }),\n      cpf: z.string().refine((v) => validateCPF(v), { message: 'CPF inválido' }),\n      phone: z.string().refine((v) => v.replace(/\\D/g, '').length >= 10 && v.replace(/\\D/g, '').length <= 11, { message: 'Telefone inválido' }),\n      coupon: z.string().optional().default('')\n    } as const;\n\n    const shape = paymentMethod === 'credit_card'\n      ? {\n          ...commonShape,\n          cardNumber: z.string().refine((v) => validateCardNumber(v), { message: 'Número do cartão inválido' }),\n          expiryDate: z.string().refine((v) => {\n            if (v.length < 5) return false;\n            const [month, year] = v.split('/');\n            const currentDate = new Date();\n            const currentYear = currentDate.getFullYear() % 100;\n            const currentMonth = currentDate.getMonth() + 1;\n            const expMonth = parseInt(month); const expYear = parseInt(year);\n            if (expMonth < 1 || expMonth > 12) return false;\n            if (expYear < currentYear || (expYear === currentYear && expMonth < currentMonth)) return false;\n            return true;\n          }, { message: 'Data de expiração inválida' }),\n          cvv: z.string().min(3, { message: 'CVV deve ter pelo menos 3 dígitos' }),\n          cardName: z.string().min(3, { message: 'Nome do titular é obrigatório' }).regex(/^[a-zA-ZÀ-ÿ\\s]+$/, { message: 'Nome deve conter apenas letras' })\n        }\n      : {\n          ...commonShape,\n          cardNumber: z.string().optional().default(''),\n          expiryDate: z.string().optional().default(''),\n          cvv: z.string().optional().default(''),\n          cardName: z.string().optional().default('')\n        };\n\n    return z.object(shape).superRefine((data, ctx) => {\n      if (data.email.toLowerCase() !== data.emailConfirm.toLowerCase()) {\n        ctx.addIssue({ code: 'custom', message: 'Emails não conferem', path: ['emailConfirm'] });\n      }\n    });\n  };\n\n  const validateForm = () => {\n    const parsed = getSchema().safeParse(formData);\n    const newValidations: Record<string, string> = {};\n    if (!parsed.success) for (const issue of parsed.error.issues) { const key = (issue.path[0] as string) || 'form'; newValidations[key] = issue.message; }\n    setValidations(newValidations);\n    return parsed.success;\n  };\n\n  const handleInputChange = (field: keyof FormData, value: string): void => {\n    let formattedValue = value;\n    if (field === 'cardNumber') formattedValue = formatCardNumber(value);\n    else if (field === 'expiryDate') formattedValue = formatExpiryDate(value);\n    else if (field === 'cpf') formattedValue = formatCPF(value);\n    else if (field === 'phone') formattedValue = formatPhone(value);\n    else if (field === 'cvv') formattedValue = value.replace(/\\D/g, '').substring(0, 4);\n    else if (field === 'cardName') formattedValue = value.replace(/[^a-zA-ZÀ-ÿ\\s]/g, '').toUpperCase();\n    else if (field === 'email') formattedValue = value.toLowerCase();\n    else if (field === 'emailConfirm') formattedValue = value.toLowerCase();\n    else if (field === 'coupon') formattedValue = value.toUpperCase().replace(/\\s/g, '');\n    setFormData(prev => ({ ...prev, [field]: formattedValue }));\n    if (validations[field]) setValidations(prev => ({ ...prev, [field]: '' }));\n  };\n\n  // Preencher com dados do usuário logado\n  useEffect(() => {\n    if (!isAuthenticated) return;\n    setFormData(prev => {\n      if (prev.email || prev.cpf || prev.fullName) return prev;\n      return {\n        ...prev,\n        email: userProfile?.email || prev.email,\n        emailConfirm: userProfile?.email || prev.emailConfirm,\n        cpf: userProfile?.cpf || prev.cpf,\n        fullName: userProfile?.fullName || userProfile?.name || prev.fullName,\n      };\n    });\n  }, [isAuthenticated, userProfile?.email, userProfile?.cpf]);\n\n  // Controlar skeleton de montagem do cliente\n  useEffect(() => {\n    const t = setTimeout(() => setClientReady(true), 100);\n    return () => clearTimeout(t);\n  }, []);\n\n  // Validar cupom com debounce\n  const validateCoupon = async (couponCode: string) => {\n    if (!couponCode.trim()) { setCouponData(null); setCouponCalculation(null); setCouponError(''); return; }\n    setCouponLoading(true); setCouponError('');\n    try {\n      const response = await fetch('/api/validate-coupon', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ coupon: couponCode, amount: 19700 }) });\n      const result = await response.json();\n      if (result.success) { setCouponData(result.coupon); setCouponCalculation(result.calculation); setCouponError(''); }\n      else { setCouponData(null); setCouponCalculation(null); setCouponError(result.error); }\n    } catch { setCouponError('Erro ao validar cupom'); setCouponData(null); setCouponCalculation(null); }\n    finally { setCouponLoading(false); }\n  };\n\n  useEffect(() => { const timer = setTimeout(() => { if (formData.coupon) validateCoupon(formData.coupon); }, 500); return () => clearTimeout(timer); }, [formData.coupon]);\n\n  // PIX status polling\n  useEffect(() => {\n    if (!pixData?.order_id) return;\n    let stopped = false;\n    const checkStatus = async () => {\n      try {\n        const res = await fetch(`/api/create-pix?order_id=${pixData.order_id}`, { method: 'PUT' });\n        const json = await res.json();\n        if (json.success && json.status === 'paid') { if (!stopped) { stopped = true; window.location.href = `/checkout/success?order_id=${pixData.order_id}&mode=pix`; } }\n      } catch {}\n    };\n    checkStatus(); const id = setInterval(checkStatus, 10000);\n    return () => { stopped = true; clearInterval(id); };\n  }, [pixData?.order_id]);\n\n  const CardIcons = () => (\n    <div className=\"mt-2 flex justify-end\">\n      <img src=\"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ1dzeybZgprwWRyK-12bqIACT_B4BQG6dNPQ&s\" alt=\"Bandeiras de Cartão\" className=\"h-5 w-auto\" />\n    </div>\n  );\n\n  const copyPixCode = () => { if (pixData) navigator.clipboard.writeText(pixData.qr_code_url); };\n\n  const handleSubmit = async () => {\n    if (!validateForm()) return;\n    setLoading(true); setError(''); setProcessingStep('Validando dados...');\n    try {\n      const finalAmount = couponCalculation ? couponCalculation.final_amount : 19700;\n      const baseData = {\n        customer: {\n          email: formData.email,\n          document_number: formData.cpf.replace(/\\D/g, ''),\n          name: paymentMethod === 'credit_card' ? formData.cardName : (formData.fullName || 'Cliente PIX'),\n          type: 'individual',\n          phone: formData.phone,\n          code: formData.email\n        },\n        amount: finalAmount,\n        ...(couponData && { coupon: couponData.code })\n      };\n      if (paymentMethod === 'credit_card') {\n        setProcessingStep('Processando pagamento...'); setLoadingMessage('Validando cartão de crédito');\n        const subscriptionData = { ...baseData, plan: { amount: finalAmount, interval: 'month', interval_count: 1, name: 'Plano SaaS Mensal' }, card: { number: formData.cardNumber.replace(/\\s/g, ''), holder_name: formData.cardName, exp_month: formData.expiryDate.split('/')[0], exp_year: '20' + formData.expiryDate.split('/')[1], cvv: formData.cvv }, payment_method: 'credit_card' };\n        setLoadingMessage('Criando assinatura...');\n        const response = await fetch('/api/create-subscription', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(subscriptionData) });\n        const result = await response.json();\n        if (result.success) {\n          const status = result.status || result.order?.charges?.[0]?.status;\n          if (status === 'paid') { setProcessingStep('Pagamento aprovado!'); setLoadingMessage('Redirecionando...'); window.location.href = `/checkout/success?order_id=${result.order_id}&mode=card`; }\n          else { const msg = status === 'not_authorized' ? 'Pagamento não autorizado' : status === 'failed' ? 'Pagamento falhou' : 'Pagamento pendente'; setError(`${msg}. Seu acesso ao dashboard será liberado somente após aprovação.`); setProcessingStep(''); setLoadingMessage(''); }\n        } else { throw new Error(result.error || 'Erro ao processar pagamento'); }\n      } else {\n        setProcessingStep('Gerando PIX...'); setLoadingMessage('Criando código de pagamento');\n        const pixDataPayload = { ...baseData, payment_method: 'pix', pix_expiration_date: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString() };\n        const response = await fetch('/api/create-pix', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(pixDataPayload) });\n        const result = await response.json();\n        if (result.success && result.qr_code_url) {\n          setProcessingStep('PIX gerado com sucesso!');\n          setLoadingMessage('');\n          setTimeout(() => {\n            setPixData({\n              qr_code: result.qr_code_url,\n              qr_code_url: result.qr_code,\n              expires_at: result.expires_at,\n              pix_key: result.pix_key,\n              amount: result.amount,\n              order_id: result.order_id\n            });\n          }, 1000);\n        }\n        else { throw new Error(result.error || 'Erro ao gerar PIX'); }\n      }\n    } catch { setError('Erro ao processar pagamento. Tente novamente.'); setProcessingStep(''); setLoadingMessage(''); }\n    finally { setLoading(false); }\n  };\n\n  if (success && paymentMethod === 'credit_card') {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 flex items-center justify-center p-4\">\n        <div className=\"max-w-md w-full bg-white rounded-2xl shadow-xl p-8 text-center\">\n          <div className=\"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6 animate-pulse\">\n            <Check className=\"w-10 h-10 text-green-600\" />\n          </div>\n          <h2 className=\"text-2xl font-bold text-gray-800 mb-4\">🎉 Assinatura Ativada!</h2>\n          <p className=\"text-gray-600 mb-6\">Parabéns! Sua assinatura foi processada com sucesso. Você receberá um email de confirmação em breve.</p>\n          <div className=\"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-4\">\n            <div className=\"text-sm text-gray-600 space-y-2\">\n              <div className=\"flex justify-between\"><span>Plano:</span><span className=\"font-medium\">Professional</span></div>\n              <div className=\"flex justify-between\"><span>Valor:</span><span className=\"font-medium\">{couponCalculation ? `R$ ${(couponCalculation.final_amount / 100).toFixed(2)}/mês` : 'R$ 197,00/mês'}</span></div>\n              {couponData && (<div className=\"flex justify-between text-green-600\"><span>Cupom aplicado:</span><span className=\"font-medium\">{couponData.code}</span></div>)}\n              <div className=\"flex justify-between\"><span>Próxima cobrança:</span><span className=\"font-medium\">{new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toLocaleDateString('pt-BR')}</span></div>\n            </div>\n          </div>\n          <div className=\"bg-green-50 rounded-lg p-4 mb-6 border border-green-200\">\n            <div className=\"flex items-center mb-2\"><div className=\"w-5 h-5 bg-green-500 rounded-full flex items-center justify-center mr-2\"><Check className=\"w-3 h-3 text-white\" /></div><p className=\"text-sm font-medium text-green-800\">Investimento Inteligente!</p></div>\n            <p className=\"text-sm text-green-700\">Não se preocupe com o valor - ele se paga em poucas operações bem-sucedidas! Você agora tem acesso às melhores estratégias para multiplicar seus ganhos.</p>\n          </div>\n          <div className=\"space-y-3\">\n            <button onClick={() => { setLoadingMessage('Redirecionando para o dashboard...'); setTimeout(() => { window.location.href = '/dashboard'; }, 1500); }} className=\"w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-3 px-6 rounded-lg font-semibold hover:from-blue-700 hover:to-indigo-700 transition-all\">🚀 Acessar Dashboard</button>\n            <button onClick={() => window.location.href = '/profile' } className=\"w-full bg-gray-100 text-gray-700 py-2 px-6 rounded-lg font-medium hover:bg-gray-200 transition-all text-sm\">Ver detalhes da assinatura</button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (pixData) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 flex items-center justify-center p-4\">\n        <div className=\"max-w-md w-full bg-white rounded-2xl shadow-xl p-8 text-center\">\n          <div className=\"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6\"><Smartphone className=\"w-8 h-8 text-green-600\" /></div>\n          <h2 className=\"text-2xl font-bold text-gray-800 mb-4\">Pague com PIX</h2>\n          <p className=\"text-gray-600 mb-6\">Escaneie o QR Code com seu banco ou copie o código PIX</p>\n          <div className=\"bg-gray-100 p-6 rounded-lg mb-6\">\n            <div className=\"w-48 h-48 mx-auto bg-white rounded-lg flex items-center justify-center\">\n              {pixData.qr_code_url ? (\n                <QrCanvas code={pixData.qr_code_url} />\n              ) : (\n                <Skeleton className=\"w-40 h-40\" />\n              )}\n            </div>\n          </div>\n          <div className=\"bg-gray-50 rounded-lg p-4 mb-6 text-left\">\n            <p className=\"text-sm text-gray-600 mb-2\">Código PIX:</p>\n            <div className=\"flex items-center justify-between bg-white p-3 rounded border\"><span className=\"text-sm font-mono text-gray-700 truncate\">{pixData.qr_code_url.substring(0, 40)}...</span><button onClick={copyPixCode} className=\"ml-2 p-1 text-green-600 hover:bg-green-50 rounded\"><Copy className=\"w-4 h-4\" /></button></div>\n          </div>\n          <div className=\"text-center text-sm text-gray-600 mb-6\"><p className=\"font-semibold text-gray-800 text-lg\">R$ 197,00</p><p>Válido até: {new Date(pixData.expires_at).toLocaleString('pt-BR')}</p></div>\n          <div className=\"grid grid-cols-2 gap-3 mb-6\">\n            <button\n              onClick={async () => {\n                if (!pixData?.order_id || checkingPix) return;\n                setCheckingPix(true);\n                const controller = new AbortController();\n                const timeoutId = setTimeout(() => controller.abort(), 7000);\n                try {\n                  const res = await fetch(`/api/create-pix?order_id=${pixData.order_id}`, { method: 'PUT', signal: controller.signal });\n                  const json = await res.json();\n                  if (json.success && json.status === 'paid') {\n                    window.location.href = `/checkout/success?order_id=${pixData.order_id}&mode=pix`;\n                  }\n                } catch {}\n                finally {\n                  clearTimeout(timeoutId);\n                  setCheckingPix(false);\n                }\n              }}\n              disabled={checkingPix}\n              className={`w-full ${checkingPix ? 'bg-green-500' : 'bg-green-600'} text-white py-3 px-6 rounded-lg font-semibold hover:bg-green-700 transition-all`}\n            >\n              {checkingPix ? 'Verificando…' : 'Já paguei, verificar'}\n            </button>\n            <button onClick={() => { setPixData(null); setPaymentMethod('credit_card'); }} className=\"w-full bg-gray-100 text-gray-700 py-3 px-6 rounded-lg font-semibold hover:bg-gray-200 transition-all\">Voltar para cartão</button>\n          </div>\n          <button onClick={() => { setPixData(null); setPaymentMethod('credit_card'); }} className=\"w-full bg-gray-100 text-gray-700 py-3 px-6 rounded-lg font-semibold hover:bg-gray-200 transition-all\">Voltar para outras opções</button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100\">\n      <div className=\"container mx-auto px-4 py-8\">\n        <div className=\"max-w-6xl mx-auto\">\n          <div className=\"text-center mb-8\">\n            <h1 className=\"text-3xl font-bold text-gray-800 mb-2\">Assine Agora</h1>\n            <p className=\"text-gray-600\">Comece sua jornada com nosso SaaS</p>\n          </div>\n\n          <div className=\"grid md:grid-cols-3 gap-8\">\n            {/* Coluna esquerda (30%) - sticky */}\n            <div className=\"md:col-span-1\">\n              <div className=\"bg-white rounded-2xl shadow-xl p-8 md:sticky md:top-8\">\n                <div className=\"flex items-center mb-6\">\n                  <div className=\"w-12 h-12 bg-gradient-to-r from-green-600 to-emerald-600 rounded-xl flex items-center justify-center\">\n                    <Star className=\"w-6 h-6 text-white\" />\n                  </div>\n                  <div className=\"ml-4\">\n                    <h3 className=\"text-xl font-bold text-gray-800\">Plano Professional</h3>\n                    <p className=\"text-gray-600\">Acesso completo à plataforma</p>\n                  </div>\n                </div>\n\n                <div className=\"border-t border-gray-200 pt-6 mb-6\">\n                  <div className=\"flex justify-between items-center mb-4\">\n                    {couponLoading ? (\n                      <div className=\"space-y-2 w-full\">\n                        <Skeleton className=\"h-4 w-24\" />\n                        <Skeleton className=\"h-8 w-32\" />\n                      </div>\n                    ) : couponCalculation ? (\n                      <div className=\"space-y-2\">\n                        <div className=\"flex items-center space-x-2\">\n                          <span className=\"text-lg text-gray-500 line-through\">R$ {(couponCalculation.original_amount / 100).toFixed(2)}</span>\n                          <span className=\"text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full font-medium\">-{Math.round(couponCalculation.savings_percentage)}%</span>\n                        </div>\n                        <span className=\"text-3xl font-bold text-green-600\">R$ {(couponCalculation.final_amount / 100).toFixed(2)}</span>\n                      </div>\n                    ) : (\n                      <span className=\"text-3xl font-bold text-gray-800\">R$ 197</span>\n                    )}\n                    <span className=\"text-gray-600\">/mês</span>\n                  </div>\n                  <p className=\"text-sm text-gray-600 mb-4\">Cobrança recorrente mensal</p>\n                </div>\n\n                <div className=\"space-y-4\">\n                  {[\n                    'Acesso ilimitado a todas as funcionalidades',\n                    'Suporte prioritário 24/7',\n                    'API completa para integrações',\n                    'Relatórios avançados e analytics',\n                    'Backup automático diário',\n                    'SSL gratuito e segurança avançada'\n                  ].map((feature, index) => (\n                    <div key={index} className=\"flex items-center\">\n                      <Check className=\"w-5 h-5 text-green-600 mr-3 flex-shrink-0\" />\n                      <span className=\"text-gray-700\">{feature}</span>\n                    </div>\n                  ))}\n                </div>\n\n                <div className=\"mt-8 p-4 bg-green-50 rounded-lg\">\n                  <div className=\"flex items-center\"><Shield className=\"w-5 h-5 text-green-600 mr-2\" /><span className=\"text-sm text-green-800 font-medium\">Garantia de 30 dias</span></div>\n                  <p className=\"text-sm text-green-700 mt-1\">Cancele a qualquer momento nos primeiros 30 dias</p>\n                </div>\n\n                <div className=\"mt-6 space-y-4\">\n                  <div className=\"border-t border-gray-200 pt-4\">\n                    <h4 className=\"text-sm font-medium text-gray-700 mb-3\">Segurança & Confiança</h4>\n                    <div className=\"grid grid-cols-2 gap-3 mb-3\">\n                      <div className=\"flex items-center p-2 bg-green-50 rounded border border-green-200 text-xs\"><Shield className=\"w-4 h-4 text-green-600 mr-2\" /><span className=\"text-green-700 font-medium\">SSL Seguro</span></div>\n                      <div className=\"flex items-center p-2 bg-green-50 rounded border border-green-200 text-xs\"><Lock className=\"w-4 h-4 text-green-600 mr-2\" /><span className=\"text-green-700 font-medium\">PCI Compliant</span></div>\n                    </div>\n                    <div className=\"grid grid-cols-2 gap-3 mb-3\">\n                      <div className=\"flex items-center p-2 bg-green-50 rounded border border-green-200 text-xs\"><Check className=\"w-4 h-4 text-green-600 mr-2\" /><span className=\"text-green-700 font-medium\">Compra Segura</span></div>\n                      <div className=\"flex items-center p-2 bg-green-50 rounded border border-green-200 text-xs\"><Shield className=\"w-4 h-4 text-green-600 mr-2\" /><span className=\"text-green-700 font-medium\">Reembolso 100%</span></div>\n                    </div>\n                    <div className=\"text-center\">\n                      <p className=\"text-xs text-gray-600 mb-2\">Bancos Parceiros:</p>\n                      <div className=\"flex justify-center space-x-2 text-xs text-gray-500\"><span className=\"px-2 py-1 bg-gray-100 rounded\">Bradesco</span><span className=\"px-2 py-1 bg-gray-100 rounded\">Itaú</span><span className=\"px-2 py-1 bg-gray-100 rounded\">Santander</span></div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            {/* Coluna direita (70%) - formulário dominante */}\n            <div className=\"md:col-span-2\">\n              <div className=\"bg-white rounded-2xl shadow-xl p-8\">\n                {/* Skeleton inicial durante montagem do cliente */}\n                {!clientReady ? (\n                  <div className=\"space-y-6\">\n                    <Skeleton className=\"h-6 w-48\" />\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <Skeleton className=\"h-12 w-full\" />\n                      <Skeleton className=\"h-12 w-full\" />\n                    </div>\n                    <Skeleton className=\"h-12 w-full\" />\n                    <Skeleton className=\"h-12 w-full\" />\n                    <Skeleton className=\"h-12 w-full\" />\n                    <Skeleton className=\"h-12 w-full\" />\n                    <Skeleton className=\"h-12 w-full\" />\n                  </div>\n                ) : (\n                 <>\n                  {/* Steps discretos */}\n                  <ol className=\"flex items-center text-sm text-gray-600 mb-6\">\n                    <li className=\"flex items-center\"><span className=\"w-6 h-6 rounded-full bg-green-600 text-white flex items-center justify-center text-xs mr-2\">1</span>Dados pessoais</li>\n                    <span className=\"mx-4\">›</span>\n                    <li className=\"flex items-center\"><span className=\"w-6 h-6 rounded-full bg-gray-200 text-gray-700 flex items-center justify-center text-xs mr-2\">2</span>Pagamento</li>\n                    <span className=\"mx-4\">›</span>\n                    <li className=\"flex items-center\"><span className=\"w-6 h-6 rounded-full bg-gray-200 text-gray-700 flex items-center justify-center text-xs mr-2\">3</span>Confirmar</li>\n                  </ol>\n\n                  <div className=\"flex items-center mb-6\"><CreditCard className=\"w-6 h-6 text-gray-600 mr-2\" /><h3 className=\"text-xl font-bold text-gray-800\">Informações de Pagamento</h3></div>\n\n                  {error && (<div className=\"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg flex items-center\"><AlertCircle className=\"w-5 h-5 text-red-600 mr-2\" /><span className=\"text-red-700\">{error}</span></div>)}\n\n                  <div className=\"space-y-6\">\n                  {/* Opções de pagamento */}\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-3\">Escolha a forma de pagamento</label>\n                    <div className=\"grid grid-cols-2 gap-3\">\n                      <button type=\"button\" onClick={() => setPaymentMethod('credit_card')} className={`p-4 border-2 rounded-lg flex items-center justify-center transition-all ${paymentMethod === 'credit_card' ? 'border-green-500 bg-green-50 text-green-700' : 'border-gray-300 bg-white text-gray-700 hover:border-gray-400 hover:bg-gray-50'}`}>\n                        <CreditCard className=\"w-5 h-5 mr-2\" /><span className=\"font-medium\">Cartão</span>\n                      </button>\n                      <button type=\"button\" onClick={() => setPaymentMethod('pix')} className={`p-4 border-2 rounded-lg flex items-center justify-center transition-all ${paymentMethod === 'pix' ? 'border-green-500 bg-green-50 text-green-700' : 'border-gray-300 bg-white text-gray-700 hover:border-gray-400 hover:bg-gray-50'}`}>\n                        <Smartphone className=\"w-5 h-5 mr-2\" /><span className=\"font-medium\">PIX</span>\n                      </button>\n                    </div>\n                  </div>\n\n                  {/* Nome completo */}\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">Nome completo</label>\n                    <input type=\"text\" value={formData.fullName} onChange={(e) => handleInputChange('fullName', e.target.value)} className={`w-full px-4 py-4 border rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500 transition-all ${validations.fullName ? 'border-red-300' : 'border-gray-300'}`} placeholder=\"Seu nome completo\" />\n                    {validations.fullName && (<p className=\"mt-1 text-sm text-red-600\">{validations.fullName}</p>)}\n                  </div>\n\n                  {/* Email */}\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">Email</label>\n                    <input type=\"email\" value={formData.email} onChange={(e) => handleInputChange('email', e.target.value)} className={`w-full px-4 py-4 border rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500 transition-all ${validations.email ? 'border-red-300' : 'border-gray-300'}`} placeholder=\"seu@email.com\" />\n                    {validations.email && (<p className=\"mt-1 text-sm text-red-600\">{validations.email}</p>)}\n                  </div>\n\n                  {/* Confirmar Email */}\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">Confirmar Email</label>\n                    <input type=\"email\" value={formData.emailConfirm} onChange={(e) => handleInputChange('emailConfirm', e.target.value)} className={`w-full px-4 py-4 border rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500 transition-all ${validations.emailConfirm ? 'border-red-300' : 'border-gray-300'}`} placeholder=\"repita seu@email.com\" />\n                  </div>\n\n                  {/* CPF */}\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">CPF</label>\n                    <input type=\"text\" value={formData.cpf} onChange={(e) => handleInputChange('cpf', e.target.value)} className={`w-full px-4 py-4 border rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500 transition-all ${validations.cpf ? 'border-red-300' : 'border-gray-300'}`} placeholder=\"000.000.000-00\" />\n                    {validations.cpf && (<p className=\"mt-1 text-sm text-red-600\">{validations.cpf}</p>)}\n                  </div>\n\n                  {/* Telefone */}\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">Telefone</label>\n                    <input type=\"text\" value={formData.phone} onChange={(e) => handleInputChange('phone', e.target.value)} className={`w-full px-4 py-4 border rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500 transition-all ${validations.phone ? 'border-red-300' : 'border-gray-300'}`} placeholder=\"(11) 99999-9999\" />\n                    {validations.phone && (<p className=\"mt-1 text-sm text-red-600\">{validations.phone}</p>)}\n                  </div>\n\n                  {/* Cupom por link */}\n                  <div>\n                    <button type=\"button\" onClick={() => setShowCoupon(!showCoupon)} className=\"flex items-center text-green-600 hover:text-green-700 font-medium mb-2\">\n                      <Tag className=\"w-4 h-4 mr-2\" />Tenho um cupom de desconto<ChevronDown className={`w-4 h-4 ml-2 transition-transform ${showCoupon ? 'rotate-180' : ''}`} />\n                    </button>\n                    {showCoupon && (\n                      <div className=\"space-y-3\">\n                        <div className=\"relative\">\n                          <input type=\"text\" value={formData.coupon} onChange={(e) => handleInputChange('coupon', e.target.value.toUpperCase())} className={`w-full px-4 py-4 border rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500 transition-all ${couponError ? 'border-red-300' : couponData ? 'border-green-300' : 'border-gray-300'}`} placeholder=\"Digite seu código do cupom\" />\n                          {couponLoading && (<div className=\"absolute right-3 top-1/2 transform -translate-y-1/2\"><div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-green-600\"></div></div>)}\n                        </div>\n                        {couponLoading && (\n                          <div className=\"space-y-2\">\n                            <Skeleton className=\"h-4 w-40\" />\n                            <Skeleton className=\"h-4 w-56\" />\n                          </div>\n                        )}\n                        {couponError && (<div className=\"flex items-center text-red-600 text-sm\"><AlertCircle className=\"w-4 h-4 mr-2\" />{couponError}</div>)}\n                        {couponData && couponCalculation && (\n                          <div className=\"p-3 bg-green-50 border border-green-200 rounded-lg\">\n                            <div className=\"flex items-center text-green-700 text-sm font-medium mb-2\"><Check className=\"w-4 h-4 mr-2\" />Cupom \"{couponData.code}\" aplicado!</div>\n                            <div className=\"text-sm text-green-600\">\n                              <p>{couponData.description}</p>\n                              <div className=\"flex justify-between mt-2\"><span>Desconto:</span><span className=\"font-medium\">{couponData.type === 'percentage' ? `${couponData.discount}%` : `R$ ${(couponData.discount / 100).toFixed(2)}`}</span></div>\n                              <div className=\"flex justify-between\"><span>Valor original:</span><span>R$ {(couponCalculation.original_amount / 100).toFixed(2)}</span></div>\n                              <div className=\"flex justify-between font-medium text-green-700\"><span>Valor final:</span><span>R$ {(couponCalculation.final_amount / 100).toFixed(2)}</span></div>\n                            </div>\n                          </div>\n                        )}\n                      </div>\n                    )}\n                  </div>\n\n                  {paymentMethod === 'credit_card' && (\n                    <>\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">Número do Cartão</label>\n                        <div className=\"relative\">\n                          <input type=\"text\" value={formData.cardNumber} onChange={(e) => handleInputChange('cardNumber', e.target.value)} className={`w-full px-4 py-4 border rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500 transition-all ${validations.cardNumber ? 'border-red-300' : 'border-gray-300'}`} placeholder=\"1234 5678 9012 3456\" maxLength={19} />\n                        </div>\n                        <CardIcons />\n                        {validations.cardNumber && (<p className=\"mt-1 text-sm text-red-600\">{validations.cardNumber}</p>)}\n                      </div>\n\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">Nome no Cartão</label>\n                        <input type=\"text\" value={formData.cardName} onChange={(e) => handleInputChange('cardName', e.target.value)} className={`w-full px-4 py-4 border rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500 transition-all ${validations.cardName ? 'border-red-300' : 'border-gray-300'}`} placeholder=\"Nome como aparece no cartão\" />\n                        {validations.cardName && (<p className=\"mt-1 text-sm text-red-600\">{validations.cardName}</p>)}\n                      </div>\n\n                      <div className=\"grid grid-cols-2 gap-4\">\n                        <div>\n                          <label className=\"block text-sm font-medium text-gray-700 mb-2\">Expiração</label>\n                          <input type=\"text\" value={formData.expiryDate} onChange={(e) => handleInputChange('expiryDate', e.target.value)} className={`w-full px-4 py-4 border rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500 transition-all ${validations.expiryDate ? 'border-red-300' : 'border-gray-300'}`} placeholder=\"MM/AA\" maxLength={5} />\n                          {validations.expiryDate && (<p className=\"mt-1 text-sm text-red-600\">{validations.expiryDate}</p>)}\n                        </div>\n                        <div>\n                          <label className=\"block text-sm font-medium text-gray-700 mb-2\">CVV</label>\n                          <input type=\"text\" value={formData.cvv} onChange={(e) => handleInputChange('cvv', e.target.value)} className={`w-full px-4 py-4 border rounded-lg bg-white text-gray-900 focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500 transition-all ${validations.cvv ? 'border-red-300' : 'border-gray-300'}`} placeholder=\"123\" maxLength={4} />\n                          {validations.cvv && (<p className=\"mt-1 text-sm text-red-600\">{validations.cvv}</p>)}\n                        </div>\n                      </div>\n                    </>\n                  )}\n\n                  <button onClick={handleSubmit} disabled={loading} className=\"w-full bg-gradient-to-r from-green-600 to-emerald-600 text-white py-4 px-6 rounded-lg font-semibold hover:from-green-700 hover:to-emerald-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center\">\n                    {loading ? (\n                      <div className=\"flex flex-col items-center space-y-2\"><div className=\"flex items-center\"><div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2\"></div>{processingStep || 'Processando...'}</div>{loadingMessage && (<span className=\"text-sm opacity-80\">{loadingMessage}</span>)}\n                      </div>\n                    ) : (\n                      <>\n                        <Lock className=\"w-5 h-5 mr-2\" />{paymentMethod === 'credit_card' ? 'Confirmar Assinatura' : 'Gerar PIX'} - {couponCalculation ? ` R$ ${(couponCalculation.final_amount / 100).toFixed(2)}/mês` : ' R$ 197/mês'}\n                      </>\n                    )}\n                  </button>\n\n                  <div className=\"text-center text-sm text-gray-600\">\n                    <div className=\"flex items-center justify-center mb-2\"><Shield className=\"w-4 h-4 text-green-600 mr-1\" /><span>Pagamento seguro e criptografado</span></div>\n                    <p>Ao continuar, você concorda com nossos <a href=\"#\" className=\"text-green-600 hover:underline\">Termos de Serviço</a></p>\n                  </div>\n                  </div>\n                 </>\n                )}\n              </div>\n            </div>\n          </div>\n\n          <div className=\"mt-12 border-t border-gray-200 pt-8\">\n            <div className=\"max-w-6xl mx-auto text-center\">\n              <div className=\"flex flex-col items-center space-y-4\">\n                <div className=\"flex items-center space-x-2 text-xs text-gray-600\"><span>Powered by</span><img src=\"https://assets.decocache.com/payme/ab015445-0855-45b7-9abb-0df413196ca2/pagarme-logo-main.svg\" alt=\"Pagar.me\" className=\"h-4 w-auto\" /></div>\n                <div className=\"flex items-center space-x-4 text-xs text-gray-500\"><a href=\"#\" className=\"hover:text-gray-700 transition-colors\">Legal</a><span>|</span><a href=\"#\" className=\"hover:text-gray-700 transition-colors\">Returns</a><span>|</span><a href=\"#\" className=\"hover:text-gray-700 transition-colors\">Contact</a></div>\n                <p className=\"text-xs text-gray-500\">© 2025 Umbrella Tecnologia. - Todos os direitos reservados.</p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Sticky CTA no mobile */}\n      <div className=\"fixed bottom-0 inset-x-0 md:hidden bg-white/95 backdrop-blur border-t border-gray-200 p-3 z-50\">\n        <button onClick={handleSubmit} disabled={loading} className=\"w-full bg-gradient-to-r from-green-600 to-emerald-600 text-white py-3 px-6 rounded-lg font-semibold hover:from-green-700 hover:to-emerald-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center\">\n          {loading ? (\n            <div className=\"flex items-center\"><div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2\"></div>{processingStep || 'Processando...'}</div>\n          ) : (\n            <>\n              <Lock className=\"w-5 h-5 mr-2\" />{paymentMethod === 'credit_card' ? 'Confirmar Assinatura' : 'Gerar PIX'}\n            </>\n          )}\n        </button>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/checkout/success/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/community/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/config/builderSpec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/custom-signals/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/daily-goals/page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'baseValue'. Either include it or remove the dependency array.","line":239,"column":6,"nodeType":"ArrayExpression","endLine":239,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [baseValue]","fix":{"range":[7234,7236],"text":"[baseValue]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { DashboardLayout } from '@/components/dashboard/layout';\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Progress } from '@/components/ui/progress';\r\nimport { Separator } from '@/components/ui/separator';\r\nimport { Alert, AlertDescription } from '@/components/ui/alert';\r\nimport { Switch } from '@/components/ui/switch';\r\nimport { Textarea } from '@/components/ui/textarea';\r\nimport { \r\n  Target, \r\n  TrendingUp, \r\n  TrendingDown, \r\n  Trophy, \r\n  Calendar,\r\n  Clock,\r\n  DollarSign,\r\n  CheckCircle,\r\n  XCircle,\r\n  Star,\r\n  Flame,\r\n  Award,\r\n  Plus,\r\n  Edit,\r\n  Save,\r\n  RotateCcw,\r\n  Shield,\r\n  Lightbulb\r\n} from 'lucide-react';\r\nimport { \r\n  ResponsiveContainer, \r\n  LineChart, \r\n  Line, \r\n  XAxis, \r\n  YAxis, \r\n  CartesianGrid, \r\n  Tooltip, \r\n  Legend,\r\n  BarChart,\r\n  Bar,\r\n  RadialBarChart,\r\n  RadialBar\r\n} from 'recharts';\r\n\r\n// Dados mock para demonstração\r\nconst initialTodayGoals = [\r\n  {\r\n    id: 1,\r\n    title: 'Meta de Lucro',\r\n    target: 200,\r\n    current: 150,\r\n    type: 'profit',\r\n    priority: 'high',\r\n    deadline: '23:59',\r\n    completed: false\r\n  },\r\n  {\r\n    id: 2,\r\n    title: 'Número de Sessões',\r\n    target: 5,\r\n    current: 3,\r\n    type: 'sessions',\r\n    priority: 'medium',\r\n    deadline: '22:00',\r\n    completed: false\r\n  },\r\n  {\r\n    id: 3,\r\n    title: 'Taxa de Acerto',\r\n    target: 70,\r\n    current: 75,\r\n    type: 'winrate',\r\n    priority: 'medium',\r\n    deadline: '23:59',\r\n    completed: true\r\n  },\r\n  {\r\n    id: 4,\r\n    title: 'Tempo de Jogo',\r\n    target: 180,\r\n    current: 120,\r\n    type: 'time',\r\n    priority: 'low',\r\n    deadline: '20:00',\r\n    completed: false\r\n  }\r\n];\r\n\r\nconst weeklyProgress = [\r\n  { day: 'Seg', goal: 200, achieved: 180, completed: false },\r\n  { day: 'Ter', goal: 200, achieved: 250, completed: true },\r\n  { day: 'Qua', goal: 200, achieved: 120, completed: false },\r\n  { day: 'Qui', goal: 200, achieved: 300, completed: true },\r\n  { day: 'Sex', goal: 200, achieved: 190, completed: false },\r\n  { day: 'Sáb', goal: 250, achieved: 280, completed: true },\r\n  { day: 'Dom', goal: 150, achieved: 150, completed: true }\r\n];\r\n\r\nconst achievements = [\r\n  {\r\n    id: 1,\r\n    title: 'Sequência de 3 dias',\r\n    description: 'Atingiu a meta por 3 dias consecutivos',\r\n    icon: '🔥',\r\n    unlocked: true,\r\n    date: '15/01/2024'\r\n  },\r\n  {\r\n    id: 2,\r\n    title: 'Meta Superada',\r\n    description: 'Superou a meta diária em 50%',\r\n    icon: '🚀',\r\n    unlocked: true,\r\n    date: '12/01/2024'\r\n  },\r\n  {\r\n    id: 3,\r\n    title: 'Semana Perfeita',\r\n    description: 'Atingiu todas as metas da semana',\r\n    icon: '👑',\r\n    unlocked: false,\r\n    date: null\r\n  },\r\n  {\r\n    id: 4,\r\n    title: 'Disciplina Total',\r\n    description: 'Não ultrapassou limites por 7 dias',\r\n    icon: '🛡️',\r\n    unlocked: true,\r\n    date: '10/01/2024'\r\n  }\r\n];\r\n\r\nconst goalHistory = [\r\n  { date: '15/01', profit: 220, goal: 200, sessions: 4, winRate: 75, completed: true },\r\n  { date: '14/01', profit: 180, goal: 200, sessions: 3, winRate: 60, completed: false },\r\n  { date: '13/01', profit: 250, goal: 200, sessions: 5, winRate: 80, completed: true },\r\n  { date: '12/01', profit: 300, goal: 200, sessions: 6, winRate: 70, completed: true },\r\n  { date: '11/01', profit: 150, goal: 200, sessions: 3, winRate: 50, completed: false },\r\n  { date: '10/01', profit: 280, goal: 250, sessions: 5, winRate: 85, completed: true },\r\n  { date: '09/01', profit: 190, goal: 200, sessions: 4, winRate: 65, completed: false }\r\n];\r\n\r\nexport default function DailyGoalsPage() {\r\n  const [todayGoals, setTodayGoals] = useState(initialTodayGoals);\r\n  const [newGoalTitle, setNewGoalTitle] = useState('');\r\n  const [newGoalTarget, setNewGoalTarget] = useState('');\r\n  const [newGoalType, setNewGoalType] = useState('profit');\r\n  const [newGoalDeadline, setNewGoalDeadline] = useState('23:59');\r\n  const [goalValueType, setGoalValueType] = useState('fixed'); // 'fixed' ou 'percentage'\r\n  const [baseValue, setBaseValue] = useState('1000'); // Valor base para cálculo percentual\r\n  const [editingGoal, setEditingGoal] = useState<number | null>(null);\r\n  const [motivationalMessage, setMotivationalMessage] = useState(\r\n    \"Bom dia! Hoje é um novo dia para alcançar suas metas. Vamos começar com foco e disciplina! 💪\"\r\n  );\r\n  const [showMotivationalAlert, setShowMotivationalAlert] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [currentStreak, setCurrentStreak] = useState(3);\r\n  const [totalGoalsCompleted, setTotalGoalsCompleted] = useState(12);\r\n  \r\n  // Estados para missões\r\n  const [missions, setMissions] = useState([\r\n    {\r\n      id: 1,\r\n      title: \"Fazer 10 apostas com estratégia Martingale\",\r\n      description: \"Use a estratégia Martingale em pelo menos 10 apostas hoje\",\r\n      target: 10,\r\n      current: 3,\r\n      type: \"strategy\",\r\n      strategy: \"Martingale\",\r\n      reward: \"50 XP\",\r\n      completed: false\r\n    },\r\n    {\r\n      id: 2,\r\n      title: \"Manter taxa de acerto acima de 70%\",\r\n      description: \"Mantenha sua taxa de acerto acima de 70% durante todo o dia\",\r\n      target: 70,\r\n      current: 85,\r\n      type: \"winrate\",\r\n      reward: \"100 XP\",\r\n      completed: false\r\n    },\r\n    {\r\n      id: 3,\r\n      title: \"Não exceder 5% da banca por aposta\",\r\n      description: \"Mantenha a disciplina e não aposte mais que 5% da banca\",\r\n      target: 1,\r\n      current: 1,\r\n      type: \"discipline\",\r\n      reward: \"75 XP\",\r\n      completed: true\r\n    }\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    const fetchPrefs = async () => {\r\n      try {\r\n        const res = await fetch('/api/user-preferences');\r\n        if (!res.ok) throw new Error('Erro ao buscar preferências');\r\n        const prefs = await res.json();\r\n        const targetProfit = Number(prefs?.daily_goal ?? initialTodayGoals[0]?.target ?? 200);\r\n        const base = Number(prefs?.initial_bankroll ?? baseValue);\r\n        setBaseValue(String(base));\r\n        setTodayGoals(prev => {\r\n          const idx = prev.findIndex(g => g.type === 'profit');\r\n          if (idx >= 0) {\r\n            const updated = [...prev];\r\n            updated[idx] = { ...updated[idx], target: targetProfit };\r\n            return updated;\r\n          }\r\n          return [\r\n            {\r\n              id: Date.now(),\r\n              title: 'Meta de Lucro',\r\n              target: targetProfit,\r\n              current: 0,\r\n              type: 'profit',\r\n              priority: 'high',\r\n              deadline: '23:59',\r\n              completed: false\r\n            },\r\n            ...prev\r\n          ];\r\n        });\r\n      } catch (e) {\r\n        // fallback silencioso\r\n      }\r\n    };\r\n    fetchPrefs();\r\n  }, []);\r\n\r\n  // Calcular estatísticas do dia\r\n  const todayStats = {\r\n    totalGoals: todayGoals.length,\r\n    completedGoals: todayGoals.filter(g => g.completed).length,\r\n    totalProgress: todayGoals.reduce((sum, goal) => {\r\n      const progress = Math.min((goal.current / goal.target) * 100, 100);\r\n      return sum + progress;\r\n    }, 0) / todayGoals.length,\r\n    estimatedCompletion: '18:30' // Mock\r\n  };\r\n\r\n  // Função para calcular valor da meta baseado no tipo\r\n  const calculateGoalValue = () => {\r\n    if (goalValueType === 'percentage') {\r\n      const base = parseFloat(baseValue) || 1000;\r\n      const percentage = parseFloat(newGoalTarget) || 0;\r\n      return (base * percentage) / 100;\r\n    }\r\n    return parseFloat(newGoalTarget) || 0;\r\n  };\r\n\r\n  // Função para gerar feedback motivacional com LLM\r\n  const generateMotivationalFeedback = async (type: 'achievement' | 'encouragement', context?: any) => {\r\n    const messages = {\r\n      achievement: [\r\n        \"🎉 Parabéns! Você atingiu sua meta! Sua disciplina está pagando dividendos!\",\r\n        \"🏆 Excelente trabalho! Mais uma meta conquistada. Continue assim!\",\r\n        \"⭐ Fantástico! Você está no caminho certo para o sucesso!\",\r\n        \"🚀 Meta alcançada! Sua consistência é inspiradora!\"\r\n      ],\r\n      encouragement: [\r\n        \"💪 Você está quase lá! Mantenha o foco e a disciplina!\",\r\n        \"🎯 Cada aposta é um passo em direção à sua meta. Continue!\",\r\n        \"⚡ A persistência é a chave do sucesso. Não desista!\",\r\n        \"🌟 Acredite no seu potencial! Você consegue!\"\r\n      ]\r\n    };\r\n    \r\n    const randomMessage = messages[type][Math.floor(Math.random() * messages[type].length)];\r\n    setMotivationalMessage(randomMessage);\r\n    setShowMotivationalAlert(true);\r\n    \r\n    // Auto-hide alert after 5 seconds\r\n    setTimeout(() => setShowMotivationalAlert(false), 5000);\r\n  };\r\n\r\n  const handleAddGoal = () => {\r\n    // Calcular ou definir padrão para o alvo\r\n    let calculatedTarget = calculateGoalValue();\r\n    if (!newGoalTarget || calculatedTarget <= 0) {\r\n      // Valores padrão por tipo quando o usuário não preenche\r\n      calculatedTarget =\r\n        newGoalType === 'profit' ? 100 :\r\n        newGoalType === 'sessions' ? 5 :\r\n        newGoalType === 'winrate' ? 70 :\r\n        newGoalType === 'time' ? 60 : 100;\r\n    }\r\n\r\n    // Título padrão quando não informado\r\n    const defaultTitle =\r\n      newGoalType === 'profit' ? `Meta de Lucro` :\r\n      newGoalType === 'sessions' ? `Número de Sessões` :\r\n      newGoalType === 'winrate' ? `Taxa de Acerto` :\r\n      newGoalType === 'time' ? `Tempo de Jogo` : 'Nova Meta';\r\n\r\n    const titleWithValue = () => {\r\n      if (newGoalType === 'profit') return `${defaultTitle} (${calculatedTarget} R$)`;\r\n      if (newGoalType === 'sessions') return `${defaultTitle} (${calculatedTarget})`;\r\n      if (newGoalType === 'winrate') return `${defaultTitle} (${calculatedTarget}%)`;\r\n      if (newGoalType === 'time') return `${defaultTitle} (${calculatedTarget} min)`;\r\n      return defaultTitle;\r\n    };\r\n\r\n    const newGoal = {\r\n      id: Date.now(),\r\n      title: newGoalTitle ? newGoalTitle : titleWithValue(),\r\n      target: calculatedTarget,\r\n      current: 0,\r\n      type: newGoalType as 'profit' | 'sessions' | 'winrate' | 'time',\r\n      deadline: newGoalDeadline,\r\n      priority: 'medium' as const,\r\n      completed: false,\r\n      valueType: goalValueType,\r\n      originalTarget: newGoalTarget\r\n    };\r\n\r\n    setTodayGoals([...todayGoals, newGoal]);\r\n    setNewGoalTitle('');\r\n    setNewGoalTarget('');\r\n    setNewGoalType('profit');\r\n    setNewGoalDeadline('23:59');\r\n    setGoalValueType('fixed');\r\n\r\n    generateMotivationalFeedback('encouragement');\r\n  };\r\n\r\n  const handleCompleteGoal = (goalId: number) => {\r\n    setTodayGoals(todayGoals.map(goal => \r\n      goal.id === goalId \r\n        ? { ...goal, completed: true, current: goal.target }\r\n        : goal\r\n    ));\r\n    \r\n    generateMotivationalFeedback('achievement');\r\n  };\r\n\r\n  // Função para completar missão\r\n  const handleCompleteMission = (missionId: number) => {\r\n    setMissions(missions.map(mission => \r\n      mission.id === missionId \r\n        ? { ...mission, completed: true, current: mission.target }\r\n        : mission\r\n    ));\r\n    \r\n    generateMotivationalFeedback('achievement');\r\n  };\r\n\r\n  // Função para simular progresso de missão\r\n  const simulateMissionProgress = (missionId: number, increment: number = 1) => {\r\n    setMissions(missions.map(mission => {\r\n      if (mission.id === missionId && !mission.completed) {\r\n        const newCurrent = Math.min(mission.current + increment, mission.target);\r\n        const completed = newCurrent >= mission.target;\r\n        \r\n        if (completed && !mission.completed) {\r\n          generateMotivationalFeedback('achievement');\r\n        }\r\n        \r\n        return { ...mission, current: newCurrent, completed };\r\n      }\r\n      return mission;\r\n    }));\r\n  };\r\n\r\n  const handleSaveGoals = async () => {\r\n    setIsLoading(true);\r\n    try {\r\n      const profitGoal = todayGoals.find(g => g.type === 'profit');\r\n      await fetch('/api/user-preferences', {\r\n        method: 'PUT',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          daily_goal: profitGoal?.target ?? 0\r\n        })\r\n      });\r\n      console.log('Metas salvas com sucesso');\r\n    } catch (e) {\r\n      console.error('Erro ao salvar metas', e);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const getGoalIcon = (type: string) => {\r\n    switch (type) {\r\n      case 'profit': return <DollarSign className=\"h-4 w-4\" />;\r\n      case 'sessions': return <Target className=\"h-4 w-4\" />;\r\n      case 'winrate': return <TrendingUp className=\"h-4 w-4\" />;\r\n      case 'time': return <Clock className=\"h-4 w-4\" />;\r\n      default: return <Target className=\"h-4 w-4\" />;\r\n    }\r\n  };\r\n\r\n  const getPriorityColor = (priority: string) => {\r\n    switch (priority) {\r\n      case 'high': return 'border-red-600 bg-red-100 dark:border-red-700 dark:bg-red-900/20';\r\n      case 'medium': return 'border-yellow-600 bg-yellow-100 dark:border-yellow-700 dark:bg-yellow-900/20';\r\n      case 'low': return 'border-green-600 bg-green-100 dark:border-green-700 dark:bg-green-900/20';\r\n      default: return 'border-slate-600 bg-slate-100 dark:border-slate-700 dark:bg-slate-900/20';\r\n    }\r\n  };\r\n\r\n  const getMotivationalMessage = () => {\r\n    const completionRate = (todayStats.completedGoals / todayStats.totalGoals) * 100;\r\n    \r\n    if (completionRate === 100) {\r\n      return \"🎉 Parabéns! Você atingiu todas as suas metas hoje!\";\r\n    } else if (completionRate >= 75) {\r\n      return \"🔥 Você está quase lá! Mais um pouco e todas as metas estarão completas!\";\r\n    } else if (completionRate >= 50) {\r\n      return \"💪 Bom progresso! Continue focado para atingir suas metas!\";\r\n    } else if (completionRate >= 25) {\r\n      return \"⚡ Você pode fazer isso! Mantenha o foco e a disciplina!\";\r\n    } else {\r\n      return \"🎯 Comece agora! Cada pequeno passo te aproxima das suas metas!\";\r\n    }\r\n  };\r\n\r\n  return (\r\n    <DashboardLayout>\r\n      <div className=\"space-y-6\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <h1 className=\"text-3xl font-bold tracking-tight\">Metas Diárias</h1>\r\n            <p className=\"text-muted-foreground\">\r\n              Defina e acompanhe suas metas para manter o foco e a disciplina\r\n            </p>\r\n          </div>\r\n          <div className=\"flex items-center gap-2\">\r\n            <Badge variant=\"outline\" className=\"text-orange-600\">\r\n              <Flame className=\"h-3 w-3 mr-1\" />\r\n              {currentStreak} dias seguidos\r\n            </Badge>\r\n            <Badge variant=\"outline\" className=\"text-green-600\">\r\n              <Trophy className=\"h-3 w-3 mr-1\" />\r\n              {totalGoalsCompleted} metas atingidas\r\n            </Badge>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Mensagem Motivacional */}\r\n        <Alert className=\"border-blue-500 bg-blue-100 dark:border-blue-700 dark:bg-blue-900/20\">\r\n          <Star className=\"h-4 w-4\" />\r\n          <AlertDescription className=\"font-medium\">\r\n            {getMotivationalMessage()}\r\n          </AlertDescription>\r\n        </Alert>\r\n\r\n        {/* Alerta Motivacional Dinâmico */}\r\n        {showMotivationalAlert && (\r\n          <Alert className=\"border-green-500 bg-green-100 dark:border-green-700 dark:bg-green-900/20 animate-pulse\">\r\n            <Trophy className=\"h-4 w-4\" />\r\n            <AlertDescription>\r\n              {motivationalMessage}\r\n            </AlertDescription>\r\n            <Button \r\n              variant=\"ghost\" \r\n              size=\"sm\" \r\n              className=\"absolute top-2 right-2\"\r\n              onClick={() => setShowMotivationalAlert(false)}\r\n            >\r\n              ×\r\n            </Button>\r\n          </Alert>\r\n        )}\r\n\r\n        {/* Cards de Resumo */}\r\n        <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\r\n          <Card>\r\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n              <CardTitle className=\"text-sm font-medium\">Progresso Geral</CardTitle>\r\n              <Target className=\"h-4 w-4 text-muted-foreground\" />\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"text-2xl font-bold\">{todayStats.totalProgress.toFixed(0)}%</div>\r\n              <Progress value={todayStats.totalProgress} className=\"mt-2\" />\r\n              <p className=\"text-xs text-muted-foreground mt-1\">\r\n                {todayStats.completedGoals} de {todayStats.totalGoals} metas concluídas\r\n              </p>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card>\r\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n              <CardTitle className=\"text-sm font-medium\">Sequência Atual</CardTitle>\r\n              <Flame className=\"h-4 w-4 text-orange-500\" />\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"text-2xl font-bold text-orange-600\">{currentStreak}</div>\r\n              <p className=\"text-xs text-muted-foreground\">\r\n                Dias consecutivos atingindo metas\r\n              </p>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card>\r\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n              <CardTitle className=\"text-sm font-medium\">Previsão</CardTitle>\r\n              <Clock className=\"h-4 w-4 text-muted-foreground\" />\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"text-2xl font-bold\">{todayStats.estimatedCompletion}</div>\r\n              <p className=\"text-xs text-muted-foreground\">\r\n                Horário estimado para conclusão\r\n              </p>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card>\r\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n              <CardTitle className=\"text-sm font-medium\">Taxa de Sucesso</CardTitle>\r\n              <Award className=\"h-4 w-4 text-muted-foreground\" />\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"text-2xl font-bold text-green-600\">85%</div>\r\n              <p className=\"text-xs text-muted-foreground\">\r\n                Últimos 30 dias\r\n              </p>\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n\r\n        {/* Tabs de Conteúdo */}\r\n        <Tabs defaultValue=\"today\" className=\"space-y-4\">\r\n          <TabsList>\r\n            <TabsTrigger value=\"today\">Hoje</TabsTrigger>\r\n            <TabsTrigger value=\"missions\">Missões</TabsTrigger>\r\n            <TabsTrigger value=\"weekly\">Semanal</TabsTrigger>\r\n            <TabsTrigger value=\"achievements\">Conquistas</TabsTrigger>\r\n            <TabsTrigger value=\"history\">Histórico</TabsTrigger>\r\n          </TabsList>\r\n\r\n          <TabsContent value=\"today\" className=\"space-y-4\">\r\n            <div className=\"grid gap-6 md:grid-cols-2\">\r\n              {/* Metas de Hoje */}\r\n              <Card>\r\n                <CardHeader>\r\n                  <CardTitle>Metas de Hoje</CardTitle>\r\n                  <CardDescription>\r\n                    Acompanhe o progresso das suas metas diárias\r\n                  </CardDescription>\r\n                </CardHeader>\r\n                <CardContent className=\"space-y-4\">\r\n                  {todayGoals.map((goal) => {\r\n                    const progress = Math.min((goal.current / goal.target) * 100, 100);\r\n                    const isOverTarget = goal.current > goal.target;\r\n                    \r\n                    return (\r\n                      <div\r\n                        key={goal.id}\r\n                        className={`p-4 border-l-4 rounded-lg ${getPriorityColor(goal.priority)}`}\r\n                      >\r\n                        <div className=\"flex items-center justify-between mb-2\">\r\n                          <div className=\"flex items-center gap-2\">\r\n                            {getGoalIcon(goal.type)}\r\n                            <h4 className=\"font-medium\">{goal.title}</h4>\r\n                            {goal.completed && (\r\n                              <CheckCircle className=\"h-4 w-4 text-green-600\" />\r\n                            )}\r\n                          </div>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <Badge variant=\"outline\" className=\"text-xs\">\r\n                              {goal.deadline}\r\n                            </Badge>\r\n                            {!goal.completed && (\r\n                              <Button\r\n                                size=\"sm\"\r\n                                variant=\"outline\"\r\n                                onClick={() => handleCompleteGoal(goal.id)}\r\n                              >\r\n                                <CheckCircle className=\"h-3 w-3\" />\r\n                              </Button>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                        \r\n                        <div className=\"space-y-2\">\r\n                          <div className=\"flex justify-between text-sm\">\r\n                            <span>Progresso:</span>\r\n                            <span className={isOverTarget ? 'text-green-600 font-medium' : ''}>\r\n                              {goal.current} / {goal.target}\r\n                              {goal.type === 'profit' && ' R$'}\r\n                              {goal.type === 'winrate' && '%'}\r\n                              {goal.type === 'time' && ' min'}\r\n                            </span>\r\n                          </div>\r\n                          <Progress \r\n                            value={progress} \r\n                            className={`h-2 ${isOverTarget ? 'bg-green-100' : ''}`}\r\n                          />\r\n                          <p className=\"text-xs text-muted-foreground\">\r\n                            {progress.toFixed(0)}% concluído\r\n                            {isOverTarget && ' (Meta superada! 🎉)'}\r\n                          </p>\r\n                        </div>\r\n                      </div>\r\n                    );\r\n                  })}\r\n                </CardContent>\r\n              </Card>\r\n\r\n              {/* Adicionar Nova Meta */}\r\n              <Card>\r\n                <CardHeader>\r\n                  <CardTitle>Adicionar Nova Meta</CardTitle>\r\n                  <CardDescription>\r\n                    Crie uma nova meta para hoje\r\n                  </CardDescription>\r\n                </CardHeader>\r\n                <CardContent className=\"space-y-4\">\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"goal-title\">Título da Meta</Label>\r\n                    <Input\r\n                      id=\"goal-title\"\r\n                      placeholder=\"Ex: Lucro de R$ 100\"\r\n                      value={newGoalTitle}\r\n                      onChange={(e) => setNewGoalTitle(e.target.value)}\r\n                    />\r\n                  </div>\r\n\r\n                  <div className=\"space-y-4\">\r\n                    <div className=\"space-y-2\">\r\n                      <Label>Tipo de Valor</Label>\r\n                      <Select value={goalValueType} onValueChange={setGoalValueType}>\r\n                        <SelectTrigger>\r\n                          <SelectValue />\r\n                        </SelectTrigger>\r\n                        <SelectContent>\r\n                          <SelectItem value=\"fixed\">Valor Fixo</SelectItem>\r\n                          <SelectItem value=\"percentage\">Percentual da Banca</SelectItem>\r\n                        </SelectContent>\r\n                      </Select>\r\n                    </div>\r\n\r\n                    {goalValueType === 'percentage' && (\r\n                      <div className=\"space-y-2\">\r\n                        <Label htmlFor=\"base-value\">Valor Base da Banca (R$)</Label>\r\n                        <Input\r\n                          id=\"base-value\"\r\n                          type=\"number\"\r\n                          placeholder=\"1000\"\r\n                          value={baseValue}\r\n                          onChange={(e) => setBaseValue(e.target.value)}\r\n                        />\r\n                      </div>\r\n                    )}\r\n\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                      <div className=\"space-y-2\">\r\n                        <Label htmlFor=\"goal-target\">\r\n                          {goalValueType === 'percentage' ? 'Percentual (%)' : 'Valor Alvo'}\r\n                        </Label>\r\n                        <Input\r\n                          id=\"goal-target\"\r\n                          type=\"number\"\r\n                          placeholder={goalValueType === 'percentage' ? '10' : '100'}\r\n                          value={newGoalTarget}\r\n                          onChange={(e) => setNewGoalTarget(e.target.value)}\r\n                        />\r\n                        {goalValueType === 'percentage' && newGoalTarget && (\r\n                          <p className=\"text-xs text-muted-foreground\">\r\n                            Valor calculado: R$ {calculateGoalValue().toFixed(2)}\r\n                          </p>\r\n                        )}\r\n                      </div>\r\n                      \r\n                      <div className=\"space-y-2\">\r\n                        <Label>Tipo</Label>\r\n                        <Select value={newGoalType} onValueChange={setNewGoalType}>\r\n                          <SelectTrigger>\r\n                            <SelectValue />\r\n                          </SelectTrigger>\r\n                          <SelectContent>\r\n                            <SelectItem value=\"profit\">Lucro (R$)</SelectItem>\r\n                            <SelectItem value=\"sessions\">Sessões</SelectItem>\r\n                            <SelectItem value=\"winrate\">Taxa de Acerto (%)</SelectItem>\r\n                            <SelectItem value=\"time\">Tempo (min)</SelectItem>\r\n                          </SelectContent>\r\n                        </Select>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"goal-deadline\">Prazo</Label>\r\n                    <Input\r\n                      id=\"goal-deadline\"\r\n                      type=\"time\"\r\n                      value={newGoalDeadline}\r\n                      onChange={(e) => setNewGoalDeadline(e.target.value)}\r\n                    />\r\n                  </div>\r\n\r\n                  <Button onClick={handleAddGoal} className=\"w-full\">\r\n                    <Plus className=\"h-4 w-4 mr-2\" />\r\n                    Adicionar Meta\r\n                  </Button>\r\n                  <Button variant=\"outline\" onClick={handleSaveGoals} className=\"w-full\">\r\n                    <Save className=\"h-4 w-4 mr-2\" />\r\n                    Salvar Metas\r\n                  </Button>\r\n                </CardContent>\r\n              </Card>\r\n            </div>\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"missions\" className=\"space-y-4\">\r\n            <div className=\"grid gap-6 md:grid-cols-2\">\r\n              {/* Missões Ativas */}\r\n              <Card>\r\n                <CardHeader>\r\n                  <CardTitle>Missões Diárias</CardTitle>\r\n                  <CardDescription>\r\n                    Complete missões para ganhar XP e desbloquear conquistas\r\n                  </CardDescription>\r\n                </CardHeader>\r\n                <CardContent className=\"space-y-4\">\r\n                  {missions.map((mission) => {\r\n                    const progress = Math.min((mission.current / mission.target) * 100, 100);\r\n                    const isOverTarget = mission.current > mission.target;\r\n                    \r\n                    return (\r\n                      <div\r\n                        key={mission.id}\r\n                        className={`p-4 border rounded-lg ${\r\n                          mission.completed \r\n                            ? 'border-green-600 bg-green-100 dark:border-green-700 dark:bg-green-900/20' \r\n                            : 'border-slate-600 bg-slate-100 dark:border-slate-700 dark:bg-slate-900/20'\r\n                        }`}\r\n                      >\r\n                        <div className=\"flex items-center justify-between mb-2\">\r\n                          <div className=\"flex items-center gap-2\">\r\n                            {mission.type === 'strategy' && <Target className=\"h-4 w-4 text-blue-600\" />}\r\n                            {mission.type === 'winrate' && <TrendingUp className=\"h-4 w-4 text-green-600\" />}\r\n                            {mission.type === 'discipline' && <Shield className=\"h-4 w-4 text-purple-600\" />}\r\n                            <h4 className=\"font-medium\">{mission.title}</h4>\r\n                            {mission.completed && (\r\n                              <CheckCircle className=\"h-4 w-4 text-green-600\" />\r\n                            )}\r\n                          </div>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <Badge variant=\"outline\" className=\"text-xs\">\r\n                              {mission.reward}\r\n                            </Badge>\r\n                            {!mission.completed && (\r\n                              <Button\r\n                                size=\"sm\"\r\n                                variant=\"outline\"\r\n                                onClick={() => handleCompleteMission(mission.id)}\r\n                              >\r\n                                <CheckCircle className=\"h-3 w-3\" />\r\n                              </Button>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                        \r\n                        <p className=\"text-sm text-muted-foreground mb-3\">\r\n                          {mission.description}\r\n                        </p>\r\n                        \r\n                        <div className=\"space-y-2\">\r\n                          <div className=\"flex justify-between text-sm\">\r\n                            <span>Progresso:</span>\r\n                            <span className={isOverTarget ? 'text-green-600 font-medium' : ''}>\r\n                              {mission.current} / {mission.target}\r\n                              {mission.type === 'winrate' && '%'}\r\n                            </span>\r\n                          </div>\r\n                          <Progress \r\n                            value={progress} \r\n                            className={`h-2 ${isOverTarget ? 'bg-green-100 dark:bg-green-900/20' : ''}`}\r\n                          />\r\n                          <div className=\"flex justify-between items-center\">\r\n                            <p className=\"text-xs text-muted-foreground\">\r\n                              {progress.toFixed(0)}% concluído\r\n                              {isOverTarget && ' (Superado! 🎉)'}\r\n                            </p>\r\n                            {!mission.completed && mission.type === 'strategy' && (\r\n                              <Button\r\n                                size=\"sm\"\r\n                                variant=\"ghost\"\r\n                                onClick={() => simulateMissionProgress(mission.id)}\r\n                                className=\"text-xs\"\r\n                              >\r\n                                Simular +1\r\n                              </Button>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    );\r\n                  })}\r\n                </CardContent>\r\n              </Card>\r\n\r\n              {/* Estatísticas de Missões */}\r\n              <Card>\r\n                <CardHeader>\r\n                  <CardTitle>Estatísticas de Missões</CardTitle>\r\n                  <CardDescription>\r\n                    Seu progresso geral em missões\r\n                  </CardDescription>\r\n                </CardHeader>\r\n                <CardContent className=\"space-y-4\">\r\n                  <div className=\"grid grid-cols-2 gap-4\">\r\n                    <div className=\"text-center p-4 border rounded-lg bg-slate-100 dark:bg-slate-900/20 border-slate-600 dark:border-slate-700\">\r\n                      <div className=\"text-2xl font-bold text-green-600\">\r\n                        {missions.filter(m => m.completed).length}\r\n                      </div>\r\n                      <p className=\"text-sm text-muted-foreground\">Concluídas</p>\r\n                    </div>\r\n                    <div className=\"text-center p-4 border rounded-lg bg-slate-100 dark:bg-slate-900/20 border-slate-600 dark:border-slate-700\">\r\n                      <div className=\"text-2xl font-bold text-blue-600\">\r\n                        {missions.filter(m => !m.completed).length}\r\n                      </div>\r\n                      <p className=\"text-sm text-muted-foreground\">Pendentes</p>\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  <div className=\"space-y-3\">\r\n                    <div className=\"flex justify-between items-center\">\r\n                      <span className=\"text-sm\">XP Total Disponível:</span>\r\n                      <span className=\"font-medium\">\r\n                        {missions.reduce((total, mission) => {\r\n                          const xp = parseInt(mission.reward.replace(' XP', ''));\r\n                          return total + xp;\r\n                        }, 0)} XP\r\n                      </span>\r\n                    </div>\r\n                    \r\n                    <div className=\"flex justify-between items-center\">\r\n                      <span className=\"text-sm\">XP Conquistado:</span>\r\n                      <span className=\"font-medium text-green-600\">\r\n                        {missions\r\n                          .filter(m => m.completed)\r\n                          .reduce((total, mission) => {\r\n                            const xp = parseInt(mission.reward.replace(' XP', ''));\r\n                            return total + xp;\r\n                          }, 0)} XP\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  <Button \r\n                    className=\"w-full\" \r\n                    onClick={() => generateMotivationalFeedback('encouragement')}\r\n                  >\r\n                    <Lightbulb className=\"h-4 w-4 mr-2\" />\r\n                    Motivação Sofia\r\n                  </Button>\r\n                </CardContent>\r\n              </Card>\r\n            </div>\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"weekly\" className=\"space-y-4\">\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Progresso Semanal</CardTitle>\r\n                <CardDescription>\r\n                  Visualize seu desempenho ao longo da semana\r\n                </CardDescription>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <ResponsiveContainer width=\"100%\" height={300}>\r\n                  <BarChart data={weeklyProgress}>\r\n                    <CartesianGrid strokeDasharray=\"3 3\" />\r\n                    <XAxis dataKey=\"day\" />\r\n                    <YAxis />\r\n                    <Tooltip \r\n                      formatter={(value, name) => [\r\n                        `R$ ${value}`, \r\n                        name === 'goal' ? 'Meta' : 'Atingido'\r\n                      ]}\r\n                    />\r\n                    <Legend />\r\n                    <Bar dataKey=\"goal\" fill=\"#475569\" name=\"Meta\" />\r\n                    <Bar dataKey=\"achieved\" fill=\"#10b981\" name=\"Atingido\" />\r\n                  </BarChart>\r\n                </ResponsiveContainer>\r\n                \r\n                <div className=\"mt-4 grid grid-cols-7 gap-2\">\r\n                  {weeklyProgress.map((day, index) => (\r\n                    <div key={index} className=\"text-center\">\r\n                      <div className={`w-8 h-8 mx-auto rounded-full flex items-center justify-center text-xs font-medium ${\r\n                        day.completed ? 'bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400' : 'bg-slate-100 text-slate-600 dark:bg-slate-900/30 dark:text-slate-400'\r\n                      }`}>\r\n                        {day.completed ? '✓' : '○'}\r\n                      </div>\r\n                      <p className=\"text-xs mt-1\">{day.day}</p>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"achievements\" className=\"space-y-4\">\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Conquistas</CardTitle>\r\n                <CardDescription>\r\n                  Suas conquistas e marcos alcançados\r\n                </CardDescription>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"grid gap-4 md:grid-cols-2\">\r\n                  {achievements.map((achievement) => (\r\n                    <div\r\n                      key={achievement.id}\r\n                      className={`p-4 border rounded-lg ${\r\n                        achievement.unlocked \r\n                          ? 'border-green-600 bg-green-100 dark:border-green-700 dark:bg-green-900/20' \r\n                          : 'border-slate-600 bg-slate-100 dark:border-slate-700 dark:bg-slate-900/20 opacity-80'\r\n                      }`}\r\n                    >\r\n                      <div className=\"flex items-start gap-3\">\r\n                        <div className=\"text-2xl\">{achievement.icon}</div>\r\n                        <div className=\"flex-1\">\r\n                          <h4 className=\"font-medium\">{achievement.title}</h4>\r\n                          <p className=\"text-sm text-muted-foreground mb-2\">\r\n                            {achievement.description}\r\n                          </p>\r\n                          {achievement.unlocked ? (\r\n                            <Badge variant=\"outline\" className=\"text-green-600\">\r\n                              Desbloqueado em {achievement.date}\r\n                            </Badge>\r\n                          ) : (\r\n                            <Badge variant=\"outline\">\r\n                              Bloqueado\r\n                            </Badge>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"history\" className=\"space-y-4\">\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Histórico de Metas</CardTitle>\r\n                <CardDescription>\r\n                  Acompanhe seu histórico de metas dos últimos dias\r\n                </CardDescription>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <Table>\r\n                  <TableHeader>\r\n                    <TableRow>\r\n                      <TableHead>Data</TableHead>\r\n                      <TableHead>Meta</TableHead>\r\n                      <TableHead>Atingido</TableHead>\r\n                      <TableHead>Sessões</TableHead>\r\n                      <TableHead>Taxa</TableHead>\r\n                      <TableHead>Status</TableHead>\r\n                    </TableRow>\r\n                  </TableHeader>\r\n                  <TableBody>\r\n                    {goalHistory.map((day, index) => (\r\n                      <TableRow key={index}>\r\n                        <TableCell>{day.date}</TableCell>\r\n                        <TableCell>R$ {day.goal}</TableCell>\r\n                        <TableCell className={day.profit >= day.goal ? 'text-green-600' : 'text-red-600'}>\r\n                          R$ {day.profit}\r\n                        </TableCell>\r\n                        <TableCell>{day.sessions}</TableCell>\r\n                        <TableCell>\r\n                          <Badge variant={day.winRate >= 70 ? 'default' : 'secondary'}>\r\n                            {day.winRate}%\r\n                          </Badge>\r\n                        </TableCell>\r\n                        <TableCell>\r\n                          {day.completed ? (\r\n                            <CheckCircle className=\"h-4 w-4 text-green-600\" />\r\n                          ) : (\r\n                            <XCircle className=\"h-4 w-4 text-red-600\" />\r\n                          )}\r\n                        </TableCell>\r\n                      </TableRow>\r\n                    ))}\r\n                  </TableBody>\r\n                </Table>\r\n              </CardContent>\r\n            </Card>\r\n          </TabsContent>\r\n        </Tabs>\r\n      </div>\r\n    </DashboardLayout>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/dashboard-v2/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/dashboard/page.auth-skeleton-backup-20260122.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'activeSignal'. Either include it or remove the dependency array.","line":637,"column":6,"nodeType":"ArrayExpression","endLine":637,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [activeSignal, liveSignalsData]","fix":{"range":[27611,27628],"text":"[activeSignal, liveSignalsData]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchRecentSignals', 'fetchRouletteHistory', 'fetchUserPreferences', 'updateKPIs', and 'updateRouletteStatus'. Either include them or remove the dependency array.","line":800,"column":6,"nodeType":"ArrayExpression","endLine":800,"endColumn":33,"suggestions":[{"desc":"Update the dependencies array to be: [user, isLoading, getToken, fetchUserPreferences, fetchRecentSignals, updateKPIs, fetchRouletteHistory, updateRouletteStatus]","fix":{"range":[33766,33793],"text":"[user, isLoading, getToken, fetchUserPreferences, fetchRecentSignals, updateKPIs, fetchRouletteHistory, updateRouletteStatus]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'motivationalPhrases.length'. Either include it or remove the dependency array.","line":811,"column":6,"nodeType":"ArrayExpression","endLine":811,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [motivationalPhrases.length]","fix":{"range":[34074,34076],"text":"[motivationalPhrases.length]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchRouletteStatus'. Either include it or remove the dependency array.","line":891,"column":6,"nodeType":"ArrayExpression","endLine":891,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [user, getToken, fetchRouletteStatus]","fix":{"range":[36780,36796],"text":"[user, getToken, fetchRouletteStatus]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect, useCallback, useRef } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useAuth } from '@/contexts/auth-context';\nimport { DashboardLayout } from '@/components/dashboard/layout';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { Progress } from '@/components/ui/progress';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Separator } from '@/components/ui/separator';\nimport { LineChart, Line, BarChart, Bar, PieChart, Pie, Cell, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts';\nimport { ArrowRight, ArrowUpRight, Clock, Activity, TrendingUp, BarChart3, Target, AlertTriangle, CheckCircle, ChevronRight, Play, Zap, History, Settings, ExternalLink } from 'lucide-react';\nimport { DashboardSkeleton } from '@/components/dashboard/dashboard-skeleton';\nimport { useDashboardPreferences } from '@/hooks/use-dashboard-preferences';\nimport { withLazyLoading } from '@/components/lazy/lazy-component';\nimport { apiClient } from '@/lib/api-client';\nimport { useRealtimeSignals } from '@/hooks/use-websocket';\nimport { usePerformanceMonitoring, useSmartMemo, useDebounce } from '@/hooks/use-performance';\n\r\n// Componentes lazy\r\nconst LiveSignals = withLazyLoading(() => import('@/components/dashboard/live-signals'));\r\nconst StatsCards = withLazyLoading(() => import('@/components/dashboard/stats-cards'));\r\nconst PerformanceChart = withLazyLoading(() => import('@/components/dashboard/performance-chart'));\r\nconst RouletteStatus = withLazyLoading(() => import('@/components/dashboard/roulette-status'));\r\nconst RecentActivity = withLazyLoading(() => import('@/components/dashboard/recent-activity'));\r\nconst RouletteModal = withLazyLoading(() => import('@/components/dashboard/roulette-modal'));\r\n\r\n// Definição de Tipos para os dados do Backend\r\ninterface GeneratedSignal {\r\n  id: string;\r\n  strategy_name: string;\r\n  table_id: string;\r\n  suggested_bets: (string | number)[];\r\n  suggested_units: number;\r\n  confidence_level: number;\r\n  confidence_score?: number;\r\n  confidence_factors?: {\r\n    strategy_performance: number;\r\n    table_performance: number;\r\n    pattern_strength: number;\r\n    data_volume: number;\r\n    time_factor: number;\r\n    consistency: number;\r\n  };\r\n  timestamp_generated: string;\r\n  expires_at: string;\r\n  is_validated: boolean;\r\n  type: string;\r\n  message: string;\r\n  // Campos compatíveis com o componente LiveSignals\r\n  strategy_id: string;\r\n  bet_numbers: (string | number)[];\r\n  expected_return: number;\r\n  status: string;\r\n}\r\n\r\ninterface RouletteSpin {\r\n  id: string;\r\n  table_id: string;\r\n  spin_number: number;\r\n  spin_timestamp: string;\r\n}\r\n\r\ninterface KpiData {\r\n  strategy_id: string;\r\n  total_signals_generated: number;\r\n  successful_signals: number;\r\n  failed_signals: number;\r\n  assertiveness_rate_percent: number;\r\n  total_net_profit_loss: number;\r\n  last_updated: string;\r\n}\r\n\r\n// Dados dinâmicos baseados no backend\r\n\r\nexport default function DashboardPage() {\n  const router = useRouter();\n  const { user, isLoading, getToken } = useAuth();\n  const { preferences: dashboardPreferences, loading: preferencesLoading } = useDashboardPreferences();\r\n  const [currentPhraseIndex, setCurrentPhraseIndex] = useState(0);\r\n  const [showActivateDialog, setShowActivateDialog] = useState(false);\r\n  const [selectedActiveTable, setSelectedActiveTable] = useState<{ tableId: string; strategyName: string; suggestedBets: (string | number)[] } | null>(null);\r\n  const [connectionStatus, setConnectionStatus] = useState<'connected' | 'disconnected' | 'reconnecting'>('connected');\r\n  const lastActivityRef = useRef<number>(Date.now());\r\n  const loadedUserRef = useRef<string | null>(null);\r\n  // Assinar sinais em tempo real e filtrar por mesa ativa (se houver)\r\n  const { signals: realtimeSignals, status: realtimeStatus } = useRealtimeSignals({ \r\n    limit: 50,\r\n    tableId: selectedActiveTable?.tableId,\r\n    batchMs: 500\r\n  });\r\n\r\n  // Mapear status do realtime para os valores esperados pelo UI\r\n  type UiRealtimeStatus = 'connected' | 'reconnecting' | 'disconnected';\r\n  const toUiRealtimeStatus = (status?: string): UiRealtimeStatus | undefined => {\r\n    if (!status) return undefined;\r\n    if (status === 'connected') return 'connected';\r\n    if (status === 'connecting' || status === 'reconnecting') return 'reconnecting';\r\n    return 'disconnected';\r\n  };\r\n\r\n  // Frases motivacionais reais sobre estratégias de roleta\r\n  const motivationalPhrases = [\r\n    \"Disciplina e gestão de banca são fundamentais para o sucesso sustentável\",\r\n    \"Análise de padrões históricos aumenta significativamente suas chances\",\r\n    \"Nunca aposte mais do que pode perder - preserve seu capital\",\r\n    \"Estratégias baseadas em dados superam intuição a longo prazo\",\r\n    \"Mantenha controle emocional - decisões racionais geram melhores resultados\",\r\n    \"Diversifique suas estratégias para reduzir riscos concentrados\",\r\n    \"Acompanhe suas estatísticas para identificar padrões de sucesso\",\r\n    \"Paciência é uma virtude - aguarde os melhores momentos para apostar\"\r\n  ];\r\n\r\n  // Frases de boas-vindas diárias\r\n  const welcomePhrases = [\r\n    \"virar a sorte!\",\r\n    \"desafiar a roleta!\",\r\n    \"girar com ousadia.\",\r\n    \"apostar com confiança.\",\r\n    \"seguir sua intuição.\",\r\n    \"mudar seu destino.\",\r\n    \"mostrar quem manda na roleta.\",\r\n    \"sentir a adrenalina do giro.\",\r\n    \"vencer com estilo.\",\r\n    \"confiar na sua sorte.\",\r\n    \"testar sua estratégia.\",\r\n    \"acertar aquele número premiado.\",\r\n    \"dar um show na roleta.\",\r\n    \"surpreender a banca!\",\r\n    \"girar até ganhar!\",\r\n    \"fazer história no jogo.\",\r\n    \"mostrar que você domina o jogo.\",\r\n    \"buscar aquele giro perfeito.\",\r\n    \"deixar a sorte falar mais alto.\",\r\n    \"fazer a roleta sorrir pra você.\",\r\n    \"dar aquele giro maroto.\",\r\n    \"mostrar que número quente é com você.\",\r\n    \"dar o famoso \\\"giro da virada\\\".\",\r\n    \"virar o jogo a seu favor.\",\r\n    \"jogar com coragem e estratégia.\",\r\n    \"fazer a sorte acontecer.\",\r\n    \"transformar giros em vitórias.\",\r\n    \"mostrar que ninguém segura sua maré de sorte.\",\r\n    \"reinar absoluto na roleta.\",\r\n    \"mostrar quem manda na mesa.\",\r\n    \"girar como um verdadeiro mestre.\",\r\n    \"fazer a banca tremer!\",\r\n    \"deixar sua marca no jogo.\"\r\n  ];\r\n\r\n  // Função para obter a frase do dia baseada na data\r\n  const getDailyWelcomeMessage = () => {\r\n    const today = new Date();\r\n    const dayOfYear = Math.floor((today.getTime() - new Date(today.getFullYear(), 0, 0).getTime()) / (1000 * 60 * 60 * 24));\r\n    const phraseIndex = dayOfYear % welcomePhrases.length;\r\n    \r\n    const options: Intl.DateTimeFormatOptions = {\r\n      weekday: 'long',\r\n      day: 'numeric',\r\n      month: 'long',\r\n      year: 'numeric'\r\n    };\r\n    \r\n    const formattedDate = today.toLocaleDateString('pt-BR', options);\r\n    const userMetadata = user as any;\r\n    const firstName = userMetadata?.user_metadata?.first_name || userMetadata?.user_metadata?.name?.split(' ')[0] || 'Usuário';\r\n    \r\n    return {\r\n      greeting: `Olá, ${firstName}! Hoje é ${formattedDate}, dia de ${welcomePhrases[phraseIndex]}`,\r\n      firstName\r\n    };\r\n  };\r\n\r\n  // Estados para dados reais do backend\r\n  const [liveSignalsData, setLiveSignalsData] = useState<GeneratedSignal[]>([\r\n    // DADOS MOCK TEMPORÁRIOS PARA TESTE\r\n    {\r\n      id: \"1\",\r\n      strategy_name: \"Estratégia Fibonacci Avançada\",\r\n      strategy_id: \"fibonacci-advanced\",\r\n      table_id: \"evolution-double-ball-roulette\",\r\n      suggested_bets: [7, 14, 21, 28, \"Red\", \"1st-12\"],\r\n      bet_numbers: [7, 14, 21, 28, \"Red\", \"1st-12\"],\r\n      suggested_units: 3,\r\n      confidence_level: 85,\r\n      confidence_score: 85,\r\n      confidence_factors: {\r\n        strategy_performance: 0.82,\r\n        table_performance: 0.78,\r\n        pattern_strength: 0.91,\r\n        data_volume: 0.88,\r\n        time_factor: 0.75,\r\n        consistency: 0.83\r\n      },\r\n      timestamp_generated: new Date().toISOString(),\r\n      expires_at: new Date(Date.now() + 60000).toISOString(), // 1 minuto\r\n      expected_return: 125.50,\r\n      is_validated: false,\r\n      type: \"pattern\",\r\n      status: \"active\",\r\n      message: \"Padrão forte detectado nos últimos 15 giros. Sequência de números pares com alta probabilidade.\"\r\n    },\r\n    {\r\n      id: \"2\",\r\n      strategy_name: \"Martingale Modificado\",\r\n      strategy_id: \"martingale-modified\",\r\n      table_id: \"evolution-lightning-roulette\",\r\n      suggested_bets: [0, 32, 15, \"Black\"],\r\n      bet_numbers: [0, 32, 15, \"Black\"],\r\n      suggested_units: 2,\r\n      confidence_level: 65,\r\n      confidence_score: 65,\r\n      timestamp_generated: new Date(Date.now() - 30000).toISOString(), // 30 segundos atrás\r\n      expires_at: new Date(Date.now() + 30000).toISOString(), // 30 segundos\r\n      expected_return: 89.25,\r\n      is_validated: false,\r\n      type: \"progression\",\r\n      status: \"active\",\r\n      message: \"Oportunidade de recuperação identificada. Aposte com cautela.\"\r\n    }\r\n  ]);\r\n  const [latestRouletteSpin, setLatestRouletteSpin] = useState<RouletteSpin | null>(null);\r\n  const [kpisData, setKpisData] = useState<KpiData[]>([]);\r\n  const [rouletteHistoryData, setRouletteHistoryData] = useState<RouletteSpin[]>([]);\r\n  const [activeSignal, setActiveSignal] = useState<GeneratedSignal | null>({\r\n    id: \"1\",\r\n    strategy_name: \"Estratégia Fibonacci Avançada\",\r\n    strategy_id: \"fibonacci-advanced\",\r\n    table_id: \"evolution-double-ball-roulette\",\r\n    suggested_bets: [7, 14, 21, 28, \"Red\", \"1st-12\"],\r\n    bet_numbers: [7, 14, 21, 28, \"Red\", \"1st-12\"],\r\n    suggested_units: 3,\r\n    confidence_level: 85,\r\n    confidence_score: 85,\r\n    confidence_factors: {\r\n      strategy_performance: 0.82,\r\n      table_performance: 0.78,\r\n      pattern_strength: 0.91,\r\n      data_volume: 0.88,\r\n      time_factor: 0.75,\r\n      consistency: 0.83\r\n    },\r\n    timestamp_generated: new Date().toISOString(),\r\n    expires_at: new Date(Date.now() + 60000).toISOString(),\r\n    expected_return: 125.50,\r\n    is_validated: false,\r\n    type: \"pattern\",\r\n    status: \"active\",\r\n    message: \"Padrão forte detectado nos últimos 15 giros. Sequência de números pares com alta probabilidade.\"\r\n  });\r\n  const [countdown, setCountdown] = useState(0);\r\n  const [progressValue, setProgressValue] = useState(0);\r\n  const [loading_data, setLoadingData] = useState(true); // Mantido para compatibilidade, mas não bloqueará tudo\r\n  const [loadingSignals, setLoadingSignals] = useState(true);\r\n  const [loadingStats, setLoadingStats] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [activeRouletteStatus, setActiveRouletteStatus] = useState<{table_id: string, status: string} | null>(null);\r\n  const [monitoredTables, setMonitoredTables] = useState<string[]>([]); // Roletas monitoradas\r\n  const monitoredTablesRef = useRef<string[]>([]); // Ref para evitar re-renders no Realtime\r\n\r\n  const BACKEND_URL = process.env.NEXT_PUBLIC_BACKEND_URL || 'http://localhost:3001';\r\n\r\n  // Helper para headers condicionais ao token (tipado)\r\n  const buildHeaders = (token?: string | null): Record<string, string> => (\r\n    token ? { Authorization: `Bearer ${token}` } : {}\r\n  );\r\n\r\n\r\n  // Função para buscar preferências do usuário (roletas monitoradas)\r\n  const fetchUserPreferences = useCallback(async () => {\r\n    try {\r\n      const token = await getToken();\r\n      const response = await apiClient.get('/user-preferences', {\r\n        headers: buildHeaders(token),\r\n        timeout: 8000,\r\n      });\r\n      const preferences = (response as any)?.data ?? response;\r\n      console.log('✅ Preferências do usuário carregadas:', preferences);\r\n      const tables = Array.isArray(preferences?.tables) ? preferences.tables : (Array.isArray(preferences) ? preferences : []);\r\n      setMonitoredTables(tables);\r\n      return tables;\r\n    } catch (error) {\r\n      console.error('❌ Erro ao buscar preferências:', error);\r\n      return [];\r\n    }\r\n  }, [getToken]);\r\n\r\n  // Mesclar sinais em tempo real com os carregados inicialmente\r\n  useEffect(() => {\r\n    try {\r\n      if (Array.isArray(realtimeSignals) && realtimeSignals.length > 0) {\r\n        setLiveSignalsData((prev) => {\r\n          const existingIds = new Set(prev.map((s) => s.id));\r\n          const normalized = realtimeSignals.map((s) => ({\r\n            id: s.id,\r\n            strategy_name: s.strategy_name,\r\n            strategy_id: s.strategy_id,\r\n            table_id: s.table_id,\r\n            suggested_bets: s.suggested_bets ?? s.bet_numbers ?? [],\r\n            bet_numbers: s.bet_numbers ?? s.suggested_bets ?? [],\r\n            suggested_units: typeof s.suggested_units === 'number' ? s.suggested_units : 1,\r\n            confidence_level: s.confidence_level,\r\n            confidence_score: typeof s.confidence_score === 'number' ? s.confidence_score : s.confidence_level,\r\n            confidence_factors: s.confidence_factors,\r\n            timestamp_generated: s.timestamp_generated,\r\n            expires_at: s.expires_at,\r\n            expected_return: s.expected_return,\r\n            is_validated: false,\r\n            type: 'pattern',\r\n            status: s.status ?? 'active',\r\n            message: s.message ?? ''\r\n          }));\r\n\r\n          const fresh = normalized.filter((s) => !existingIds.has(s.id));\r\n          const merged = [...fresh, ...prev];\r\n          return merged.slice(0, 100);\r\n        });\r\n      }\r\n      // Atualizar status de conexão\r\n      if (realtimeStatus === 'connected') {\r\n        setConnectionStatus('connected');\r\n      } else if (realtimeStatus === 'connecting') {\r\n        setConnectionStatus('reconnecting');\r\n      } else {\r\n        setConnectionStatus('disconnected');\r\n      }\r\n    } catch (e) {\r\n      console.warn('Falha ao mesclar sinais realtime:', e);\r\n    }\r\n  }, [realtimeSignals, realtimeStatus]);\r\n \r\n  // Função para atualizar KPIs periodicamente\r\n  const updateKPIs = useCallback(async () => {\r\n    try {\r\n      const token = await getToken();\r\n      const response = await apiClient.get('/kpis', {\r\n        headers: buildHeaders(token),\r\n        timeout: 12000,\r\n      });\r\n      const rawData = (response as any)?.data ?? response;\r\n      if (!rawData) return;\r\n      const dataArray = Array.isArray(rawData) ? rawData : (rawData.data || []);\r\n      const transformedData: KpiData[] = dataArray.map((item: any) => ({\r\n        strategy_id: item.strategy_id || 'Estratégia Desconhecida',\r\n        total_signals_generated: Number(item.total_signals_generated ?? item.total_activations ?? 0) || 0,\r\n        successful_signals: Number(item.successful_signals ?? item.total_hits ?? 0) || 0,\r\n        failed_signals: Number(item.failed_signals ?? item.total_misses ?? 0) || 0,\r\n        assertiveness_rate_percent: Number(item.assertiveness_rate_percent ?? item.hit_rate ?? 0) || 0,\r\n        total_net_profit_loss: Number(item.total_net_profit_loss ?? item.total_net_payout ?? 0) || 0,\r\n        last_updated: item.last_updated || new Date().toISOString()\r\n      }));\r\n      setKpisData(transformedData);\r\n      console.log('🔄 KPIs atualizados');\r\n    } catch (error) {\r\n      console.error('❌ Erro ao atualizar KPIs:', error);\r\n    }\r\n  }, [getToken]);\r\n \r\n  // Função para atualizar status da roleta\r\n  const updateRouletteStatus = useCallback(async () => {\r\n    try {\r\n      const token = await getToken();\r\n      const response = await apiClient.get('/roulette-status', {\r\n        headers: buildHeaders(token),\r\n        timeout: 10000,\r\n      });\r\n      const statusData = (response as any)?.data ?? response;\r\n      setActiveRouletteStatus(statusData);\r\n      console.log('🔄 Status da roleta atualizado');\r\n    } catch (error) {\r\n      console.error('❌ Erro ao atualizar status da roleta:', error);\r\n    }\r\n  }, [getToken]);\r\n\r\n  // Função para buscar table_ids do backend\r\n  const fetchTableIds = useCallback(async () => {\r\n    console.log('🎯 Iniciando busca de table_ids...');\r\n    try {\r\n      const token = await getToken();\r\n      console.log('🔑 Token para table_ids obtido:', token ? 'Sim' : 'Não');\r\n      \r\n      const response = await apiClient.get('/roulette-tables', {\r\n        headers: buildHeaders(token),\r\n        timeout: 10000,\r\n      });\r\n      const data = (response as any)?.data ?? response;\r\n      console.log('✅ Roulette tables fetched successfully:', data);\r\n      \r\n      let tableIds: string[] = [];\r\n      if (Array.isArray(data)) {\r\n        if (data.length > 0 && typeof data[0] === 'string') {\r\n          tableIds = data as string[];\r\n        } else {\r\n          tableIds = data.map((t: any) => t.table_id || t.id).filter(Boolean);\r\n        }\r\n      } else if (Array.isArray(data?.data)) {\r\n        const arr = data.data;\r\n        tableIds = arr.map((t: any) => t.table_id || t.id).filter(Boolean);\r\n      }\r\n      \r\n      if (tableIds.length === 0) {\r\n        console.warn('⚠️ Nenhum table_id válido encontrado no retorno, usando padrão');\r\n        tableIds = ['mesa1', 'mesa2', 'mesa3'];\r\n      }\r\n      \r\n      console.log('🎯 Table IDs extraídos:', tableIds);\r\n      setMonitoredTables(tableIds);\r\n      return tableIds;\r\n    } catch (error: any) {\r\n      console.error('❌ Erro ao buscar table_ids:', error);\r\n      \r\n      const defaultTables = ['mesa1', 'mesa2', 'mesa3'];\r\n      setMonitoredTables(defaultTables);\r\n      return defaultTables;\r\n    }\r\n  }, [getToken]);\r\n\r\n  // Função para buscar KPIs do backend\r\n  const fetchKpis = useCallback(async () => {\r\n    try {\r\n      const token = await getToken();\r\n      const response = await apiClient.get('/kpis', {\r\n        headers: buildHeaders(token),\r\n        timeout: 12000,\r\n      });\r\n      const rawData = (response as any)?.data ?? response;\r\n      const dataArray = Array.isArray(rawData) ? rawData : (rawData?.data || []);\r\n      const transformedData: KpiData[] = dataArray.map((item: any) => ({\r\n        strategy_id: item.strategy_id || 'Estratégia Desconhecida',\r\n        total_signals_generated: Number(item.total_signals_generated ?? item.total_activations ?? 0) || 0,\r\n        successful_signals: Number(item.successful_signals ?? item.total_hits ?? 0) || 0,\r\n        failed_signals: Number(item.failed_signals ?? item.total_misses ?? 0) || 0,\r\n        assertiveness_rate_percent: Number(item.assertiveness_rate_percent ?? item.hit_rate ?? 0) || 0,\r\n        total_net_profit_loss: Number(item.total_net_profit_loss ?? item.total_net_payout ?? 0) || 0,\r\n        last_updated: item.last_updated || new Date().toISOString()\r\n      }));\r\n      setKpisData(transformedData);\r\n    } catch (error: any) {\r\n      console.error('❌ Erro ao buscar KPIs do backend:', error);\r\n      setKpisData([]);\r\n    }\r\n  }, [getToken]);\r\n\r\n\r\n\r\n  // Função para buscar histórico da roleta do backend\r\n  const fetchRouletteHistory = useCallback(async (table_id: string = 'pragmatic-mega-roulette') => {\r\n    console.log('🔍 Iniciando busca do histórico da roleta...');\r\n    try {\r\n      const token = await getToken();\r\n      console.log('🔑 Token obtido:', token ? 'Sim' : 'Não');\r\n      \r\n      const response = await apiClient.getRouletteHistory(undefined, 100);\r\n      const data: RouletteSpin[] = ((response as any)?.data ?? response) as RouletteSpin[];\r\n      console.log('✅ Roulette history fetched successfully:', data);\r\n      console.log('📊 Número de giros recebidos:', data.length);\r\n      setRouletteHistoryData(data);\r\n      \r\n      if (data.length > 0) {\r\n        setLatestRouletteSpin(data[0]);\r\n        console.log('🎯 Último giro definido:', data[0].spin_number);\r\n      } else {\r\n        console.log('❌ Nenhum giro encontrado no histórico');\r\n      }\r\n    } catch (error) {\r\n      console.error('❌ Erro ao buscar histórico da roleta:', error);\r\n      setError('Não foi possível carregar o histórico da roleta. Verifique a conexão com o backend.');\r\n      setRouletteHistoryData([]);\r\n      setLatestRouletteSpin(null);\r\n    }\r\n  }, [getToken]);\r\n\r\n  // Função para buscar status da roleta ativa\r\n  const fetchRouletteStatus = useCallback(async () => {\r\n    console.log('🔍 Iniciando busca do status da roleta...');\r\n    try {\r\n      const token = await getToken();\r\n      console.log('🔑 Token obtido:', token ? 'Sim' : 'Não');\r\n      \r\n      const response = await apiClient.getRouletteStatus();\r\n      const data = (response as any)?.data ?? response;\r\n      console.log('✅ Roulette status fetched successfully:', data);\r\n      console.log('📊 Tipo de dados retornados:', typeof data, Array.isArray(data) ? 'Array' : 'Object');\r\n      \r\n      if (Array.isArray(data) && data.length > 0) {\r\n        const activeTable = data.find((table: any) => table.status === 'active') || data[0];\r\n        console.log('🎯 Mesa ativa selecionada:', activeTable);\r\n        return activeTable;\r\n      }\r\n      \r\n      return data;\r\n    } catch (error) {\r\n      console.error('❌ Erro ao buscar status da roleta:', error);\r\n      return null;\r\n    }\r\n  }, [getToken]);\r\n\r\n  // Função para buscar padrões recentes\r\n  const fetchRecentSignals = useCallback(async () => {\r\n    console.log('🔍 Iniciando busca de padrões recentes...');\r\n    try {\r\n      const token = await getToken();\r\n      console.log('🔑 Token para padrões obtido:', token ? 'Sim' : 'Não');\r\n      \r\n      const response = await apiClient.getSignalsRecent(undefined, 5);\r\n      const rawDataAny: any = (response as any)?.data ?? response;\r\n      console.log('✅ Recent signals fetched successfully:', rawDataAny);\r\n      \r\n      // Padronizar para array, independente do formato retornado\r\n      let signalsArray: any[] = [];\r\n      try {\r\n        if (Array.isArray(rawDataAny)) {\r\n          signalsArray = rawDataAny;\r\n        } else if (rawDataAny && Array.isArray(rawDataAny.signals)) {\r\n          signalsArray = rawDataAny.signals;\r\n        } else if (rawDataAny && Array.isArray(rawDataAny.items)) {\r\n          signalsArray = rawDataAny.items;\r\n        } else if (rawDataAny && typeof rawDataAny === 'object') {\r\n          const values = Object.values(rawDataAny);\r\n          signalsArray = values.flatMap((v: any) => Array.isArray(v) ? v : []);\r\n        } else {\r\n          signalsArray = [];\r\n        }\r\n      } catch (parseErr) {\r\n        console.warn('Falha ao padronizar dados de sinais recentes:', parseErr);\r\n        signalsArray = [];\r\n      }\r\n      console.log('📊 Número de padrões recebidos:', Array.isArray(signalsArray) ? signalsArray.length : 0);\r\n      \r\n      // Buscar as preferências atuais do usuário para filtrar\r\n      let currentMonitoredTables: string[] = [];\r\n      try {\r\n        const prefsResp = await apiClient.getUserPreferences();\r\n        const preferences = (prefsResp as any)?.data ?? prefsResp;\r\n        currentMonitoredTables = Array.isArray(preferences?.tables) ? preferences.tables : [];\r\n      } catch (error) {\r\n        console.log('⚠️ Usando todas as mesas devido a erro ao buscar preferências:', error);\r\n      }\r\n      \r\n      // Filtrar apenas sinais das roletas monitoradas\r\n      const filteredData = signalsArray.filter((signal: any) => {\r\n        const isMonitored = currentMonitoredTables.length === 0 || currentMonitoredTables.includes(signal.table_id);\r\n        if (!isMonitored) {\r\n          console.log('🚫 Sinal filtrado (roleta não monitorada):', signal.table_id);\r\n        }\r\n        return isMonitored;\r\n      });\r\n      \r\n      console.log('🎯 Sinais filtrados para roletas monitoradas:', filteredData.length, 'de', Array.isArray(signalsArray) ? signalsArray.length : 0);\r\n      console.log('📋 Roletas monitoradas:', currentMonitoredTables);\r\n      console.log('📊 Dados brutos dos sinais:', rawDataAny);\r\n      console.log('🔍 Sinais filtrados:', filteredData);\r\n      \r\n      // Mapear dados para estrutura compatível com LiveSignals\r\n      const mappedData = filteredData.map(signal => ({\r\n        ...signal,\r\n        strategy_id: signal.strategy_name,\r\n        bet_numbers: signal.suggested_bets,\r\n        expected_return: signal.expected_return,\r\n        status: signal.is_validated ? 'validated' : 'pending',\r\n        confidence_level: typeof signal.confidence_level === 'string' ? \r\n          (signal.confidence_level === 'High' ? 85 : signal.confidence_level === 'Medium' ? 65 : 45) : \r\n          signal.confidence_level,\r\n        message: signal.message,\r\n        suggested_bets: signal.suggested_bets,\r\n        confidence_score: signal.confidence_score,\r\n        confidence_factors: signal.confidence_factors\r\n      }));\r\n      \r\n      console.log('🗂️ Dados mapeados:', mappedData);\r\n      \r\n      mappedData.forEach((signal, index) => {\r\n        console.log(`📋 Sinal ${index + 1}:`);\r\n        console.log('  - ID:', signal.id);\r\n        console.log('  - Estratégia:', signal.strategy_name);\r\n        console.log('  - Apostas sugeridas (suggested_bets):', signal.suggested_bets);\r\n        console.log('  - Apostas mapeadas (bet_numbers):', signal.bet_numbers);\r\n        console.log('  - Mensagem:', signal.message);\r\n        console.log('  - Status:', signal.status);\r\n      });\r\n      \r\n      setLiveSignalsData(mappedData);\r\n      \r\n      if (mappedData.length > 0) {\r\n        const mostRecentSignal = mappedData[0];\r\n        setActiveSignal(mostRecentSignal);\r\n        console.log('🎯 Sinal ativo inicial definido:', mostRecentSignal.strategy_id, 'ID:', mostRecentSignal.id);\r\n        console.log('🔢 Apostas do sinal ativo:', mostRecentSignal.bet_numbers);\r\n        console.log('📝 Estratégia do sinal ativo:', mostRecentSignal.strategy_name);\r\n        \r\n        if (mostRecentSignal.expires_at) {\r\n          const now = new Date().getTime();\r\n          const expiresAt = new Date(mostRecentSignal.expires_at).getTime();\r\n          const timeLeft = Math.max(0, Math.floor((expiresAt - now) / 1000));\r\n          setCountdown(timeLeft);\r\n          console.log('⏰ Countdown inicial definido:', timeLeft, 'segundos');\r\n        } else {\r\n          setCountdown(0);\r\n          console.log('⏰ Nenhum expires_at no sinal inicial, countdown = 0');\r\n        }\r\n      } else {\r\n        setActiveSignal(null);\r\n        setCountdown(0);\r\n        console.log('❌ Nenhum sinal encontrado, activeSignal = null');\r\n      }\r\n    } catch (error: any) {\r\n      console.error('❌ Erro ao buscar sinais recentes:', error);\r\n      setError(error?.message?.includes('TIMEOUT') ? 'Timeout na conexão com o servidor' : 'Sistema temporariamente indisponível');\r\n      setLiveSignalsData([]);\r\n      setActiveSignal(null);\r\n      setCountdown(0);\r\n    }\r\n  }, [getToken]);\r\n\r\n  // Efeito para sincronizar activeSignal com o primeiro sinal da lista\r\n  useEffect(() => {\r\n    if (liveSignalsData.length > 0 && !activeSignal) {\r\n      const mostRecentSignal = liveSignalsData[0];\r\n      setActiveSignal(mostRecentSignal);\r\n      console.log('🔄 Sincronizando activeSignal com primeiro sinal da lista:', mostRecentSignal.strategy_id);\r\n      \r\n      // Calcular countdown\r\n      if (mostRecentSignal.expires_at) {\r\n        const now = new Date().getTime();\r\n        const expiresAt = new Date(mostRecentSignal.expires_at).getTime();\r\n        const timeLeft = Math.max(0, Math.floor((expiresAt - now) / 1000));\r\n        setCountdown(timeLeft);\r\n      } else {\r\n        setCountdown(0);\r\n      }\r\n    }\r\n  }, [liveSignalsData]); // Removido activeSignal das dependências para evitar loop infinito\r\n\r\n  // Sincronizar estado com ref para evitar re-renders no Realtime\r\n  useEffect(() => {\r\n    monitoredTablesRef.current = monitoredTables;\r\n  }, [monitoredTables]);\r\n\r\n  // Guard de autenticação para redirecionar usuários não logados\n  useEffect(() => {\n    if (isLoading) {\n      return;\n    }\n\n    const checkAuth = async () => {\n      if (!user) {\n        const token = await getToken();\n        if (!token) {\n          router.replace('/login');\n        }\n      }\n    };\n\n    checkAuth();\n  }, [user, isLoading, getToken, router]);\n\n  // Efeito para carregar dados iniciais do backend\n  useEffect(() => {\r\n    console.log('🔄 useEffect executado - carregando dados reais!');\r\n    console.log('👤 User:', user);\r\n    console.log('⏳ isLoading:', isLoading);\r\n    \r\n    if (user && !isLoading) {\r\n      console.log('✅ Condições atendidas - iniciando carregamento de dados reais...');\r\n      \r\n      const loadInitialData = async () => {\r\n          // Não bloquear a interface inteira com loading_data\r\n          setLoadingData(false);\r\n          setLoadingSignals(true);\r\n          setLoadingStats(true);\r\n          setError(null);\r\n          \r\n          try {\r\n            console.log('🚀 Iniciando carregamento otimizado de dados (Paralelo)...');\r\n            console.log('👤 Usuário logado:', user?.email);\r\n            \r\n            const token = await getToken();\r\n            const isMock = (process.env.NEXT_PUBLIC_USE_MOCK_DATA === 'true') || (process.env.USE_MOCK_DATA === 'true');\r\n            \r\n            if (!token && !isMock) {\r\n              setConnectionStatus('disconnected');\r\n              setError('Sessão não autenticada. Faça login para dados reais.');\r\n              console.log('ℹ️ Prosseguindo sem token, evitando interrupção do carregamento inicial');\r\n            }\r\n            \r\n            // 1. Carregar Preferências (Rápido e importante)\r\n            try {\r\n              if (!isMock) {\r\n                await fetchUserPreferences();\r\n              }\r\n            } catch (prefError) {\r\n              console.warn('⚠️ Erro ao carregar preferências:', prefError);\r\n            }\r\n\r\n            // 2. Carregar Sinais (Pode ser lento - isolado)\r\n            const loadSignals = async () => {\r\n              console.log('🎯 Iniciando carga de sinais...');\r\n              try {\r\n                if (!isMock) {\r\n                  await fetchRecentSignals();\r\n                }\r\n              } catch (signalsError: any) {\r\n                console.warn('⚠️ Erro ao carregar sinais:', signalsError?.message || signalsError);\r\n              } finally {\r\n                setLoadingSignals(false);\r\n                console.log('🏁 Carga de sinais finalizada');\r\n              }\r\n            };\r\n\r\n            // 3. Carregar Estatísticas e Histórico (Isolado)\r\n            const loadStats = async () => {\r\n              console.log('📊 Iniciando carga de estatísticas...');\r\n              try {\r\n                const secondaryPromises = [\r\n                  !isMock ? updateKPIs() : Promise.resolve(),\r\n                  !isMock ? fetchRouletteHistory() : Promise.resolve(),\r\n                  !isMock ? updateRouletteStatus() : Promise.resolve()\r\n                ];\r\n                await Promise.allSettled(secondaryPromises);\r\n              } catch (statsError) {\r\n                console.error('❌ Erro ao carregar estatísticas:', statsError);\r\n              } finally {\r\n                setLoadingStats(false);\r\n                console.log('🏁 Carga de estatísticas finalizada');\r\n              }\r\n            };\r\n\r\n            // Disparar carregamentos em paralelo\r\n            loadSignals();\r\n            loadStats();\r\n            \r\n          } catch (error) {\r\n            console.error('❌ Erro geral ao iniciar carregamento:', error);\r\n            setError('Erro ao conectar com o servidor. Verifique sua conexão.');\r\n            setLoadingSignals(false);\r\n            setLoadingStats(false);\r\n          }\r\n        };\r\n\r\n      if (loadedUserRef.current !== user.email) {\r\n        loadedUserRef.current = user.email || '';\r\n        loadInitialData();\r\n      } else {\r\n        console.log('🔄 Usuário já carregado, atualizando dados silenciosamente...');\r\n        fetchRecentSignals();\r\n        updateKPIs();\r\n        fetchRouletteHistory();\r\n        updateRouletteStatus();\r\n      }\r\n\r\n      // Configurar polling para atualizações em tempo real\r\n      console.log('🔄 Configurando polling para atualizações...');\r\n      setConnectionStatus((s) => s);\r\n      \r\n      // Polling para sinais recentes\r\n      const pollSignals = async () => {\r\n        try {\r\n          await fetchRecentSignals();\r\n          setConnectionStatus('connected');\r\n          lastActivityRef.current = Date.now();\r\n        } catch (error) {\r\n          console.error('❌ Erro ao buscar sinais:', error);\r\n        }\r\n      };\r\n      \r\n      // Polling para histórico de roleta\r\n      const pollRouletteHistory = async () => {\r\n        try {\r\n          await fetchRouletteHistory();\r\n        } catch (error) {\r\n          console.error('❌ Erro ao buscar histórico de roleta:', error);\r\n        }\r\n      };\r\n      \r\n      // Executar polling inicial (já coberto pelo loadInitialData, mas mantendo lógica original se necessário)\r\n      // pollSignals(); // Comentado pois loadInitialData já chama\r\n      // pollRouletteHistory(); // Comentado pois loadInitialData já chama\r\n      \r\n      // Configurar intervalos de polling\r\n      const signalsInterval = setInterval(pollSignals, 5000); // A cada 5 segundos\r\n      const rouletteInterval = setInterval(pollRouletteHistory, 10000); // A cada 10 segundos\r\n\r\n      // Cleanup function\r\n      return () => {\r\n        console.log('🧹 Cleanup - removing polling intervals...');\r\n        clearInterval(signalsInterval);\r\n        clearInterval(rouletteInterval);\r\n        console.log('🧹 Cleanup completed successfully');\r\n      };\r\n    } else {\r\n      console.log('❌ Condições não atendidas para carregar dados:');\r\n      console.log('   - User existe:', !!user);\r\n      console.log('   - Loading:', isLoading);\r\n    }\r\n  }, [user, isLoading, getToken]);\r\n\r\n  // Rotação das frases motivacionais\r\n  useEffect(() => {\r\n    const interval = setInterval(() => {\r\n      setCurrentPhraseIndex((prevIndex) =>\r\n        (prevIndex + 1) % motivationalPhrases.length\r\n      );\r\n    }, 8000);\r\n\r\n    return () => clearInterval(interval);\r\n  }, []);\r\n\r\n  // Atualizações periódicas de dados\r\n  useEffect(() => {\r\n    if (user && !isLoading) {\r\n      // Atualizar KPIs a cada 5 minutos\r\n      const kpisInterval = setInterval(() => {\r\n        updateKPIs();\r\n      }, 5 * 60 * 1000);\r\n\r\n      // Atualizar status da roleta a cada 60 segundos\r\n      const statusInterval = setInterval(() => {\r\n        updateRouletteStatus();\r\n      }, 60 * 1000);\r\n\r\n      return () => {\r\n        clearInterval(kpisInterval);\r\n        clearInterval(statusInterval);\r\n      };\r\n    }\r\n  }, [user, isLoading, updateKPIs, updateRouletteStatus]);\r\n\r\n  // Contagem regressiva do sinal ativo baseada em expires_at\r\n  useEffect(() => {\r\n    if (activeSignal && activeSignal.expires_at) {\r\n      const updateCountdown = () => {\r\n        const now = new Date().getTime();\r\n        const expiresAt = new Date(activeSignal.expires_at).getTime();\r\n        const createdAt = new Date(activeSignal.timestamp_generated).getTime();\r\n        const timeLeft = Math.max(0, Math.floor((expiresAt - now) / 1000));\r\n        \r\n        setCountdown(timeLeft);\r\n        \r\n        // Calcular progresso da barra (começa em 100% e diminui até 0%)\r\n        // Usar uma duração padrão de 5 minutos (300 segundos) se não conseguir calcular a duração total\r\n        const totalDuration = expiresAt - createdAt;\r\n        let progress = 0;\r\n        \r\n        if (totalDuration > 0) {\r\n          const remaining = Math.max(0, expiresAt - now);\r\n          progress = Math.max(0, Math.min(100, (remaining / totalDuration) * 100));\r\n        } else {\r\n           // Fallback: assumir duração de 60 segundos (mais realista para roleta) e calcular baseado no countdown\r\n           const assumedDuration = 60; // 60 segundos (1 minuto)\r\n           progress = Math.max(0, Math.min(100, (timeLeft / assumedDuration) * 100));\r\n         }\r\n        \r\n        setProgressValue(progress);\r\n        \r\n        if (timeLeft === 0) {\r\n          setActiveSignal(null);\r\n          setProgressValue(0);\r\n        }\r\n      };\r\n      \r\n      updateCountdown();\r\n      const interval = setInterval(updateCountdown, 1000);\r\n      \r\n      return () => clearInterval(interval);\r\n    } else {\r\n      setCountdown(0);\r\n      setProgressValue(0);\r\n    }\r\n  }, [activeSignal]);\r\n\r\n  // Atualização periódica do status da roleta\r\n  useEffect(() => {\r\n    if (user) {\r\n      const updateRouletteStatus = async () => {\r\n        const status = await fetchRouletteStatus();\r\n        if (status) {\r\n          setActiveRouletteStatus(status);\r\n        }\r\n      };\r\n      \r\n      // Atualizar a cada 60 segundos\r\n      const interval = setInterval(updateRouletteStatus, 60000);\r\n      \r\n      return () => clearInterval(interval);\r\n    }\r\n  }, [user, getToken]); // Removida fetchRouletteStatus das dependências\r\n\r\n  if (isLoading || !user) {\n    console.log('⏳ Dashboard em estado de carregamento ou usuário não autenticado...');\n    return (\n      <DashboardLayout>\n        <DashboardSkeleton />\n      </DashboardLayout>\n    );\n  }\n\r\n  return (\r\n    <DashboardLayout>\r\n      <div className=\"flex flex-col gap-6\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div className=\"flex items-center gap-4\">\r\n            <h1 className=\"text-3xl font-bold tracking-tight font-heading\">Dashboard</h1>\r\n            {/* Indicador de Status da Conexão */}\r\n            <div className=\"flex items-center gap-2\">\r\n              <div className={`w-2 h-2 rounded-full ${\r\n                connectionStatus === 'connected' ? 'bg-green-500' :\r\n                connectionStatus === 'reconnecting' ? 'bg-yellow-500 animate-pulse' :\r\n                'bg-red-500'\r\n              }`} />\r\n              <span className={`text-sm ${\r\n                connectionStatus === 'connected' ? 'text-green-600' :\r\n                connectionStatus === 'reconnecting' ? 'text-yellow-600' :\r\n                'text-red-600'\r\n              }`}>\r\n                {connectionStatus === 'connected' ? 'Conectado' :\r\n                 connectionStatus === 'reconnecting' ? 'Reconectando...' :\r\n                 'Desconectado'}\r\n              </span>\r\n            </div>\r\n          </div>\r\n          <div className=\"flex gap-2\">\r\n            <Button variant=\"outline\" className=\"gap-2\">\r\n              <History className=\"h-4 w-4\" />\r\n              Ver Histórico\r\n            </Button>\r\n            <Dialog open={showActivateDialog} onOpenChange={setShowActivateDialog}>\r\n              <DialogTrigger asChild>\r\n                <Button className=\"gap-2\">\r\n                  <Play className=\"h-4 w-4\" />\r\n                  Ativar Estratégia\r\n                </Button>\r\n              </DialogTrigger>\r\n              <DialogContent>\r\n                <DialogHeader>\r\n                  <DialogTitle>Ativar Nova Estratégia</DialogTitle>\r\n                  <DialogDescription>\r\n                    Selecione a estratégia que deseja ativar e configure os parâmetros.\r\n                  </DialogDescription>\r\n                </DialogHeader>\r\n                <div className=\"grid gap-4 py-4\">\r\n                  <div className=\"space-y-2\">\r\n                    <h4 className=\"font-medium\">Estratégia</h4>\r\n                    <Select defaultValue=\"fibonacci\">\r\n                      <SelectTrigger>\r\n                        <SelectValue placeholder=\"Selecione uma estratégia\" />\r\n                      </SelectTrigger>\r\n                      <SelectContent>\r\n                        {kpisData.map((kpi) => (\r\n                          <SelectItem key={kpi.strategy_id} value={kpi.strategy_id}>\r\n                      {kpi.strategy_id}\r\n                          </SelectItem>\r\n                        ))}\r\n                      </SelectContent>\r\n                    </Select>\r\n                  </div>\r\n                </div>\r\n                <DialogFooter>\r\n                  <Button variant=\"outline\" onClick={() => setShowActivateDialog(false)}>\r\n                    Cancelar\r\n                  </Button>\r\n                  <Button onClick={() => setShowActivateDialog(false)}>\r\n                    Ativar\r\n                  </Button>\r\n                </DialogFooter>\r\n              </DialogContent>\r\n            </Dialog>\r\n          </div>\r\n        </div>\r\n\r\n\r\n        {/* Carregamento inicial não bloqueante */}\r\n        <>\r\n          {/* Informações Dinâmicas */}\r\n            <Card className=\"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-950/20 dark:to-indigo-950/20 border-blue-200 dark:border-blue-800\">\r\n              <CardContent className=\"p-4\">\r\n                <div className=\"flex items-center gap-3\">\r\n                  <div className=\"p-2 bg-blue-100 dark:bg-blue-900 rounded-full\">\r\n                    <Zap className=\"h-5 w-5 text-blue-600 dark:text-blue-400\" />\r\n                  </div>\r\n                  <p className=\"text-sm text-blue-800 dark:text-blue-200 font-medium\">\r\n                    {motivationalPhrases[currentPhraseIndex]}\r\n                  </p>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n\r\n        {/* Seção Padrão Ativo */}\r\n        {loadingSignals ? (\r\n          <Card className=\"bg-gradient-to-r from-gray-800 to-gray-900 border-gray-700 text-white\">\r\n            <CardContent className=\"p-6\">\r\n              <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6\">\r\n                {/* Estratégia e Números - Skeleton */}\r\n                <div className=\"space-y-3\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Badge variant=\"secondary\" className=\"bg-green-600 text-white border-green-500\">\r\n                       <div className=\"w-2 h-2 bg-green-300 rounded-full mr-1 animate-pulse\"></div>\r\n                       Ao Vivo\r\n                     </Badge>\r\n                  </div>\r\n                  <h3 className=\"text-lg font-semibold\">Padrão Ativo</h3>\r\n                  <div className=\"text-sm text-gray-300\">\r\n                    <Skeleton className=\"h-4 w-32\" />\r\n                  </div>\r\n                  <div className=\"space-y-2\">\r\n                    <p className=\"text-xs text-gray-400\">Números Indicados</p>\r\n                    <div className=\"flex flex-wrap gap-1\">\r\n                      {Array.from({ length: 6 }).map((_, index) => (\r\n                        <Skeleton key={index} className=\"w-8 h-8 rounded-full\" />\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"space-y-1\">\r\n                    <p className=\"text-xs text-gray-400\">Confiança</p>\r\n                    <div className=\"text-lg font-bold\">\r\n                      <Skeleton className=\"h-6 w-12\" />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Tempo para Ação - Skeleton */}\r\n                <div className=\"space-y-3\">\r\n                  <h4 className=\"text-sm font-medium text-gray-300\">Tempo para Ação</h4>\r\n                  <div className=\"text-center\">\r\n                    <div className=\"text-3xl font-bold mb-2\">\r\n                      <Skeleton className=\"h-10 w-16 mx-auto\" />\r\n                    </div>\r\n                    <Progress value={0} className=\"h-2 bg-gray-700\" />\r\n                  </div>\r\n                  <div className=\"space-y-1\">\r\n                    <p className=\"text-xs text-gray-400\">Status da Roleta</p>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <div className=\"w-2 h-2 bg-green-400 rounded-full\"></div>\r\n                      <span className=\"text-sm\">Online</span>\r\n                      <Skeleton className=\"h-4 w-20\" />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Histórico da Estratégia - Skeleton */}\r\n                <div className=\"space-y-3\">\r\n                  <h4 className=\"text-sm font-medium text-gray-300\">Histórico da Estratégia</h4>\r\n                  <div className=\"grid grid-cols-2 gap-4\">\r\n                    <div className=\"text-center\">\r\n                      <p className=\"text-xs text-gray-400\">Assertividade</p>\r\n                      <div className=\"text-lg font-bold\">\r\n                        <Skeleton className=\"h-6 w-10 mx-auto\" />\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"text-center\">\r\n                      <p className=\"text-xs text-gray-400\">Sinais Hoje</p>\r\n                      <div className=\"text-lg font-bold\">\r\n                        <Skeleton className=\"h-6 w-8 mx-auto\" />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Botão Aplicar Aposta - Skeleton */}\r\n                <div className=\"flex flex-col justify-center\">\r\n                  <Button \r\n                    size=\"lg\" \r\n                    disabled\r\n                    className=\"bg-gray-600 text-gray-400 font-semibold py-3 px-6 rounded-lg cursor-not-allowed\"\r\n                  >\r\n                    <ExternalLink className=\"w-5 h-5 mr-2\" />\r\n                    Carregando...\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        ) : activeSignal ? (\r\n          <Card className=\"bg-gradient-to-r from-gray-800 to-gray-900 border-gray-700 text-white\">\r\n            <CardContent className=\"p-6\">\r\n              <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6\">\r\n                {/* Estratégia e Números */}\r\n                <div className=\"space-y-3\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Badge variant=\"secondary\" className=\"bg-green-600 text-white border-green-500\">\r\n                       <div className=\"w-2 h-2 bg-green-300 rounded-full mr-1 animate-pulse\"></div>\r\n                       Ao Vivo\r\n                     </Badge>\r\n                  </div>\r\n                  <h3 className=\"text-lg font-semibold\">Padrão Ativo</h3>\r\n                  <p className=\"text-sm text-gray-300\">\r\n                     Estratégia: {activeSignal.strategy_name || activeSignal.strategy_id}\r\n                   </p>\r\n                  <div className=\"space-y-2\">\r\n                     <p className=\"text-xs text-gray-400\">Números Indicados</p>\r\n                     <div className=\"flex flex-wrap gap-1\">\r\n                       {(() => {\r\n                         // Processar bet_numbers para exibir APENAS números válidos (0-36)\r\n                         let numbers: number[] = [];\r\n                         \r\n                         // Usar bet_numbers ou suggested_bets como fallback\r\n                         const betsArray = activeSignal.bet_numbers || activeSignal.suggested_bets;\r\n                         \r\n                         if (Array.isArray(betsArray)) {\r\n                           // Se é array, processar cada item\r\n                           betsArray.forEach(bet => {\r\n                             if (typeof bet === 'string') {\r\n                               // Se é string, pode ser \"1,2,3\" ou um número individual\r\n                               if (bet.includes(',')) {\r\n                                 // String com números separados por vírgula\r\n                                 const nums = bet.split(',').map(n => n.trim());\r\n                                 nums.forEach(num => {\r\n                                   const parsedNum = Number(num);\r\n                                   if (!isNaN(parsedNum) && parsedNum >= 0 && parsedNum <= 36) {\r\n                                     numbers.push(parsedNum);\r\n                                   }\r\n                                 });\r\n                               } else {\r\n                                 // Verificar se é um número válido\r\n                                 const parsedNum = Number(bet);\r\n                                 if (!isNaN(parsedNum) && parsedNum >= 0 && parsedNum <= 36) {\r\n                                   numbers.push(parsedNum);\r\n                                 }\r\n                               }\r\n                             } else if (typeof bet === 'number') {\r\n                               // Se é número, verificar se está no range válido\r\n                               if (bet >= 0 && bet <= 36) {\r\n                                 numbers.push(bet);\r\n                               }\r\n                             }\r\n                           });\r\n                         }\r\n                         \r\n                         // Remover duplicatas e limitar a 12 números\r\n                         const uniqueNumbers = Array.from(new Set(numbers)).slice(0, 12);\r\n                         \r\n                         return uniqueNumbers.map((number, index) => {\r\n                           // Definir cor baseada nas regras da roleta\r\n                           let bgColor;\r\n                           \r\n                           // Verde: 0\r\n                           if (number === 0) {\r\n                             bgColor = 'bg-green-600';\r\n                           }\r\n                           // Vermelho: números específicos\r\n                           else if ([1, 3, 5, 7, 9, 12, 14, 16, 18, 19, 21, 23, 25, 27, 30, 32, 34, 36].includes(number)) {\r\n                             bgColor = 'bg-red-600';\r\n                           }\r\n                           // Preto: todos os outros números\r\n                           else {\r\n                             bgColor = 'bg-black';\r\n                           }\r\n                           \r\n                           return (\r\n                             <div \r\n                               key={index} \r\n                               className={`w-8 h-8 ${bgColor} text-white text-xs font-bold rounded-full flex items-center justify-center`}\r\n                             >\r\n                               {number}\r\n                             </div>\r\n                           );\r\n                         });\r\n                       })()} \r\n                     </div>\r\n                   </div>\r\n                  <div className=\"space-y-1\">\r\n                    <p className=\"text-xs text-gray-400\">Confiança</p>\r\n                    <p className=\"text-lg font-bold\">\r\n                      {(() => {\r\n                        // Se confidence_level é um número válido, usar ele\r\n                         if (typeof activeSignal.confidence_level === 'number' && activeSignal.confidence_level > 0) {\r\n                           // Se o valor já está em porcentagem (>1), usar direto, senão multiplicar por 100\r\n                           const percentage = activeSignal.confidence_level > 1 ? activeSignal.confidence_level : activeSignal.confidence_level * 100;\r\n                           return `${percentage.toFixed(0)}%`;\r\n                         }\r\n                         // Se não há confidence_level válido, tentar converter confidence_level\r\n                        if (activeSignal.confidence_level) {\r\n                          if (activeSignal.confidence_level >= 80) return '85%';\r\n                          if (activeSignal.confidence_level >= 60) return '65%';\r\n                          if (activeSignal.confidence_level >= 40) return '45%';\r\n                          return '20%';\r\n                        }\r\n                        return '0%';\r\n                      })()} \r\n                    </p>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Tempo para Ação */}\r\n                <div className=\"space-y-3\">\r\n                  <h4 className=\"text-sm font-medium text-gray-300\">Tempo para Ação</h4>\r\n                  <div className=\"text-center\">\r\n                    <div className={`text-3xl font-bold mb-2 transition-colors duration-300 ${\r\n                      countdown <= 0 ? 'text-red-400' : countdown <= 30 ? 'text-yellow-400' : 'text-white'\r\n                    }`}>\r\n                      {countdown <= 0 ? 'EXPIRADO' : `${Math.floor(countdown / 60)}:${(countdown % 60).toString().padStart(2, '0')}`}\r\n                    </div>\r\n                    <div className=\"relative\">\r\n                      <Progress \r\n                         value={progressValue} \r\n                         className={`h-3 bg-gray-700 transition-all duration-300 ${\r\n                           countdown <= 0 ? 'opacity-100' : 'opacity-90'\r\n                         }`}\r\n                       />\r\n                       {/* Overlay vermelho quando expirado */}\r\n                       {countdown <= 0 && (\r\n                         <div className=\"absolute inset-0 bg-red-500 rounded-full opacity-80 animate-pulse\"></div>\r\n                       )}\r\n                       {/* Indicador de urgência quando restam poucos segundos */}\r\n                       {countdown > 0 && countdown <= 30 && (\r\n                         <div className=\"absolute inset-0 bg-yellow-500 rounded-full opacity-20 animate-pulse\"></div>\r\n                       )}\r\n                    </div>\r\n                    {/* Status do tempo */}\r\n                    <div className={`text-xs mt-2 font-medium transition-colors duration-300 ${\r\n                      countdown <= 0 ? 'text-red-400' : countdown <= 30 ? 'text-yellow-400' : 'text-gray-400'\r\n                    }`}>\r\n                      {countdown <= 0 ? 'Sinal expirado' : countdown <= 30 ? 'Últimos segundos!' : 'Tempo disponível'}\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"space-y-1\">\r\n                    <p className=\"text-xs text-gray-400\">Status da Roleta</p>\r\n                     <div className=\"flex items-center gap-2\">\r\n                       <div className={`w-2 h-2 rounded-full transition-colors duration-300 ${\r\n                         countdown <= 0 ? 'bg-red-400' : 'bg-green-400'\r\n                       }`}></div>\r\n                       <span className=\"text-sm\">Online</span>\r\n                       <span className=\"text-xs text-gray-400\">\r\n                         {activeSignal.table_id}\r\n                       </span>\r\n                     </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Histórico da Estratégia */}\r\n                <div className=\"space-y-3\">\r\n                  <h4 className=\"text-sm font-medium text-gray-300\">Histórico da Estratégia</h4>\r\n                   <div className=\"grid grid-cols-2 gap-4\">\r\n                     <div className=\"text-center\">\r\n                       <p className=\"text-xs text-gray-400\">Assertividade</p>\r\n                       <p className=\"text-lg font-bold\">\r\n                         {(() => {\r\n                           // Assertividade específica da estratégia ativa\r\n                           const kpi = kpisData.find(k => k.strategy_id === (activeSignal.strategy_name || activeSignal.strategy_id));\r\n                           if (kpi && typeof kpi.assertiveness_rate_percent === 'number' && !isNaN(kpi.assertiveness_rate_percent)) {\r\n                             return `${kpi.assertiveness_rate_percent.toFixed(1)}%`;\r\n                           }\r\n                           // Se não há dados de KPI, mostrar 0% ao invés de N/A\r\n                           return '0%';\r\n                         })()} \r\n                       </p>\r\n                     </div>\r\n                     <div className=\"text-center\">\r\n                       <p className=\"text-xs text-gray-400\">Sinais Hoje</p>\r\n                       <p className=\"text-lg font-bold\">\r\n                         {(() => {\r\n                           const kpi = kpisData.find(k => k.strategy_id === (activeSignal.strategy_name || activeSignal.strategy_id));\r\n                           if (kpi && typeof kpi.total_signals_generated === 'number' && !isNaN(kpi.total_signals_generated)) {\r\n                             return kpi.total_signals_generated.toString();\r\n                           }\r\n                           // Se não há dados de KPI, mostrar 0 ao invés de N/A\r\n                           return '0';\r\n                         })()} \r\n                       </p>\r\n                     </div>\r\n                   </div>\r\n                </div>\r\n\r\n                {/* Botão Ir para a Mesa */}\r\n                <div className=\"flex flex-col justify-center\">\r\n                  <div className=\"relative group\">\r\n                    <Button \r\n                    size=\"lg\" \r\n                    disabled={countdown <= 0}\r\n                    className={`font-semibold py-3 px-6 rounded-lg transition-all duration-200 transform ${\r\n                      countdown <= 0 \r\n                        ? 'bg-gray-600 text-gray-400 cursor-not-allowed opacity-50' \r\n                        : 'bg-green-600 hover:bg-green-500 text-white hover:scale-105'\r\n                    }`}\r\n                    onClick={() => {\r\n                      if (countdown > 0) {\r\n                        setSelectedActiveTable({\r\n                          tableId: activeSignal.table_id || 'pragmatic-mega-roulette',\r\n                          strategyName: activeSignal.strategy_name || activeSignal.strategy_id,\r\n                          suggestedBets: activeSignal.bet_numbers || []\r\n                        });\r\n                      }\r\n                    }}\r\n                  >\r\n                    <Target className=\"w-5 h-5 mr-2\" />\r\n                    {countdown <= 0 ? 'Sinal Expirado' : 'Entrar'}\n                  </Button>\r\n                    <div className=\"mt-2 text-center\">\n                      <button\n                        type=\"button\"\n                        className=\"text-xs text-gray-300 underline underline-offset-4 hover:text-white transition-colors\"\n                        onClick={() => {\n                          if (!activeSignal || !liveSignalsData.length) return;\n                          const currentIndex = liveSignalsData.findIndex(\n                            (signal) => signal.id === activeSignal.id\n                          );\n                          if (currentIndex === -1) return;\n                          const nextIndex = currentIndex + 1;\n                          const nextSignal =\n                            nextIndex < liveSignalsData.length\n                              ? liveSignalsData[nextIndex]\n                              : null;\n                          if (nextSignal) {\n                            setActiveSignal(nextSignal);\n                          } else {\n                            setActiveSignal(null);\n                          }\n                        }}\n                      >\n                        Pular\n                      </button>\n                    </div>\n                    \r\n                    {/* Tooltip com números de aposta */}\r\n                    <div className=\"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10\">\r\n                      <div className=\"text-xs text-gray-300 mb-1\">Apostas Sugeridas:</div>\r\n                      <div className=\"flex gap-1\">\r\n                        {(() => {\r\n                          // Filtrar apenas números válidos (0-36)\r\n                          const validNumbers: number[] = [];\r\n                          \r\n                          const betsArray = activeSignal.bet_numbers || activeSignal.suggested_bets;\r\n                          \r\n                          betsArray?.forEach(bet => {\r\n                            if (typeof bet === 'string') {\r\n                              if (bet.includes(',')) {\r\n                                // String com números separados por vírgula\r\n                                const nums = bet.split(',').map(n => n.trim());\r\n                                nums.forEach(num => {\r\n                                  const parsedNum = Number(num);\r\n                                  if (!isNaN(parsedNum) && parsedNum >= 0 && parsedNum <= 36) {\r\n                                    validNumbers.push(parsedNum);\r\n                                  }\r\n                                });\r\n                              } else {\r\n                                // Verificar se é um número válido\r\n                                const parsedNum = Number(bet);\r\n                                if (!isNaN(parsedNum) && parsedNum >= 0 && parsedNum <= 36) {\r\n                                  validNumbers.push(parsedNum);\r\n                                }\r\n                              }\r\n                            } else if (typeof bet === 'number') {\r\n                              // Se é número, verificar se está no range válido\r\n                              if (bet >= 0 && bet <= 36) {\r\n                                validNumbers.push(bet);\r\n                              }\r\n                            }\r\n                          });\r\n                          \r\n                          // Remover duplicatas e limitar a 5\r\n                          const uniqueNumbers = Array.from(new Set(validNumbers)).slice(0, 5);\r\n                          \r\n                          return (\r\n                            <>\r\n                              {uniqueNumbers.map((number, index) => (\r\n                                <span key={index} className=\"bg-green-600 px-2 py-1 rounded text-xs font-bold\">\r\n                                  {number}\r\n                                </span>\r\n                              ))}\r\n                              {validNumbers.length > 5 && (\r\n                                <span className=\"text-gray-400 text-xs\">+{validNumbers.length - 5}</span>\r\n                              )}\r\n                            </>\r\n                          );\r\n                        })()}\r\n                      </div>\r\n                      {/* Seta do tooltip */}\r\n                      <div className=\"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900\"></div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        ) : (\r\n          <Card className=\"bg-gradient-to-r from-gray-800 to-gray-900 border-gray-700 text-white opacity-50\">\r\n            <CardContent className=\"p-6\">\r\n              <div className=\"text-center space-y-3\">\r\n                <h3 className=\"text-lg font-semibold\">Aguardando Padrão</h3>\r\n                <p className=\"text-sm text-gray-400\">\r\n                  Nenhum padrão ativo no momento. Aguarde a próxima oportunidade.\r\n                </p>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        )}\r\n\r\n        {/* Layout Principal do Dashboard */}\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n              {/* Coluna Esquerda - Padrão Ativo e Estatísticas */}\r\n              <div className=\"lg:col-span-2 space-y-6\">\r\n                {dashboardPreferences.showStatsCards && (\r\n                  <StatsCards \r\n                        kpisData={kpisData} \r\n                        loading={loadingStats} \r\n                        activeSignal={activeSignal}\r\n                        countdown={countdown}\r\n                      />\r\n                )}\r\n                \r\n                {dashboardPreferences.showLiveSignals && (\r\n                  <LiveSignals \r\n                    signals={liveSignalsData} \r\n                    activeSignal={activeSignal} \r\n                    countdown={countdown} \r\n                    progressValue={progressValue} \r\n                    loading={loadingSignals}\r\n                    realtimeStatus={toUiRealtimeStatus(realtimeStatus)}\r\n                    onGoToTable={(signal) => setSelectedActiveTable({\r\n                      tableId: signal.table_id,\r\n                      strategyName: signal.strategy_id,\r\n                      suggestedBets: signal.bet_numbers || []\r\n                    })}\r\n                  />\r\n                )}\r\n                \r\n                {dashboardPreferences.showPerformanceChart && (\r\n                  <PerformanceChart kpisData={kpisData} loading={loadingStats} />\r\n                )}\r\n              </div>\r\n              \r\n              {/* Coluna Direita - Status da Roleta e Atividade Recente */}\r\n              <div className=\"space-y-6\">\r\n                {dashboardPreferences.showRouletteStatus && (\r\n                  <RouletteStatus \r\n                  latestSpin={latestRouletteSpin} \r\n                  rouletteHistoryData={rouletteHistoryData} \r\n                />\r\n                )}\r\n                \r\n                {dashboardPreferences.showRecentActivity && (\r\n                  <RecentActivity \r\n                    signals={liveSignalsData} \r\n                    spins={rouletteHistoryData} \r\n                    loading={loadingStats} \r\n                  />\r\n                )}\r\n              </div>\r\n            </div>\r\n          </>\r\n      </div>\r\n\r\n      {/* Modal da Roleta */}\r\n      <RouletteModal\r\n        isOpen={!!selectedActiveTable}\r\n        onClose={() => setSelectedActiveTable(null)}\r\n        tableId={selectedActiveTable?.tableId || ''}\r\n        strategyName={selectedActiveTable?.strategyName || ''}\r\n        suggestedBets={selectedActiveTable?.suggestedBets || []}\r\n      />\r\n    </DashboardLayout>\r\n  );\r\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/dashboard/page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'activeSignal'. Either include it or remove the dependency array.","line":637,"column":6,"nodeType":"ArrayExpression","endLine":637,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [activeSignal, liveSignalsData]","fix":{"range":[27611,27628],"text":"[activeSignal, liveSignalsData]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchRecentSignals', 'fetchRouletteHistory', 'fetchUserPreferences', 'updateKPIs', and 'updateRouletteStatus'. Either include them or remove the dependency array.","line":789,"column":6,"nodeType":"ArrayExpression","endLine":789,"endColumn":33,"suggestions":[{"desc":"Update the dependencies array to be: [user, isLoading, getToken, fetchUserPreferences, fetchRecentSignals, updateKPIs, fetchRouletteHistory, updateRouletteStatus]","fix":{"range":[33587,33614],"text":"[user, isLoading, getToken, fetchUserPreferences, fetchRecentSignals, updateKPIs, fetchRouletteHistory, updateRouletteStatus]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'motivationalPhrases.length'. Either include it or remove the dependency array.","line":800,"column":6,"nodeType":"ArrayExpression","endLine":800,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [motivationalPhrases.length]","fix":{"range":[33895,33897],"text":"[motivationalPhrases.length]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchRouletteStatus'. Either include it or remove the dependency array.","line":880,"column":6,"nodeType":"ArrayExpression","endLine":880,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [user, getToken, fetchRouletteStatus]","fix":{"range":[36601,36617],"text":"[user, getToken, fetchRouletteStatus]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect, useCallback, useRef } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useAuth } from '@/contexts/auth-context';\nimport { DashboardLayout } from '@/components/dashboard/layout';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { Progress } from '@/components/ui/progress';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Separator } from '@/components/ui/separator';\nimport { LineChart, Line, BarChart, Bar, PieChart, Pie, Cell, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts';\nimport { ArrowRight, ArrowUpRight, Clock, Activity, TrendingUp, BarChart3, Target, AlertTriangle, CheckCircle, ChevronRight, Play, Zap, History, Settings, ExternalLink } from 'lucide-react';\nimport { DashboardSkeleton } from '@/components/dashboard/dashboard-skeleton';\nimport { useDashboardPreferences } from '@/hooks/use-dashboard-preferences';\nimport { withLazyLoading } from '@/components/lazy/lazy-component';\nimport { apiClient } from '@/lib/api-client';\nimport { useRealtimeSignals } from '@/hooks/use-websocket';\nimport { usePerformanceMonitoring, useSmartMemo, useDebounce } from '@/hooks/use-performance';\n\r\n// Componentes lazy\r\nconst LiveSignals = withLazyLoading(() => import('@/components/dashboard/live-signals'));\r\nconst StatsCards = withLazyLoading(() => import('@/components/dashboard/stats-cards'));\r\nconst PerformanceChart = withLazyLoading(() => import('@/components/dashboard/performance-chart'));\r\nconst RouletteStatus = withLazyLoading(() => import('@/components/dashboard/roulette-status'));\r\nconst RecentActivity = withLazyLoading(() => import('@/components/dashboard/recent-activity'));\r\nconst RouletteModal = withLazyLoading(() => import('@/components/dashboard/roulette-modal'));\r\n\r\n// Definição de Tipos para os dados do Backend\r\ninterface GeneratedSignal {\r\n  id: string;\r\n  strategy_name: string;\r\n  table_id: string;\r\n  suggested_bets: (string | number)[];\r\n  suggested_units: number;\r\n  confidence_level: number;\r\n  confidence_score?: number;\r\n  confidence_factors?: {\r\n    strategy_performance: number;\r\n    table_performance: number;\r\n    pattern_strength: number;\r\n    data_volume: number;\r\n    time_factor: number;\r\n    consistency: number;\r\n  };\r\n  timestamp_generated: string;\r\n  expires_at: string;\r\n  is_validated: boolean;\r\n  type: string;\r\n  message: string;\r\n  // Campos compatíveis com o componente LiveSignals\r\n  strategy_id: string;\r\n  bet_numbers: (string | number)[];\r\n  expected_return: number;\r\n  status: string;\r\n}\r\n\r\ninterface RouletteSpin {\r\n  id: string;\r\n  table_id: string;\r\n  spin_number: number;\r\n  spin_timestamp: string;\r\n}\r\n\r\ninterface KpiData {\r\n  strategy_id: string;\r\n  total_signals_generated: number;\r\n  successful_signals: number;\r\n  failed_signals: number;\r\n  assertiveness_rate_percent: number;\r\n  total_net_profit_loss: number;\r\n  last_updated: string;\r\n}\r\n\r\n// Dados dinâmicos baseados no backend\r\n\r\nexport default function DashboardPage() {\n  const router = useRouter();\n  const { user, isLoading, getToken } = useAuth();\n  const { preferences: dashboardPreferences, loading: preferencesLoading } = useDashboardPreferences();\r\n  const [currentPhraseIndex, setCurrentPhraseIndex] = useState(0);\r\n  const [showActivateDialog, setShowActivateDialog] = useState(false);\r\n  const [selectedActiveTable, setSelectedActiveTable] = useState<{ tableId: string; strategyName: string; suggestedBets: (string | number)[] } | null>(null);\r\n  const [connectionStatus, setConnectionStatus] = useState<'connected' | 'disconnected' | 'reconnecting'>('connected');\r\n  const lastActivityRef = useRef<number>(Date.now());\r\n  const loadedUserRef = useRef<string | null>(null);\r\n  // Assinar sinais em tempo real e filtrar por mesa ativa (se houver)\r\n  const { signals: realtimeSignals, status: realtimeStatus } = useRealtimeSignals({ \r\n    limit: 50,\r\n    tableId: selectedActiveTable?.tableId,\r\n    batchMs: 500\r\n  });\r\n\r\n  // Mapear status do realtime para os valores esperados pelo UI\r\n  type UiRealtimeStatus = 'connected' | 'reconnecting' | 'disconnected';\r\n  const toUiRealtimeStatus = (status?: string): UiRealtimeStatus | undefined => {\r\n    if (!status) return undefined;\r\n    if (status === 'connected') return 'connected';\r\n    if (status === 'connecting' || status === 'reconnecting') return 'reconnecting';\r\n    return 'disconnected';\r\n  };\r\n\r\n  // Frases motivacionais reais sobre estratégias de roleta\r\n  const motivationalPhrases = [\r\n    \"Disciplina e gestão de banca são fundamentais para o sucesso sustentável\",\r\n    \"Análise de padrões históricos aumenta significativamente suas chances\",\r\n    \"Nunca aposte mais do que pode perder - preserve seu capital\",\r\n    \"Estratégias baseadas em dados superam intuição a longo prazo\",\r\n    \"Mantenha controle emocional - decisões racionais geram melhores resultados\",\r\n    \"Diversifique suas estratégias para reduzir riscos concentrados\",\r\n    \"Acompanhe suas estatísticas para identificar padrões de sucesso\",\r\n    \"Paciência é uma virtude - aguarde os melhores momentos para apostar\"\r\n  ];\r\n\r\n  // Frases de boas-vindas diárias\r\n  const welcomePhrases = [\r\n    \"virar a sorte!\",\r\n    \"desafiar a roleta!\",\r\n    \"girar com ousadia.\",\r\n    \"apostar com confiança.\",\r\n    \"seguir sua intuição.\",\r\n    \"mudar seu destino.\",\r\n    \"mostrar quem manda na roleta.\",\r\n    \"sentir a adrenalina do giro.\",\r\n    \"vencer com estilo.\",\r\n    \"confiar na sua sorte.\",\r\n    \"testar sua estratégia.\",\r\n    \"acertar aquele número premiado.\",\r\n    \"dar um show na roleta.\",\r\n    \"surpreender a banca!\",\r\n    \"girar até ganhar!\",\r\n    \"fazer história no jogo.\",\r\n    \"mostrar que você domina o jogo.\",\r\n    \"buscar aquele giro perfeito.\",\r\n    \"deixar a sorte falar mais alto.\",\r\n    \"fazer a roleta sorrir pra você.\",\r\n    \"dar aquele giro maroto.\",\r\n    \"mostrar que número quente é com você.\",\r\n    \"dar o famoso \\\"giro da virada\\\".\",\r\n    \"virar o jogo a seu favor.\",\r\n    \"jogar com coragem e estratégia.\",\r\n    \"fazer a sorte acontecer.\",\r\n    \"transformar giros em vitórias.\",\r\n    \"mostrar que ninguém segura sua maré de sorte.\",\r\n    \"reinar absoluto na roleta.\",\r\n    \"mostrar quem manda na mesa.\",\r\n    \"girar como um verdadeiro mestre.\",\r\n    \"fazer a banca tremer!\",\r\n    \"deixar sua marca no jogo.\"\r\n  ];\r\n\r\n  // Função para obter a frase do dia baseada na data\r\n  const getDailyWelcomeMessage = () => {\r\n    const today = new Date();\r\n    const dayOfYear = Math.floor((today.getTime() - new Date(today.getFullYear(), 0, 0).getTime()) / (1000 * 60 * 60 * 24));\r\n    const phraseIndex = dayOfYear % welcomePhrases.length;\r\n    \r\n    const options: Intl.DateTimeFormatOptions = {\r\n      weekday: 'long',\r\n      day: 'numeric',\r\n      month: 'long',\r\n      year: 'numeric'\r\n    };\r\n    \r\n    const formattedDate = today.toLocaleDateString('pt-BR', options);\r\n    const userMetadata = user as any;\r\n    const firstName = userMetadata?.user_metadata?.first_name || userMetadata?.user_metadata?.name?.split(' ')[0] || 'Usuário';\r\n    \r\n    return {\r\n      greeting: `Olá, ${firstName}! Hoje é ${formattedDate}, dia de ${welcomePhrases[phraseIndex]}`,\r\n      firstName\r\n    };\r\n  };\r\n\r\n  // Estados para dados reais do backend\r\n  const [liveSignalsData, setLiveSignalsData] = useState<GeneratedSignal[]>([\r\n    // DADOS MOCK TEMPORÁRIOS PARA TESTE\r\n    {\r\n      id: \"1\",\r\n      strategy_name: \"Estratégia Fibonacci Avançada\",\r\n      strategy_id: \"fibonacci-advanced\",\r\n      table_id: \"evolution-double-ball-roulette\",\r\n      suggested_bets: [7, 14, 21, 28, \"Red\", \"1st-12\"],\r\n      bet_numbers: [7, 14, 21, 28, \"Red\", \"1st-12\"],\r\n      suggested_units: 3,\r\n      confidence_level: 85,\r\n      confidence_score: 85,\r\n      confidence_factors: {\r\n        strategy_performance: 0.82,\r\n        table_performance: 0.78,\r\n        pattern_strength: 0.91,\r\n        data_volume: 0.88,\r\n        time_factor: 0.75,\r\n        consistency: 0.83\r\n      },\r\n      timestamp_generated: new Date().toISOString(),\r\n      expires_at: new Date(Date.now() + 60000).toISOString(), // 1 minuto\r\n      expected_return: 125.50,\r\n      is_validated: false,\r\n      type: \"pattern\",\r\n      status: \"active\",\r\n      message: \"Padrão forte detectado nos últimos 15 giros. Sequência de números pares com alta probabilidade.\"\r\n    },\r\n    {\r\n      id: \"2\",\r\n      strategy_name: \"Martingale Modificado\",\r\n      strategy_id: \"martingale-modified\",\r\n      table_id: \"evolution-lightning-roulette\",\r\n      suggested_bets: [0, 32, 15, \"Black\"],\r\n      bet_numbers: [0, 32, 15, \"Black\"],\r\n      suggested_units: 2,\r\n      confidence_level: 65,\r\n      confidence_score: 65,\r\n      timestamp_generated: new Date(Date.now() - 30000).toISOString(), // 30 segundos atrás\r\n      expires_at: new Date(Date.now() + 30000).toISOString(), // 30 segundos\r\n      expected_return: 89.25,\r\n      is_validated: false,\r\n      type: \"progression\",\r\n      status: \"active\",\r\n      message: \"Oportunidade de recuperação identificada. Aposte com cautela.\"\r\n    }\r\n  ]);\r\n  const [latestRouletteSpin, setLatestRouletteSpin] = useState<RouletteSpin | null>(null);\r\n  const [kpisData, setKpisData] = useState<KpiData[]>([]);\r\n  const [rouletteHistoryData, setRouletteHistoryData] = useState<RouletteSpin[]>([]);\r\n  const [activeSignal, setActiveSignal] = useState<GeneratedSignal | null>({\r\n    id: \"1\",\r\n    strategy_name: \"Estratégia Fibonacci Avançada\",\r\n    strategy_id: \"fibonacci-advanced\",\r\n    table_id: \"evolution-double-ball-roulette\",\r\n    suggested_bets: [7, 14, 21, 28, \"Red\", \"1st-12\"],\r\n    bet_numbers: [7, 14, 21, 28, \"Red\", \"1st-12\"],\r\n    suggested_units: 3,\r\n    confidence_level: 85,\r\n    confidence_score: 85,\r\n    confidence_factors: {\r\n      strategy_performance: 0.82,\r\n      table_performance: 0.78,\r\n      pattern_strength: 0.91,\r\n      data_volume: 0.88,\r\n      time_factor: 0.75,\r\n      consistency: 0.83\r\n    },\r\n    timestamp_generated: new Date().toISOString(),\r\n    expires_at: new Date(Date.now() + 60000).toISOString(),\r\n    expected_return: 125.50,\r\n    is_validated: false,\r\n    type: \"pattern\",\r\n    status: \"active\",\r\n    message: \"Padrão forte detectado nos últimos 15 giros. Sequência de números pares com alta probabilidade.\"\r\n  });\r\n  const [countdown, setCountdown] = useState(0);\r\n  const [progressValue, setProgressValue] = useState(0);\r\n  const [loading_data, setLoadingData] = useState(true); // Mantido para compatibilidade, mas não bloqueará tudo\r\n  const [loadingSignals, setLoadingSignals] = useState(true);\r\n  const [loadingStats, setLoadingStats] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [activeRouletteStatus, setActiveRouletteStatus] = useState<{table_id: string, status: string} | null>(null);\r\n  const [monitoredTables, setMonitoredTables] = useState<string[]>([]); // Roletas monitoradas\r\n  const monitoredTablesRef = useRef<string[]>([]); // Ref para evitar re-renders no Realtime\r\n\r\n  const BACKEND_URL = process.env.NEXT_PUBLIC_BACKEND_URL || 'http://localhost:3001';\r\n\r\n  // Helper para headers condicionais ao token (tipado)\r\n  const buildHeaders = (token?: string | null): Record<string, string> => (\r\n    token ? { Authorization: `Bearer ${token}` } : {}\r\n  );\r\n\r\n\r\n  // Função para buscar preferências do usuário (roletas monitoradas)\r\n  const fetchUserPreferences = useCallback(async () => {\r\n    try {\r\n      const token = await getToken();\r\n      const response = await apiClient.get('/user-preferences', {\r\n        headers: buildHeaders(token),\r\n        timeout: 8000,\r\n      });\r\n      const preferences = (response as any)?.data ?? response;\r\n      console.log('✅ Preferências do usuário carregadas:', preferences);\r\n      const tables = Array.isArray(preferences?.tables) ? preferences.tables : (Array.isArray(preferences) ? preferences : []);\r\n      setMonitoredTables(tables);\r\n      return tables;\r\n    } catch (error) {\r\n      console.error('❌ Erro ao buscar preferências:', error);\r\n      return [];\r\n    }\r\n  }, [getToken]);\r\n\r\n  // Mesclar sinais em tempo real com os carregados inicialmente\r\n  useEffect(() => {\r\n    try {\r\n      if (Array.isArray(realtimeSignals) && realtimeSignals.length > 0) {\r\n        setLiveSignalsData((prev) => {\r\n          const existingIds = new Set(prev.map((s) => s.id));\r\n          const normalized = realtimeSignals.map((s) => ({\r\n            id: s.id,\r\n            strategy_name: s.strategy_name,\r\n            strategy_id: s.strategy_id,\r\n            table_id: s.table_id,\r\n            suggested_bets: s.suggested_bets ?? s.bet_numbers ?? [],\r\n            bet_numbers: s.bet_numbers ?? s.suggested_bets ?? [],\r\n            suggested_units: typeof s.suggested_units === 'number' ? s.suggested_units : 1,\r\n            confidence_level: s.confidence_level,\r\n            confidence_score: typeof s.confidence_score === 'number' ? s.confidence_score : s.confidence_level,\r\n            confidence_factors: s.confidence_factors,\r\n            timestamp_generated: s.timestamp_generated,\r\n            expires_at: s.expires_at,\r\n            expected_return: s.expected_return,\r\n            is_validated: false,\r\n            type: 'pattern',\r\n            status: s.status ?? 'active',\r\n            message: s.message ?? ''\r\n          }));\r\n\r\n          const fresh = normalized.filter((s) => !existingIds.has(s.id));\r\n          const merged = [...fresh, ...prev];\r\n          return merged.slice(0, 100);\r\n        });\r\n      }\r\n      // Atualizar status de conexão\r\n      if (realtimeStatus === 'connected') {\r\n        setConnectionStatus('connected');\r\n      } else if (realtimeStatus === 'connecting') {\r\n        setConnectionStatus('reconnecting');\r\n      } else {\r\n        setConnectionStatus('disconnected');\r\n      }\r\n    } catch (e) {\r\n      console.warn('Falha ao mesclar sinais realtime:', e);\r\n    }\r\n  }, [realtimeSignals, realtimeStatus]);\r\n \r\n  // Função para atualizar KPIs periodicamente\r\n  const updateKPIs = useCallback(async () => {\r\n    try {\r\n      const token = await getToken();\r\n      const response = await apiClient.get('/kpis', {\r\n        headers: buildHeaders(token),\r\n        timeout: 12000,\r\n      });\r\n      const rawData = (response as any)?.data ?? response;\r\n      if (!rawData) return;\r\n      const dataArray = Array.isArray(rawData) ? rawData : (rawData.data || []);\r\n      const transformedData: KpiData[] = dataArray.map((item: any) => ({\r\n        strategy_id: item.strategy_id || 'Estratégia Desconhecida',\r\n        total_signals_generated: Number(item.total_signals_generated ?? item.total_activations ?? 0) || 0,\r\n        successful_signals: Number(item.successful_signals ?? item.total_hits ?? 0) || 0,\r\n        failed_signals: Number(item.failed_signals ?? item.total_misses ?? 0) || 0,\r\n        assertiveness_rate_percent: Number(item.assertiveness_rate_percent ?? item.hit_rate ?? 0) || 0,\r\n        total_net_profit_loss: Number(item.total_net_profit_loss ?? item.total_net_payout ?? 0) || 0,\r\n        last_updated: item.last_updated || new Date().toISOString()\r\n      }));\r\n      setKpisData(transformedData);\r\n      console.log('🔄 KPIs atualizados');\r\n    } catch (error) {\r\n      console.error('❌ Erro ao atualizar KPIs:', error);\r\n    }\r\n  }, [getToken]);\r\n \r\n  // Função para atualizar status da roleta\r\n  const updateRouletteStatus = useCallback(async () => {\r\n    try {\r\n      const token = await getToken();\r\n      const response = await apiClient.get('/roulette-status', {\r\n        headers: buildHeaders(token),\r\n        timeout: 10000,\r\n      });\r\n      const statusData = (response as any)?.data ?? response;\r\n      setActiveRouletteStatus(statusData);\r\n      console.log('🔄 Status da roleta atualizado');\r\n    } catch (error) {\r\n      console.error('❌ Erro ao atualizar status da roleta:', error);\r\n    }\r\n  }, [getToken]);\r\n\r\n  // Função para buscar table_ids do backend\r\n  const fetchTableIds = useCallback(async () => {\r\n    console.log('🎯 Iniciando busca de table_ids...');\r\n    try {\r\n      const token = await getToken();\r\n      console.log('🔑 Token para table_ids obtido:', token ? 'Sim' : 'Não');\r\n      \r\n      const response = await apiClient.get('/roulette-tables', {\r\n        headers: buildHeaders(token),\r\n        timeout: 10000,\r\n      });\r\n      const data = (response as any)?.data ?? response;\r\n      console.log('✅ Roulette tables fetched successfully:', data);\r\n      \r\n      let tableIds: string[] = [];\r\n      if (Array.isArray(data)) {\r\n        if (data.length > 0 && typeof data[0] === 'string') {\r\n          tableIds = data as string[];\r\n        } else {\r\n          tableIds = data.map((t: any) => t.table_id || t.id).filter(Boolean);\r\n        }\r\n      } else if (Array.isArray(data?.data)) {\r\n        const arr = data.data;\r\n        tableIds = arr.map((t: any) => t.table_id || t.id).filter(Boolean);\r\n      }\r\n      \r\n      if (tableIds.length === 0) {\r\n        console.warn('⚠️ Nenhum table_id válido encontrado no retorno, usando padrão');\r\n        tableIds = ['mesa1', 'mesa2', 'mesa3'];\r\n      }\r\n      \r\n      console.log('🎯 Table IDs extraídos:', tableIds);\r\n      setMonitoredTables(tableIds);\r\n      return tableIds;\r\n    } catch (error: any) {\r\n      console.error('❌ Erro ao buscar table_ids:', error);\r\n      \r\n      const defaultTables = ['mesa1', 'mesa2', 'mesa3'];\r\n      setMonitoredTables(defaultTables);\r\n      return defaultTables;\r\n    }\r\n  }, [getToken]);\r\n\r\n  // Função para buscar KPIs do backend\r\n  const fetchKpis = useCallback(async () => {\r\n    try {\r\n      const token = await getToken();\r\n      const response = await apiClient.get('/kpis', {\r\n        headers: buildHeaders(token),\r\n        timeout: 12000,\r\n      });\r\n      const rawData = (response as any)?.data ?? response;\r\n      const dataArray = Array.isArray(rawData) ? rawData : (rawData?.data || []);\r\n      const transformedData: KpiData[] = dataArray.map((item: any) => ({\r\n        strategy_id: item.strategy_id || 'Estratégia Desconhecida',\r\n        total_signals_generated: Number(item.total_signals_generated ?? item.total_activations ?? 0) || 0,\r\n        successful_signals: Number(item.successful_signals ?? item.total_hits ?? 0) || 0,\r\n        failed_signals: Number(item.failed_signals ?? item.total_misses ?? 0) || 0,\r\n        assertiveness_rate_percent: Number(item.assertiveness_rate_percent ?? item.hit_rate ?? 0) || 0,\r\n        total_net_profit_loss: Number(item.total_net_profit_loss ?? item.total_net_payout ?? 0) || 0,\r\n        last_updated: item.last_updated || new Date().toISOString()\r\n      }));\r\n      setKpisData(transformedData);\r\n    } catch (error: any) {\r\n      console.error('❌ Erro ao buscar KPIs do backend:', error);\r\n      setKpisData([]);\r\n    }\r\n  }, [getToken]);\r\n\r\n\r\n\r\n  // Função para buscar histórico da roleta do backend\r\n  const fetchRouletteHistory = useCallback(async (table_id: string = 'pragmatic-mega-roulette') => {\r\n    console.log('🔍 Iniciando busca do histórico da roleta...');\r\n    try {\r\n      const token = await getToken();\r\n      console.log('🔑 Token obtido:', token ? 'Sim' : 'Não');\r\n      \r\n      const response = await apiClient.getRouletteHistory(undefined, 100);\r\n      const data: RouletteSpin[] = ((response as any)?.data ?? response) as RouletteSpin[];\r\n      console.log('✅ Roulette history fetched successfully:', data);\r\n      console.log('📊 Número de giros recebidos:', data.length);\r\n      setRouletteHistoryData(data);\r\n      \r\n      if (data.length > 0) {\r\n        setLatestRouletteSpin(data[0]);\r\n        console.log('🎯 Último giro definido:', data[0].spin_number);\r\n      } else {\r\n        console.log('❌ Nenhum giro encontrado no histórico');\r\n      }\r\n    } catch (error) {\r\n      console.error('❌ Erro ao buscar histórico da roleta:', error);\r\n      setError('Não foi possível carregar o histórico da roleta. Verifique a conexão com o backend.');\r\n      setRouletteHistoryData([]);\r\n      setLatestRouletteSpin(null);\r\n    }\r\n  }, [getToken]);\r\n\r\n  // Função para buscar status da roleta ativa\r\n  const fetchRouletteStatus = useCallback(async () => {\r\n    console.log('🔍 Iniciando busca do status da roleta...');\r\n    try {\r\n      const token = await getToken();\r\n      console.log('🔑 Token obtido:', token ? 'Sim' : 'Não');\r\n      \r\n      const response = await apiClient.getRouletteStatus();\r\n      const data = (response as any)?.data ?? response;\r\n      console.log('✅ Roulette status fetched successfully:', data);\r\n      console.log('📊 Tipo de dados retornados:', typeof data, Array.isArray(data) ? 'Array' : 'Object');\r\n      \r\n      if (Array.isArray(data) && data.length > 0) {\r\n        const activeTable = data.find((table: any) => table.status === 'active') || data[0];\r\n        console.log('🎯 Mesa ativa selecionada:', activeTable);\r\n        return activeTable;\r\n      }\r\n      \r\n      return data;\r\n    } catch (error) {\r\n      console.error('❌ Erro ao buscar status da roleta:', error);\r\n      return null;\r\n    }\r\n  }, [getToken]);\r\n\r\n  // Função para buscar padrões recentes\r\n  const fetchRecentSignals = useCallback(async () => {\r\n    console.log('🔍 Iniciando busca de padrões recentes...');\r\n    try {\r\n      const token = await getToken();\r\n      console.log('🔑 Token para padrões obtido:', token ? 'Sim' : 'Não');\r\n      \r\n      const response = await apiClient.getSignalsRecent(undefined, 5);\r\n      const rawDataAny: any = (response as any)?.data ?? response;\r\n      console.log('✅ Recent signals fetched successfully:', rawDataAny);\r\n      \r\n      // Padronizar para array, independente do formato retornado\r\n      let signalsArray: any[] = [];\r\n      try {\r\n        if (Array.isArray(rawDataAny)) {\r\n          signalsArray = rawDataAny;\r\n        } else if (rawDataAny && Array.isArray(rawDataAny.signals)) {\r\n          signalsArray = rawDataAny.signals;\r\n        } else if (rawDataAny && Array.isArray(rawDataAny.items)) {\r\n          signalsArray = rawDataAny.items;\r\n        } else if (rawDataAny && typeof rawDataAny === 'object') {\r\n          const values = Object.values(rawDataAny);\r\n          signalsArray = values.flatMap((v: any) => Array.isArray(v) ? v : []);\r\n        } else {\r\n          signalsArray = [];\r\n        }\r\n      } catch (parseErr) {\r\n        console.warn('Falha ao padronizar dados de sinais recentes:', parseErr);\r\n        signalsArray = [];\r\n      }\r\n      console.log('📊 Número de padrões recebidos:', Array.isArray(signalsArray) ? signalsArray.length : 0);\r\n      \r\n      // Buscar as preferências atuais do usuário para filtrar\r\n      let currentMonitoredTables: string[] = [];\r\n      try {\r\n        const prefsResp = await apiClient.getUserPreferences();\r\n        const preferences = (prefsResp as any)?.data ?? prefsResp;\r\n        currentMonitoredTables = Array.isArray(preferences?.tables) ? preferences.tables : [];\r\n      } catch (error) {\r\n        console.log('⚠️ Usando todas as mesas devido a erro ao buscar preferências:', error);\r\n      }\r\n      \r\n      // Filtrar apenas sinais das roletas monitoradas\r\n      const filteredData = signalsArray.filter((signal: any) => {\r\n        const isMonitored = currentMonitoredTables.length === 0 || currentMonitoredTables.includes(signal.table_id);\r\n        if (!isMonitored) {\r\n          console.log('🚫 Sinal filtrado (roleta não monitorada):', signal.table_id);\r\n        }\r\n        return isMonitored;\r\n      });\r\n      \r\n      console.log('🎯 Sinais filtrados para roletas monitoradas:', filteredData.length, 'de', Array.isArray(signalsArray) ? signalsArray.length : 0);\r\n      console.log('📋 Roletas monitoradas:', currentMonitoredTables);\r\n      console.log('📊 Dados brutos dos sinais:', rawDataAny);\r\n      console.log('🔍 Sinais filtrados:', filteredData);\r\n      \r\n      // Mapear dados para estrutura compatível com LiveSignals\r\n      const mappedData = filteredData.map(signal => ({\r\n        ...signal,\r\n        strategy_id: signal.strategy_name,\r\n        bet_numbers: signal.suggested_bets,\r\n        expected_return: signal.expected_return,\r\n        status: signal.is_validated ? 'validated' : 'pending',\r\n        confidence_level: typeof signal.confidence_level === 'string' ? \r\n          (signal.confidence_level === 'High' ? 85 : signal.confidence_level === 'Medium' ? 65 : 45) : \r\n          signal.confidence_level,\r\n        message: signal.message,\r\n        suggested_bets: signal.suggested_bets,\r\n        confidence_score: signal.confidence_score,\r\n        confidence_factors: signal.confidence_factors\r\n      }));\r\n      \r\n      console.log('🗂️ Dados mapeados:', mappedData);\r\n      \r\n      mappedData.forEach((signal, index) => {\r\n        console.log(`📋 Sinal ${index + 1}:`);\r\n        console.log('  - ID:', signal.id);\r\n        console.log('  - Estratégia:', signal.strategy_name);\r\n        console.log('  - Apostas sugeridas (suggested_bets):', signal.suggested_bets);\r\n        console.log('  - Apostas mapeadas (bet_numbers):', signal.bet_numbers);\r\n        console.log('  - Mensagem:', signal.message);\r\n        console.log('  - Status:', signal.status);\r\n      });\r\n      \r\n      setLiveSignalsData(mappedData);\r\n      \r\n      if (mappedData.length > 0) {\r\n        const mostRecentSignal = mappedData[0];\r\n        setActiveSignal(mostRecentSignal);\r\n        console.log('🎯 Sinal ativo inicial definido:', mostRecentSignal.strategy_id, 'ID:', mostRecentSignal.id);\r\n        console.log('🔢 Apostas do sinal ativo:', mostRecentSignal.bet_numbers);\r\n        console.log('📝 Estratégia do sinal ativo:', mostRecentSignal.strategy_name);\r\n        \r\n        if (mostRecentSignal.expires_at) {\r\n          const now = new Date().getTime();\r\n          const expiresAt = new Date(mostRecentSignal.expires_at).getTime();\r\n          const timeLeft = Math.max(0, Math.floor((expiresAt - now) / 1000));\r\n          setCountdown(timeLeft);\r\n          console.log('⏰ Countdown inicial definido:', timeLeft, 'segundos');\r\n        } else {\r\n          setCountdown(0);\r\n          console.log('⏰ Nenhum expires_at no sinal inicial, countdown = 0');\r\n        }\r\n      } else {\r\n        setActiveSignal(null);\r\n        setCountdown(0);\r\n        console.log('❌ Nenhum sinal encontrado, activeSignal = null');\r\n      }\r\n    } catch (error: any) {\r\n      console.error('❌ Erro ao buscar sinais recentes:', error);\r\n      setError(error?.message?.includes('TIMEOUT') ? 'Timeout na conexão com o servidor' : 'Sistema temporariamente indisponível');\r\n      setLiveSignalsData([]);\r\n      setActiveSignal(null);\r\n      setCountdown(0);\r\n    }\r\n  }, [getToken]);\r\n\r\n  // Efeito para sincronizar activeSignal com o primeiro sinal da lista\r\n  useEffect(() => {\r\n    if (liveSignalsData.length > 0 && !activeSignal) {\r\n      const mostRecentSignal = liveSignalsData[0];\r\n      setActiveSignal(mostRecentSignal);\r\n      console.log('🔄 Sincronizando activeSignal com primeiro sinal da lista:', mostRecentSignal.strategy_id);\r\n      \r\n      // Calcular countdown\r\n      if (mostRecentSignal.expires_at) {\r\n        const now = new Date().getTime();\r\n        const expiresAt = new Date(mostRecentSignal.expires_at).getTime();\r\n        const timeLeft = Math.max(0, Math.floor((expiresAt - now) / 1000));\r\n        setCountdown(timeLeft);\r\n      } else {\r\n        setCountdown(0);\r\n      }\r\n    }\r\n  }, [liveSignalsData]); // Removido activeSignal das dependências para evitar loop infinito\r\n\r\n  // Sincronizar estado com ref para evitar re-renders no Realtime\r\n  useEffect(() => {\r\n    monitoredTablesRef.current = monitoredTables;\r\n  }, [monitoredTables]);\r\n\r\n  // Guard de autenticação para redirecionar usuários não logados\n  useEffect(() => {\n    if (!isLoading && !user) {\n      router.replace('/login');\n    }\n  }, [user, isLoading, router]);\n\n  // Efeito para carregar dados iniciais do backend\n  useEffect(() => {\r\n    console.log('🔄 useEffect executado - carregando dados reais!');\r\n    console.log('👤 User:', user);\r\n    console.log('⏳ isLoading:', isLoading);\r\n    \r\n    if (user && !isLoading) {\r\n      console.log('✅ Condições atendidas - iniciando carregamento de dados reais...');\r\n      \r\n      const loadInitialData = async () => {\r\n          // Não bloquear a interface inteira com loading_data\r\n          setLoadingData(false);\r\n          setLoadingSignals(true);\r\n          setLoadingStats(true);\r\n          setError(null);\r\n          \r\n          try {\r\n            console.log('🚀 Iniciando carregamento otimizado de dados (Paralelo)...');\r\n            console.log('👤 Usuário logado:', user?.email);\r\n            \r\n            const token = await getToken();\r\n            const isMock = (process.env.NEXT_PUBLIC_USE_MOCK_DATA === 'true') || (process.env.USE_MOCK_DATA === 'true');\r\n            \r\n            if (!token && !isMock) {\r\n              setConnectionStatus('disconnected');\r\n              setError('Sessão não autenticada. Faça login para dados reais.');\r\n              console.log('ℹ️ Prosseguindo sem token, evitando interrupção do carregamento inicial');\r\n            }\r\n            \r\n            // 1. Carregar Preferências (Rápido e importante)\r\n            try {\r\n              if (!isMock) {\r\n                await fetchUserPreferences();\r\n              }\r\n            } catch (prefError) {\r\n              console.warn('⚠️ Erro ao carregar preferências:', prefError);\r\n            }\r\n\r\n            // 2. Carregar Sinais (Pode ser lento - isolado)\r\n            const loadSignals = async () => {\r\n              console.log('🎯 Iniciando carga de sinais...');\r\n              try {\r\n                if (!isMock) {\r\n                  await fetchRecentSignals();\r\n                }\r\n              } catch (signalsError: any) {\r\n                console.warn('⚠️ Erro ao carregar sinais:', signalsError?.message || signalsError);\r\n              } finally {\r\n                setLoadingSignals(false);\r\n                console.log('🏁 Carga de sinais finalizada');\r\n              }\r\n            };\r\n\r\n            // 3. Carregar Estatísticas e Histórico (Isolado)\r\n            const loadStats = async () => {\r\n              console.log('📊 Iniciando carga de estatísticas...');\r\n              try {\r\n                const secondaryPromises = [\r\n                  !isMock ? updateKPIs() : Promise.resolve(),\r\n                  !isMock ? fetchRouletteHistory() : Promise.resolve(),\r\n                  !isMock ? updateRouletteStatus() : Promise.resolve()\r\n                ];\r\n                await Promise.allSettled(secondaryPromises);\r\n              } catch (statsError) {\r\n                console.error('❌ Erro ao carregar estatísticas:', statsError);\r\n              } finally {\r\n                setLoadingStats(false);\r\n                console.log('🏁 Carga de estatísticas finalizada');\r\n              }\r\n            };\r\n\r\n            // Disparar carregamentos em paralelo\r\n            loadSignals();\r\n            loadStats();\r\n            \r\n          } catch (error) {\r\n            console.error('❌ Erro geral ao iniciar carregamento:', error);\r\n            setError('Erro ao conectar com o servidor. Verifique sua conexão.');\r\n            setLoadingSignals(false);\r\n            setLoadingStats(false);\r\n          }\r\n        };\r\n\r\n      if (loadedUserRef.current !== user.email) {\r\n        loadedUserRef.current = user.email || '';\r\n        loadInitialData();\r\n      } else {\r\n        console.log('🔄 Usuário já carregado, atualizando dados silenciosamente...');\r\n        fetchRecentSignals();\r\n        updateKPIs();\r\n        fetchRouletteHistory();\r\n        updateRouletteStatus();\r\n      }\r\n\r\n      // Configurar polling para atualizações em tempo real\r\n      console.log('🔄 Configurando polling para atualizações...');\r\n      setConnectionStatus((s) => s);\r\n      \r\n      // Polling para sinais recentes\r\n      const pollSignals = async () => {\r\n        try {\r\n          await fetchRecentSignals();\r\n          setConnectionStatus('connected');\r\n          lastActivityRef.current = Date.now();\r\n        } catch (error) {\r\n          console.error('❌ Erro ao buscar sinais:', error);\r\n        }\r\n      };\r\n      \r\n      // Polling para histórico de roleta\r\n      const pollRouletteHistory = async () => {\r\n        try {\r\n          await fetchRouletteHistory();\r\n        } catch (error) {\r\n          console.error('❌ Erro ao buscar histórico de roleta:', error);\r\n        }\r\n      };\r\n      \r\n      // Executar polling inicial (já coberto pelo loadInitialData, mas mantendo lógica original se necessário)\r\n      // pollSignals(); // Comentado pois loadInitialData já chama\r\n      // pollRouletteHistory(); // Comentado pois loadInitialData já chama\r\n      \r\n      // Configurar intervalos de polling\r\n      const signalsInterval = setInterval(pollSignals, 5000); // A cada 5 segundos\r\n      const rouletteInterval = setInterval(pollRouletteHistory, 10000); // A cada 10 segundos\r\n\r\n      // Cleanup function\r\n      return () => {\r\n        console.log('🧹 Cleanup - removing polling intervals...');\r\n        clearInterval(signalsInterval);\r\n        clearInterval(rouletteInterval);\r\n        console.log('🧹 Cleanup completed successfully');\r\n      };\r\n    } else {\r\n      console.log('❌ Condições não atendidas para carregar dados:');\r\n      console.log('   - User existe:', !!user);\r\n      console.log('   - Loading:', isLoading);\r\n    }\r\n  }, [user, isLoading, getToken]);\r\n\r\n  // Rotação das frases motivacionais\r\n  useEffect(() => {\r\n    const interval = setInterval(() => {\r\n      setCurrentPhraseIndex((prevIndex) =>\r\n        (prevIndex + 1) % motivationalPhrases.length\r\n      );\r\n    }, 8000);\r\n\r\n    return () => clearInterval(interval);\r\n  }, []);\r\n\r\n  // Atualizações periódicas de dados\r\n  useEffect(() => {\r\n    if (user && !isLoading) {\r\n      // Atualizar KPIs a cada 5 minutos\r\n      const kpisInterval = setInterval(() => {\r\n        updateKPIs();\r\n      }, 5 * 60 * 1000);\r\n\r\n      // Atualizar status da roleta a cada 60 segundos\r\n      const statusInterval = setInterval(() => {\r\n        updateRouletteStatus();\r\n      }, 60 * 1000);\r\n\r\n      return () => {\r\n        clearInterval(kpisInterval);\r\n        clearInterval(statusInterval);\r\n      };\r\n    }\r\n  }, [user, isLoading, updateKPIs, updateRouletteStatus]);\r\n\r\n  // Contagem regressiva do sinal ativo baseada em expires_at\r\n  useEffect(() => {\r\n    if (activeSignal && activeSignal.expires_at) {\r\n      const updateCountdown = () => {\r\n        const now = new Date().getTime();\r\n        const expiresAt = new Date(activeSignal.expires_at).getTime();\r\n        const createdAt = new Date(activeSignal.timestamp_generated).getTime();\r\n        const timeLeft = Math.max(0, Math.floor((expiresAt - now) / 1000));\r\n        \r\n        setCountdown(timeLeft);\r\n        \r\n        // Calcular progresso da barra (começa em 100% e diminui até 0%)\r\n        // Usar uma duração padrão de 5 minutos (300 segundos) se não conseguir calcular a duração total\r\n        const totalDuration = expiresAt - createdAt;\r\n        let progress = 0;\r\n        \r\n        if (totalDuration > 0) {\r\n          const remaining = Math.max(0, expiresAt - now);\r\n          progress = Math.max(0, Math.min(100, (remaining / totalDuration) * 100));\r\n        } else {\r\n           // Fallback: assumir duração de 60 segundos (mais realista para roleta) e calcular baseado no countdown\r\n           const assumedDuration = 60; // 60 segundos (1 minuto)\r\n           progress = Math.max(0, Math.min(100, (timeLeft / assumedDuration) * 100));\r\n         }\r\n        \r\n        setProgressValue(progress);\r\n        \r\n        if (timeLeft === 0) {\r\n          setActiveSignal(null);\r\n          setProgressValue(0);\r\n        }\r\n      };\r\n      \r\n      updateCountdown();\r\n      const interval = setInterval(updateCountdown, 1000);\r\n      \r\n      return () => clearInterval(interval);\r\n    } else {\r\n      setCountdown(0);\r\n      setProgressValue(0);\r\n    }\r\n  }, [activeSignal]);\r\n\r\n  // Atualização periódica do status da roleta\r\n  useEffect(() => {\r\n    if (user) {\r\n      const updateRouletteStatus = async () => {\r\n        const status = await fetchRouletteStatus();\r\n        if (status) {\r\n          setActiveRouletteStatus(status);\r\n        }\r\n      };\r\n      \r\n      // Atualizar a cada 60 segundos\r\n      const interval = setInterval(updateRouletteStatus, 60000);\r\n      \r\n      return () => clearInterval(interval);\r\n    }\r\n  }, [user, getToken]); // Removida fetchRouletteStatus das dependências\r\n\r\n  if (isLoading) {\n    console.log('⏳ Dashboard em estado de carregamento...');\n    return (\n      <DashboardLayout>\n        <DashboardSkeleton />\n      </DashboardLayout>\n    );\n  }\n\r\n  return (\r\n    <DashboardLayout>\r\n      <div className=\"flex flex-col gap-6\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div className=\"flex items-center gap-4\">\r\n            <h1 className=\"text-3xl font-bold tracking-tight font-heading\">Dashboard</h1>\r\n            {/* Indicador de Status da Conexão */}\r\n            <div className=\"flex items-center gap-2\">\r\n              <div className={`w-2 h-2 rounded-full ${\r\n                connectionStatus === 'connected' ? 'bg-green-500' :\r\n                connectionStatus === 'reconnecting' ? 'bg-yellow-500 animate-pulse' :\r\n                'bg-red-500'\r\n              }`} />\r\n              <span className={`text-sm ${\r\n                connectionStatus === 'connected' ? 'text-green-600' :\r\n                connectionStatus === 'reconnecting' ? 'text-yellow-600' :\r\n                'text-red-600'\r\n              }`}>\r\n                {connectionStatus === 'connected' ? 'Conectado' :\r\n                 connectionStatus === 'reconnecting' ? 'Reconectando...' :\r\n                 'Desconectado'}\r\n              </span>\r\n            </div>\r\n          </div>\r\n          <div className=\"flex gap-2\">\r\n            <Button variant=\"outline\" className=\"gap-2\">\r\n              <History className=\"h-4 w-4\" />\r\n              Ver Histórico\r\n            </Button>\r\n            <Dialog open={showActivateDialog} onOpenChange={setShowActivateDialog}>\r\n              <DialogTrigger asChild>\r\n                <Button className=\"gap-2\">\r\n                  <Play className=\"h-4 w-4\" />\r\n                  Ativar Estratégia\r\n                </Button>\r\n              </DialogTrigger>\r\n              <DialogContent>\r\n                <DialogHeader>\r\n                  <DialogTitle>Ativar Nova Estratégia</DialogTitle>\r\n                  <DialogDescription>\r\n                    Selecione a estratégia que deseja ativar e configure os parâmetros.\r\n                  </DialogDescription>\r\n                </DialogHeader>\r\n                <div className=\"grid gap-4 py-4\">\r\n                  <div className=\"space-y-2\">\r\n                    <h4 className=\"font-medium\">Estratégia</h4>\r\n                    <Select defaultValue=\"fibonacci\">\r\n                      <SelectTrigger>\r\n                        <SelectValue placeholder=\"Selecione uma estratégia\" />\r\n                      </SelectTrigger>\r\n                      <SelectContent>\r\n                        {kpisData.map((kpi) => (\r\n                          <SelectItem key={kpi.strategy_id} value={kpi.strategy_id}>\r\n                      {kpi.strategy_id}\r\n                          </SelectItem>\r\n                        ))}\r\n                      </SelectContent>\r\n                    </Select>\r\n                  </div>\r\n                </div>\r\n                <DialogFooter>\r\n                  <Button variant=\"outline\" onClick={() => setShowActivateDialog(false)}>\r\n                    Cancelar\r\n                  </Button>\r\n                  <Button onClick={() => setShowActivateDialog(false)}>\r\n                    Ativar\r\n                  </Button>\r\n                </DialogFooter>\r\n              </DialogContent>\r\n            </Dialog>\r\n          </div>\r\n        </div>\r\n\r\n\r\n        {/* Carregamento inicial não bloqueante */}\r\n        <>\r\n          {/* Informações Dinâmicas */}\r\n            <Card className=\"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-950/20 dark:to-indigo-950/20 border-blue-200 dark:border-blue-800\">\r\n              <CardContent className=\"p-4\">\r\n                <div className=\"flex items-center gap-3\">\r\n                  <div className=\"p-2 bg-blue-100 dark:bg-blue-900 rounded-full\">\r\n                    <Zap className=\"h-5 w-5 text-blue-600 dark:text-blue-400\" />\r\n                  </div>\r\n                  <p className=\"text-sm text-blue-800 dark:text-blue-200 font-medium\">\r\n                    {motivationalPhrases[currentPhraseIndex]}\r\n                  </p>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n\r\n        {/* Seção Padrão Ativo */}\r\n        {loadingSignals ? (\r\n          <Card className=\"bg-gradient-to-r from-gray-800 to-gray-900 border-gray-700 text-white\">\r\n            <CardContent className=\"p-6\">\r\n              <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6\">\r\n                {/* Estratégia e Números - Skeleton */}\r\n                <div className=\"space-y-3\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Badge variant=\"secondary\" className=\"bg-green-600 text-white border-green-500\">\r\n                       <div className=\"w-2 h-2 bg-green-300 rounded-full mr-1 animate-pulse\"></div>\r\n                       Ao Vivo\r\n                     </Badge>\r\n                  </div>\r\n                  <h3 className=\"text-lg font-semibold\">Padrão Ativo</h3>\r\n                  <div className=\"text-sm text-gray-300\">\r\n                    <Skeleton className=\"h-4 w-32\" />\r\n                  </div>\r\n                  <div className=\"space-y-2\">\r\n                    <p className=\"text-xs text-gray-400\">Números Indicados</p>\r\n                    <div className=\"flex flex-wrap gap-1\">\r\n                      {Array.from({ length: 6 }).map((_, index) => (\r\n                        <Skeleton key={index} className=\"w-8 h-8 rounded-full\" />\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"space-y-1\">\r\n                    <p className=\"text-xs text-gray-400\">Confiança</p>\r\n                    <div className=\"text-lg font-bold\">\r\n                      <Skeleton className=\"h-6 w-12\" />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Tempo para Ação - Skeleton */}\r\n                <div className=\"space-y-3\">\r\n                  <h4 className=\"text-sm font-medium text-gray-300\">Tempo para Ação</h4>\r\n                  <div className=\"text-center\">\r\n                    <div className=\"text-3xl font-bold mb-2\">\r\n                      <Skeleton className=\"h-10 w-16 mx-auto\" />\r\n                    </div>\r\n                    <Progress value={0} className=\"h-2 bg-gray-700\" />\r\n                  </div>\r\n                  <div className=\"space-y-1\">\r\n                    <p className=\"text-xs text-gray-400\">Status da Roleta</p>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <div className=\"w-2 h-2 bg-green-400 rounded-full\"></div>\r\n                      <span className=\"text-sm\">Online</span>\r\n                      <Skeleton className=\"h-4 w-20\" />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Histórico da Estratégia - Skeleton */}\r\n                <div className=\"space-y-3\">\r\n                  <h4 className=\"text-sm font-medium text-gray-300\">Histórico da Estratégia</h4>\r\n                  <div className=\"grid grid-cols-2 gap-4\">\r\n                    <div className=\"text-center\">\r\n                      <p className=\"text-xs text-gray-400\">Assertividade</p>\r\n                      <div className=\"text-lg font-bold\">\r\n                        <Skeleton className=\"h-6 w-10 mx-auto\" />\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"text-center\">\r\n                      <p className=\"text-xs text-gray-400\">Sinais Hoje</p>\r\n                      <div className=\"text-lg font-bold\">\r\n                        <Skeleton className=\"h-6 w-8 mx-auto\" />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Botão Aplicar Aposta - Skeleton */}\r\n                <div className=\"flex flex-col justify-center\">\r\n                  <Button \r\n                    size=\"lg\" \r\n                    disabled\r\n                    className=\"bg-gray-600 text-gray-400 font-semibold py-3 px-6 rounded-lg cursor-not-allowed\"\r\n                  >\r\n                    <ExternalLink className=\"w-5 h-5 mr-2\" />\r\n                    Carregando...\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        ) : activeSignal ? (\r\n          <Card className=\"bg-gradient-to-r from-gray-800 to-gray-900 border-gray-700 text-white\">\r\n            <CardContent className=\"p-6\">\r\n              <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6\">\r\n                {/* Estratégia e Números */}\r\n                <div className=\"space-y-3\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Badge variant=\"secondary\" className=\"bg-green-600 text-white border-green-500\">\r\n                       <div className=\"w-2 h-2 bg-green-300 rounded-full mr-1 animate-pulse\"></div>\r\n                       Ao Vivo\r\n                     </Badge>\r\n                  </div>\r\n                  <h3 className=\"text-lg font-semibold\">Padrão Ativo</h3>\r\n                  <p className=\"text-sm text-gray-300\">\r\n                     Estratégia: {activeSignal.strategy_name || activeSignal.strategy_id}\r\n                   </p>\r\n                  <div className=\"space-y-2\">\r\n                     <p className=\"text-xs text-gray-400\">Números Indicados</p>\r\n                     <div className=\"flex flex-wrap gap-1\">\r\n                       {(() => {\r\n                         // Processar bet_numbers para exibir APENAS números válidos (0-36)\r\n                         let numbers: number[] = [];\r\n                         \r\n                         // Usar bet_numbers ou suggested_bets como fallback\r\n                         const betsArray = activeSignal.bet_numbers || activeSignal.suggested_bets;\r\n                         \r\n                         if (Array.isArray(betsArray)) {\r\n                           // Se é array, processar cada item\r\n                           betsArray.forEach(bet => {\r\n                             if (typeof bet === 'string') {\r\n                               // Se é string, pode ser \"1,2,3\" ou um número individual\r\n                               if (bet.includes(',')) {\r\n                                 // String com números separados por vírgula\r\n                                 const nums = bet.split(',').map(n => n.trim());\r\n                                 nums.forEach(num => {\r\n                                   const parsedNum = Number(num);\r\n                                   if (!isNaN(parsedNum) && parsedNum >= 0 && parsedNum <= 36) {\r\n                                     numbers.push(parsedNum);\r\n                                   }\r\n                                 });\r\n                               } else {\r\n                                 // Verificar se é um número válido\r\n                                 const parsedNum = Number(bet);\r\n                                 if (!isNaN(parsedNum) && parsedNum >= 0 && parsedNum <= 36) {\r\n                                   numbers.push(parsedNum);\r\n                                 }\r\n                               }\r\n                             } else if (typeof bet === 'number') {\r\n                               // Se é número, verificar se está no range válido\r\n                               if (bet >= 0 && bet <= 36) {\r\n                                 numbers.push(bet);\r\n                               }\r\n                             }\r\n                           });\r\n                         }\r\n                         \r\n                         // Remover duplicatas e limitar a 12 números\r\n                         const uniqueNumbers = Array.from(new Set(numbers)).slice(0, 12);\r\n                         \r\n                         return uniqueNumbers.map((number, index) => {\r\n                           // Definir cor baseada nas regras da roleta\r\n                           let bgColor;\r\n                           \r\n                           // Verde: 0\r\n                           if (number === 0) {\r\n                             bgColor = 'bg-green-600';\r\n                           }\r\n                           // Vermelho: números específicos\r\n                           else if ([1, 3, 5, 7, 9, 12, 14, 16, 18, 19, 21, 23, 25, 27, 30, 32, 34, 36].includes(number)) {\r\n                             bgColor = 'bg-red-600';\r\n                           }\r\n                           // Preto: todos os outros números\r\n                           else {\r\n                             bgColor = 'bg-black';\r\n                           }\r\n                           \r\n                           return (\r\n                             <div \r\n                               key={index} \r\n                               className={`w-8 h-8 ${bgColor} text-white text-xs font-bold rounded-full flex items-center justify-center`}\r\n                             >\r\n                               {number}\r\n                             </div>\r\n                           );\r\n                         });\r\n                       })()} \r\n                     </div>\r\n                   </div>\r\n                  <div className=\"space-y-1\">\r\n                    <p className=\"text-xs text-gray-400\">Confiança</p>\r\n                    <p className=\"text-lg font-bold\">\r\n                      {(() => {\r\n                        // Se confidence_level é um número válido, usar ele\r\n                         if (typeof activeSignal.confidence_level === 'number' && activeSignal.confidence_level > 0) {\r\n                           // Se o valor já está em porcentagem (>1), usar direto, senão multiplicar por 100\r\n                           const percentage = activeSignal.confidence_level > 1 ? activeSignal.confidence_level : activeSignal.confidence_level * 100;\r\n                           return `${percentage.toFixed(0)}%`;\r\n                         }\r\n                         // Se não há confidence_level válido, tentar converter confidence_level\r\n                        if (activeSignal.confidence_level) {\r\n                          if (activeSignal.confidence_level >= 80) return '85%';\r\n                          if (activeSignal.confidence_level >= 60) return '65%';\r\n                          if (activeSignal.confidence_level >= 40) return '45%';\r\n                          return '20%';\r\n                        }\r\n                        return '0%';\r\n                      })()} \r\n                    </p>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Tempo para Ação */}\r\n                <div className=\"space-y-3\">\r\n                  <h4 className=\"text-sm font-medium text-gray-300\">Tempo para Ação</h4>\r\n                  <div className=\"text-center\">\r\n                    <div className={`text-3xl font-bold mb-2 transition-colors duration-300 ${\r\n                      countdown <= 0 ? 'text-red-400' : countdown <= 30 ? 'text-yellow-400' : 'text-white'\r\n                    }`}>\r\n                      {countdown <= 0 ? 'EXPIRADO' : `${Math.floor(countdown / 60)}:${(countdown % 60).toString().padStart(2, '0')}`}\r\n                    </div>\r\n                    <div className=\"relative\">\r\n                      <Progress \r\n                         value={progressValue} \r\n                         className={`h-3 bg-gray-700 transition-all duration-300 ${\r\n                           countdown <= 0 ? 'opacity-100' : 'opacity-90'\r\n                         }`}\r\n                       />\r\n                       {/* Overlay vermelho quando expirado */}\r\n                       {countdown <= 0 && (\r\n                         <div className=\"absolute inset-0 bg-red-500 rounded-full opacity-80 animate-pulse\"></div>\r\n                       )}\r\n                       {/* Indicador de urgência quando restam poucos segundos */}\r\n                       {countdown > 0 && countdown <= 30 && (\r\n                         <div className=\"absolute inset-0 bg-yellow-500 rounded-full opacity-20 animate-pulse\"></div>\r\n                       )}\r\n                    </div>\r\n                    {/* Status do tempo */}\r\n                    <div className={`text-xs mt-2 font-medium transition-colors duration-300 ${\r\n                      countdown <= 0 ? 'text-red-400' : countdown <= 30 ? 'text-yellow-400' : 'text-gray-400'\r\n                    }`}>\r\n                      {countdown <= 0 ? 'Sinal expirado' : countdown <= 30 ? 'Últimos segundos!' : 'Tempo disponível'}\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"space-y-1\">\r\n                    <p className=\"text-xs text-gray-400\">Status da Roleta</p>\r\n                     <div className=\"flex items-center gap-2\">\r\n                       <div className={`w-2 h-2 rounded-full transition-colors duration-300 ${\r\n                         countdown <= 0 ? 'bg-red-400' : 'bg-green-400'\r\n                       }`}></div>\r\n                       <span className=\"text-sm\">Online</span>\r\n                       <span className=\"text-xs text-gray-400\">\r\n                         {activeSignal.table_id}\r\n                       </span>\r\n                     </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Histórico da Estratégia */}\r\n                <div className=\"space-y-3\">\r\n                  <h4 className=\"text-sm font-medium text-gray-300\">Histórico da Estratégia</h4>\r\n                   <div className=\"grid grid-cols-2 gap-4\">\r\n                     <div className=\"text-center\">\r\n                       <p className=\"text-xs text-gray-400\">Assertividade</p>\r\n                       <p className=\"text-lg font-bold\">\r\n                         {(() => {\r\n                           // Assertividade específica da estratégia ativa\r\n                           const kpi = kpisData.find(k => k.strategy_id === (activeSignal.strategy_name || activeSignal.strategy_id));\r\n                           if (kpi && typeof kpi.assertiveness_rate_percent === 'number' && !isNaN(kpi.assertiveness_rate_percent)) {\r\n                             return `${kpi.assertiveness_rate_percent.toFixed(1)}%`;\r\n                           }\r\n                           // Se não há dados de KPI, mostrar 0% ao invés de N/A\r\n                           return '0%';\r\n                         })()} \r\n                       </p>\r\n                     </div>\r\n                     <div className=\"text-center\">\r\n                       <p className=\"text-xs text-gray-400\">Sinais Hoje</p>\r\n                       <p className=\"text-lg font-bold\">\r\n                         {(() => {\r\n                           const kpi = kpisData.find(k => k.strategy_id === (activeSignal.strategy_name || activeSignal.strategy_id));\r\n                           if (kpi && typeof kpi.total_signals_generated === 'number' && !isNaN(kpi.total_signals_generated)) {\r\n                             return kpi.total_signals_generated.toString();\r\n                           }\r\n                           // Se não há dados de KPI, mostrar 0 ao invés de N/A\r\n                           return '0';\r\n                         })()} \r\n                       </p>\r\n                     </div>\r\n                   </div>\r\n                </div>\r\n\r\n                {/* Botão Ir para a Mesa */}\r\n                <div className=\"flex flex-col justify-center\">\r\n                  <div className=\"relative group\">\r\n                    <Button \r\n                    size=\"lg\" \r\n                    disabled={countdown <= 0}\r\n                    className={`font-semibold py-3 px-6 rounded-lg transition-all duration-200 transform ${\r\n                      countdown <= 0 \r\n                        ? 'bg-gray-600 text-gray-400 cursor-not-allowed opacity-50' \r\n                        : 'bg-green-600 hover:bg-green-500 text-white hover:scale-105'\r\n                    }`}\r\n                    onClick={() => {\r\n                      if (countdown > 0) {\r\n                        setSelectedActiveTable({\r\n                          tableId: activeSignal.table_id || 'pragmatic-mega-roulette',\r\n                          strategyName: activeSignal.strategy_name || activeSignal.strategy_id,\r\n                          suggestedBets: activeSignal.bet_numbers || []\r\n                        });\r\n                      }\r\n                    }}\r\n                  >\r\n                    <Target className=\"w-5 h-5 mr-2\" />\r\n                    {countdown <= 0 ? 'Sinal Expirado' : 'Entrar'}\n                  </Button>\r\n                    <div className=\"mt-2 text-center\">\n                      <button\n                        type=\"button\"\n                        className=\"text-xs text-gray-300 underline underline-offset-4 hover:text-white transition-colors\"\n                        onClick={() => {\n                          if (!activeSignal || !liveSignalsData.length) return;\n                          const currentIndex = liveSignalsData.findIndex(\n                            (signal) => signal.id === activeSignal.id\n                          );\n                          if (currentIndex === -1) return;\n                          const nextIndex = currentIndex + 1;\n                          const nextSignal =\n                            nextIndex < liveSignalsData.length\n                              ? liveSignalsData[nextIndex]\n                              : null;\n                          if (nextSignal) {\n                            setActiveSignal(nextSignal);\n                          } else {\n                            setActiveSignal(null);\n                          }\n                        }}\n                      >\n                        Pular\n                      </button>\n                    </div>\n                    \r\n                    {/* Tooltip com números de aposta */}\r\n                    <div className=\"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10\">\r\n                      <div className=\"text-xs text-gray-300 mb-1\">Apostas Sugeridas:</div>\r\n                      <div className=\"flex gap-1\">\r\n                        {(() => {\r\n                          // Filtrar apenas números válidos (0-36)\r\n                          const validNumbers: number[] = [];\r\n                          \r\n                          const betsArray = activeSignal.bet_numbers || activeSignal.suggested_bets;\r\n                          \r\n                          betsArray?.forEach(bet => {\r\n                            if (typeof bet === 'string') {\r\n                              if (bet.includes(',')) {\r\n                                // String com números separados por vírgula\r\n                                const nums = bet.split(',').map(n => n.trim());\r\n                                nums.forEach(num => {\r\n                                  const parsedNum = Number(num);\r\n                                  if (!isNaN(parsedNum) && parsedNum >= 0 && parsedNum <= 36) {\r\n                                    validNumbers.push(parsedNum);\r\n                                  }\r\n                                });\r\n                              } else {\r\n                                // Verificar se é um número válido\r\n                                const parsedNum = Number(bet);\r\n                                if (!isNaN(parsedNum) && parsedNum >= 0 && parsedNum <= 36) {\r\n                                  validNumbers.push(parsedNum);\r\n                                }\r\n                              }\r\n                            } else if (typeof bet === 'number') {\r\n                              // Se é número, verificar se está no range válido\r\n                              if (bet >= 0 && bet <= 36) {\r\n                                validNumbers.push(bet);\r\n                              }\r\n                            }\r\n                          });\r\n                          \r\n                          // Remover duplicatas e limitar a 5\r\n                          const uniqueNumbers = Array.from(new Set(validNumbers)).slice(0, 5);\r\n                          \r\n                          return (\r\n                            <>\r\n                              {uniqueNumbers.map((number, index) => (\r\n                                <span key={index} className=\"bg-green-600 px-2 py-1 rounded text-xs font-bold\">\r\n                                  {number}\r\n                                </span>\r\n                              ))}\r\n                              {validNumbers.length > 5 && (\r\n                                <span className=\"text-gray-400 text-xs\">+{validNumbers.length - 5}</span>\r\n                              )}\r\n                            </>\r\n                          );\r\n                        })()}\r\n                      </div>\r\n                      {/* Seta do tooltip */}\r\n                      <div className=\"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900\"></div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        ) : (\r\n          <Card className=\"bg-gradient-to-r from-gray-800 to-gray-900 border-gray-700 text-white opacity-50\">\r\n            <CardContent className=\"p-6\">\r\n              <div className=\"text-center space-y-3\">\r\n                <h3 className=\"text-lg font-semibold\">Aguardando Padrão</h3>\r\n                <p className=\"text-sm text-gray-400\">\r\n                  Nenhum padrão ativo no momento. Aguarde a próxima oportunidade.\r\n                </p>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        )}\r\n\r\n        {/* Layout Principal do Dashboard */}\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n              {/* Coluna Esquerda - Padrão Ativo e Estatísticas */}\r\n              <div className=\"lg:col-span-2 space-y-6\">\r\n                {dashboardPreferences.showStatsCards && (\r\n                  <StatsCards \r\n                        kpisData={kpisData} \r\n                        loading={loadingStats} \r\n                        activeSignal={activeSignal}\r\n                        countdown={countdown}\r\n                      />\r\n                )}\r\n                \r\n                {dashboardPreferences.showLiveSignals && (\r\n                  <LiveSignals \r\n                    signals={liveSignalsData} \r\n                    activeSignal={activeSignal} \r\n                    countdown={countdown} \r\n                    progressValue={progressValue} \r\n                    loading={loadingSignals}\r\n                    realtimeStatus={toUiRealtimeStatus(realtimeStatus)}\r\n                    onGoToTable={(signal) => setSelectedActiveTable({\r\n                      tableId: signal.table_id,\r\n                      strategyName: signal.strategy_id,\r\n                      suggestedBets: signal.bet_numbers || []\r\n                    })}\r\n                  />\r\n                )}\r\n                \r\n                {dashboardPreferences.showPerformanceChart && (\r\n                  <PerformanceChart kpisData={kpisData} loading={loadingStats} />\r\n                )}\r\n              </div>\r\n              \r\n              {/* Coluna Direita - Status da Roleta e Atividade Recente */}\r\n              <div className=\"space-y-6\">\r\n                {dashboardPreferences.showRouletteStatus && (\r\n                  <RouletteStatus \r\n                  latestSpin={latestRouletteSpin} \r\n                  rouletteHistoryData={rouletteHistoryData} \r\n                />\r\n                )}\r\n                \r\n                {dashboardPreferences.showRecentActivity && (\r\n                  <RecentActivity \r\n                    signals={liveSignalsData} \r\n                    spins={rouletteHistoryData} \r\n                    loading={loadingStats} \r\n                  />\r\n                )}\r\n              </div>\r\n            </div>\r\n          </>\r\n      </div>\r\n\r\n      {/* Modal da Roleta */}\r\n      <RouletteModal\r\n        isOpen={!!selectedActiveTable}\r\n        onClose={() => setSelectedActiveTable(null)}\r\n        tableId={selectedActiveTable?.tableId || ''}\r\n        strategyName={selectedActiveTable?.strategyName || ''}\r\n        suggestedBets={selectedActiveTable?.suggestedBets || []}\r\n      />\r\n    </DashboardLayout>\r\n  );\r\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/dashboard/test-page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/email-confirmation/page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has an unnecessary dependency: 'supabase'. Either exclude it or remove the dependency array. Outer scope values like 'supabase' aren't valid dependencies because mutating them doesn't re-render the component.","line":55,"column":6,"nodeType":"ArrayExpression","endLine":55,"endColumn":38,"suggestions":[{"desc":"Update the dependencies array to be: [router, searchParams]","fix":{"range":[1928,1960],"text":"[router, searchParams]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect, Suspense } from 'react';\r\nimport { useRouter, useSearchParams } from 'next/navigation';\r\nimport { supabase } from '@/lib/supabase';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { CheckCircle, Mail, RefreshCw, ArrowRight, AlertCircle } from 'lucide-react';\r\nimport { toast } from 'sonner';\r\nimport Link from 'next/link';\r\nimport { motion } from 'framer-motion';\r\n\r\nfunction EmailConfirmationContent() {\r\n  const [isResending, setIsResending] = useState(false);\r\n  const [resendCount, setResendCount] = useState(0);\r\n  const [isConfirmed, setIsConfirmed] = useState(false);\r\n  const [userEmail, setUserEmail] = useState('');\r\n  \r\n  const router = useRouter();\r\n  const searchParams = useSearchParams();\r\n\r\n  useEffect(() => {\r\n    // Verificar se há um email nos parâmetros da URL\r\n    const email = searchParams.get('email');\r\n    if (email) {\r\n      setUserEmail(email);\r\n    }\r\n\r\n    // Verificar se o usuário já está logado e confirmado\r\n    const checkUser = async () => {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (user && user.email_confirmed_at) {\r\n        setIsConfirmed(true);\r\n        toast.success('Email confirmado com sucesso!');\r\n        setTimeout(() => {\r\n          router.push('/dashboard');\r\n        }, 2000);\r\n      }\r\n    };\r\n\r\n    checkUser();\r\n\r\n    // Escutar mudanças no estado de autenticação\r\n    const { data: { subscription } } = supabase.auth.onAuthStateChange((event, session) => {\r\n      if (event === 'SIGNED_IN' && session?.user?.email_confirmed_at) {\r\n        setIsConfirmed(true);\r\n        toast.success('Email confirmado com sucesso!');\r\n        setTimeout(() => {\r\n          router.push('/dashboard');\r\n        }, 2000);\r\n      }\r\n    });\r\n\r\n    return () => subscription.unsubscribe();\r\n  }, [supabase, router, searchParams]);\r\n\r\n  const handleResendEmail = async () => {\r\n    if (resendCount >= 3) {\r\n      toast.error('Limite de reenvios atingido. Aguarde alguns minutos antes de tentar novamente.');\r\n      return;\r\n    }\r\n\r\n    setIsResending(true);\r\n    \r\n    try {\r\n      const { error } = await supabase.auth.resend({\r\n        type: 'signup',\r\n        email: userEmail,\r\n      });\r\n\r\n      if (error) {\r\n        console.error('Erro ao reenviar email:', error);\r\n        toast.error('Erro ao reenviar email de confirmação');\r\n      } else {\r\n        setResendCount(prev => prev + 1);\r\n        toast.success('Email de confirmação reenviado com sucesso!');\r\n      }\r\n    } catch (error) {\r\n      console.error('Erro ao reenviar email:', error);\r\n      toast.error('Erro interno do servidor');\r\n    } finally {\r\n      setIsResending(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-background via-background to-muted/20\">\r\n      <motion.div\r\n        initial={{ opacity: 0, y: 20 }}\r\n        animate={{ opacity: 1, y: 0 }}\r\n        transition={{ duration: 0.5 }}\r\n        className=\"w-full max-w-md\"\r\n      >\r\n        <Card className=\"shadow-2xl border-0 bg-card/95 backdrop-blur-sm\">\r\n          <CardHeader className=\"text-center space-y-4\">\r\n            {isConfirmed ? (\r\n              <>\r\n                <motion.div\r\n                  initial={{ scale: 0 }}\r\n                  animate={{ scale: 1 }}\r\n                  transition={{ type: \"spring\", delay: 0.2 }}\r\n                  className=\"inline-flex items-center justify-center w-16 h-16 bg-green-100 dark:bg-green-900/20 rounded-full mx-auto\"\r\n                >\r\n                  <CheckCircle className=\"w-8 h-8 text-green-600 dark:text-green-400\" />\r\n                </motion.div>\r\n                <CardTitle className=\"text-2xl font-heading text-green-600 dark:text-green-400\">\r\n                  Email confirmado!\r\n                </CardTitle>\r\n                <CardDescription className=\"font-sans\">\r\n                  Sua conta foi ativada com sucesso. Redirecionando para o dashboard...\r\n                </CardDescription>\r\n              </>\r\n            ) : (\r\n              <>\r\n                <motion.div\r\n                  initial={{ scale: 0 }}\r\n                  animate={{ scale: 1 }}\r\n                  transition={{ type: \"spring\", delay: 0.2 }}\r\n                  className=\"inline-flex items-center justify-center w-16 h-16 bg-blue-100 dark:bg-blue-900/20 rounded-full mx-auto\"\r\n                >\r\n                  <Mail className=\"w-8 h-8 text-blue-600 dark:text-blue-400\" />\r\n                </motion.div>\r\n                <CardTitle className=\"text-2xl font-heading\">\r\n                  Confirme seu Email\r\n                </CardTitle>\r\n                <CardDescription className=\"font-sans\">\r\n                  Enviamos um link de confirmação para{' '}\r\n                  <span className=\"font-medium text-foreground\">\r\n                    {userEmail || 'seu email'}\r\n                  </span>\r\n                </CardDescription>\r\n              </>\r\n            )}\r\n          </CardHeader>\r\n          \r\n          <CardContent className=\"space-y-6\">\r\n            {!isConfirmed && (\r\n              <>\r\n                <div className=\"bg-muted/50 p-4 rounded-lg space-y-2\">\r\n                  <div className=\"flex items-start gap-3\">\r\n                    <AlertCircle className=\"w-5 h-5 text-muted-foreground mt-0.5 flex-shrink-0\" />\r\n                    <div className=\"text-sm text-muted-foreground\">\r\n                      <p className=\"font-medium mb-1\">Instruções:</p>\r\n                      <ul className=\"space-y-1 text-xs\">\r\n                        <li>• Verifique sua caixa de entrada</li>\r\n                        <li>• Verifique a pasta de spam/lixo eletrônico</li>\r\n                        <li>• Clique no link de confirmação no email</li>\r\n                        <li>• Retorne a esta página após confirmar</li>\r\n                      </ul>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"space-y-3\">\r\n                  <Button\r\n                    onClick={handleResendEmail}\r\n                    disabled={isResending || resendCount >= 3}\r\n                    variant=\"outline\"\r\n                    className=\"w-full\"\r\n                  >\r\n                    {isResending ? (\r\n                      <RefreshCw className=\"w-4 h-4 animate-spin mr-2\" />\r\n                    ) : (\r\n                      <Mail className=\"w-4 h-4 mr-2\" />\r\n                    )}\r\n                    {isResending ? 'Reenviando...' : 'Reenviar Email'}\r\n                  </Button>\r\n\r\n                  {resendCount > 0 && (\r\n                    <p className=\"text-xs text-muted-foreground text-center\">\r\n                      Emails enviados: {resendCount}/3\r\n                    </p>\r\n                  )}\r\n                </div>\r\n\r\n                <div className=\"text-center text-sm font-sans space-y-2\">\r\n                  <p className=\"text-muted-foreground\">\r\n                    Já confirmou seu email?\r\n                  </p>\r\n                  <Link\r\n                    href=\"/login\"\r\n                    className=\"text-primary hover:underline font-medium inline-flex items-center gap-1\"\r\n                  >\r\n                    Fazer Login\r\n                    <ArrowRight className=\"w-3 h-3\" />\r\n                  </Link>\r\n                </div>\r\n              </>\r\n            )}\r\n\r\n            {isConfirmed && (\r\n              <div className=\"text-center\">\r\n                <Button\r\n                  onClick={() => router.push('/dashboard')}\r\n                  className=\"w-full bg-gradient-to-r from-primary to-accent hover:opacity-90\"\r\n                >\r\n                  <ArrowRight className=\"w-4 h-4 mr-2\" />\r\n                  Ir para Dashboard\r\n                </Button>\r\n              </div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n      </motion.div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function EmailConfirmationPage() {\r\n  return (\r\n    <Suspense fallback={\r\n      <div className=\"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex items-center justify-center p-4\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4\"></div>\r\n          <p className=\"text-gray-600\">Carregando...</p>\r\n        </div>\r\n      </div>\r\n    }>\r\n      <EmailConfirmationContent />\r\n    </Suspense>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/export/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/forgot-password/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/help/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/historico-de-padroes/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/history/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/import/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/insights/[id]/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/insights/page.backup.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/insights/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/lab/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/lib/strategySemantics.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/login/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/logs/metrics/page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchMetrics'. Either include it or remove the dependency array.","line":102,"column":6,"nodeType":"ArrayExpression","endLine":102,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [fetchMetrics, period]","fix":{"range":[2476,2484],"text":"[fetchMetrics, period]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { DashboardLayout } from '@/components/dashboard/layout';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Progress } from '@/components/ui/progress';\r\nimport { \r\n  BarChart3, \r\n  TrendingUp, \r\n  AlertTriangle, \r\n  Activity, \r\n  Users, \r\n  Clock,\r\n  RefreshCw,\r\n  FileText,\r\n  Zap,\r\n  Target\r\n} from 'lucide-react';\r\nimport {\r\n  BarChart,\r\n  Bar,\r\n  XAxis,\r\n  YAxis,\r\n  CartesianGrid,\r\n  Tooltip,\r\n  ResponsiveContainer,\r\n  PieChart,\r\n  Pie,\r\n  Cell,\r\n  LineChart,\r\n  Line\r\n} from 'recharts';\r\n\r\ninterface LogMetrics {\r\n  overview: {\r\n    total_logs: number;\r\n    error_count: number;\r\n    warn_count: number;\r\n    info_count: number;\r\n    debug_count: number;\r\n    error_rate: number;\r\n    warn_rate: number;\r\n  };\r\n  hourly_stats: Array<{\r\n    hour: string;\r\n    count: number;\r\n  }>;\r\n  top_errors: Array<{\r\n    message: string;\r\n    count: number;\r\n    last_occurrence: string;\r\n  }>;\r\n  user_activity: Array<{\r\n    user_id: string;\r\n    log_count: number;\r\n    error_count: number;\r\n    last_activity: string;\r\n  }>;\r\n  context_breakdown: Array<{\r\n    context: string;\r\n    count: number;\r\n    error_count: number;\r\n  }>;\r\n}\r\n\r\nconst COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042', '#8884D8'];\r\n\r\nexport default function LogMetricsPage() {\r\n  const [metrics, setMetrics] = useState<LogMetrics | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [period, setPeriod] = useState('24h');\r\n  const [lastUpdate, setLastUpdate] = useState<Date | null>(null);\r\n\r\n  const fetchMetrics = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const response = await fetch(`/api/logs/metrics?period=${period}`);\r\n      \r\n      if (!response.ok) {\r\n        throw new Error('Falha ao buscar métricas');\r\n      }\r\n\r\n      const result = await response.json();\r\n      if (result.success) {\r\n        setMetrics(result.data);\r\n        setLastUpdate(new Date());\r\n      } else {\r\n        throw new Error(result.error || 'Erro desconhecido');\r\n      }\r\n    } catch (error) {\r\n      console.error('Erro ao buscar métricas:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchMetrics();\r\n  }, [period]);\r\n\r\n  const formatHourlyData = (hourlyStats: LogMetrics['hourly_stats']) => {\r\n    return hourlyStats.map(stat => ({\r\n      ...stat,\r\n      hour: new Date(stat.hour).toLocaleTimeString('pt-BR', { \r\n        hour: '2-digit', \r\n        minute: '2-digit' \r\n      })\r\n    }));\r\n  };\r\n\r\n  const getLevelColor = (level: string) => {\r\n    switch (level.toLowerCase()) {\r\n      case 'error': return 'destructive';\r\n      case 'warn': return 'warning';\r\n      case 'info': return 'default';\r\n      case 'debug': return 'secondary';\r\n      default: return 'default';\r\n    }\r\n  };\r\n\r\n  if (loading && !metrics) {\r\n    return (\r\n      <DashboardLayout>\r\n        <div className=\"flex items-center justify-center h-64\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <RefreshCw className=\"h-6 w-6 animate-spin\" />\r\n            <span>Carregando métricas de logs...</span>\r\n          </div>\r\n        </div>\r\n      </DashboardLayout>\r\n    );\r\n  }\r\n\r\n  if (!metrics) {\r\n    return (\r\n      <DashboardLayout>\r\n        <div className=\"flex items-center justify-center h-64\">\r\n          <div className=\"text-center\">\r\n            <AlertTriangle className=\"h-12 w-12 mx-auto mb-4 text-yellow-500\" />\r\n            <h3 className=\"text-lg font-semibold mb-2\">Métricas Indisponíveis</h3>\r\n            <p className=\"text-muted-foreground mb-4\">\r\n              Não foi possível carregar as métricas de logs.\r\n            </p>\r\n            <Button onClick={fetchMetrics}>\r\n              <RefreshCw className=\"h-4 w-4 mr-2\" />\r\n              Tentar Novamente\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </DashboardLayout>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <DashboardLayout>\r\n      <div className=\"space-y-6\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <h1 className=\"text-3xl font-bold tracking-tight\">Métricas de Logs</h1>\r\n            <p className=\"text-muted-foreground\">\r\n              Dashboard de análise e estatísticas dos logs do sistema\r\n            </p>\r\n          </div>\r\n          <div className=\"flex items-center gap-4\">\r\n            <Select value={period} onValueChange={setPeriod}>\r\n              <SelectTrigger className=\"w-32\">\r\n                <SelectValue />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                <SelectItem value=\"1h\">1 Hora</SelectItem>\r\n                <SelectItem value=\"24h\">24 Horas</SelectItem>\r\n                <SelectItem value=\"7d\">7 Dias</SelectItem>\r\n                <SelectItem value=\"30d\">30 Dias</SelectItem>\r\n              </SelectContent>\r\n            </Select>\r\n            {lastUpdate && (\r\n              <div className=\"text-sm text-muted-foreground\">\r\n                Atualizado: {lastUpdate.toLocaleTimeString()}\r\n              </div>\r\n            )}\r\n            <Button onClick={fetchMetrics} disabled={loading}>\r\n              <RefreshCw className={`h-4 w-4 mr-2 ${loading ? 'animate-spin' : ''}`} />\r\n              Atualizar\r\n            </Button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Cards de Overview */}\r\n        <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\r\n          <Card>\r\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n              <CardTitle className=\"text-sm font-medium\">Total de Logs</CardTitle>\r\n              <FileText className=\"h-4 w-4 text-muted-foreground\" />\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"text-2xl font-bold\">{metrics.overview.total_logs.toLocaleString()}</div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card>\r\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n              <CardTitle className=\"text-sm font-medium\">Taxa de Erro</CardTitle>\r\n              <AlertTriangle className=\"h-4 w-4 text-muted-foreground\" />\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"text-2xl font-bold text-red-600\">\r\n                {metrics.overview.error_rate.toFixed(2)}%\r\n              </div>\r\n              <p className=\"text-xs text-muted-foreground\">\r\n                {metrics.overview.error_count} erros\r\n              </p>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card>\r\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n              <CardTitle className=\"text-sm font-medium\">Taxa de Aviso</CardTitle>\r\n              <Zap className=\"h-4 w-4 text-muted-foreground\" />\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"text-2xl font-bold text-yellow-600\">\r\n                {metrics.overview.warn_rate.toFixed(2)}%\r\n              </div>\r\n              <p className=\"text-xs text-muted-foreground\">\r\n                {metrics.overview.warn_count} avisos\r\n              </p>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card>\r\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n              <CardTitle className=\"text-sm font-medium\">Usuários Ativos</CardTitle>\r\n              <Users className=\"h-4 w-4 text-muted-foreground\" />\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"text-2xl font-bold\">{metrics.user_activity.length}</div>\r\n              <p className=\"text-xs text-muted-foreground\">\r\n                com atividade de logs\r\n              </p>\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n\r\n        {/* Gráficos */}\r\n        <div className=\"grid gap-6 md:grid-cols-2\">\r\n          {/* Gráfico de Logs por Hora */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"flex items-center gap-2\">\r\n                <BarChart3 className=\"h-5 w-5\" />\r\n                Logs por Hora\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <ResponsiveContainer width=\"100%\" height={300}>\r\n                <BarChart data={formatHourlyData(metrics.hourly_stats)}>\r\n                  <CartesianGrid strokeDasharray=\"3 3\" />\r\n                  <XAxis dataKey=\"hour\" />\r\n                  <YAxis />\r\n                  <Tooltip />\r\n                  <Bar dataKey=\"count\" fill=\"#8884d8\" />\r\n                </BarChart>\r\n              </ResponsiveContainer>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* Distribuição por Nível */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"flex items-center gap-2\">\r\n                <Target className=\"h-5 w-5\" />\r\n                Distribuição por Nível\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"space-y-4\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Badge variant=\"destructive\">ERROR</Badge>\r\n                    <span className=\"text-sm\">{metrics.overview.error_count}</span>\r\n                  </div>\r\n                  <Progress \r\n                    value={(metrics.overview.error_count / metrics.overview.total_logs) * 100} \r\n                    className=\"w-24\" \r\n                  />\r\n                </div>\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Badge variant=\"destructive\">WARN</Badge>\r\n                    <span className=\"text-sm\">{metrics.overview.warn_count}</span>\r\n                  </div>\r\n                  <Progress \r\n                    value={(metrics.overview.warn_count / metrics.overview.total_logs) * 100} \r\n                    className=\"w-24\" \r\n                  />\r\n                </div>\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Badge variant=\"default\">INFO</Badge>\r\n                    <span className=\"text-sm\">{metrics.overview.info_count}</span>\r\n                  </div>\r\n                  <Progress \r\n                    value={(metrics.overview.info_count / metrics.overview.total_logs) * 100} \r\n                    className=\"w-24\" \r\n                  />\r\n                </div>\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Badge variant=\"secondary\">DEBUG</Badge>\r\n                    <span className=\"text-sm\">{metrics.overview.debug_count}</span>\r\n                  </div>\r\n                  <Progress \r\n                    value={(metrics.overview.debug_count / metrics.overview.total_logs) * 100} \r\n                    className=\"w-24\" \r\n                  />\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n\r\n        {/* Tabelas de Detalhes */}\r\n        <div className=\"grid gap-6 md:grid-cols-2\">\r\n          {/* Top Erros */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"flex items-center gap-2\">\r\n                <AlertTriangle className=\"h-5 w-5\" />\r\n                Principais Erros\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"space-y-3\">\r\n                {metrics.top_errors.slice(0, 5).map((error, index) => (\r\n                  <div key={index} className=\"flex items-center justify-between p-3 border rounded\">\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <p className=\"text-sm font-medium truncate\">{error.message}</p>\r\n                      <p className=\"text-xs text-muted-foreground\">\r\n                        Última ocorrência: {new Date(error.last_occurrence).toLocaleString()}\r\n                      </p>\r\n                    </div>\r\n                    <Badge variant=\"destructive\">{error.count}</Badge>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* Breakdown por Contexto */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"flex items-center gap-2\">\r\n                <Activity className=\"h-5 w-5\" />\r\n                Logs por Contexto\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"space-y-3\">\r\n                {metrics.context_breakdown.slice(0, 5).map((context, index) => (\r\n                  <div key={index} className=\"flex items-center justify-between p-3 border rounded\">\r\n                    <div className=\"flex-1\">\r\n                      <p className=\"text-sm font-medium\">{context.context}</p>\r\n                      <p className=\"text-xs text-muted-foreground\">\r\n                        {context.error_count} erros de {context.count} total\r\n                      </p>\r\n                    </div>\r\n                    <div className=\"text-right\">\r\n                      <Badge variant=\"outline\">{context.count}</Badge>\r\n                      {context.error_count > 0 && (\r\n                        <Badge variant=\"destructive\" className=\"ml-1\">\r\n                          {context.error_count}\r\n                        </Badge>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n      </div>\r\n    </DashboardLayout>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/logs/page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has missing dependencies: 'currentPage' and 'pageSize'. Either include them or remove the dependency array. You can also replace multiple useState variables with useReducer if 'setTotalPages' needs the current value of 'pageSize'.","line":221,"column":6,"nodeType":"ArrayExpression","endLine":221,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [currentPage, filters, pageSize]","fix":{"range":[8692,8701],"text":"[currentPage, filters, pageSize]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadLogs'. Either include it or remove the dependency array.","line":226,"column":6,"nodeType":"ArrayExpression","endLine":226,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadLogs]","fix":{"range":[8787,8789],"text":"[loadLogs]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'filters', 'loadLogs', and 'searchDebounce'. Either include them or remove the dependency array.","line":260,"column":6,"nodeType":"ArrayExpression","endLine":260,"endColumn":47,"suggestions":[{"desc":"Update the dependencies array to be: [filters, filters.search, filters.searchInDetails, loadLogs, searchDebounce]","fix":{"range":[9778,9819],"text":"[filters, filters.search, filters.searchInDetails, loadLogs, searchDebounce]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'filters' and 'loadLogs'. Either include them or remove the dependency array.","line":266,"column":6,"nodeType":"ArrayExpression","endLine":266,"endColumn":109,"suggestions":[{"desc":"Update the dependencies array to be: [filters.level, filters.timeRange, filters.context, filters.userId, filters.startDate, filters.endDate, loadLogs, filters]","fix":{"range":[10011,10114],"text":"[filters.level, filters.timeRange, filters.context, filters.userId, filters.startDate, filters.endDate, loadLogs, filters]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect, useCallback } from 'react';\r\nimport { DashboardLayout } from '@/components/dashboard/layout';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\r\nimport { Search, Copy, Trash2, AlertTriangle, Info, CheckCircle, Clock, RefreshCw, Filter, X, ChevronLeft, ChevronRight, ChevronsLeft, ChevronsRight } from 'lucide-react';\r\nimport { logger, LogLevel, LogEntry, SystemLogEntry, LogLevelString } from '@/lib/logger';\r\nimport { ExportDialog } from '@/components/logs/export-dialog';\r\n\r\n// Interface específica para a UI que inclui id\r\ninterface UILogEntry extends Omit<LogEntry, 'level'> {\r\n  id: string;\r\n  type: 'error' | 'warning' | 'info' | 'success';\r\n  source?: string;\r\n  details?: string;\r\n}\r\n\r\n// Função para converter LogEntry do sistema para o formato da interface\r\nconst convertSystemLogToUILog = (systemLog: SystemLogEntry, index: number): UILogEntry => {\r\n  const logLevelToType: Record<string, 'error' | 'warning' | 'info'> = {\r\n    'ERROR': 'error' as const,\r\n    'WARN': 'warning' as const,\r\n    'INFO': 'info' as const,\r\n    'DEBUG': 'info' as const,\r\n  };\r\n\r\n  const formatTimestamp = (isoString: string): string => {\r\n    const date = new Date(isoString);\r\n    return date.toLocaleString('pt-BR', {\r\n      year: 'numeric',\r\n      month: '2-digit',\r\n      day: '2-digit',\r\n      hour: '2-digit',\r\n      minute: '2-digit',\r\n      second: '2-digit',\r\n    }).replace(',', '');\r\n  };\r\n\r\n  const getSource = (context?: any): string => {\r\n    if (context?.component) {\r\n      return context.component.toLowerCase().replace(/\\s+/g, '-');\r\n    }\r\n    return 'system';\r\n  };\r\n\r\n  const getDetails = (context?: any): string | undefined => {\r\n    const details: string[] = [];\r\n    \r\n    if (context?.action) {\r\n      details.push(`Ação: ${context.action}`);\r\n    }\r\n    \r\n    if (context?.metadata) {\r\n      const metadata = context.metadata;\r\n      Object.entries(metadata).forEach(([key, value]) => {\r\n        if (typeof value === 'object') {\r\n          details.push(`${key}: ${JSON.stringify(value)}`);\r\n        } else {\r\n          details.push(`${key}: ${value}`);\r\n        }\r\n      });\r\n    }\r\n    \r\n    return details.length > 0 ? details.join(' | ') : undefined;\r\n  };\r\n\r\n  return {\r\n    id: `${Date.now()}-${index}`,\r\n    timestamp: formatTimestamp(systemLog.timestamp),\r\n    type: logLevelToType[systemLog.level],\r\n    message: systemLog.message,\r\n    source: getSource(systemLog.context),\r\n    details: getDetails(systemLog.context),\r\n  };\r\n};\r\n\r\nexport default function LogsPage() {\r\n  const [logs, setLogs] = useState<UILogEntry[]>([]);\r\n  const [systemLogs, setSystemLogs] = useState<SystemLogEntry[]>([]);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  \r\n  // Estados para filtros avançados\r\n  const [filters, setFilters] = useState({\r\n    startDate: '',\r\n    endDate: '',\r\n    userId: '',\r\n    context: '',\r\n    level: 'all',\r\n    search: '',\r\n    timeRange: 'all', // novo: intervalo predefinido\r\n    searchInDetails: false // novo: buscar nos detalhes\r\n  });\r\n  const [availableContexts, setAvailableContexts] = useState<string[]>([]);\r\n  const [availableUsers, setAvailableUsers] = useState<string[]>([]);\r\n  const [savedFilters, setSavedFilters] = useState<{[key: string]: typeof filters}>({});\r\n  const [activeFiltersCount, setActiveFiltersCount] = useState(0);\r\n  \r\n  // Estado para busca em tempo real\r\n  const [searchDebounce, setSearchDebounce] = useState<NodeJS.Timeout | null>(null);\r\n  \r\n  // Estados para paginação\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [totalPages, setTotalPages] = useState(1);\r\n  const [totalLogs, setTotalLogs] = useState(0);\r\n  const [pageSize, setPageSize] = useState(50); // logs por página\r\n\r\n  const loadLogs = useCallback(async (filterParams = filters, page = currentPage) => {\r\n    setIsLoading(true);\r\n    try {\r\n      // Aplicar intervalos de tempo predefinidos\r\n      let adjustedFilters = { ...filterParams };\r\n      if (filterParams.timeRange !== 'all') {\r\n        const now = new Date();\r\n        let startDate = new Date();\r\n        \r\n        switch (filterParams.timeRange) {\r\n          case '1h':\r\n            startDate.setHours(now.getHours() - 1);\r\n            break;\r\n          case '24h':\r\n            startDate.setDate(now.getDate() - 1);\r\n            break;\r\n          case '7d':\r\n            startDate.setDate(now.getDate() - 7);\r\n            break;\r\n          case '30d':\r\n            startDate.setDate(now.getDate() - 30);\r\n            break;\r\n        }\r\n        \r\n        adjustedFilters.startDate = startDate.toISOString().slice(0, 16);\r\n        adjustedFilters.endDate = now.toISOString().slice(0, 16);\r\n      }\r\n      \r\n      // Construir parâmetros de consulta para a API\r\n      const queryParams = new URLSearchParams();\r\n      \r\n      if (adjustedFilters.level && adjustedFilters.level !== 'all') {\r\n        queryParams.append('level', adjustedFilters.level);\r\n      }\r\n      if (adjustedFilters.startDate) {\r\n        queryParams.append('startDate', adjustedFilters.startDate);\r\n      }\r\n      if (adjustedFilters.endDate) {\r\n        queryParams.append('endDate', adjustedFilters.endDate);\r\n      }\r\n      if (adjustedFilters.userId) {\r\n        queryParams.append('userId', adjustedFilters.userId);\r\n      }\r\n      if (adjustedFilters.context) {\r\n        queryParams.append('context', adjustedFilters.context);\r\n      }\r\n      if (adjustedFilters.search) {\r\n        queryParams.append('search', adjustedFilters.search);\r\n        if (adjustedFilters.searchInDetails) {\r\n          queryParams.append('searchInDetails', 'true');\r\n        }\r\n      }\r\n      \r\n      // Adicionar parâmetros de paginação\r\n      const offset = (page - 1) * pageSize;\r\n      queryParams.append('limit', pageSize.toString());\r\n      queryParams.append('offset', offset.toString());\r\n      \r\n      // Fazer requisição para API com filtros e paginação\r\n      const response = await fetch(`/api/logs?${queryParams.toString()}`);\r\n      if (!response.ok) {\r\n        throw new Error('Erro ao carregar logs da API');\r\n      }\r\n      \r\n      const result = await response.json();\r\n      const databaseLogs = result.data || result; // suportar tanto formato paginado quanto simples\r\n      const total = result.total || databaseLogs.length;\r\n      setSystemLogs(databaseLogs);\r\n      \r\n      // Atualizar informações de paginação\r\n      setTotalLogs(total);\r\n      setTotalPages(Math.ceil(total / pageSize));\r\n      setCurrentPage(page);\r\n      \r\n      // Converter logs do banco para o formato da UI\r\n      const convertedLogs = databaseLogs.map((log: SystemLogEntry, index: number) => ({\r\n        id: log.id || `log-${index}`,\r\n        timestamp: new Date(log.created_at || '').toLocaleString('pt-BR').replace(',', ''),\r\n        type: log.level.toLowerCase() as 'info' | 'warning' | 'error' | 'success',\r\n        message: log.message,\r\n        source: log.context || 'Sistema',\r\n        details: log.details ? JSON.stringify(log.details) : undefined\r\n      })); // Não reverter aqui pois a API já ordena por data decrescente\r\n      setLogs(convertedLogs);\r\n      \r\n      // Extrair contextos e usuários únicos para os filtros (apenas na primeira página)\r\n      if (page === 1) {\r\n        const contexts = Array.from(new Set(databaseLogs.map((log: SystemLogEntry) => log.context).filter(Boolean))) as string[];\r\n        const users = Array.from(new Set(databaseLogs.map((log: SystemLogEntry) => log.user_id).filter(Boolean))) as string[];\r\n        setAvailableContexts(contexts);\r\n        setAvailableUsers(users);\r\n      }\r\n      \r\n    } catch (error) {\r\n      console.error('Erro ao carregar logs:', error);\r\n      // Fallback para logs locais se houver erro\r\n       const localLogs = logger.getLogs();\r\n       const convertedLogs = localLogs.map((log, index) => ({\r\n         id: `log-${index}`,\r\n         timestamp: log.timestamp.toLocaleString().replace(',', ''),\r\n         type: LogLevelString[log.level].toLowerCase() as 'info' | 'warning' | 'error' | 'success',\r\n         message: log.message,\r\n         source: typeof log.context === 'string' ? log.context : (log.context?.component || 'Sistema'),\r\n         details: log.context ? JSON.stringify(log.context) : undefined\r\n       })).reverse();\r\n       setLogs(convertedLogs);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [filters]);\r\n\r\n  // Carregar logs na inicialização\r\n  useEffect(() => {\r\n    loadLogs();\r\n  }, []);\r\n\r\n  // Atualizar contagem de filtros ativos\r\n  useEffect(() => {\r\n    const count = Object.entries(filters).filter(([key, value]) => {\r\n      if (key === 'level' && value === 'all') return false;\r\n      if (key === 'timeRange' && value === 'all') return false;\r\n      if (key === 'searchInDetails') return false; // não conta como filtro ativo\r\n      return value !== '' && value !== false;\r\n    }).length;\r\n    setActiveFiltersCount(count);\r\n  }, [filters]);\r\n\r\n  // Busca em tempo real com debounce\r\n  useEffect(() => {\r\n    // Limpar timeout anterior se existir\r\n    if (searchDebounce) {\r\n      clearTimeout(searchDebounce);\r\n    }\r\n\r\n    // Criar novo timeout para busca\r\n    const timeout = setTimeout(() => {\r\n      // Executar busca automaticamente após 500ms de inatividade\r\n      loadLogs(filters, 1);\r\n    }, 500);\r\n\r\n    setSearchDebounce(timeout);\r\n\r\n    // Cleanup function\r\n    return () => {\r\n      if (timeout) {\r\n        clearTimeout(timeout);\r\n      }\r\n    };\r\n  }, [filters.search, filters.searchInDetails]);\r\n\r\n  // Aplicar filtros avançados automaticamente quando mudarem\r\n  useEffect(() => {\r\n    // Aplicar filtros automaticamente quando mudarem (exceto busca)\r\n    loadLogs(filters, 1);\r\n  }, [filters.level, filters.timeRange, filters.context, filters.userId, filters.startDate, filters.endDate]);\r\n\r\n  const clearLogs = async () => {\r\n    try {\r\n      await logger.clearDatabaseLogs();\r\n      logger.clearLogs(); // Também limpar logs locais\r\n      setLogs([]);\r\n      setSystemLogs([]);\r\n    } catch (error) {\r\n      console.error('Erro ao limpar logs:', error);\r\n      // Fallback para limpeza local apenas\r\n      logger.clearLogs();\r\n      setLogs([]);\r\n      setSystemLogs([]);\r\n    }\r\n   };\r\n\r\n   const copyLogs = () => {\r\n    const logText = logs\r\n      .map(log => `[${log.timestamp}] [${log.type.toUpperCase()}] [${log.source}] ${log.message}`)\r\n      .join('\\n');\r\n    \r\n    navigator.clipboard.writeText(logText);\r\n  };\r\n\r\n  // Funções para manipular filtros\r\n  const handleFilterChange = (key: string, value: string) => {\r\n    setFilters(prev => ({\r\n      ...prev,\r\n      [key]: value\r\n    }));\r\n  };\r\n\r\n  const handleCheckboxChange = (key: string, value: boolean) => {\r\n    setFilters(prev => ({\r\n      ...prev,\r\n      [key]: value\r\n    }));\r\n  };\r\n\r\n  const applyFilters = () => {\r\n    setCurrentPage(1); // Resetar para primeira página\r\n    loadLogs(filters, 1);\r\n  };\r\n\r\n  const clearFilters = () => {\r\n    const clearedFilters = {\r\n      startDate: '',\r\n      endDate: '',\r\n      userId: '',\r\n      context: '',\r\n      level: 'all',\r\n      search: '',\r\n      timeRange: 'all',\r\n      searchInDetails: false\r\n    };\r\n    setFilters(clearedFilters);\r\n    setCurrentPage(1); // Resetar para primeira página\r\n    loadLogs(clearedFilters, 1);\r\n  };\r\n\r\n  // Funções de navegação de páginas\r\n  const goToPage = (page: number) => {\r\n    if (page >= 1 && page <= totalPages) {\r\n      loadLogs(filters, page);\r\n    }\r\n  };\r\n\r\n  const goToNextPage = () => {\r\n    if (currentPage < totalPages) {\r\n      goToPage(currentPage + 1);\r\n    }\r\n  };\r\n\r\n  const goToPrevPage = () => {\r\n    if (currentPage > 1) {\r\n      goToPage(currentPage - 1);\r\n    }\r\n  };\r\n\r\n  // Funções para filtros salvos\r\n  const saveCurrentFilters = (name: string) => {\r\n    if (name.trim()) {\r\n      setSavedFilters(prev => ({\r\n        ...prev,\r\n        [name]: { ...filters }\r\n      }));\r\n      // Salvar no localStorage\r\n      localStorage.setItem('savedLogFilters', JSON.stringify({\r\n        ...savedFilters,\r\n        [name]: { ...filters }\r\n      }));\r\n    }\r\n  };\r\n\r\n  const loadSavedFilters = (name: string) => {\r\n    const saved = savedFilters[name];\r\n    if (saved) {\r\n      setFilters(saved);\r\n      loadLogs(saved);\r\n    }\r\n  };\r\n\r\n  const deleteSavedFilters = (name: string) => {\r\n    const updated = { ...savedFilters };\r\n    delete updated[name];\r\n    setSavedFilters(updated);\r\n    localStorage.setItem('savedLogFilters', JSON.stringify(updated));\r\n  };\r\n\r\n  // Carregar filtros salvos do localStorage na inicialização\r\n  useEffect(() => {\r\n    const saved = localStorage.getItem('savedLogFilters');\r\n    if (saved) {\r\n      try {\r\n        setSavedFilters(JSON.parse(saved));\r\n      } catch (error) {\r\n        console.error('Erro ao carregar filtros salvos:', error);\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  // Função para gerar logs de teste\r\n  const generateTestLogs = async () => {\r\n    console.log('=== INICIANDO TESTE DE LOGS ===');\r\n    try {\r\n      // Testar cada nível individualmente\r\n      logger.debug('Teste DEBUG');\r\n      logger.info('Teste INFO');\r\n      logger.warn('Teste WARN');\r\n      logger.error('Teste ERROR');\r\n      \r\n      console.log('Logs de teste enviados');\r\n      // Recarregar logs após o teste\r\n      setTimeout(() => loadLogs(), 2000);\r\n    } catch (error) {\r\n      console.error('Erro durante teste de logs:', error);\r\n    }\r\n  };\r\n\r\n  // Função para gerar apenas 2 logs de teste\r\n  const generate2TestLogs = async () => {\r\n    console.log('=== INICIANDO TESTE COM 2 LOGS ===');\r\n    try {\r\n      logger.info('Log de teste 1 - INFO');\r\n      logger.warn('Log de teste 2 - WARN');\r\n      \r\n      console.log('2 logs de teste enviados');\r\n      // Recarregar logs após o teste\r\n      setTimeout(() => loadLogs(), 2000);\r\n    } catch (error) {\r\n      console.error('Erro durante teste de 2 logs:', error);\r\n    }\r\n  };\r\n\r\n  // Os logs já vêm filtrados da API, então não precisamos filtrar novamente aqui\r\n  const filteredLogs = logs;\r\n\r\n  const getLogIcon = (type: string) => {\r\n    switch (type) {\r\n      case 'info': return <Info className=\"h-4 w-4 text-blue-400\" />;\r\n      case 'warning': return <AlertTriangle className=\"h-4 w-4 text-yellow-400\" />;\r\n      case 'error': return <AlertTriangle className=\"h-4 w-4 text-destructive\" />;\r\n      case 'success': return <CheckCircle className=\"h-4 w-4 text-primary\" />;\r\n      default: return <Info className=\"h-4 w-4\" />;\r\n    }\r\n  };\r\n\r\n  const getLogBadgeStyle = (type: string) => {\r\n    switch (type) {\r\n      case 'info': return 'bg-blue-500/10 text-blue-500 border-blue-500/20';\r\n      case 'warning': return 'bg-yellow-500/10 text-yellow-500 border-yellow-500/20';\r\n      case 'error': return 'bg-destructive/10 text-destructive border-destructive/20';\r\n      case 'success': return 'bg-primary/10 text-primary border-primary/20';\r\n      default: return 'bg-muted text-muted-foreground';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <DashboardLayout>\r\n      <div className=\"flex flex-col gap-6\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <h1 className=\"text-3xl font-urbanist font-bold tracking-tight\">Logs do Sistema</h1>\r\n          <p className=\"text-muted-foreground\">\r\n            Acompanhe todas as atividades e padrões gerados pelo sistema\r\n          </p>\r\n          <div className=\"flex items-center gap-2\">\r\n            <Button \r\n              variant=\"outline\" \r\n              size=\"icon\" \r\n              onClick={() => loadLogs()}\r\n              disabled={isLoading}\r\n              title=\"Atualizar logs\"\r\n            >\r\n              <RefreshCw className={`h-4 w-4 ${isLoading ? 'animate-spin' : ''}`} />\r\n            </Button>\r\n            <Button variant=\"outline\" size=\"icon\" onClick={copyLogs} title=\"Copiar logs\">\r\n              <Copy className=\"h-4 w-4\" />\r\n            </Button>\r\n            <ExportDialog logs={systemLogs} />\r\n            <Button variant=\"outline\" size=\"icon\" onClick={clearLogs} title=\"Limpar logs\">\r\n              <Trash2 className=\"h-4 w-4\" />\r\n            </Button>\r\n            <Button variant=\"outline\" size=\"sm\" onClick={generateTestLogs} title=\"Gerar logs de teste\">\r\n              Teste\r\n            </Button>\r\n            <Button variant=\"outline\" size=\"sm\" onClick={generate2TestLogs} title=\"Gerar 2 logs de teste\">\r\n              2 Logs\r\n            </Button>\r\n          </div>\r\n        </div>\r\n\r\n        <Card>\r\n          <CardHeader>\r\n            <div className=\"flex items-center justify-between\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <CardTitle className=\"font-urbanist\">Filtros Avançados</CardTitle>\r\n                {activeFiltersCount > 0 && (\r\n                  <Badge variant=\"secondary\" className=\"bg-primary/10 text-primary\">\r\n                    {activeFiltersCount} ativo{activeFiltersCount > 1 ? 's' : ''}\r\n                  </Badge>\r\n                )}\r\n              </div>\r\n              {Object.keys(savedFilters).length > 0 && (\r\n                <Select onValueChange={loadSavedFilters}>\r\n                  <SelectTrigger className=\"w-48\">\r\n                    <SelectValue placeholder=\"Filtros salvos\" />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    {Object.keys(savedFilters).map(name => (\r\n                      <SelectItem key={name} value={name}>{name}</SelectItem>\r\n                    ))}\r\n                  </SelectContent>\r\n                </Select>\r\n              )}\r\n            </div>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-3\">\r\n              {/* Busca por texto */}\r\n              <div className=\"relative\">\r\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4\" />\r\n                <Input\r\n                  placeholder=\"Buscar mensagem... (busca em tempo real)\"\r\n                  value={filters.search}\r\n                  onChange={(e) => handleFilterChange('search', e.target.value)}\r\n                  className=\"pl-10\"\r\n                />\r\n                {filters.search && (\r\n                  <div className=\"mt-1 flex items-center justify-between\">\r\n                    <label className=\"flex items-center gap-2 text-xs text-muted-foreground\">\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        checked={filters.searchInDetails}\r\n                        onChange={(e) => handleCheckboxChange('searchInDetails', e.target.checked)}\r\n                        className=\"w-3 h-3\"\r\n                      />\r\n                      Buscar nos detalhes\r\n                    </label>\r\n                    <span className=\"text-xs text-green-600 flex items-center gap-1\">\r\n                      <div className=\"w-2 h-2 bg-green-500 rounded-full animate-pulse\"></div>\r\n                      Busca automática ativa\r\n                    </span>\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Intervalo de tempo predefinido */}\r\n              <Select value={filters.timeRange} onValueChange={(value) => handleFilterChange('timeRange', value)}>\r\n                <SelectTrigger>\r\n                  <SelectValue placeholder=\"Período\" />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  <SelectItem value=\"all\">Todo o período</SelectItem>\r\n                  <SelectItem value=\"1h\">Última hora</SelectItem>\r\n                  <SelectItem value=\"24h\">Últimas 24h</SelectItem>\r\n                  <SelectItem value=\"7d\">Últimos 7 dias</SelectItem>\r\n                  <SelectItem value=\"30d\">Últimos 30 dias</SelectItem>\r\n                </SelectContent>\r\n              </Select>\r\n\r\n              {/* Filtro por nível */}\r\n              <Select value={filters.level} onValueChange={(value) => handleFilterChange('level', value)}>\r\n                <SelectTrigger>\r\n                  <SelectValue placeholder=\"Nível\" />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  <SelectItem value=\"all\">Todos os níveis</SelectItem>\r\n                  <SelectItem value=\"ERROR\">Error</SelectItem>\r\n                  <SelectItem value=\"WARN\">Warning</SelectItem>\r\n                  <SelectItem value=\"INFO\">Info</SelectItem>\r\n                  <SelectItem value=\"DEBUG\">Debug</SelectItem>\r\n                </SelectContent>\r\n              </Select>\r\n\r\n              {/* Filtro por contexto */}\r\n              <Select value={filters.context || \"all\"} onValueChange={(value) => handleFilterChange('context', value === \"all\" ? \"\" : value)}>\r\n                <SelectTrigger>\r\n                  <SelectValue placeholder=\"Contexto\" />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  <SelectItem value=\"all\">Todos os contextos</SelectItem>\r\n                  {availableContexts.map(context => (\r\n                    <SelectItem key={context} value={context}>{context}</SelectItem>\r\n                  ))}\r\n                </SelectContent>\r\n              </Select>\r\n\r\n              {/* Filtro por usuário */}\r\n              <Select value={filters.userId || \"all\"} onValueChange={(value) => handleFilterChange('userId', value === \"all\" ? \"\" : value)}>\r\n                <SelectTrigger>\r\n                  <SelectValue placeholder=\"Usuário\" />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  <SelectItem value=\"all\">Todos os usuários</SelectItem>\r\n                  {availableUsers.map(user => (\r\n                    <SelectItem key={user} value={user}>{user}</SelectItem>\r\n                  ))}\r\n                </SelectContent>\r\n              </Select>\r\n\r\n              {/* Data inicial */}\r\n              <Input\r\n                type=\"datetime-local\"\r\n                placeholder=\"Data inicial\"\r\n                value={filters.startDate}\r\n                onChange={(e) => handleFilterChange('startDate', e.target.value)}\r\n              />\r\n\r\n              {/* Data final */}\r\n              <Input\r\n                type=\"datetime-local\"\r\n                placeholder=\"Data final\"\r\n                value={filters.endDate}\r\n                onChange={(e) => handleFilterChange('endDate', e.target.value)}\r\n              />\r\n            </div>\r\n\r\n            {/* Botões de ação dos filtros */}\r\n            <div className=\"flex gap-2 mt-3 flex-wrap\">\r\n              <Button onClick={() => loadLogs(filters, 1)} size=\"sm\">\r\n                <Filter className=\"w-4 h-4 mr-2\" />\r\n                Aplicar Filtros Avançados\r\n              </Button>\r\n              <Button onClick={clearFilters} variant=\"outline\" size=\"sm\">\r\n                <X className=\"w-4 h-4 mr-2\" />\r\n                Limpar Filtros\r\n              </Button>\r\n              {activeFiltersCount > 0 && (\r\n                <Button \r\n                  onClick={() => {\r\n                    const name = prompt('Nome para salvar estes filtros:');\r\n                    if (name) saveCurrentFilters(name);\r\n                  }} \r\n                  variant=\"outline\" \r\n                  size=\"sm\"\r\n                >\r\n                  💾 Salvar Filtros\r\n                </Button>\r\n              )}\r\n              {Object.keys(savedFilters).length > 0 && (\r\n                <Button \r\n                  onClick={() => {\r\n                    const name = prompt('Nome do filtro para excluir:\\n' + Object.keys(savedFilters).join('\\n'));\r\n                    if (name && savedFilters[name]) deleteSavedFilters(name);\r\n                  }} \r\n                  variant=\"outline\" \r\n                  size=\"sm\"\r\n                  className=\"text-destructive hover:text-destructive\"\r\n                >\r\n                  🗑️ Excluir Salvos\r\n                </Button>\r\n              )}\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Tabs defaultValue=\"list\">\r\n          <TabsList className=\"mb-4\">\r\n            <TabsTrigger value=\"list\" className=\"font-plus-jakarta\">Lista</TabsTrigger>\r\n            <TabsTrigger value=\"realtime\" className=\"font-plus-jakarta\">Tempo Real</TabsTrigger>\r\n          </TabsList>\r\n\r\n          <TabsContent value=\"list\" className=\"mt-0\">\r\n            <Card>\r\n              <CardContent className=\"p-0\">\r\n                <div className=\"h-[600px] rounded-md border overflow-y-auto\">\r\n                  <div className=\"p-4 space-y-4\">\r\n                    {filteredLogs.length > 0 ? (\r\n                      filteredLogs.map((log) => (\r\n                        <div key={log.id} className=\"flex flex-col space-y-2 p-3 rounded-lg border bg-card/50\">\r\n                          <div className=\"flex items-center justify-between\">\r\n                            <div className=\"flex items-center gap-2\">\r\n                              {getLogIcon(log.type)}\r\n                              <Badge variant=\"outline\" className={getLogBadgeStyle(log.type)}>\r\n                                {log.type.toUpperCase()}\r\n                              </Badge>\r\n                              <Badge variant=\"outline\">{log.source}</Badge>\r\n                            </div>\r\n                            <div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\r\n                              <Clock className=\"h-3 w-3\" />\r\n                              {log.timestamp}\r\n                            </div>\r\n                          </div>\r\n                          <p className=\"text-sm font-plus-jakarta\">{log.message}</p>\r\n                          {log.details && (\r\n                            <p className=\"text-xs text-muted-foreground bg-muted/50 p-2 rounded font-plus-jakarta\">\r\n                              {log.details}\r\n                            </p>\r\n                          )}\r\n                        </div>\r\n                      ))\r\n                    ) : (\r\n                      <div className=\"flex flex-col items-center justify-center h-40 text-muted-foreground\">\r\n                        <Info className=\"h-8 w-8 mb-2\" />\r\n                        <p className=\"font-plus-jakarta\">Nenhum log encontrado com os filtros atuais</p>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n                \r\n                {/* Paginação */}\r\n                {totalLogs > 0 && (\r\n                  <div className=\"p-4 border-t bg-muted/20\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <div className=\"text-sm text-muted-foreground\">\r\n                        Mostrando {((currentPage - 1) * pageSize) + 1} a {Math.min(currentPage * pageSize, totalLogs)} de {totalLogs} logs\r\n                      </div>\r\n                      \r\n                      <div className=\"flex items-center gap-2\">\r\n                        <Button\r\n                          variant=\"outline\"\r\n                          size=\"sm\"\r\n                          onClick={() => goToPage(1)}\r\n                          disabled={currentPage === 1}\r\n                          className=\"h-8 w-8 p-0\"\r\n                        >\r\n                          <ChevronsLeft className=\"h-4 w-4\" />\r\n                        </Button>\r\n                        \r\n                        <Button\r\n                          variant=\"outline\"\r\n                          size=\"sm\"\r\n                          onClick={goToPrevPage}\r\n                          disabled={currentPage === 1}\r\n                          className=\"h-8 w-8 p-0\"\r\n                        >\r\n                          <ChevronLeft className=\"h-4 w-4\" />\r\n                        </Button>\r\n                        \r\n                        <div className=\"flex items-center gap-1\">\r\n                          {Array.from({ length: Math.min(5, totalPages) }, (_, i) => {\r\n                            let pageNum;\r\n                            if (totalPages <= 5) {\r\n                              pageNum = i + 1;\r\n                            } else if (currentPage <= 3) {\r\n                              pageNum = i + 1;\r\n                            } else if (currentPage >= totalPages - 2) {\r\n                              pageNum = totalPages - 4 + i;\r\n                            } else {\r\n                              pageNum = currentPage - 2 + i;\r\n                            }\r\n                            \r\n                            return (\r\n                              <Button\r\n                                key={pageNum}\r\n                                variant={currentPage === pageNum ? \"default\" : \"outline\"}\r\n                                size=\"sm\"\r\n                                onClick={() => goToPage(pageNum)}\r\n                                className=\"h-8 w-8 p-0\"\r\n                              >\r\n                                {pageNum}\r\n                              </Button>\r\n                            );\r\n                          })}\r\n                        </div>\r\n                        \r\n                        <Button\r\n                          variant=\"outline\"\r\n                          size=\"sm\"\r\n                          onClick={goToNextPage}\r\n                          disabled={currentPage === totalPages}\r\n                          className=\"h-8 w-8 p-0\"\r\n                        >\r\n                          <ChevronRight className=\"h-4 w-4\" />\r\n                        </Button>\r\n                        \r\n                        <Button\r\n                          variant=\"outline\"\r\n                          size=\"sm\"\r\n                          onClick={() => goToPage(totalPages)}\r\n                          disabled={currentPage === totalPages}\r\n                          className=\"h-8 w-8 p-0\"\r\n                        >\r\n                          <ChevronsRight className=\"h-4 w-4\" />\r\n                        </Button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </CardContent>\r\n            </Card>\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"realtime\" className=\"mt-0\">\r\n            <Card>\r\n              <CardHeader>\r\n                <div className=\"flex items-center justify-between\">\r\n                  <CardTitle className=\"font-urbanist\">Logs em Tempo Real</CardTitle>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <div className=\"flex items-center gap-1\">\r\n                      <div className=\"w-2 h-2 bg-green-500 rounded-full animate-pulse\"></div>\r\n                      <span className=\"text-xs text-muted-foreground\">Ativo</span>\r\n                    </div>\r\n                    <Button \r\n                      variant=\"outline\" \r\n                      size=\"sm\" \r\n                      onClick={() => loadLogs()}\r\n                      disabled={isLoading}\r\n                    >\r\n                      <RefreshCw className={`h-3 w-3 mr-1 ${isLoading ? 'animate-spin' : ''}`} />\r\n                      Atualizar\r\n                    </Button>\r\n                  </div>\r\n                </div>\r\n              </CardHeader>\r\n              <CardContent className=\"p-0\">\r\n                <div className=\"h-[500px] rounded-md border overflow-y-auto\">\r\n                  <div className=\"p-4 space-y-2\">\r\n                    {filteredLogs.length > 0 ? (\r\n                      filteredLogs.slice(0, 20).map((log) => (\r\n                        <div key={log.id} className=\"flex items-start gap-3 p-2 rounded-lg border bg-card/30 hover:bg-card/50 transition-colors\">\r\n                          <div className=\"flex items-center gap-2 min-w-0 flex-1\">\r\n                            {getLogIcon(log.type)}\r\n                            <Badge variant=\"outline\" className={`${getLogBadgeStyle(log.type)} text-xs`}>\r\n                              {log.type.toUpperCase()}\r\n                            </Badge>\r\n                            <span className=\"text-xs text-muted-foreground font-mono\">\r\n                              {log.timestamp.split(' ')[1]}\r\n                            </span>\r\n                            <span className=\"text-sm font-plus-jakarta truncate\">\r\n                              {log.message}\r\n                            </span>\r\n                          </div>\r\n                          <Badge variant=\"outline\" className=\"text-xs shrink-0\">\r\n                            {log.source}\r\n                          </Badge>\r\n                        </div>\r\n                      ))\r\n                    ) : (\r\n                      <div className=\"flex flex-col items-center justify-center h-40 text-muted-foreground\">\r\n                        <Clock className=\"h-8 w-8 mb-2\" />\r\n                        <p className=\"font-plus-jakarta\">Aguardando novos logs...</p>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </TabsContent>\r\n        </Tabs>\r\n      </div>\r\n    </DashboardLayout>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/metrics/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/ml/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/monitoring/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/not-found.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/onboarding/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/payment/cancel/page.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":1,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":51,"column":38,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[1940,1999],"text":"• Você clicou em &quot;Cancelar\" durante o processo de pagamento"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[1940,1999],"text":"• Você clicou em &ldquo;Cancelar\" durante o processo de pagamento"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[1940,1999],"text":"• Você clicou em &#34;Cancelar\" durante o processo de pagamento"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[1940,1999],"text":"• Você clicou em &rdquo;Cancelar\" durante o processo de pagamento"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":1,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":51,"column":47,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[1940,1999],"text":"• Você clicou em \"Cancelar&quot; durante o processo de pagamento"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[1940,1999],"text":"• Você clicou em \"Cancelar&ldquo; durante o processo de pagamento"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[1940,1999],"text":"• Você clicou em \"Cancelar&#34; durante o processo de pagamento"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[1940,1999],"text":"• Você clicou em \"Cancelar&rdquo; durante o processo de pagamento"},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React from 'react';\r\nimport { XCircle, ArrowLeft, RefreshCw, HelpCircle } from 'lucide-react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\n\r\nexport default function PaymentCancelPage() {\r\n  const handleRetryPayment = () => {\r\n    // Voltar para a página de checkout\r\n    window.location.href = '/checkout';\r\n  };\r\n\r\n  const handleGoHome = () => {\r\n    window.location.href = '/';\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 py-12\">\r\n      <div className=\"max-w-2xl mx-auto px-4\">\r\n        {/* Header de Cancelamento */}\r\n        <div className=\"text-center mb-8\">\r\n          <div className=\"mx-auto w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4\">\r\n            <XCircle className=\"w-8 h-8 text-red-600\" />\r\n          </div>\r\n          <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">\r\n            Pagamento Cancelado\r\n          </h1>\r\n          <p className=\"text-gray-600\">\r\n            Sua transação foi cancelada. Nenhum valor foi cobrado.\r\n          </p>\r\n        </div>\r\n\r\n        {/* Informações sobre o Cancelamento */}\r\n        <Card className=\"mb-6\">\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center\">\r\n              <XCircle className=\"w-5 h-5 text-red-600 mr-2\" />\r\n              O que aconteceu?\r\n            </CardTitle>\r\n            <CardDescription>\r\n              Possíveis motivos para o cancelamento\r\n            </CardDescription>\r\n          </CardHeader>\r\n          <CardContent className=\"space-y-4\">\r\n            <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-4\">\r\n              <h3 className=\"font-medium text-yellow-800 mb-2\">\r\n                Motivos comuns para cancelamento:\r\n              </h3>\r\n              <ul className=\"text-sm text-yellow-700 space-y-1\">\r\n                <li>• Você clicou em \"Cancelar\" durante o processo de pagamento</li>\r\n                <li>• Fechou a janela do navegador durante a transação</li>\r\n                <li>• Houve um problema de conexão com a internet</li>\r\n                <li>• Decidiu não prosseguir com a compra</li>\r\n              </ul>\r\n            </div>\r\n            \r\n            <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\r\n              <h3 className=\"font-medium text-blue-800 mb-2\">\r\n                Não se preocupe!\r\n              </h3>\r\n              <p className=\"text-sm text-blue-700\">\r\n                Nenhum valor foi cobrado do seu cartão ou conta. Você pode tentar novamente \r\n                a qualquer momento ou entrar em contato conosco se precisar de ajuda.\r\n              </p>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Opções Disponíveis */}\r\n        <Card className=\"mb-6\">\r\n          <CardHeader>\r\n            <CardTitle>O que você gostaria de fazer?</CardTitle>\r\n            <CardDescription>\r\n              Escolha uma das opções abaixo para continuar\r\n            </CardDescription>\r\n          </CardHeader>\r\n          <CardContent className=\"space-y-4\">\r\n            <div className=\"grid gap-4\">\r\n              <div className=\"flex items-start space-x-3 p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors\">\r\n                <RefreshCw className=\"w-5 h-5 text-green-600 mt-0.5\" />\r\n                <div className=\"flex-1\">\r\n                  <h4 className=\"font-medium text-gray-900\">Tentar novamente</h4>\r\n                  <p className=\"text-sm text-gray-600\">\r\n                    Volte ao checkout e complete sua compra do Sistema SOFIA\r\n                  </p>\r\n                </div>\r\n              </div>\r\n              \r\n              <div className=\"flex items-start space-x-3 p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors\">\r\n                <ArrowLeft className=\"w-5 h-5 text-blue-600 mt-0.5\" />\r\n                <div className=\"flex-1\">\r\n                  <h4 className=\"font-medium text-gray-900\">Voltar ao início</h4>\r\n                  <p className=\"text-sm text-gray-600\">\r\n                    Retorne à página inicial para explorar mais sobre o sistema\r\n                  </p>\r\n                </div>\r\n              </div>\r\n              \r\n              <div className=\"flex items-start space-x-3 p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors\">\r\n                <HelpCircle className=\"w-5 h-5 text-purple-600 mt-0.5\" />\r\n                <div className=\"flex-1\">\r\n                  <h4 className=\"font-medium text-gray-900\">Precisa de ajuda?</h4>\r\n                  <p className=\"text-sm text-gray-600\">\r\n                    Entre em contato com nosso suporte para esclarecimentos\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Ações */}\r\n        <div className=\"flex flex-col sm:flex-row gap-4\">\r\n          <Button \r\n            className=\"flex-1 bg-green-600 hover:bg-green-700\"\r\n            onClick={handleRetryPayment}\r\n          >\r\n            <RefreshCw className=\"w-4 h-4 mr-2\" />\r\n            Tentar Pagamento Novamente\r\n          </Button>\r\n          \r\n          <Button \r\n            variant=\"outline\" \r\n            className=\"flex-1\"\r\n            onClick={handleGoHome}\r\n          >\r\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\r\n            Voltar ao Início\r\n          </Button>\r\n        </div>\r\n\r\n        {/* Informações de Contato */}\r\n        <div className=\"mt-8 text-center\">\r\n          <p className=\"text-sm text-gray-600 mb-2\">\r\n            Ainda com dúvidas? Estamos aqui para ajudar:\r\n          </p>\r\n          <div className=\"flex justify-center space-x-6\">\r\n            <a \r\n              href=\"mailto:suporte@sofia.com\" \r\n              className=\"text-blue-600 hover:text-blue-700 text-sm\"\r\n            >\r\n              suporte@sofia.com\r\n            </a>\r\n            <a \r\n              href=\"tel:+5511999999999\" \r\n              className=\"text-blue-600 hover:text-blue-700 text-sm\"\r\n            >\r\n              (11) 99999-9999\r\n            </a>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Garantia */}\r\n        <div className=\"mt-6 bg-green-50 border border-green-200 rounded-lg p-4\">\r\n          <div className=\"text-center\">\r\n            <h3 className=\"font-medium text-green-800 mb-1\">\r\n              🔒 Compra 100% Segura\r\n            </h3>\r\n            <p className=\"text-sm text-green-700\">\r\n              Todos os pagamentos são processados de forma segura pela Pagar.me. \r\n              Seus dados estão protegidos com criptografia SSL.\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/payment/success/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/privacy-policy/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/profile/page.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":190,"column":15,"nodeType":"JSXOpeningElement","endLine":194,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Card } from '@/components/ui/card';\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { \r\n  User, \r\n  Settings, \r\n  Shield, \r\n  Bell, \r\n  Palette, \r\n  Database, \r\n  Key, \r\n  Activity,\r\n  Camera,\r\n  Mail,\r\n  Phone,\r\n  MapPin,\r\n  Calendar,\r\n  Globe,\r\n  Lock,\r\n  Eye,\r\n  EyeOff,\r\n  Save,\r\n  Upload,\r\n  Download,\r\n  Trash2,\r\n  Edit3,\r\n  Check,\r\n  X,\r\n  AlertTriangle,\r\n  Info\r\n} from 'lucide-react';\r\n\r\ninterface UserProfile {\r\n  id: string;\r\n  name: string;\r\n  email: string;\r\n  phone: string;\r\n  avatar: string;\r\n  location: string;\r\n  birthDate: string;\r\n  language: string;\r\n  timezone: string;\r\n  bio: string;\r\n  joinDate: string;\r\n  lastLogin: string;\r\n  accountType: 'free' | 'premium' | 'enterprise';\r\n  isVerified: boolean;\r\n}\r\n\r\ninterface UserPreferences {\r\n  theme: 'light' | 'dark' | 'auto';\r\n  notifications: {\r\n    email: boolean;\r\n    push: boolean;\r\n    sms: boolean;\r\n    alerts: boolean;\r\n  };\r\n  privacy: {\r\n    profileVisible: boolean;\r\n    activityVisible: boolean;\r\n    dataSharing: boolean;\r\n  };\r\n  trading: {\r\n    defaultStrategy: string;\r\n    riskLevel: 'low' | 'medium' | 'high';\r\n    autoStop: boolean;\r\n    maxLoss: number;\r\n  };\r\n}\r\n\r\ninterface SecuritySettings {\r\n  twoFactorEnabled: boolean;\r\n  lastPasswordChange: string;\r\n  activeSessions: number;\r\n  loginHistory: Array<{\r\n    date: string;\r\n    location: string;\r\n    device: string;\r\n    ip: string;\r\n  }>;\r\n}\r\n\r\nexport default function ProfilePage() {\r\n  const [activeTab, setActiveTab] = useState('profile');\r\n  const [isEditing, setIsEditing] = useState(false);\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const [profile, setProfile] = useState<UserProfile>({\r\n    id: 'user_123',\r\n    name: 'João Silva',\r\n    email: 'joao.silva@email.com',\r\n    phone: '+55 11 99999-9999',\r\n    avatar: '/api/placeholder/150/150',\r\n    location: 'São Paulo, SP',\r\n    birthDate: '1990-05-15',\r\n    language: 'pt-BR',\r\n    timezone: 'America/Sao_Paulo',\r\n    bio: 'Trader experiente com foco em estratégias de roulette.',\r\n    joinDate: '2023-01-15',\r\n    lastLogin: '2024-01-15 14:30',\r\n    accountType: 'premium',\r\n    isVerified: true\r\n  });\r\n\r\n  const [preferences, setPreferences] = useState<UserPreferences>({\r\n    theme: 'dark',\r\n    notifications: {\r\n      email: true,\r\n      push: true,\r\n      sms: false,\r\n      alerts: true\r\n    },\r\n    privacy: {\r\n      profileVisible: true,\r\n      activityVisible: false,\r\n      dataSharing: false\r\n    },\r\n    trading: {\r\n      defaultStrategy: 'martingale',\r\n      riskLevel: 'medium',\r\n      autoStop: true,\r\n      maxLoss: 1000\r\n    }\r\n  });\r\n\r\n  const [security, setSecurity] = useState<SecuritySettings>({\r\n    twoFactorEnabled: true,\r\n    lastPasswordChange: '2023-12-01',\r\n    activeSessions: 3,\r\n    loginHistory: [\r\n      { date: '2024-01-15 14:30', location: 'São Paulo, SP', device: 'Chrome/Windows', ip: '192.168.1.1' },\r\n      { date: '2024-01-14 09:15', location: 'São Paulo, SP', device: 'Mobile/Android', ip: '192.168.1.2' },\r\n      { date: '2024-01-13 16:45', location: 'Rio de Janeiro, RJ', device: 'Safari/macOS', ip: '192.168.2.1' }\r\n    ]\r\n  });\r\n\r\n  const handleSaveProfile = async () => {\r\n    setLoading(true);\r\n    try {\r\n      // Simular API call\r\n      await new Promise(resolve => setTimeout(resolve, 1000));\r\n      setIsEditing(false);\r\n      // Toast de sucesso\r\n    } catch (error) {\r\n      console.error('Erro ao salvar perfil:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleUploadAvatar = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = event.target.files?.[0];\r\n    if (file) {\r\n      const reader = new FileReader();\r\n      reader.onload = (e) => {\r\n        setProfile(prev => ({ ...prev, avatar: e.target?.result as string }));\r\n      };\r\n      reader.readAsDataURL(file);\r\n    }\r\n  };\r\n\r\n  const getAccountTypeBadge = (type: string) => {\r\n    const variants = {\r\n      free: 'secondary',\r\n      premium: 'default',\r\n      enterprise: 'destructive'\r\n    };\r\n    return <Badge variant={variants[type as keyof typeof variants] as any}>{type.toUpperCase()}</Badge>;\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-6\">\r\n      <div className=\"max-w-6xl mx-auto\">\r\n        {/* Header */}\r\n        <div className=\"mb-8\">\r\n          <h1 className=\"text-4xl font-bold text-white mb-2\">Meu Perfil</h1>\r\n          <p className=\"text-slate-300\">Gerencie suas informações pessoais e preferências</p>\r\n        </div>\r\n\r\n        {/* Profile Summary Card */}\r\n        <Card className=\"bg-slate-800/50 border-slate-700 p-6 mb-6\">\r\n          <div className=\"flex items-center space-x-6\">\r\n            <div className=\"relative\">\r\n              <img\r\n                src={profile.avatar}\r\n                alt=\"Avatar\"\r\n                className=\"w-24 h-24 rounded-full object-cover border-4 border-purple-500\"\r\n              />\r\n              <label className=\"absolute bottom-0 right-0 bg-purple-600 p-2 rounded-full cursor-pointer hover:bg-purple-700 transition-colors\">\r\n                <Camera className=\"w-4 h-4 text-white\" />\r\n                <input\r\n                  type=\"file\"\r\n                  accept=\"image/*\"\r\n                  onChange={handleUploadAvatar}\r\n                  className=\"hidden\"\r\n                />\r\n              </label>\r\n            </div>\r\n            <div className=\"flex-1\">\r\n              <div className=\"flex items-center space-x-3 mb-2\">\r\n                <h2 className=\"text-2xl font-bold text-white\">{profile.name}</h2>\r\n                {profile.isVerified && <Check className=\"w-6 h-6 text-green-500\" />}\r\n                {getAccountTypeBadge(profile.accountType)}\r\n              </div>\r\n              <p className=\"text-slate-300 mb-1\">{profile.email}</p>\r\n              <p className=\"text-slate-400 text-sm\">Membro desde {new Date(profile.joinDate).toLocaleDateString('pt-BR')}</p>\r\n            </div>\r\n            <div className=\"text-right\">\r\n              <p className=\"text-slate-300 text-sm\">Último acesso</p>\r\n              <p className=\"text-white font-medium\">{profile.lastLogin}</p>\r\n            </div>\r\n          </div>\r\n        </Card>\r\n\r\n        {/* Tabs */}\r\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"space-y-6\">\r\n          <TabsList className=\"grid w-full grid-cols-4 bg-slate-800/50 border-slate-700\">\r\n            <TabsTrigger value=\"profile\" className=\"flex items-center space-x-2\">\r\n              <User className=\"w-4 h-4\" />\r\n              <span>Perfil</span>\r\n            </TabsTrigger>\r\n            <TabsTrigger value=\"preferences\" className=\"flex items-center space-x-2\">\r\n              <Settings className=\"w-4 h-4\" />\r\n              <span>Preferências</span>\r\n            </TabsTrigger>\r\n            <TabsTrigger value=\"security\" className=\"flex items-center space-x-2\">\r\n              <Shield className=\"w-4 h-4\" />\r\n              <span>Segurança</span>\r\n            </TabsTrigger>\r\n            <TabsTrigger value=\"data\" className=\"flex items-center space-x-2\">\r\n              <Database className=\"w-4 h-4\" />\r\n              <span>Dados</span>\r\n            </TabsTrigger>\r\n          </TabsList>\r\n\r\n          {/* Profile Tab */}\r\n          <TabsContent value=\"profile\" className=\"space-y-6\">\r\n            <Card className=\"bg-slate-800/50 border-slate-700 p-6\">\r\n              <div className=\"flex items-center justify-between mb-6\">\r\n                <h3 className=\"text-xl font-semibold text-white\">Informações Pessoais</h3>\r\n                <button\r\n                  onClick={() => setIsEditing(!isEditing)}\r\n                  className=\"flex items-center space-x-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors\"\r\n                >\r\n                  <Edit3 className=\"w-4 h-4\" />\r\n                  <span>{isEditing ? 'Cancelar' : 'Editar'}</span>\r\n                </button>\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                <div>\r\n                  <Label className=\"text-slate-300\">Nome Completo</Label>\r\n                  <Input\r\n                    value={profile.name}\r\n                    onChange={(e) => setProfile(prev => ({ ...prev, name: e.target.value }))}\r\n                    disabled={!isEditing}\r\n                    className=\"bg-slate-700 border-slate-600 text-white\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <Label className=\"text-slate-300\">Email</Label>\r\n                  <Input\r\n                    value={profile.email}\r\n                    onChange={(e) => setProfile(prev => ({ ...prev, email: e.target.value }))}\r\n                    disabled={!isEditing}\r\n                    className=\"bg-slate-700 border-slate-600 text-white\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <Label className=\"text-slate-300\">Telefone</Label>\r\n                  <Input\r\n                    value={profile.phone}\r\n                    onChange={(e) => setProfile(prev => ({ ...prev, phone: e.target.value }))}\r\n                    disabled={!isEditing}\r\n                    className=\"bg-slate-700 border-slate-600 text-white\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <Label className=\"text-slate-300\">Localização</Label>\r\n                  <Input\r\n                    value={profile.location}\r\n                    onChange={(e) => setProfile(prev => ({ ...prev, location: e.target.value }))}\r\n                    disabled={!isEditing}\r\n                    className=\"bg-slate-700 border-slate-600 text-white\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <Label className=\"text-slate-300\">Data de Nascimento</Label>\r\n                  <Input\r\n                    type=\"date\"\r\n                    value={profile.birthDate}\r\n                    onChange={(e) => setProfile(prev => ({ ...prev, birthDate: e.target.value }))}\r\n                    disabled={!isEditing}\r\n                    className=\"bg-slate-700 border-slate-600 text-white\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <Label className=\"text-slate-300\">Idioma</Label>\r\n                  <select\r\n                    value={profile.language}\r\n                    onChange={(e) => setProfile(prev => ({ ...prev, language: e.target.value }))}\r\n                    disabled={!isEditing}\r\n                    className=\"w-full p-2 bg-slate-700 border border-slate-600 text-white rounded-md\"\r\n                  >\r\n                    <option value=\"pt-BR\">Português (Brasil)</option>\r\n                    <option value=\"en-US\">English (US)</option>\r\n                    <option value=\"es-ES\">Español</option>\r\n                  </select>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"mt-6\">\r\n                <Label className=\"text-slate-300\">Bio</Label>\r\n                <textarea\r\n                  value={profile.bio}\r\n                  onChange={(e) => setProfile(prev => ({ ...prev, bio: e.target.value }))}\r\n                  disabled={!isEditing}\r\n                  rows={3}\r\n                  className=\"w-full p-3 bg-slate-700 border border-slate-600 text-white rounded-md resize-none\"\r\n                  placeholder=\"Conte um pouco sobre você...\"\r\n                />\r\n              </div>\r\n\r\n              {isEditing && (\r\n                <div className=\"flex justify-end mt-6\">\r\n                  <button\r\n                    onClick={handleSaveProfile}\r\n                    disabled={loading}\r\n                    className=\"flex items-center space-x-2 px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50\"\r\n                  >\r\n                    <Save className=\"w-4 h-4\" />\r\n                    <span>{loading ? 'Salvando...' : 'Salvar Alterações'}</span>\r\n                  </button>\r\n                </div>\r\n              )}\r\n            </Card>\r\n          </TabsContent>\r\n\r\n          {/* Preferences Tab */}\r\n          <TabsContent value=\"preferences\" className=\"space-y-6\">\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n              {/* Theme Settings */}\r\n              <Card className=\"bg-slate-800/50 border-slate-700 p-6\">\r\n                <h3 className=\"text-xl font-semibold text-white mb-4 flex items-center\">\r\n                  <Palette className=\"w-5 h-5 mr-2\" />\r\n                  Aparência\r\n                </h3>\r\n                <div className=\"space-y-4\">\r\n                  <div>\r\n                    <Label className=\"text-slate-300\">Tema</Label>\r\n                    <select\r\n                      value={preferences.theme}\r\n                      onChange={(e) => setPreferences(prev => ({ ...prev, theme: e.target.value as any }))}\r\n                      className=\"w-full p-2 bg-slate-700 border border-slate-600 text-white rounded-md\"\r\n                    >\r\n                      <option value=\"light\">Claro</option>\r\n                      <option value=\"dark\">Escuro</option>\r\n                      <option value=\"auto\">Automático</option>\r\n                    </select>\r\n                  </div>\r\n                </div>\r\n              </Card>\r\n\r\n              {/* Notification Settings */}\r\n              <Card className=\"bg-slate-800/50 border-slate-700 p-6\">\r\n                <h3 className=\"text-xl font-semibold text-white mb-4 flex items-center\">\r\n                  <Bell className=\"w-5 h-5 mr-2\" />\r\n                  Notificações\r\n                </h3>\r\n                <div className=\"space-y-4\">\r\n                  {Object.entries(preferences.notifications).map(([key, value]) => (\r\n                    <div key={key} className=\"flex items-center justify-between\">\r\n                      <Label className=\"text-slate-300 capitalize\">{key}</Label>\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        checked={value}\r\n                        onChange={(e) => setPreferences(prev => ({\r\n                          ...prev,\r\n                          notifications: { ...prev.notifications, [key]: e.target.checked }\r\n                        }))}\r\n                        className=\"w-4 h-4 text-purple-600 bg-slate-700 border-slate-600 rounded\"\r\n                      />\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </Card>\r\n\r\n              {/* Privacy Settings */}\r\n              <Card className=\"bg-slate-800/50 border-slate-700 p-6\">\r\n                <h3 className=\"text-xl font-semibold text-white mb-4 flex items-center\">\r\n                  <Eye className=\"w-5 h-5 mr-2\" />\r\n                  Privacidade\r\n                </h3>\r\n                <div className=\"space-y-4\">\r\n                  {Object.entries(preferences.privacy).map(([key, value]) => (\r\n                    <div key={key} className=\"flex items-center justify-between\">\r\n                      <Label className=\"text-slate-300 capitalize\">{key.replace(/([A-Z])/g, ' $1')}</Label>\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        checked={value}\r\n                        onChange={(e) => setPreferences(prev => ({\r\n                          ...prev,\r\n                          privacy: { ...prev.privacy, [key]: e.target.checked }\r\n                        }))}\r\n                        className=\"w-4 h-4 text-purple-600 bg-slate-700 border-slate-600 rounded\"\r\n                      />\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </Card>\r\n\r\n              {/* Trading Settings */}\r\n              <Card className=\"bg-slate-800/50 border-slate-700 p-6\">\r\n                <h3 className=\"text-xl font-semibold text-white mb-4 flex items-center\">\r\n                  <Activity className=\"w-5 h-5 mr-2\" />\r\n                  Trading\r\n                </h3>\r\n                <div className=\"space-y-4\">\r\n                  <div>\r\n                    <Label className=\"text-slate-300\">Estratégia Padrão</Label>\r\n                    <select\r\n                      value={preferences.trading.defaultStrategy}\r\n                      onChange={(e) => setPreferences(prev => ({\r\n                        ...prev,\r\n                        trading: { ...prev.trading, defaultStrategy: e.target.value }\r\n                      }))}\r\n                      className=\"w-full p-2 bg-slate-700 border border-slate-600 text-white rounded-md\"\r\n                    >\r\n                      <option value=\"martingale\">Martingale</option>\r\n                      <option value=\"fibonacci\">Fibonacci</option>\r\n                      <option value=\"labouchere\">Labouchere</option>\r\n                    </select>\r\n                  </div>\r\n                  <div>\r\n                    <Label className=\"text-slate-300\">Nível de Risco</Label>\r\n                    <select\r\n                      value={preferences.trading.riskLevel}\r\n                      onChange={(e) => setPreferences(prev => ({\r\n                        ...prev,\r\n                        trading: { ...prev.trading, riskLevel: e.target.value as any }\r\n                      }))}\r\n                      className=\"w-full p-2 bg-slate-700 border border-slate-600 text-white rounded-md\"\r\n                    >\r\n                      <option value=\"low\">Baixo</option>\r\n                      <option value=\"medium\">Médio</option>\r\n                      <option value=\"high\">Alto</option>\r\n                    </select>\r\n                  </div>\r\n                  <div>\r\n                    <Label className=\"text-slate-300\">Perda Máxima (R$)</Label>\r\n                    <Input\r\n                      type=\"number\"\r\n                      value={preferences.trading.maxLoss}\r\n                      onChange={(e) => setPreferences(prev => ({\r\n                        ...prev,\r\n                        trading: { ...prev.trading, maxLoss: Number(e.target.value) }\r\n                      }))}\r\n                      className=\"bg-slate-700 border-slate-600 text-white\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </Card>\r\n            </div>\r\n          </TabsContent>\r\n\r\n          {/* Security Tab */}\r\n          <TabsContent value=\"security\" className=\"space-y-6\">\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n              {/* Security Overview */}\r\n              <Card className=\"bg-slate-800/50 border-slate-700 p-6\">\r\n                <h3 className=\"text-xl font-semibold text-white mb-4 flex items-center\">\r\n                  <Shield className=\"w-5 h-5 mr-2\" />\r\n                  Visão Geral de Segurança\r\n                </h3>\r\n                <div className=\"space-y-4\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <span className=\"text-slate-300\">Autenticação 2FA</span>\r\n                    <Badge variant={security.twoFactorEnabled ? \"default\" : \"destructive\"}>\r\n                      {security.twoFactorEnabled ? \"Ativada\" : \"Desativada\"}\r\n                    </Badge>\r\n                  </div>\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <span className=\"text-slate-300\">Sessões Ativas</span>\r\n                    <span className=\"text-white font-medium\">{security.activeSessions}</span>\r\n                  </div>\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <span className=\"text-slate-300\">Última Alteração de Senha</span>\r\n                    <span className=\"text-white font-medium\">{new Date(security.lastPasswordChange).toLocaleDateString('pt-BR')}</span>\r\n                  </div>\r\n                </div>\r\n              </Card>\r\n\r\n              {/* Password Change */}\r\n              <Card className=\"bg-slate-800/50 border-slate-700 p-6\">\r\n                <h3 className=\"text-xl font-semibold text-white mb-4 flex items-center\">\r\n                  <Lock className=\"w-5 h-5 mr-2\" />\r\n                  Alterar Senha\r\n                </h3>\r\n                <div className=\"space-y-4\">\r\n                  <div>\r\n                    <Label className=\"text-slate-300\">Senha Atual</Label>\r\n                    <div className=\"relative\">\r\n                      <Input\r\n                        type={showPassword ? \"text\" : \"password\"}\r\n                        className=\"bg-slate-700 border-slate-600 text-white pr-10\"\r\n                      />\r\n                      <button\r\n                        onClick={() => setShowPassword(!showPassword)}\r\n                        className=\"absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400\"\r\n                      >\r\n                        {showPassword ? <EyeOff className=\"w-4 h-4\" /> : <Eye className=\"w-4 h-4\" />}\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                  <div>\r\n                    <Label className=\"text-slate-300\">Nova Senha</Label>\r\n                    <Input\r\n                      type=\"password\"\r\n                      className=\"bg-slate-700 border-slate-600 text-white\"\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <Label className=\"text-slate-300\">Confirmar Nova Senha</Label>\r\n                    <Input\r\n                      type=\"password\"\r\n                      className=\"bg-slate-700 border-slate-600 text-white\"\r\n                    />\r\n                  </div>\r\n                  <button className=\"w-full py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors\">\r\n                    Alterar Senha\r\n                  </button>\r\n                </div>\r\n              </Card>\r\n            </div>\r\n\r\n            {/* Login History */}\r\n            <Card className=\"bg-slate-800/50 border-slate-700 p-6\">\r\n              <h3 className=\"text-xl font-semibold text-white mb-4\">Histórico de Login</h3>\r\n              <div className=\"space-y-3\">\r\n                {security.loginHistory.map((login, index) => (\r\n                  <div key={index} className=\"flex items-center justify-between p-3 bg-slate-700/50 rounded-lg\">\r\n                    <div>\r\n                      <p className=\"text-white font-medium\">{login.location}</p>\r\n                      <p className=\"text-slate-400 text-sm\">{login.device} • {login.ip}</p>\r\n                    </div>\r\n                    <span className=\"text-slate-300 text-sm\">{login.date}</span>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </Card>\r\n          </TabsContent>\r\n\r\n          {/* Data Tab */}\r\n          <TabsContent value=\"data\" className=\"space-y-6\">\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n              {/* Data Export */}\r\n              <Card className=\"bg-slate-800/50 border-slate-700 p-6\">\r\n                <h3 className=\"text-xl font-semibold text-white mb-4 flex items-center\">\r\n                  <Download className=\"w-5 h-5 mr-2\" />\r\n                  Exportar Dados\r\n                </h3>\r\n                <p className=\"text-slate-300 mb-4\">Baixe uma cópia de todos os seus dados.</p>\r\n                <button className=\"w-full py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\">\r\n                  Solicitar Exportação\r\n                </button>\r\n              </Card>\r\n\r\n              {/* Data Import */}\r\n              <Card className=\"bg-slate-800/50 border-slate-700 p-6\">\r\n                <h3 className=\"text-xl font-semibold text-white mb-4 flex items-center\">\r\n                  <Upload className=\"w-5 h-5 mr-2\" />\r\n                  Importar Dados\r\n                </h3>\r\n                <p className=\"text-slate-300 mb-4\">Importe dados de outras plataformas.</p>\r\n                <button className=\"w-full py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors\">\r\n                  Importar Arquivo\r\n                </button>\r\n              </Card>\r\n\r\n              {/* Account Deletion */}\r\n              <Card className=\"bg-slate-800/50 border-red-500 p-6 md:col-span-2\">\r\n                <h3 className=\"text-xl font-semibold text-red-400 mb-4 flex items-center\">\r\n                  <AlertTriangle className=\"w-5 h-5 mr-2\" />\r\n                  Zona de Perigo\r\n                </h3>\r\n                <p className=\"text-slate-300 mb-4\">\r\n                  Ações irreversíveis que afetarão permanentemente sua conta.\r\n                </p>\r\n                <div className=\"space-y-3\">\r\n                  <button className=\"w-full py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors\">\r\n                    Excluir Conta Permanentemente\r\n                  </button>\r\n                  <p className=\"text-slate-400 text-sm\">\r\n                    Esta ação não pode ser desfeita. Todos os seus dados serão permanentemente removidos.\r\n                  </p>\r\n                </div>\r\n              </Card>\r\n            </div>\r\n          </TabsContent>\r\n        </Tabs>\r\n      </div>\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/profit/page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'setProfitDataState' and 'setStrategyProfitsState'. Either include them or remove the dependency array.","line":172,"column":6,"nodeType":"ArrayExpression","endLine":172,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [selectedPeriod, setProfitDataState, setStrategyProfitsState]","fix":{"range":[5988,6004],"text":"[selectedPeriod, setProfitDataState, setStrategyProfitsState]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { DashboardLayout } from '@/components/dashboard/layout';\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Progress } from '@/components/ui/progress';\r\nimport { Separator } from '@/components/ui/separator';\r\nimport { \r\n  TrendingUp, \r\n  TrendingDown, \r\n  DollarSign, \r\n  Target, \r\n  Calendar,\r\n  BarChart3,\r\n  PieChart,\r\n  Download,\r\n  Filter,\r\n  RefreshCw\r\n} from 'lucide-react';\r\nimport { \r\n  ResponsiveContainer, \r\n  LineChart, \r\n  Line, \r\n  XAxis, \r\n  YAxis, \r\n  CartesianGrid, \r\n  Tooltip, \r\n  Legend,\r\n  BarChart,\r\n  Bar,\r\n  PieChart as RechartsPieChart,\r\n  Pie,\r\n  Cell\r\n} from 'recharts';\r\n\r\n// Dados mock para demonstração\r\nconst profitData = [\r\n  { date: '01/01', profit: 150, sessions: 3, winRate: 65 },\r\n  { date: '02/01', profit: -80, sessions: 2, winRate: 40 },\r\n  { date: '03/01', profit: 220, sessions: 4, winRate: 75 },\r\n  { date: '04/01', profit: 180, sessions: 3, winRate: 70 },\r\n  { date: '05/01', profit: -120, sessions: 2, winRate: 30 },\r\n  { date: '06/01', profit: 300, sessions: 5, winRate: 80 },\r\n  { date: '07/01', profit: 250, sessions: 4, winRate: 72 },\r\n];\r\n\r\nconst strategyProfits = [\r\n  { name: 'As Dúzias (Atrasadas)', profit: 450, sessions: 12, winRate: 75, color: '#10b981' },\r\n  { name: 'Irmãos de Cores', profit: 280, sessions: 8, winRate: 68, color: '#3b82f6' },\r\n  { name: 'Terminais que se Puxam', profit: -150, sessions: 6, winRate: 45, color: '#ef4444' },\r\n  { name: 'Fibonacci Avançado', profit: 320, sessions: 10, winRate: 70, color: '#8b5cf6' },\r\n];\r\n\r\n// Estado populado por API com fallback aos mocks\r\nconst ProfitPageStateInit = () => {\r\n  const [profitDataState, setProfitDataState] = useState(profitData);\r\n  const [strategyProfitsState, setStrategyProfitsState] = useState(strategyProfits);\r\n  return { profitDataState, setProfitDataState, strategyProfitsState, setStrategyProfitsState };\r\n};\r\n\r\nconst monthlyData = [\r\n  { month: 'Jan', profit: 1200, goal: 1000 },\r\n  { month: 'Fev', profit: 800, goal: 1000 },\r\n  { month: 'Mar', profit: 1500, goal: 1000 },\r\n  { month: 'Abr', profit: 900, goal: 1000 },\r\n  { month: 'Mai', profit: 1800, goal: 1000 },\r\n  { month: 'Jun', profit: 1100, goal: 1000 },\r\n];\r\n\r\nconst recentSessions = [\r\n  {\r\n    id: 1,\r\n    date: '07/01/2024',\r\n    time: '14:30',\r\n    strategy: 'As Dúzias (Atrasadas)',\r\n    table: 'Evolution Immersive',\r\n    duration: '45min',\r\n    profit: 150,\r\n    bets: 12,\r\n    winRate: 75\r\n  },\r\n  {\r\n    id: 2,\r\n    date: '07/01/2024',\r\n    time: '10:15',\r\n    strategy: 'Irmãos de Cores',\r\n    table: 'Pragmatic Brazilian',\r\n    duration: '30min',\r\n    profit: -80,\r\n    bets: 8,\r\n    winRate: 37\r\n  },\r\n  {\r\n    id: 3,\r\n    date: '06/01/2024',\r\n    time: '20:45',\r\n    strategy: 'Fibonacci Avançado',\r\n    table: 'Evolution Lightning',\r\n    duration: '60min',\r\n    profit: 220,\r\n    bets: 15,\r\n    winRate: 80\r\n  },\r\n];\r\n\r\nexport default function ProfitPage() {\r\n  const [selectedPeriod, setSelectedPeriod] = useState('7d');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const { profitDataState, setProfitDataState, strategyProfitsState, setStrategyProfitsState } = ProfitPageStateInit();\r\n\r\n  useEffect(() => {\r\n    const fetchKpis = async () => {\r\n      setIsLoading(true);\r\n      try {\r\n        const res = await fetch('/api/kpis-estrategias');\r\n        const raw = await res.json();\r\n        const dataArray = Array.isArray(raw) ? raw : (raw?.data || []);\r\n\r\n        interface StrategyKpi {\r\n          name: string;\r\n          profit: number;\r\n          sessions: number;\r\n          winRate: number;\r\n          color: string;\r\n        }\r\n\r\n        const strategies: StrategyKpi[] = dataArray.map((item: any) => ({\r\n          name: item.strategy_id || item.strategy_name || 'Estratégia Desconhecida',\r\n          profit: Number(item.total_net_profit_loss ?? item.total_net_payout ?? 0) || 0,\r\n          sessions: Number(item.total_signals_generated ?? item.total_activations ?? 0) || 0,\r\n          winRate: Number(item.assertiveness_rate_percent ?? item.hit_rate ?? 0) || 0,\r\n          color: '#10b981'\r\n        }));\r\n        setStrategyProfitsState(strategies.length ? strategies : strategyProfits);\r\n\r\n        const seriesLength = Math.max(\r\n          ...dataArray.map((item: any) => (Array.isArray(item.recentPerformance) ? item.recentPerformance.length : 0)),\r\n          0\r\n        ) || 7;\r\n        const profitsPerDay = Array.from({ length: seriesLength }, (_, i) =>\r\n          dataArray.reduce((sum: number, item: any) => {\r\n            const v = Array.isArray(item.recentPerformance) ? item.recentPerformance[i] : 0;\r\n            return sum + (typeof v === 'number' ? v : 0);\r\n          }, 0)\r\n        );\r\n        const sessionsPerDay = strategies.reduce((acc: number, st: StrategyKpi) => acc + Math.max(1, Math.round(st.sessions / seriesLength)), 0);\r\n        const avgWinRate = strategies.length\r\n          ? Math.round(strategies.reduce((acc: number, st: StrategyKpi) => acc + st.winRate, 0) / strategies.length)\r\n          : 0;\r\n        const computed = profitsPerDay.map((p, idx) => ({\r\n          date: `${String(idx + 1).padStart(2, '0')}/01`,\r\n          profit: Number(p) || 0,\r\n          sessions: sessionsPerDay,\r\n          winRate: avgWinRate\r\n        }));\r\n\r\n        setProfitDataState(computed.length ? computed : profitData);\r\n      } catch (e) {\r\n        setStrategyProfitsState(strategyProfits);\r\n        setProfitDataState(profitData);\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchKpis();\r\n  }, [selectedPeriod]);\r\n\r\n  const totalProfit = profitDataState.reduce((sum, day) => sum + day.profit, 0);\r\n  const totalSessions = profitDataState.reduce((sum, day) => sum + day.sessions, 0);\r\n  const avgWinRate = profitDataState.reduce((sum, day) => sum + day.winRate, 0) / profitDataState.length;\r\n  const profitPerSession = totalProfit / (totalSessions || 1);\r\n\r\n  const handleRefresh = () => {\r\n    setIsLoading(true);\r\n    // Simular carregamento\r\n    setTimeout(() => setIsLoading(false), 1000);\r\n  };\r\n\r\n  return (\r\n    <DashboardLayout>\r\n      <div className=\"space-y-6\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <h1 className=\"text-3xl font-bold tracking-tight\">Meu Lucro</h1>\r\n            <p className=\"text-muted-foreground\">\r\n              Acompanhe sua performance financeira e evolução\r\n            </p>\r\n          </div>\r\n          <div className=\"flex items-center gap-2\">\r\n            <Select value={selectedPeriod} onValueChange={setSelectedPeriod}>\r\n              <SelectTrigger className=\"w-32\">\r\n                <SelectValue />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                <SelectItem value=\"7d\">7 dias</SelectItem>\r\n                <SelectItem value=\"30d\">30 dias</SelectItem>\r\n                <SelectItem value=\"90d\">90 dias</SelectItem>\r\n                <SelectItem value=\"1y\">1 ano</SelectItem>\r\n              </SelectContent>\r\n            </Select>\r\n            <Button \r\n              variant=\"outline\" \r\n              size=\"sm\" \r\n              onClick={handleRefresh}\r\n              disabled={isLoading}\r\n            >\r\n              <RefreshCw className={`h-4 w-4 ${isLoading ? 'animate-spin' : ''}`} />\r\n            </Button>\r\n            <Button variant=\"outline\" size=\"sm\">\r\n              <Download className=\"h-4 w-4 mr-2\" />\r\n              Exportar\r\n            </Button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Cards de Resumo */}\r\n        <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\r\n          <Card>\r\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n              <CardTitle className=\"text-sm font-medium\">Lucro Total</CardTitle>\r\n              <DollarSign className=\"h-4 w-4 text-muted-foreground\" />\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className={`text-2xl font-bold ${totalProfit >= 0 ? 'text-green-600' : 'text-red-600'}`}>\r\n                R$ {totalProfit.toFixed(2)}\r\n              </div>\r\n              <p className=\"text-xs text-muted-foreground\">\r\n                {totalProfit >= 0 ? '+' : ''}{((totalProfit / 1000) * 100).toFixed(1)}% do bankroll inicial\r\n              </p>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card>\r\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n              <CardTitle className=\"text-sm font-medium\">Sessões</CardTitle>\r\n              <Target className=\"h-4 w-4 text-muted-foreground\" />\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"text-2xl font-bold\">{totalSessions}</div>\r\n              <p className=\"text-xs text-muted-foreground\">\r\n                Média de {(totalSessions / 7).toFixed(1)} por dia\r\n              </p>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card>\r\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n              <CardTitle className=\"text-sm font-medium\">Taxa de Acerto</CardTitle>\r\n              <TrendingUp className=\"h-4 w-4 text-muted-foreground\" />\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"text-2xl font-bold\">{avgWinRate.toFixed(1)}%</div>\r\n              <Progress value={avgWinRate} className=\"mt-2\" />\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card>\r\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n              <CardTitle className=\"text-sm font-medium\">Lucro por Sessão</CardTitle>\r\n              <BarChart3 className=\"h-4 w-4 text-muted-foreground\" />\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className={`text-2xl font-bold ${profitPerSession >= 0 ? 'text-green-600' : 'text-red-600'}`}>\r\n                R$ {profitPerSession.toFixed(2)}\r\n              </div>\r\n              <p className=\"text-xs text-muted-foreground\">\r\n                Média por sessão\r\n              </p>\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n\r\n        {/* Tabs de Conteúdo */}\r\n        <Tabs defaultValue=\"overview\" className=\"space-y-4\">\r\n          <TabsList>\r\n            <TabsTrigger value=\"overview\">Visão Geral</TabsTrigger>\r\n            <TabsTrigger value=\"strategies\">Por Estratégia</TabsTrigger>\r\n            <TabsTrigger value=\"sessions\">Sessões</TabsTrigger>\r\n            <TabsTrigger value=\"goals\">Metas</TabsTrigger>\r\n          </TabsList>\r\n\r\n          <TabsContent value=\"overview\" className=\"space-y-4\">\r\n            <div className=\"grid gap-4 md:grid-cols-2\">\r\n              {/* Gráfico de Lucro Diário */}\r\n              <Card className=\"col-span-2\">\r\n                <CardHeader>\r\n                  <CardTitle>Evolução do Lucro</CardTitle>\r\n                  <CardDescription>\r\n                    Acompanhe sua performance diária nos últimos 7 dias\r\n                  </CardDescription>\r\n                </CardHeader>\r\n                <CardContent>\r\n                  <ResponsiveContainer width=\"100%\" height={300}>\r\n                    <LineChart data={profitDataState}>\r\n                      <CartesianGrid strokeDasharray=\"3 3\" />\r\n                      <XAxis dataKey=\"date\" />\r\n                      <YAxis />\r\n                      <Tooltip \r\n                        formatter={(value, name) => [\r\n                          `R$ ${value}`, \r\n                          name === 'profit' ? 'Lucro' : name\r\n                        ]}\r\n                      />\r\n                      <Legend />\r\n                      <Line \r\n                        type=\"monotone\" \r\n                        dataKey=\"profit\" \r\n                        stroke=\"#10b981\" \r\n                        strokeWidth={2}\r\n                        name=\"Lucro\"\r\n                      />\r\n                    </LineChart>\r\n                  </ResponsiveContainer>\r\n                </CardContent>\r\n              </Card>\r\n            </div>\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"strategies\" className=\"space-y-4\">\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Performance por Estratégia</CardTitle>\r\n                <CardDescription>\r\n                  Compare o desempenho de cada estratégia\r\n                </CardDescription>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"space-y-4\">\r\n                  {strategyProfitsState.map((strategy, index) => (\r\n                    <div key={index} className=\"flex items-center justify-between p-4 border rounded-lg\">\r\n                      <div className=\"flex-1\">\r\n                        <h4 className=\"font-medium\">{strategy.name}</h4>\r\n                        <p className=\"text-sm text-muted-foreground\">\r\n                          {strategy.sessions} sessões • {strategy.winRate}% de acerto\r\n                        </p>\r\n                      </div>\r\n                      <div className=\"text-right\">\r\n                        <div className={`text-lg font-bold ${\r\n                          strategy.profit >= 0 ? 'text-green-600' : 'text-red-600'\r\n                        }`}>\r\n                          {strategy.profit >= 0 ? '+' : ''}R$ {strategy.profit}\r\n                        </div>\r\n                        <div className=\"flex items-center gap-1\">\r\n                          {strategy.profit >= 0 ? (\r\n                            <TrendingUp className=\"h-4 w-4 text-green-600\" />\r\n                          ) : (\r\n                            <TrendingDown className=\"h-4 w-4 text-red-600\" />\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"sessions\" className=\"space-y-4\">\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Sessões Recentes</CardTitle>\r\n                <CardDescription>\r\n                  Histórico detalhado das suas últimas sessões\r\n                </CardDescription>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <Table>\r\n                  <TableHeader>\r\n                    <TableRow>\r\n                      <TableHead>Data/Hora</TableHead>\r\n                      <TableHead>Estratégia</TableHead>\r\n                      <TableHead>Mesa</TableHead>\r\n                      <TableHead>Duração</TableHead>\r\n                      <TableHead>Apostas</TableHead>\r\n                      <TableHead>Taxa</TableHead>\r\n                      <TableHead className=\"text-right\">Lucro</TableHead>\r\n                    </TableRow>\r\n                  </TableHeader>\r\n                  <TableBody>\r\n                    {recentSessions.map((session) => (\r\n                      <TableRow key={session.id}>\r\n                        <TableCell>\r\n                          <div>\r\n                            <div className=\"font-medium\">{session.date}</div>\r\n                            <div className=\"text-sm text-muted-foreground\">{session.time}</div>\r\n                          </div>\r\n                        </TableCell>\r\n                        <TableCell>\r\n                          <Badge variant=\"outline\">{session.strategy}</Badge>\r\n                        </TableCell>\r\n                        <TableCell>{session.table}</TableCell>\r\n                        <TableCell>{session.duration}</TableCell>\r\n                        <TableCell>{session.bets}</TableCell>\r\n                        <TableCell>\r\n                          <Badge variant={session.winRate >= 60 ? 'default' : 'secondary'}>\r\n                            {session.winRate}%\r\n                          </Badge>\r\n                        </TableCell>\r\n                        <TableCell className=\"text-right\">\r\n                          <span className={`font-medium ${\r\n                            session.profit >= 0 ? 'text-green-600' : 'text-red-600'\r\n                          }`}>\r\n                            {session.profit >= 0 ? '+' : ''}R$ {session.profit}\r\n                          </span>\r\n                        </TableCell>\r\n                      </TableRow>\r\n                    ))}\r\n                  </TableBody>\r\n                </Table>\r\n              </CardContent>\r\n            </Card>\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"goals\" className=\"space-y-4\">\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Metas Mensais</CardTitle>\r\n                <CardDescription>\r\n                  Acompanhe o progresso das suas metas de lucro\r\n                </CardDescription>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <ResponsiveContainer width=\"100%\" height={300}>\r\n                  <BarChart data={monthlyData}>\r\n                    <CartesianGrid strokeDasharray=\"3 3\" />\r\n                    <XAxis dataKey=\"month\" />\r\n                    <YAxis />\r\n                    <Tooltip \r\n                      formatter={(value, name) => [\r\n                        `R$ ${value}`, \r\n                        name === 'profit' ? 'Lucro' : 'Meta'\r\n                      ]}\r\n                    />\r\n                    <Legend />\r\n                    <Bar dataKey=\"goal\" fill=\"#e5e7eb\" name=\"Meta\" />\r\n                    <Bar dataKey=\"profit\" fill=\"#10b981\" name=\"Lucro\" />\r\n                  </BarChart>\r\n                </ResponsiveContainer>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            <div className=\"grid gap-4 md:grid-cols-3\">\r\n              <Card>\r\n                <CardHeader>\r\n                  <CardTitle className=\"text-sm\">Meta Mensal</CardTitle>\r\n                </CardHeader>\r\n                <CardContent>\r\n                  <div className=\"text-2xl font-bold\">R$ 1.000</div>\r\n                  <Progress value={75} className=\"mt-2\" />\r\n                  <p className=\"text-xs text-muted-foreground mt-1\">\r\n                    75% concluído\r\n                  </p>\r\n                </CardContent>\r\n              </Card>\r\n\r\n              <Card>\r\n                <CardHeader>\r\n                  <CardTitle className=\"text-sm\">Dias Restantes</CardTitle>\r\n                </CardHeader>\r\n                <CardContent>\r\n                  <div className=\"text-2xl font-bold\">8</div>\r\n                  <p className=\"text-xs text-muted-foreground\">\r\n                    Para atingir a meta\r\n                  </p>\r\n                </CardContent>\r\n              </Card>\r\n\r\n              <Card>\r\n                <CardHeader>\r\n                  <CardTitle className=\"text-sm\">Lucro Necessário</CardTitle>\r\n                </CardHeader>\r\n                <CardContent>\r\n                  <div className=\"text-2xl font-bold text-green-600\">R$ 250</div>\r\n                  <p className=\"text-xs text-muted-foreground\">\r\n                    R$ 31,25 por dia\r\n                  </p>\r\n                </CardContent>\r\n              </Card>\r\n            </div>\r\n          </TabsContent>\r\n        </Tabs>\r\n      </div>\r\n    </DashboardLayout>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/rate-limiting/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/refund-policy/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/refund/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/register/[[...rest]]/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/registros-de-padroes/page.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'currentPage' and 'fetchSignalsHistory'. Either include them or remove the dependency array.","line":140,"column":6,"nodeType":"ArrayExpression","endLine":140,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [currentPage, fetchSignalsHistory, lastUpdate]","fix":{"range":[4632,4644],"text":"[currentPage, fetchSignalsHistory, lastUpdate]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/reset-password/page.backup.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/reset-password/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/roulette-status/metrics-tab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/roulette-status/page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'getFilteredNumbers'. Either include it or remove the dependency array.","line":277,"column":6,"nodeType":"ArrayExpression","endLine":277,"endColumn":59,"suggestions":[{"desc":"Update the dependencies array to be: [selectedRoulette, roulettes, getFilteredNumbers]","fix":{"range":[10385,10438],"text":"[selectedRoulette, roulettes, getFilteredNumbers]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'getDefaultTabForRoulette'. Either include it or remove the dependency array.","line":309,"column":6,"nodeType":"ArrayExpression","endLine":309,"endColumn":43,"suggestions":[{"desc":"Update the dependencies array to be: [selectedRoulette, lastTabByRoulette, getDefaultTabForRoulette]","fix":{"range":[11513,11550],"text":"[selectedRoulette, lastTabByRoulette, getDefaultTabForRoulette]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect, useMemo } from 'react';\r\nimport { useAuth } from '@/contexts/auth-context';\r\nimport { DashboardLayout } from '@/components/dashboard/layout';\r\nimport { MetricsTab } from './metrics-tab';\r\nimport { RouletteHeatmap } from '@/components/analytics/roulette-heatmap';\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Switch } from '@/components/ui/switch';\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\r\nimport { Checkbox } from '@/components/ui/checkbox';\r\nimport { \r\n  Eye, \r\n  Activity, \r\n  TrendingUp, \r\n  History, \r\n  Filter, \r\n  Bell, \r\n  Settings, \r\n  Download,\r\n  RefreshCw,\r\n  Clock,\r\n  Flame,\r\n  Snowflake,\r\n  BarChart3,\r\n  Play,\r\n  Pause,\r\n  Target,\r\n  Users,\r\n  FlipHorizontal,\r\n  GitCompare,\r\n  EyeOff,\r\n  Zap,\r\n  Timer,\r\n  Gauge,\r\n  AlertTriangle,\r\n  TrendingDown,\r\n  Calendar,\r\n  BarChart2,\r\n  PieChart,\r\n  LineChart\r\n} from 'lucide-react';\r\n\r\n// Mock data removed\r\n\r\n\r\n\r\n\r\ninterface Roulette {\r\n  id: string;\r\n  name: string;\r\n  provider: string;\r\n  status: 'online' | 'offline' | 'maintenance';\r\n  lastNumbers: number[];\r\n  isMonitored: boolean;\r\n  lastUpdate: string;\r\n  totalSpins: number;\r\n  hotNumbers: number[];\r\n  coldNumbers: number[];\r\n  isSpinning?: boolean;\r\n}\r\n\r\nexport default function RouletteStatusPage() {\r\n  const { getToken } = useAuth();\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [showMonitoredOnly, setShowMonitoredOnly] = useState(false);\r\n  const [roulettes, setRoulettes] = useState<Roulette[]>([]);\r\n  const [filterType, setFilterType] = useState(['all']);\r\n  const [lastXSpins, setLastXSpins] = useState('20');\r\n  const [showOnlineOnly, setShowOnlineOnly] = useState(false);\r\n  const [selectedRoulette, setSelectedRoulette] = useState<string | null>(null);\r\n  const [timeFilter, setTimeFilter] = useState('24h');\r\n  const [isRealTimeMode, setIsRealTimeMode] = useState(false);\r\n  const [compareMode, setCompareMode] = useState(false);\r\n  const [isComparisonMode, setIsComparisonMode] = useState(false);\r\n  const [selectedForComparison, setSelectedForComparison] = useState<string[]>([]);\r\n  const [alertDialogOpen, setAlertDialogOpen] = useState(false);\r\n  const [selectedRouletteForAlert, setSelectedRouletteForAlert] = useState<string | null>(null);\r\n  const [hoveredNumber, setHoveredNumber] = useState<number | null>(null);\r\n  const [activeTab, setActiveTab] = useState('grid');\r\n  const [lastTabByRoulette, setLastTabByRoulette] = useState<Record<string, string>>({});\r\n  const [performanceMetrics, setPerformanceMetrics] = useState<Record<string, any>>({});\r\n  const [realTimeAlerts, setRealTimeAlerts] = useState<any[]>([]);\r\n  const [spinVelocity, setSpinVelocity] = useState<Record<string, number>>({});\r\n  const [trendAnalysis, setTrendAnalysis] = useState<Record<string, any>>({});\r\n\r\n  // Carregar preferências de abas do localStorage na inicialização\r\n  useEffect(() => {\r\n    const savedTabPreferences = localStorage.getItem('roulette-tab-preferences');\r\n    if (savedTabPreferences) {\r\n      try {\r\n        setLastTabByRoulette(JSON.parse(savedTabPreferences));\r\n      } catch (error) {\r\n        console.error('Erro ao carregar preferências de abas:', error);\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  // Fetch real data from API\r\n  useEffect(() => {\r\n    const fetchRouletteStatus = async () => {\r\n      try {\r\n        const token = await getToken();\r\n        if (!token) {\r\n           console.log(\"Aguardando autenticação...\");\r\n           return;\r\n        }\r\n\r\n        const response = await fetch('/api/roulette-status', {\r\n          headers: {\r\n            'Authorization': `Bearer ${token}`\r\n          }\r\n        });\r\n\r\n        if (response.ok) {\r\n          const result = await response.json();\r\n          // Handle both array and { data: [...] } formats\r\n          const rawData = Array.isArray(result) ? result : (result.data || []);\r\n          \r\n          // Map API data to internal interface\r\n          const mappedData: Roulette[] = rawData.map((item: any) => {\r\n            const lastNumbers = item.lastNumbers || [];\r\n            // Simple calculation for hot/cold numbers if not provided\r\n            // This is a basic estimation based on frequency in the last numbers\r\n            const frequency: Record<number, number> = {};\r\n            lastNumbers.forEach((n: number) => { frequency[n] = (frequency[n] || 0) + 1; });\r\n            \r\n            const sortedNumbers = Object.entries(frequency)\r\n              .sort(([, a], [, b]) => b - a)\r\n              .map(([n]) => parseInt(n));\r\n              \r\n            return {\r\n              id: item.table_id || item.id,\r\n              name: item.table_name || item.name,\r\n              provider: item.provider || 'Unknown',\r\n              status: item.status,\r\n              lastNumbers: lastNumbers,\r\n              isMonitored: item.is_monitored ?? true,\r\n              lastUpdate: item.last_updated || new Date().toISOString(),\r\n              totalSpins: item.totalSpins || lastNumbers.length * 5 + Math.floor(Math.random() * 100), // Estimate if missing\r\n              hotNumbers: item.hotNumbers || sortedNumbers.slice(0, 5),\r\n              coldNumbers: item.coldNumbers || sortedNumbers.slice(-5),\r\n              isSpinning: item.status === 'active'\r\n            };\r\n          });\r\n\r\n          setRoulettes(mappedData);\r\n          setIsLoading(false);\r\n        } else {\r\n          console.error('Erro ao buscar status das roletas:', response.statusText);\r\n        }\r\n      } catch (error) {\r\n        console.error('Erro na requisição de status:', error);\r\n      }\r\n    };\r\n\r\n    fetchRouletteStatus();\r\n    \r\n    // Atualiza a cada 5 segundos\r\n    const interval = setInterval(fetchRouletteStatus, 5000);\r\n    return () => clearInterval(interval);\r\n  }, [getToken]);\r\n\r\n  // Simulação de métricas em tempo real (mantido apenas para dados secundários não vindos da API ainda)\r\n  useEffect(() => {\r\n    const updateMetrics = () => {\r\n      const newMetrics: Record<string, any> = {};\r\n      const newVelocity: Record<string, number> = {};\r\n      const newTrends: Record<string, any> = {};\r\n      \r\n      roulettes.forEach(roulette => {\r\n        // Métricas de performance\r\n        newMetrics[roulette.id] = {\r\n          avgSpinTime: Math.random() * 30 + 15, // 15-45 segundos\r\n          efficiency: Math.random() * 20 + 80, // 80-100%\r\n          uptime: Math.random() * 5 + 95, // 95-100%\r\n          totalSpinsToday: Math.floor(Math.random() * 500) + 200,\r\n          revenue: Math.random() * 10000 + 5000,\r\n          playerCount: Math.floor(Math.random() * 50) + 10\r\n        };\r\n        \r\n        // Velocidade de giros (giros por hora)\r\n        newVelocity[roulette.id] = Math.random() * 40 + 60; // 60-100 giros/hora\r\n        \r\n        // Análise de tendências\r\n        newTrends[roulette.id] = {\r\n          hotStreak: Math.floor(Math.random() * 10) + 1,\r\n          coldStreak: Math.floor(Math.random() * 15) + 5,\r\n          patternDetected: Math.random() > 0.7,\r\n          volatility: Math.random() * 100,\r\n          predictability: Math.random() * 100\r\n        };\r\n      });\r\n      \r\n      setPerformanceMetrics(newMetrics);\r\n      setSpinVelocity(newVelocity);\r\n      setTrendAnalysis(newTrends);\r\n      \r\n      // Gerar alertas aleatórios\r\n      if (Math.random() > 0.8) {\r\n        const alertTypes = ['hot_number', 'cold_streak', 'pattern_detected', 'high_volatility'];\r\n        const randomAlert = {\r\n          id: Date.now(),\r\n          type: alertTypes[Math.floor(Math.random() * alertTypes.length)],\r\n          rouletteId: roulettes[Math.floor(Math.random() * roulettes.length)].id,\r\n          message: 'Novo padrão detectado',\r\n          timestamp: new Date()\r\n        };\r\n        setRealTimeAlerts(prev => [randomAlert, ...prev.slice(0, 4)]);\r\n      }\r\n    };\r\n    \r\n    // Atualizar métricas a cada 5 segundos\r\n    const interval = setInterval(updateMetrics, 5000);\r\n    updateMetrics(); // Executar imediatamente\r\n    \r\n    return () => clearInterval(interval);\r\n  }, [roulettes]);\r\n\r\n  // Função para filtrar números baseado no limite de spins\r\n  const getFilteredNumbers = (numbers: number[]) => {\r\n    const limit = parseInt(lastXSpins);\r\n    // Se o limite for 500, mostra todos os números disponíveis\r\n    if (limit >= 500) {\r\n      return numbers;\r\n    }\r\n    return numbers.slice(0, limit);\r\n  };\r\n\r\n  // Processar dados para o mapa de calor\r\n  const heatmapData = useMemo(() => {\r\n    if (!selectedRoulette) return [];\r\n\r\n    const roulette = roulettes.find(r => r.id === selectedRoulette);\r\n    if (!roulette || !roulette.lastNumbers) return [];\r\n\r\n    // Calcular frequência de cada número\r\n    const numberFrequency: { [key: number]: number } = {};\r\n    const numberLastSeen: { [key: number]: string } = {};\r\n\r\n    // Inicializar todos os números (0-36) com frequência 0\r\n    for (let i = 0; i <= 36; i++) {\r\n      numberFrequency[i] = 0;\r\n    }\r\n\r\n    // Contar frequências dos números filtrados\r\n    const filteredNumbers = getFilteredNumbers(roulette.lastNumbers);\r\n    filteredNumbers.forEach((number, index) => {\r\n      if (number >= 0 && number <= 36) {\r\n        numberFrequency[number]++;\r\n        if (!numberLastSeen[number]) {\r\n          numberLastSeen[number] = `Posição ${filteredNumbers.length - index}`;\r\n        }\r\n      }\r\n    });\r\n\r\n    // Determinar cor do número (vermelho, preto ou verde)\r\n    const getNumberColor = (num: number): 'red' | 'black' | 'green' => {\r\n      if (num === 0) return 'green';\r\n      const redNumbers = [1, 3, 5, 7, 9, 12, 14, 16, 18, 19, 21, 23, 25, 27, 30, 32, 34, 36];\r\n      return redNumbers.includes(num) ? 'red' : 'black';\r\n    };\r\n\r\n    // Converter para formato do componente\r\n    return Object.entries(numberFrequency).map(([number, frequency]) => ({\r\n      number: parseInt(number),\r\n      frequency,\r\n      lastSeen: numberLastSeen[parseInt(number)] || 'Nunca',\r\n      color: getNumberColor(parseInt(number))\r\n    }));\r\n  }, [selectedRoulette, roulettes, lastXSpins, timeFilter]);\r\n\r\n  // Salvar preferências de abas no localStorage\r\n  const saveTabPreference = (rouletteId: string, tabValue: string) => {\r\n    const updatedPreferences = {\r\n      ...lastTabByRoulette,\r\n      [rouletteId]: tabValue\r\n    };\r\n    setLastTabByRoulette(updatedPreferences);\r\n    localStorage.setItem('roulette-tab-preferences', JSON.stringify(updatedPreferences));\r\n  };\r\n\r\n  // Função para lidar com mudança de aba\r\n  const handleTabChange = (value: string) => {\r\n    setActiveTab(value);\r\n    // Se há uma roleta selecionada, salvar a preferência\r\n    if (selectedRoulette) {\r\n      saveTabPreference(selectedRoulette, value);\r\n    }\r\n  };\r\n\r\n  // Função para obter a aba padrão para uma roleta específica\r\n  const getDefaultTabForRoulette = (rouletteId: string) => {\r\n    return lastTabByRoulette[rouletteId] || 'grid';\r\n  };\r\n\r\n  // Restaurar a última aba quando uma roleta específica é selecionada\r\n  useEffect(() => {\r\n    if (selectedRoulette) {\r\n      const preferredTab = getDefaultTabForRoulette(selectedRoulette);\r\n      setActiveTab(preferredTab);\r\n    }\r\n  }, [selectedRoulette, lastTabByRoulette]);\r\n\r\n  // Função para selecionar uma roleta e restaurar sua última aba\r\n  const selectRouletteAndRestoreTab = (rouletteId: string) => {\r\n    setSelectedRoulette(rouletteId);\r\n    const preferredTab = getDefaultTabForRoulette(rouletteId);\r\n    setActiveTab(preferredTab);\r\n  };\r\n\r\n  const toggleMonitored = (id: string) => {\r\n    setRoulettes(roulettes.map(roulette => \r\n      roulette.id === id ? {...roulette, isMonitored: !roulette.isMonitored} : roulette\r\n    ));\r\n  };\r\n\r\n  const toggleComparison = (id: string) => {\r\n    if (selectedForComparison.includes(id)) {\r\n      setSelectedForComparison(selectedForComparison.filter(rId => rId !== id));\r\n    } else {\r\n      setSelectedForComparison([...selectedForComparison, id]);\r\n    }\r\n  };\r\n\r\n  const openAlertDialog = (rouletteId: string) => {\r\n    setSelectedRouletteForAlert(rouletteId);\r\n    setAlertDialogOpen(true);\r\n  };\r\n\r\n  const handleNumberHover = (number: number | null) => {\r\n    setHoveredNumber(number);\r\n    \r\n    // Remove todas as classes de highlight existentes\r\n    document.querySelectorAll('.highlight, .highlight-active').forEach(el => {\r\n      el.classList.remove('highlight', 'highlight-active');\r\n    });\r\n    \r\n    if (number !== null) {\r\n      // Adiciona highlight para todos os elementos com o mesmo número\r\n      document.querySelectorAll(`[data-number=\"${number}\"]`).forEach(el => {\r\n        el.classList.add('highlight');\r\n      });\r\n    }\r\n  };\r\n\r\n  const handleNumberMouseEnter = (number: number, event: React.MouseEvent) => {\r\n    handleNumberHover(number);\r\n    // Adiciona highlight-active apenas ao elemento atual\r\n    (event.target as HTMLElement).classList.add('highlight-active');\r\n  };\r\n\r\n  const handleNumberMouseLeave = () => {\r\n    handleNumberHover(null);\r\n  };\r\n\r\n  // Auto-refresh em modo tempo real\r\n  useEffect(() => {\r\n    if (!isRealTimeMode) return;\r\n    \r\n    const interval = setInterval(() => {\r\n      // Simular atualização dos dados\r\n      setRoulettes(prev => prev.map(roulette => ({\r\n        ...roulette,\r\n        lastUpdate: new Date().toLocaleString('pt-BR')\r\n      })));\r\n    }, 5000);\r\n\r\n    return () => clearInterval(interval);\r\n  }, [isRealTimeMode]);\r\n\r\n  const getFilteredRoulettes = () => {\r\n    let filtered = roulettes;\r\n    \r\n    if (showMonitoredOnly) {\r\n      filtered = filtered.filter(r => r.isMonitored);\r\n    }\r\n    \r\n    if (showOnlineOnly) {\r\n      filtered = filtered.filter(r => r.status === 'online');\r\n    }\r\n    \r\n    return filtered;\r\n  };\r\n\r\n  const getTimeFilteredData = () => {\r\n    // Simular filtro por tempo - em produção seria baseado em timestamps reais\r\n    switch(timeFilter) {\r\n      case '1h': return roulettes.map(r => ({...r, lastNumbers: r.lastNumbers.slice(0, 5)}));\r\n      case '24h': return roulettes;\r\n      case '7d': return roulettes.map(r => ({...r, lastNumbers: [...r.lastNumbers, ...r.lastNumbers]}));\r\n      default: return roulettes;\r\n    }\r\n  };\r\n\r\n  const handleFilterTypeChange = (value: string) => {\r\n    if (filterType.includes(value)) {\r\n      setFilterType(filterType.filter(f => f !== value));\r\n    } else {\r\n      setFilterType([...filterType.filter(f => f !== 'all'), value]);\r\n    }\r\n  };\r\n\r\n  const displayedRoulettes = getFilteredRoulettes();\r\n\r\n  const getStatusColor = (status: string) => {\r\n    switch(status) {\r\n      case 'online': return 'default';\r\n      case 'offline': return 'destructive';\r\n      case 'maintenance': return 'secondary';\r\n      default: return 'outline';\r\n    }\r\n  };\r\n\r\n  const getStatusText = (status: string) => {\r\n    switch(status) {\r\n      case 'online': return 'Online';\r\n      case 'offline': return 'Offline';\r\n      case 'maintenance': return 'Manutenção';\r\n      default: return 'Desconhecido';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <DashboardLayout>\r\n      <div className=\"flex flex-col gap-6\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <History className=\"h-8 w-8 text-primary\" />\r\n            <div>\r\n              <h1 className=\"text-3xl font-bold tracking-tight\">Histórico das Roletas</h1>\r\n              <p className=\"text-muted-foreground\">Acompanhe o status e histórico completo das roletas</p>\r\n            </div>\r\n          </div>\r\n          <div className=\"flex items-center gap-4\">\r\n            <Button variant=\"outline\" size=\"sm\" className=\"gap-2\">\r\n              <RefreshCw className=\"h-4 w-4\" />\r\n              Atualizar\r\n            </Button>\r\n            <Button variant=\"outline\" size=\"sm\" className=\"gap-2\">\r\n              <Download className=\"h-4 w-4\" />\r\n              Exportar\r\n            </Button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Controles de Filtro Inteligentes */}\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <Filter className=\"h-5 w-5\" />\r\n              Filtros Inteligentes e Configurações\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4\">\r\n              <div className=\"space-y-2\">\r\n                <Label>Status das Roletas</Label>\r\n                <div className=\"flex flex-col gap-2\">\r\n                  <div className=\"flex items-center space-x-2\">\r\n                    <Switch \r\n                      id=\"monitored-only\"\r\n                      checked={showMonitoredOnly} \r\n                      onCheckedChange={setShowMonitoredOnly} \r\n                    />\r\n                    <Label htmlFor=\"monitored-only\" className=\"text-sm\">Apenas monitoradas</Label>\r\n                  </div>\r\n                  <div className=\"flex items-center space-x-2\">\r\n                    <Switch \r\n                      id=\"online-only\"\r\n                      checked={showOnlineOnly} \r\n                      onCheckedChange={setShowOnlineOnly} \r\n                    />\r\n                    <Label htmlFor=\"online-only\" className=\"text-sm\">Apenas online</Label>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              \r\n              <div className=\"space-y-2\">\r\n                <Label>Intervalo de Tempo</Label>\r\n                <Select value={timeFilter} onValueChange={setTimeFilter}>\r\n                  <SelectTrigger>\r\n                    <SelectValue />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    <SelectItem value=\"1h\">Última hora</SelectItem>\r\n                    <SelectItem value=\"24h\">Últimas 24h</SelectItem>\r\n                    <SelectItem value=\"7d\">Últimos 7 dias</SelectItem>\r\n                  </SelectContent>\r\n                </Select>\r\n                <div className=\"flex items-center space-x-2 mt-2\">\r\n                  <Switch \r\n                    id=\"real-time\"\r\n                    checked={isRealTimeMode} \r\n                    onCheckedChange={setIsRealTimeMode} \r\n                  />\r\n                  <Label htmlFor=\"real-time\" className=\"text-sm flex items-center gap-1\">\r\n                    {isRealTimeMode ? <Play className=\"h-3 w-3\" /> : <Pause className=\"h-3 w-3\" />}\r\n                    Tempo Real\r\n                  </Label>\r\n                </div>\r\n              </div>\r\n              \r\n              <div className=\"space-y-2\">\r\n                <Label>Últimas Jogadas</Label>\r\n                <Select value={lastXSpins} onValueChange={setLastXSpins}>\r\n                  <SelectTrigger>\r\n                    <SelectValue />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    <SelectItem value=\"10\">Últimas 10</SelectItem>\r\n                    <SelectItem value=\"20\">Últimas 20</SelectItem>\r\n                    <SelectItem value=\"50\">Últimas 50</SelectItem>\r\n                    <SelectItem value=\"100\">Últimas 100</SelectItem>\r\n                    <SelectItem value=\"200\">Últimas 200</SelectItem>\r\n                    <SelectItem value=\"300\">Últimas 300</SelectItem>\r\n                    <SelectItem value=\"500\">Últimas 500</SelectItem>\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n              \r\n              <div className=\"space-y-2\">\r\n                <Label>Tipos de Análise (Múltipla Seleção)</Label>\r\n                <div className=\"flex flex-wrap gap-2\">\r\n                  {[\r\n                    { value: 'hot', label: 'Números quentes', icon: Flame },\r\n                    { value: 'cold', label: 'Números frios', icon: Snowflake },\r\n                    { value: 'patterns', label: 'Padrões', icon: BarChart3 },\r\n                    { value: 'sequences', label: 'Sequências', icon: Activity },\r\n                    { value: 'terminals', label: 'Terminais', icon: Target },\r\n                    { value: 'neighbors', label: 'Vizinhos', icon: Users },\r\n                    { value: 'mirrors', label: 'Espelhos', icon: FlipHorizontal }\r\n                  ].map((option) => {\r\n                    const IconComponent = option.icon;\r\n                    const isSelected = filterType.includes(option.value);\r\n                    return (\r\n                      <Button\r\n                        key={option.value}\r\n                        type=\"button\"\r\n                        variant={isSelected ? \"default\" : \"outline\"}\r\n                        size=\"sm\"\r\n                        className={`gap-2 transition-all duration-200 ${\r\n                          isSelected \r\n                            ? 'bg-primary text-primary-foreground shadow-md scale-105' \r\n                            : 'hover:bg-primary/10 hover:border-primary/50'\r\n                        }`}\r\n                        onClick={() => handleFilterTypeChange(option.value)}\r\n                      >\r\n                        <IconComponent className=\"h-4 w-4\" />\r\n                        {option.label}\r\n                        {isSelected && (\r\n                          <Badge variant=\"secondary\" className=\"ml-1 h-4 w-4 p-0 text-xs\">✓</Badge>\r\n                        )}\r\n                      </Button>\r\n                    );\r\n                  })}\r\n                </div>\r\n              </div>\r\n              \r\n              <div className=\"space-y-2\">\r\n                <Label>Modo Comparação</Label>\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <Switch \r\n                    id=\"comparison-mode\"\r\n                    checked={isComparisonMode} \r\n                    onCheckedChange={setIsComparisonMode} \r\n                  />\r\n                  <Label htmlFor=\"comparison-mode\" className=\"text-sm flex items-center gap-1\">\r\n                    <GitCompare className=\"h-3 w-3\" />\r\n                    Comparar Roletas\r\n                  </Label>\r\n                </div>\r\n                {isComparisonMode && (\r\n                  <div className=\"mt-2 p-2 bg-muted rounded-md\">\r\n                    <p className=\"text-xs text-muted-foreground\">\r\n                      Selecione múltiplas roletas para comparar estatísticas\r\n                    </p>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Tabs value={activeTab} onValueChange={handleTabChange}>\r\n          <div className=\"flex justify-between items-center mb-4\">\r\n            <TabsList className=\"transition-all duration-200\">\r\n              <TabsTrigger value=\"grid\" className=\"transition-all duration-200 hover:bg-primary/10\">Visão Geral</TabsTrigger>\r\n              <TabsTrigger value=\"history\" className=\"transition-all duration-200 hover:bg-primary/10\">Histórico Detalhado</TabsTrigger>\r\n              <TabsTrigger value=\"heatmap\" className=\"transition-all duration-200 hover:bg-primary/10\">Mapa de Calor</TabsTrigger>\r\n              <TabsTrigger value=\"analytics\" className=\"transition-all duration-200 hover:bg-primary/10\">Análises</TabsTrigger>\r\n              <TabsTrigger value=\"metrics\" className=\"transition-all duration-200 hover:bg-primary/10\">Métricas RT</TabsTrigger>\r\n              {compareMode && selectedForComparison.length > 1 && (\r\n                <TabsTrigger value=\"comparison\" className=\"transition-all duration-200 hover:bg-primary/10\">Comparação ({selectedForComparison.length})</TabsTrigger>\r\n              )}\r\n            </TabsList>\r\n            <div className=\"flex items-center gap-2\">\r\n              {isRealTimeMode && (\r\n                <Badge variant=\"outline\" className=\"animate-pulse\">\r\n                  <Activity className=\"h-3 w-3 mr-1\" />\r\n                  Tempo Real Ativo\r\n                </Badge>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          <TabsContent value=\"grid\" className=\"mt-0 animate-in fade-in-0 slide-in-from-bottom-2 duration-300\">\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n              {displayedRoulettes.map((roulette) => (\r\n                <Card key={roulette.id} className={`overflow-hidden ${roulette.isMonitored ? 'border-primary/50' : ''}`}>\r\n                  <CardHeader className=\"pb-2\">\r\n                    <div className=\"flex justify-between items-start\">\r\n                      <div>\r\n                        <CardTitle className=\"flex items-center gap-2\">\r\n                          {roulette.name}\r\n                          {roulette.status === 'online' && (\r\n                            <div className=\"h-2 w-2 bg-green-500 rounded-full animate-pulse\" />\r\n                          )}\r\n                        </CardTitle>\r\n                        <div className=\"flex items-center gap-2 mt-1\">\r\n                          <Badge className={getStatusColor(roulette.status)}>\r\n                            {getStatusText(roulette.status)}\r\n                          </Badge>\r\n                          {roulette.isSpinning && (\r\n                            <Badge variant=\"outline\" className=\"animate-pulse\">\r\n                              Girando\r\n                            </Badge>\r\n                          )}\r\n                          <span className=\"text-xs text-muted-foreground flex items-center gap-1\">\r\n                            <Clock className=\"h-3 w-3\" />\r\n                            {roulette.lastUpdate}\r\n                          </span>\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"flex flex-col gap-1\">\r\n                        <Button \r\n                          type=\"button\"\r\n                          variant={roulette.isMonitored ? \"default\" : \"outline\"}\r\n                          size=\"sm\"\r\n                          className=\"gap-1\"\r\n                          onClick={() => toggleMonitored(roulette.id)}\r\n                        >\r\n                          {roulette.isMonitored ? <Eye className=\"h-4 w-4\" /> : <EyeOff className=\"h-4 w-4\" />}\r\n                          {roulette.isMonitored ? 'Monitorando' : 'Monitorar'}\r\n                        </Button>\r\n                        \r\n                        {compareMode && (\r\n                          <Button \r\n                            type=\"button\"\r\n                            variant={selectedForComparison.includes(roulette.id) ? \"default\" : \"outline\"}\r\n                            size=\"sm\"\r\n                            className=\"gap-1\"\r\n                            onClick={() => toggleComparison(roulette.id)}\r\n                          >\r\n                            <GitCompare className=\"h-4 w-4\" />\r\n                            {selectedForComparison.includes(roulette.id) ? 'Selecionada' : 'Comparar'}\r\n                          </Button>\r\n                        )}\r\n                        \r\n                        <Dialog open={alertDialogOpen && selectedRouletteForAlert === roulette.id} onOpenChange={(open) => !open && setAlertDialogOpen(false)}>\r\n                          <DialogTrigger asChild>\r\n                            <Button \r\n                              type=\"button\"\r\n                              variant=\"outline\"\r\n                              size=\"sm\"\r\n                              className=\"gap-1\"\r\n                              onClick={() => openAlertDialog(roulette.id)}\r\n                            >\r\n                              <Bell className=\"h-4 w-4\" />\r\n                              Alertas\r\n                            </Button>\r\n                          </DialogTrigger>\r\n                          <DialogContent>\r\n                            <DialogHeader>\r\n                              <DialogTitle>Configurar Alertas - {roulette.name}</DialogTitle>\r\n                            </DialogHeader>\r\n                            <div className=\"space-y-4\">\r\n                              <div className=\"space-y-2\">\r\n                                <Label>Tipos de Alerta</Label>\r\n                                <div className=\"flex flex-wrap gap-2\">\r\n                                  {[\r\n                                    { id: 'hot-numbers', label: 'Números quentes', icon: Flame, description: '5+ repetições' },\r\n                                    { id: 'cold-numbers', label: 'Números frios', icon: Snowflake, description: '20+ giros sem aparecer' },\r\n                                    { id: 'patterns', label: 'Padrões', icon: BarChart3, description: 'Detectados' },\r\n                                    { id: 'sequences', label: 'Sequências', icon: Activity, description: 'Especiais' }\r\n                                  ].map((alert) => {\r\n                                    const IconComponent = alert.icon;\r\n                                    return (\r\n                                      <Button\r\n                                        key={alert.id}\r\n                                        type=\"button\"\r\n                                        variant=\"outline\"\r\n                                        size=\"sm\"\r\n                                        className=\"gap-2 hover:bg-primary/10 hover:border-primary/50 flex-col h-auto p-3\"\r\n                                      >\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                          <IconComponent className=\"h-4 w-4\" />\r\n                                          {alert.label}\r\n                                        </div>\r\n                                        <span className=\"text-xs text-muted-foreground\">{alert.description}</span>\r\n                                      </Button>\r\n                                    );\r\n                                  })}\r\n                                </div>\r\n                              </div>\r\n                              <div className=\"space-y-2\">\r\n                                <Label>Método de Notificação</Label>\r\n                                <div className=\"flex flex-wrap gap-2\">\r\n                                  {[\r\n                                    { id: 'browser-notification', label: 'Navegador', icon: Bell, defaultSelected: true },\r\n                                    { id: 'sound-alert', label: 'Som', icon: Activity, defaultSelected: false }\r\n                                  ].map((method) => {\r\n                                    const IconComponent = method.icon;\r\n                                    return (\r\n                                      <Button\r\n                                        key={method.id}\r\n                                        type=\"button\"\r\n                                        variant={method.defaultSelected ? \"default\" : \"outline\"}\r\n                                        size=\"sm\"\r\n                                        className={`gap-2 transition-all duration-200 ${\r\n                                          method.defaultSelected \r\n                                            ? 'bg-primary text-primary-foreground shadow-md' \r\n                                            : 'hover:bg-primary/10 hover:border-primary/50'\r\n                                        }`}\r\n                                      >\r\n                                        <IconComponent className=\"h-4 w-4\" />\r\n                                        {method.label}\r\n                                        {method.defaultSelected && (\r\n                                          <Badge variant=\"secondary\" className=\"ml-1 h-4 w-4 p-0 text-xs\">✓</Badge>\r\n                                        )}\r\n                                      </Button>\r\n                                    );\r\n                                  })}\r\n                                </div>\r\n                              </div>\r\n                              <div className=\"flex justify-end gap-2\">\r\n                                <Button variant=\"outline\" onClick={() => setAlertDialogOpen(false)}>Cancelar</Button>\r\n                                <Button onClick={() => setAlertDialogOpen(false)}>Salvar Alertas</Button>\r\n                              </div>\r\n                            </div>\r\n                          </DialogContent>\r\n                        </Dialog>\r\n                      </div>\r\n                    </div>\r\n                  </CardHeader>\r\n                  <CardContent>\r\n                    <div className=\"space-y-4\">\r\n                      <div>\r\n                        <div className=\"flex items-center justify-between mb-2\">\r\n                          <h4 className=\"text-sm font-medium\">Últimos Números ({lastXSpins})</h4>\r\n                          <span className=\"text-xs text-muted-foreground\">{roulette.totalSpins} giros totais</span>\r\n                        </div>\r\n                        <div className=\"flex flex-wrap gap-1\">\r\n                          {getFilteredNumbers(roulette.lastNumbers).map((num, index) => (\r\n                            <span \r\n                              key={index}\r\n                              data-number={num}\r\n                              className={`inline-flex items-center justify-center h-8 w-8 rounded-full text-sm font-medium cursor-pointer transition-all duration-200 ${\r\n                                num === 0 ? 'bg-green-600 text-white' :\r\n                                [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36].includes(num) ? 'bg-red-500 text-white' : 'bg-black text-white'\r\n                              }`}\r\n                              onMouseEnter={(e) => handleNumberMouseEnter(num, e)}\r\n                              onMouseLeave={handleNumberMouseLeave}\r\n                            >\r\n                              {num}\r\n                            </span>\r\n                          ))}\r\n                        </div>\r\n                      </div>\r\n\r\n                      <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div>\r\n                          <h4 className=\"text-sm font-medium mb-2 flex items-center gap-1\">\r\n                            <Flame className=\"h-4 w-4 text-red-500\" />\r\n                            Números Quentes\r\n                          </h4>\r\n                          <div className=\"flex gap-1\">\r\n                            {roulette.hotNumbers.map((num, index) => (\r\n                              <span \r\n                                key={index}\r\n                                data-number={num}\r\n                                className={`inline-flex items-center justify-center h-6 w-6 rounded-full text-xs font-medium cursor-pointer transition-all duration-200 ${\r\n                                  num === 0 ? 'bg-green-600 text-white' :\r\n                                  [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36].includes(num) ? 'bg-red-500 text-white' : 'bg-black text-white'\r\n                                }`}\r\n                                onMouseEnter={(e) => handleNumberMouseEnter(num, e)}\r\n                                onMouseLeave={handleNumberMouseLeave}\r\n                              >\r\n                                {num}\r\n                              </span>\r\n                            ))}\r\n                          </div>\r\n                        </div>\r\n                        <div>\r\n                          <h4 className=\"text-sm font-medium mb-2 flex items-center gap-1\">\r\n                            <Snowflake className=\"h-4 w-4 text-blue-500\" />\r\n                            Números Frios\r\n                          </h4>\r\n                          <div className=\"flex gap-1\">\r\n                            {roulette.coldNumbers.map((num, index) => (\r\n                              <span \r\n                                key={index}\r\n                                data-number={num}\r\n                                className={`inline-flex items-center justify-center h-6 w-6 rounded-full text-xs font-medium cursor-pointer transition-all duration-200 ${\r\n                                  num === 0 ? 'bg-green-600 text-white' :\r\n                                  [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36].includes(num) ? 'bg-red-500 text-white' : 'bg-black text-white'\r\n                                }`}\r\n                                onMouseEnter={(e) => handleNumberMouseEnter(num, e)}\r\n                                onMouseLeave={handleNumberMouseLeave}\r\n                              >\r\n                                {num}\r\n                              </span>\r\n                            ))}\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n              ))}\r\n            </div>\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"history\" className=\"mt-0 animate-in fade-in-0 slide-in-from-bottom-2 duration-300\">\r\n            <div className=\"space-y-4\">\r\n              {displayedRoulettes.map((roulette) => (\r\n                <Card key={roulette.id}>\r\n                  <CardHeader>\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <div>\r\n                        <CardTitle className=\"flex items-center gap-2\">\r\n                             {roulette.name}\r\n                             <Badge variant={getStatusColor(roulette.status)}>\r\n                               {getStatusText(roulette.status)}\r\n                             </Badge>\r\n                           </CardTitle>\r\n                        <CardDescription>\r\n                          Histórico completo dos últimos {lastXSpins} números\r\n                        </CardDescription>\r\n                      </div>\r\n                      <div className=\"flex gap-2\">\r\n                        <Button variant=\"outline\" size=\"sm\" className=\"gap-1\">\r\n                          <Bell className=\"h-4 w-4\" />\r\n                          Configurar Alerta\r\n                        </Button>\r\n                        <Button variant=\"outline\" size=\"sm\" className=\"gap-1\">\r\n                          <Download className=\"h-4 w-4\" />\r\n                          Exportar\r\n                        </Button>\r\n                      </div>\r\n                    </div>\r\n                  </CardHeader>\r\n                  <CardContent>\r\n                    <div className=\"space-y-6\">\r\n                      {/* Estatísticas Rápidas */}\r\n                      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n                        <div className=\"text-center p-3 bg-muted/50 rounded-lg\">\r\n                          <div className=\"text-2xl font-bold text-primary\">{roulette.totalSpins}</div>\r\n                          <div className=\"text-sm text-muted-foreground\">Total de Giros</div>\r\n                        </div>\r\n                        <div className=\"text-center p-3 bg-muted/50 rounded-lg\">\r\n                          <div className=\"text-2xl font-bold text-red-500\">{roulette.hotNumbers.length}</div>\r\n                          <div className=\"text-sm text-muted-foreground\">Números Quentes</div>\r\n                        </div>\r\n                        <div className=\"text-center p-3 bg-muted/50 rounded-lg\">\r\n                          <div className=\"text-2xl font-bold text-blue-500\">{roulette.coldNumbers.length}</div>\r\n                          <div className=\"text-sm text-muted-foreground\">Números Frios</div>\r\n                        </div>\r\n                        <div className=\"text-center p-3 bg-muted/50 rounded-lg\">\r\n                          <div className=\"text-2xl font-bold text-green-500\">{roulette.lastNumbers[0]}</div>\r\n                          <div className=\"text-sm text-muted-foreground\">Último Número</div>\r\n                        </div>\r\n                      </div>\r\n\r\n                      {/* Tabela de Histórico */}\r\n                      <div>\r\n                        <div className=\"flex items-center justify-between mb-3\">\r\n                          <h4 className=\"text-lg font-semibold\">Histórico de Números</h4>\r\n                          <div className=\"text-sm text-muted-foreground\">\r\n                            Exibindo {getFilteredNumbers(roulette.lastNumbers).length} de {roulette.lastNumbers.length} números\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"border rounded-lg overflow-hidden\">\r\n                          <div className={`${parseInt(lastXSpins) >= 100 ? 'max-h-96 overflow-y-auto' : ''} p-4 bg-muted/30`}>\r\n                            <div className=\"grid grid-cols-10 gap-1\">\r\n                              {getFilteredNumbers(roulette.lastNumbers).map((num, index) => (\r\n                                <div key={index} className=\"text-center\">\r\n                                  <div className=\"text-xs text-muted-foreground mb-1\">#{getFilteredNumbers(roulette.lastNumbers).length - index}</div>\r\n                                  <div \r\n                                    data-number={num}\r\n                                    className={`inline-flex items-center justify-center h-10 w-10 rounded-full text-sm font-medium cursor-pointer transition-all duration-200 ${\r\n                                      num === 0 ? 'bg-green-600 text-white' :\r\n                                      [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36].includes(num) ? 'bg-red-500 text-white' : 'bg-black text-white'\r\n                                    }`}\r\n                                    onMouseEnter={(e) => handleNumberMouseEnter(num, e)}\r\n                                    onMouseLeave={handleNumberMouseLeave}\r\n                                  >\r\n                                    {num}\r\n                                  </div>\r\n                                </div>\r\n                              ))}\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n\r\n                      {/* Análise de Padrões */}\r\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                        <div>\r\n                          <h4 className=\"text-lg font-semibold mb-3 flex items-center gap-2\">\r\n                            <Flame className=\"h-5 w-5 text-red-500\" />\r\n                            Análise de Números Quentes\r\n                          </h4>\r\n                          <div className=\"space-y-2\">\r\n                            {roulette.hotNumbers.map((num, index) => (\r\n                              <div key={index} className=\"flex items-center justify-between p-2 bg-red-50 dark:bg-red-950/20 rounded\">\r\n                                <div className=\"flex items-center gap-2\">\r\n                                  <span \r\n                                    className={`inline-flex items-center justify-center h-6 w-6 rounded-full text-xs font-medium ${\r\n                                      num === 0 ? 'bg-green-600 text-white' :\r\n                                      [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36].includes(num) ? 'bg-red-500 text-white' : 'bg-black text-white'\r\n                                    }`}\r\n                                  >\r\n                                    {num}\r\n                                  </span>\r\n                                  <span className=\"font-medium\">Número {num}</span>\r\n                                </div>\r\n                                <span className=\"text-sm text-muted-foreground\">{Math.floor(Math.random() * 10) + 5} aparições</span>\r\n                              </div>\r\n                            ))}\r\n                          </div>\r\n                        </div>\r\n                        \r\n                        <div>\r\n                          <h4 className=\"text-lg font-semibold mb-3 flex items-center gap-2\">\r\n                            <Snowflake className=\"h-5 w-5 text-blue-500\" />\r\n                            Análise de Números Frios\r\n                          </h4>\r\n                          <div className=\"space-y-2\">\r\n                            {roulette.coldNumbers.map((num, index) => (\r\n                              <div key={index} className=\"flex items-center justify-between p-2 bg-blue-50 dark:bg-blue-950/20 rounded\">\r\n                                <div className=\"flex items-center gap-2\">\r\n                                  <span \r\n                                    className={`inline-flex items-center justify-center h-6 w-6 rounded-full text-xs font-medium ${\r\n                                      num === 0 ? 'bg-green-600 text-white' :\r\n                                      [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36].includes(num) ? 'bg-red-500 text-white' : 'bg-black text-white'\r\n                                    }`}\r\n                                  >\r\n                                    {num}\r\n                                  </span>\r\n                                  <span className=\"font-medium\">Número {num}</span>\r\n                                </div>\r\n                                <span className=\"text-sm text-muted-foreground\">{Math.floor(Math.random() * 3) + 1} aparições</span>\r\n                              </div>\r\n                            ))}\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n              ))}\r\n            </div>\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"heatmap\" className=\"mt-0 animate-in fade-in-0 slide-in-from-bottom-2 duration-300\">\r\n            <Card className=\"mb-6\">\r\n              <CardHeader>\r\n                <CardTitle className=\"flex items-center gap-2\">\r\n                  <BarChart3 className=\"h-5 w-5\" />\r\n                  Mapa de Calor das Roletas\r\n                </CardTitle>\r\n                <CardDescription>\r\n                  Selecione uma roleta para visualizar o mapa de calor detalhado\r\n                </CardDescription>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"space-y-4\">\r\n                  <div className=\"space-y-2\">\r\n                    <Label>Selecionar Roleta</Label>\r\n                    <Select value={selectedRoulette || \"\"} onValueChange={(value) => {\r\n                      setSelectedRoulette(value || null);\r\n                    }}>\r\n                      <SelectTrigger>\r\n                        <SelectValue placeholder=\"Escolha uma roleta...\" />\r\n                      </SelectTrigger>\r\n                      <SelectContent>\r\n                        {displayedRoulettes.map((roulette) => (\r\n                          <SelectItem key={roulette.id} value={roulette.id}>\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <div className={`h-2 w-2 rounded-full ${\r\n                                roulette.status === 'online' ? 'bg-green-500' : \r\n                                roulette.status === 'offline' ? 'bg-red-500' : 'bg-yellow-500'\r\n                              }`} />\r\n                              {roulette.name}\r\n                              {roulette.isMonitored && <Badge variant=\"outline\" className=\"ml-2 text-xs\">Monitorada</Badge>}\r\n                            </div>\r\n                          </SelectItem>\r\n                        ))}\r\n                      </SelectContent>\r\n                    </Select>\r\n                  </div>\r\n                  \r\n                  {selectedRoulette && (\r\n                    <div className=\"flex items-center gap-4 p-3 bg-muted rounded-lg\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <div className={`h-3 w-3 rounded-full ${\r\n                          roulettes.find(r => r.id === selectedRoulette)?.status === 'online' ? 'bg-green-500' : \r\n                          roulettes.find(r => r.id === selectedRoulette)?.status === 'offline' ? 'bg-red-500' : 'bg-yellow-500'\r\n                        }`} />\r\n                        <span className=\"font-medium\">{roulettes.find(r => r.id === selectedRoulette)?.name}</span>\r\n                      </div>\r\n                      <Badge className={getStatusColor(roulettes.find(r => r.id === selectedRoulette)?.status || 'offline')}>\r\n                        {getStatusText(roulettes.find(r => r.id === selectedRoulette)?.status || 'offline')}\r\n                      </Badge>\r\n                      <span className=\"text-sm text-muted-foreground\">\r\n                        {roulettes.find(r => r.id === selectedRoulette)?.totalSpins} giros totais\r\n                      </span>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            {selectedRoulette ? (\r\n              <RouletteHeatmap\r\n                data={heatmapData}\r\n                title={`Mapa de Calor - ${roulettes.find(r => r.id === selectedRoulette)?.name}`}\r\n                description={`Frequência dos números baseada nos últimos ${lastXSpins} giros (filtro: ${timeFilter})`}\r\n                showStats={true}\r\n              />\r\n            ) : (\r\n              <Card>\r\n                <CardContent className=\"flex items-center justify-center py-12\">\r\n                  <div className=\"text-center text-muted-foreground\">\r\n                    <BarChart3 className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\r\n                    <p>Selecione uma roleta acima para visualizar o mapa de calor</p>\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n            )}\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"analytics\" className=\"mt-0 animate-in fade-in-0 slide-in-from-bottom-2 duration-300\">\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n              {displayedRoulettes.map((roulette) => (\r\n                <Card key={roulette.id}>\r\n                  <CardHeader>\r\n                    <CardTitle className=\"flex items-center gap-2\">\r\n                      <BarChart3 className=\"h-5 w-5\" />\r\n                      Análises - {roulette.name}\r\n                    </CardTitle>\r\n                    <CardDescription>\r\n                      Padrões e tendências identificadas\r\n                    </CardDescription>\r\n                  </CardHeader>\r\n                  <CardContent>\r\n                    <div className=\"space-y-6\">\r\n                      {/* Distribuição por Cor */}\r\n                      <div>\r\n                        <h4 className=\"font-semibold mb-3\">Distribuição por Cor</h4>\r\n                        <div className=\"space-y-2\">\r\n                          <div className=\"flex items-center justify-between\">\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <div className=\"h-4 w-4 bg-red-500 rounded\"></div>\r\n                              <span>Vermelho</span>\r\n                            </div>\r\n                            <span className=\"font-medium\">\r\n                              {getFilteredNumbers(roulette.lastNumbers).filter(n => [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36].includes(n)).length}\r\n                            </span>\r\n                          </div>\r\n                          <div className=\"flex items-center justify-between\">\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <div className=\"h-4 w-4 bg-black rounded\"></div>\r\n                              <span>Preto</span>\r\n                            </div>\r\n                            <span className=\"font-medium\">\r\n                              {getFilteredNumbers(roulette.lastNumbers).filter(n => ![1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36,0].includes(n)).length}\r\n                            </span>\r\n                          </div>\r\n                          <div className=\"flex items-center justify-between\">\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <div className=\"h-4 w-4 bg-green-600 rounded\"></div>\r\n                              <span>Zero</span>\r\n                            </div>\r\n                            <span className=\"font-medium\">\r\n                              {getFilteredNumbers(roulette.lastNumbers).filter(n => n === 0).length}\r\n                            </span>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n\r\n                      {/* Padrões Detectados */}\r\n                      <div>\r\n                        <h4 className=\"font-semibold mb-3\">Padrões Detectados</h4>\r\n                        <div className=\"space-y-2\">\r\n                          <div className=\"p-3 bg-yellow-50 dark:bg-yellow-950/20 rounded-lg\">\r\n                            <div className=\"flex items-center gap-2 mb-1\">\r\n                              <div className=\"h-2 w-2 bg-yellow-500 rounded-full\"></div>\r\n                              <span className=\"font-medium text-sm\">Sequência de Vermelhos</span>\r\n                            </div>\r\n                            <p className=\"text-xs text-muted-foreground\">3 números vermelhos consecutivos detectados</p>\r\n                          </div>\r\n                          <div className=\"p-3 bg-blue-50 dark:bg-blue-950/20 rounded-lg\">\r\n                            <div className=\"flex items-center gap-2 mb-1\">\r\n                              <div className=\"h-2 w-2 bg-blue-500 rounded-full\"></div>\r\n                              <span className=\"font-medium text-sm\">Números Vizinhos</span>\r\n                            </div>\r\n                            <p className=\"text-xs text-muted-foreground\">Números próximos na roda apareceram recentemente</p>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n\r\n                      {/* Ações Recomendadas */}\r\n                      <div>\r\n                        <h4 className=\"font-semibold mb-3\">Ações Recomendadas</h4>\r\n                        <div className=\"space-y-2\">\r\n                          <Button variant=\"outline\" size=\"sm\" className=\"w-full gap-2\">\r\n                            <Bell className=\"h-4 w-4\" />\r\n                            Configurar Alerta para Padrão\r\n                          </Button>\r\n                          <Button variant=\"outline\" size=\"sm\" className=\"w-full gap-2\">\r\n                            <Download className=\"h-4 w-4\" />\r\n                            Exportar Análise Completa\r\n                          </Button>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n              ))}\r\n            </div>\r\n          </TabsContent>\r\n\r\n          {/* Aba de Comparação */}\r\n          <TabsContent value=\"comparison\" className=\"mt-0 animate-in fade-in-0 slide-in-from-bottom-2 duration-300\">\r\n            <div className=\"space-y-6\">\r\n              <div className=\"flex justify-between items-center\">\r\n                <h3 className=\"text-lg font-semibold\">Comparação de Roletas</h3>\r\n                <Button \r\n                  variant=\"outline\" \r\n                  size=\"sm\"\r\n                  onClick={() => {\r\n                    setSelectedForComparison([])\r\n                    setCompareMode(false)\r\n                  }}\r\n                >\r\n                  Limpar Seleção\r\n                </Button>\r\n              </div>\r\n              \r\n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n                {selectedForComparison.map(rouletteId => {\r\n                  const roulette = roulettes.find((r: Roulette) => r.id === rouletteId)\r\n                  if (!roulette) return null\r\n                  \r\n                  return (\r\n                    <Card key={roulette.id}>\r\n                      <CardHeader>\r\n                        <div className=\"flex justify-between items-center\">\r\n                          <CardTitle className=\"flex items-center gap-2\">\r\n                            {roulette.name}\r\n                            <Badge className={getStatusColor(roulette.status)}>\r\n                              {getStatusText(roulette.status)}\r\n                            </Badge>\r\n                          </CardTitle>\r\n                          <Button \r\n                            variant=\"ghost\" \r\n                            size=\"sm\"\r\n                            onClick={() => toggleComparison(roulette.id)}\r\n                          >\r\n                            ✕\r\n                          </Button>\r\n                        </div>\r\n                      </CardHeader>\r\n                      <CardContent>\r\n                        <div className=\"space-y-4\">\r\n                          <div className=\"grid grid-cols-2 gap-4\">\r\n                            <div className=\"text-center\">\r\n                              <div className=\"text-2xl font-bold text-green-600\">{roulette.lastNumbers[0]}</div>\r\n                              <div className=\"text-sm text-muted-foreground\">Último Número</div>\r\n                            </div>\r\n                            <div className=\"text-center\">\r\n                              <div className=\"text-2xl font-bold\">{roulette.totalSpins}</div>\r\n                              <div className=\"text-sm text-muted-foreground\">Total de Giros</div>\r\n                            </div>\r\n                          </div>\r\n                          \r\n                          <div>\r\n                            <div className=\"text-sm font-medium mb-2\">Últimos 10 Números</div>\r\n                            <div className=\"flex flex-wrap gap-1\">\r\n                              {roulette.lastNumbers.slice(0, 10).map((num: number, idx: number) => (\r\n                                <Badge \r\n                                  key={idx} \r\n                                  variant=\"outline\" \r\n                                  className=\"text-xs cursor-pointer transition-all duration-200\"\r\n                                  data-number={num}\r\n                                  onMouseEnter={(e) => handleNumberMouseEnter(num, e)}\r\n                                  onMouseLeave={handleNumberMouseLeave}\r\n                                >\r\n                                  {num}\r\n                                </Badge>\r\n                              ))}\r\n                            </div>\r\n                          </div>\r\n                          \r\n                          <div>\r\n                            <div className=\"text-sm font-medium mb-2\">Números Quentes</div>\r\n                            <div className=\"flex flex-wrap gap-1\">\r\n                              {roulette.hotNumbers.map((num: number, idx: number) => (\r\n                                <Badge \r\n                                  key={idx} \r\n                                  variant=\"destructive\" \r\n                                  className=\"text-xs cursor-pointer transition-all duration-200\"\r\n                                  data-number={num}\r\n                                  onMouseEnter={(e) => handleNumberMouseEnter(num, e)}\r\n                                  onMouseLeave={handleNumberMouseLeave}\r\n                                >\r\n                                  {num}\r\n                                </Badge>\r\n                              ))}\r\n                            </div>\r\n                          </div>\r\n                          \r\n                          <div>\r\n                            <div className=\"text-sm font-medium mb-2\">Números Frios</div>\r\n                            <div className=\"flex flex-wrap gap-1\">\r\n                              {roulette.coldNumbers.map((num: number, idx: number) => (\r\n                                <Badge \r\n                                  key={idx} \r\n                                  variant=\"secondary\" \r\n                                  className=\"text-xs cursor-pointer transition-all duration-200\"\r\n                                  data-number={num}\r\n                                  onMouseEnter={(e) => handleNumberMouseEnter(num, e)}\r\n                                  onMouseLeave={handleNumberMouseLeave}\r\n                                >\r\n                                  {num}\r\n                                </Badge>\r\n                              ))}\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      </CardContent>\r\n                    </Card>\r\n                  )\r\n                })}\r\n              </div>\r\n              \r\n              {selectedForComparison.length > 1 && (\r\n                <Card>\r\n                  <CardHeader>\r\n                    <CardTitle>Análise Comparativa</CardTitle>\r\n                  </CardHeader>\r\n                  <CardContent>\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                      <div className=\"text-center\">\r\n                        <div className=\"text-lg font-semibold\">Números em Comum (Quentes)</div>\r\n                        <div className=\"flex flex-wrap gap-1 justify-center mt-2\">\r\n                          {/* Simulação de números quentes em comum */}\r\n                          <Badge variant=\"destructive\">7</Badge>\r\n                          <Badge variant=\"destructive\">23</Badge>\r\n                          <Badge variant=\"destructive\">31</Badge>\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"text-center\">\r\n                        <div className=\"text-lg font-semibold\">Padrões Similares</div>\r\n                        <div className=\"mt-2\">\r\n                          <Badge variant=\"outline\">Sequências Pares</Badge>\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"text-center\">\r\n                        <div className=\"text-lg font-semibold\">Divergências</div>\r\n                        <div className=\"mt-2\">\r\n                          <Badge variant=\"secondary\">Velocidade de Giro</Badge>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n              )}\r\n            </div>\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"metrics\" className=\"mt-0 animate-in fade-in-0 slide-in-from-bottom-2 duration-300\">\r\n            <MetricsTab \r\n              roulettes={displayedRoulettes}\r\n              performanceMetrics={performanceMetrics}\r\n              spinVelocity={spinVelocity}\r\n              trendAnalysis={trendAnalysis}\r\n              realTimeAlerts={realTimeAlerts}\r\n            />\r\n          </TabsContent>\r\n        </Tabs>\r\n      </div>\r\n    </DashboardLayout>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/security-check/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/settings/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/simulator/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/strategies/page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'strategyDescriptions.length'. Either include it or remove the dependency array.","line":88,"column":6,"nodeType":"ArrayExpression","endLine":88,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [activeTab, strategyDescriptions.length]","fix":{"range":[2780,2791],"text":"[activeTab, strategyDescriptions.length]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'applyFilters'. Either include it or remove the dependency array.","line":93,"column":6,"nodeType":"ArrayExpression","endLine":93,"endColumn":37,"suggestions":[{"desc":"Update the dependencies array to be: [strategyDescriptions, filters, applyFilters]","fix":{"range":[2879,2910],"text":"[strategyDescriptions, filters, applyFilters]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport { DashboardLayout } from '@/components/dashboard/layout'\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport { Switch } from '@/components/ui/switch'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Badge } from '@/components/ui/badge'\r\nimport { Separator } from '@/components/ui/separator'\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'\r\nimport { toast } from 'sonner'\r\nimport { Loader2, Save, RotateCcw, Settings, Target, Table, BookOpen } from 'lucide-react'\r\nimport { StrategyFilter } from '@/components/dashboard/strategy-filter'\r\nimport { StrategyGrid } from '@/components/dashboard/strategy-grid'\r\nimport { apiClient } from '@/lib/api-client'\r\n\r\ninterface Strategy {\r\n  id: string\r\n  name: string\r\n  enabled: boolean\r\n  origin?: 'curated' | 'builder'\r\n  status?: 'active' | 'paused' | string\r\n}\r\n\r\ninterface StrategyDescription {\r\n  name: string\r\n  description: string\r\n  logic: string\r\n  focus: string\r\n  risk: string\r\n  recommendedChips: string\r\n  category: string\r\n}\r\n\r\ninterface FilterState {\r\n  search: string\r\n  category: string\r\n  risk: string\r\n  chips: string\r\n}\r\n\r\ninterface RouletteTable {\r\n  id: string\r\n  name: string\r\n  enabled: boolean\r\n}\r\n\r\ninterface UserPreferences {\r\n  strategies: string[]\r\n  tables: string[]\r\n}\r\n\r\ninterface AvailableOptions {\r\n  strategies: string[]\r\n  tables: { id: string; name: string }[]\r\n  default_preferences: UserPreferences\r\n}\r\n\r\nexport default function EstrategiasAtivas() {\r\n  const [strategies, setStrategies] = useState<Strategy[]>([])\r\n  const [tables, setTables] = useState<RouletteTable[]>([])\r\n  const [strategyDescriptions, setStrategyDescriptions] = useState<StrategyDescription[]>([])\r\n  const [filteredDescriptions, setFilteredDescriptions] = useState<StrategyDescription[]>([])\r\n  const [categories, setCategories] = useState<string[]>([])\r\n  const [loading, setLoading] = useState(true)\r\n  const [descriptionsLoading, setDescriptionsLoading] = useState(false)\r\n  const [saving, setSaving] = useState(false)\r\n  const [hasChanges, setHasChanges] = useState(false)\r\n  const [activeTab, setActiveTab] = useState('active')\r\n  const [filters, setFilters] = useState<FilterState>({\r\n    search: '',\r\n    category: '',\r\n    risk: '',\r\n    chips: ''\r\n  })\r\n  const [builderStrategyIds, setBuilderStrategyIds] = useState<string[]>([])\r\n\r\n  // Carregar opções disponíveis e preferências do usuário\r\n  useEffect(() => {\r\n    loadData()\r\n  }, [])\r\n\r\n  // Carregar descrições de estratégias quando a aba for ativada\r\n  useEffect(() => {\r\n    if (activeTab === 'descriptions' && strategyDescriptions.length === 0) {\r\n      loadStrategyDescriptions()\r\n    }\r\n  }, [activeTab])\r\n\r\n  // Aplicar filtros nas descrições\r\n  useEffect(() => {\r\n    applyFilters()\r\n  }, [strategyDescriptions, filters])\r\n\r\n  const loadStrategyDescriptions = async () => {\r\n    try {\r\n      setDescriptionsLoading(true)\r\n      const response = await apiClient.getStrategyDescriptions()\r\n      \r\n      if (response.data && Array.isArray((response.data as any).strategies)) {\r\n        setStrategyDescriptions((response.data as any).strategies)\r\n        setCategories((response.data as any).categories || [])\r\n      } else if (response.data && Array.isArray(response.data)) {\r\n        // Caso a resposta seja diretamente um array de estratégias\r\n        setStrategyDescriptions(response.data as StrategyDescription[])\r\n      }\r\n    } catch (error) {\r\n      toast.error('Erro ao carregar descrições de estratégias')\r\n    } finally {\r\n      setDescriptionsLoading(false)\r\n    }\r\n  }\r\n\r\n  const applyFilters = () => {\r\n    let filtered = [...strategyDescriptions]\r\n\r\n    // Filtro por busca\r\n    if (filters.search) {\r\n      const searchLower = filters.search.toLowerCase()\r\n      filtered = filtered.filter(strategy => \r\n        strategy.name.toLowerCase().includes(searchLower) ||\r\n        strategy.description.toLowerCase().includes(searchLower) ||\r\n        strategy.focus.toLowerCase().includes(searchLower)\r\n      )\r\n    }\r\n\r\n    // Filtro por categoria\r\n    if (filters.category && filters.category !== 'all') {\r\n      filtered = filtered.filter(strategy => strategy.category === filters.category)\r\n    }\r\n\r\n    // Filtro por risco\r\n    if (filters.risk && filters.risk !== 'all') {\r\n      filtered = filtered.filter(strategy => strategy.risk === filters.risk)\r\n    }\r\n\r\n    // Filtro por fichas\r\n    if (filters.chips && filters.chips !== 'all') {\r\n      filtered = filtered.filter(strategy => strategy.recommendedChips === filters.chips)\r\n    }\r\n\r\n    setFilteredDescriptions(filtered)\r\n  }\r\n\r\n  const handleFilterChange = (newFilters: FilterState) => {\r\n    setFilters(newFilters)\r\n  }\r\n\r\n  const loadData = async () => {\r\n    try {\r\n      setLoading(true)\r\n      \r\n      // Buscar opções disponíveis, preferências do usuário e estratégias do Builder\r\n      const [availableResponse, preferencesResponse, builderResponse] = await Promise.all([\r\n        fetch('/api/available-options'),\r\n        fetch('/api/user-preferences'),\r\n        fetch('/api/strategies').catch(() => null as any)\r\n      ])\r\n\r\n      let availableOptions: AvailableOptions\r\n      let userPreferences: UserPreferences | null = null\r\n\r\n      if (availableResponse.ok) {\r\n        availableOptions = await availableResponse.json()\r\n      } else {\r\n        // Fallback para dados padrão se a API não estiver disponível\r\n        availableOptions = {\r\n          strategies: [\r\n            'Irmãos de Cores',\r\n            'Terminais Pull',\r\n            'Espelho',\r\n            'Onda',\r\n            'As Dúzias (Atrasadas)',\r\n            'Terminais que se Puxam',\r\n            'Os Opostos',\r\n            'Cavalo/Linha',\r\n            'Sequência de Números',\r\n            'Padrão Fibonacci'\r\n          ],\r\n          tables: [],\r\n          default_preferences: {\r\n            strategies: [],\r\n            tables: []\r\n          }\r\n        }\r\n        \r\n        // Buscar mesas de roleta da API real\r\n        try {\r\n          const tablesResponse = await fetch('/api/roulette-tables')\r\n          \r\n          if (tablesResponse.ok) {\r\n            const tablesData = await tablesResponse.json()\r\n            availableOptions.tables = tablesData.map((table: any) => ({\r\n              id: table.id,\r\n              name: table.name\r\n            }))\r\n          }\r\n        } catch (error) {\r\n          // Erro silencioso - mesas serão carregadas do fallback\r\n        }\r\n      }\r\n\r\n      if (preferencesResponse.ok) {\r\n        userPreferences = await preferencesResponse.json()\r\n      }\r\n\r\n      // Se não há preferências do usuário, usar preferências padrão\r\n      if (!userPreferences) {\r\n        userPreferences = availableOptions.default_preferences\r\n      }\r\n\r\n      // Configurar estratégias curadas com estado baseado nas preferências\r\n      const curatedStrategies: Strategy[] = availableOptions.strategies.map(strategyName => ({\r\n        id: strategyName,\r\n        name: strategyName,\r\n        enabled: userPreferences?.strategies.includes(strategyName) ?? true,\r\n        origin: 'curated',\r\n        status: (userPreferences?.strategies.includes(strategyName) ? 'active' : 'paused')\r\n      }))\r\n\r\n      // Configurar mesas com estado baseado nas preferências\r\n      // Mostrar TODAS as mesas disponíveis, não apenas as que estão nas preferências\r\n      const tablesWithState: RouletteTable[] = availableOptions.tables.map(table => ({\r\n        id: table.id,\r\n        name: table.name,\r\n        enabled: userPreferences?.tables.includes(table.id) ?? false // Padrão false para mostrar que não estão sendo monitoradas\r\n      }))\r\n\r\n      // Ordenar mesas: ativas por padrão primeiro, depois as outras\r\n      const defaultTables = availableOptions.default_preferences.tables\r\n      tablesWithState.sort((a, b) => {\r\n        const aIsDefault = defaultTables.includes(a.id)\r\n        const bIsDefault = defaultTables.includes(b.id)\r\n        \r\n        if (aIsDefault && !bIsDefault) return -1\r\n        if (!aIsDefault && bIsDefault) return 1\r\n        return a.name.localeCompare(b.name)\r\n      })\r\n\r\n      // Carregar estratégias do Builder do backend\r\n      let builderList: any[] = []\r\n      if (builderResponse && builderResponse.ok) {\r\n        const builderData = await builderResponse.json()\r\n        builderList = Array.isArray(builderData) ? builderData : (builderData?.strategies || [])\r\n      }\r\n      const builderStrategies: Strategy[] = builderList.map((s: any) => ({\r\n        id: s.id,\r\n        name: s.name || s.id,\r\n        enabled: String(s.status || '').toLowerCase() === 'active',\r\n        origin: 'builder',\r\n        status: String(s.status || '').toLowerCase() === 'active' ? 'active' : 'paused'\r\n      }))\r\n      setBuilderStrategyIds(builderStrategies.map(s => s.id))\r\n\r\n      // Unificar listas (curadas + Builder)\r\n      setStrategies([...curatedStrategies, ...builderStrategies])\r\n      setTables(tablesWithState)\r\n      setHasChanges(false)\r\n    } catch (error) {\r\n      toast.error('Erro ao carregar configurações')\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    try {\r\n      const bc = new BroadcastChannel('strategies')\r\n      bc.onmessage = (ev: MessageEvent) => {\r\n        const msg: any = (ev && (ev as any).data) || (ev as any)\r\n        if (msg?.type === 'strategy_saved') {\r\n          loadData()\r\n        }\r\n      }\r\n      return () => bc.close()\r\n    } catch (_) {\r\n      // ambientes sem BroadcastChannel\r\n    }\r\n  }, [])\r\n\r\n  const toggleStrategy = async (strategyId: string) => {\r\n    const isBuilder = builderStrategyIds.includes(strategyId)\r\n    const current = strategies.find(s => s.id === strategyId)\r\n    const enabling = !(current?.enabled)\r\n\r\n    setStrategies(prev => \r\n      prev.map(s => \r\n        s.id === strategyId \r\n          ? { ...s, enabled: !s.enabled, status: !s.enabled ? 'active' : 'paused' }\r\n          : s\r\n      )\r\n    )\r\n\r\n    if (isBuilder) {\r\n      try {\r\n        const resp = await fetch('/api/automation/auto-entry/toggle', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({ strategy_id: strategyId, enabled: enabling })\r\n        })\r\n        if (!resp.ok) {\r\n          const data = await resp.json().catch(() => ({}))\r\n          throw new Error(String((data as any)?.error || resp.statusText))\r\n        }\r\n        toast.success(enabling ? 'Estratégia ativada.' : 'Estratégia pausada.')\r\n      } catch (error) {\r\n        toast.error('Erro ao alternar estratégia do Builder')\r\n      }\r\n    } else {\r\n      setHasChanges(true)\r\n    }\r\n  }\r\n\r\n  const toggleTable = (tableId: string) => {\r\n    setTables(prev => \r\n      prev.map(table => \r\n        table.id === tableId \r\n          ? { ...table, enabled: !table.enabled }\r\n          : table\r\n      )\r\n    )\r\n    setHasChanges(true)\r\n  }\r\n\r\n  const savePreferences = async () => {\r\n    try {\r\n      setSaving(true)\r\n      \r\n      const preferences: UserPreferences = {\r\n        strategies: strategies\r\n          .filter(s => !builderStrategyIds.includes(s.id))\r\n          .filter(s => s.enabled)\r\n          .map(s => s.id),\r\n        tables: tables.filter(t => t.enabled).map(t => t.id)\r\n      }\r\n\r\n      const response = await fetch('/api/user-preferences', {\r\n        method: 'PUT',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify(preferences)\r\n      })\r\n\r\n      if (response.ok) {\r\n        setHasChanges(false)\r\n        toast.success('Configurações salvas com sucesso!')\r\n      } else {\r\n        throw new Error('Falha ao salvar preferências')\r\n      }\r\n    } catch (error) {\r\n      toast.error('Erro ao salvar configurações')\r\n    } finally {\r\n      setSaving(false)\r\n    }\r\n  }\r\n\r\n  const resetToDefaults = async () => {\r\n    try {\r\n      // Buscar preferências padrão curadas da API\r\n      const response = await fetch('/api/available-options')\r\n\r\n      if (response.ok) {\r\n        const data = await response.json()\r\n        const defaultPreferences = data.default_preferences\r\n\r\n        // Restaurar estratégias baseadas no padrão curado\r\n        setStrategies(prev => \r\n          prev.map(strategy => ({\r\n            ...strategy,\r\n            enabled: defaultPreferences.strategies.includes(strategy.id),\r\n            status: defaultPreferences.strategies.includes(strategy.id) ? 'active' : 'paused'\r\n          }))\r\n        )\r\n\r\n        // Restaurar mesas baseadas no padrão curado\r\n        setTables(prev => \r\n          prev.map(table => ({\r\n            ...table,\r\n            enabled: defaultPreferences.tables.includes(table.id)\r\n          }))\r\n        )\r\n\r\n        setHasChanges(true)\r\n        toast.info('Configurações restauradas para o padrão curado')\r\n      } else {\r\n        throw new Error('Falha ao buscar configurações padrão')\r\n      }\r\n    } catch (error) {\r\n      toast.error('Erro ao restaurar configurações padrão')\r\n    }\r\n  }\r\n\r\n  const enabledStrategiesCount = strategies.filter(s => s.enabled).length\r\n  const enabledTablesCount = tables.filter(t => t.enabled).length\r\n\r\n  if (loading) {\r\n    return (\r\n      <DashboardLayout>\r\n        <div className=\"container mx-auto p-6\">\r\n          <div className=\"flex items-center justify-center min-h-[400px]\">\r\n            <div className=\"flex items-center space-x-2\">\r\n              <Loader2 className=\"h-6 w-6 animate-spin\" />\r\n              <span>Carregando configurações...</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </DashboardLayout>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <DashboardLayout>\r\n      <div className=\"container mx-auto p-6 space-y-6\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between\">\r\n          <div className=\"space-y-1\">\r\n            <h1 className=\"text-3xl font-bold tracking-tight flex items-center gap-2\">\r\n              <Settings className=\"h-8 w-8\" />\r\n              Estratégias\r\n            </h1>\r\n            <p className=\"text-muted-foreground\">\r\n              Gerencie suas estratégias ativas e explore descrições detalhadas\r\n            </p>\r\n          </div>\r\n          \r\n          {activeTab === 'active' && (\r\n            <div className=\"flex items-center gap-2\">\r\n              <Button\r\n                variant=\"outline\"\r\n                onClick={resetToDefaults}\r\n                disabled={saving}\r\n              >\r\n                <RotateCcw className=\"h-4 w-4 mr-2\" />\r\n                Restaurar Padrão\r\n              </Button>\r\n              \r\n              <Button\r\n                onClick={savePreferences}\r\n                disabled={!hasChanges || saving}\r\n              >\r\n                {saving ? (\r\n                  <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\r\n                ) : (\r\n                  <Save className=\"h-4 w-4 mr-2\" />\r\n                )}\r\n                Salvar Configurações\r\n              </Button>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Tabs */}\r\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"space-y-6\">\r\n          <TabsList className=\"grid w-full grid-cols-2\">\r\n            <TabsTrigger value=\"active\" className=\"flex items-center gap-2\">\r\n              <Settings className=\"h-4 w-4\" />\r\n              Estratégias Ativas\r\n            </TabsTrigger>\r\n            <TabsTrigger value=\"descriptions\" className=\"flex items-center gap-2\">\r\n              <BookOpen className=\"h-4 w-4\" />\r\n              Descrições de Estratégias\r\n            </TabsTrigger>\r\n          </TabsList>\r\n\r\n          <TabsContent value=\"active\" className=\"space-y-6\">\r\n\r\n        {/* Status Cards */}\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n          <Card>\r\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n              <CardTitle className=\"text-sm font-medium\">Estratégias Ativas</CardTitle>\r\n              <Target className=\"h-4 w-4 text-muted-foreground\" />\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"text-2xl font-bold\">{enabledStrategiesCount}</div>\r\n              <p className=\"text-xs text-muted-foreground\">\r\n                de {strategies.length} disponíveis\r\n              </p>\r\n            </CardContent>\r\n          </Card>\r\n          \r\n          <Card>\r\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n              <CardTitle className=\"text-sm font-medium\">Mesas Monitoradas</CardTitle>\r\n              <Table className=\"h-4 w-4 text-muted-foreground\" />\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"text-2xl font-bold\">{enabledTablesCount}</div>\r\n              <p className=\"text-xs text-muted-foreground\">\r\n                de {tables.length} disponíveis\r\n              </p>\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n\r\n        {/* Estratégias Section */}\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <Target className=\"h-5 w-5\" />\r\n              Estratégias Disponíveis\r\n            </CardTitle>\r\n            <CardDescription>\r\n              Selecione quais estratégias você deseja que a SOFIA monitore e analise\r\n            </CardDescription>\r\n          </CardHeader>\r\n          <CardContent className=\"space-y-4\">\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n              {strategies.map((strategy) => (\r\n                <div\r\n                  key={strategy.id}\r\n                  className=\"flex items-center justify-between p-4 border rounded-lg hover:bg-muted/50 transition-colors\"\r\n                >\r\n                  <div className=\"flex items-center space-x-3\">\r\n                    <Switch\r\n                      checked={strategy.enabled}\r\n                      onCheckedChange={() => toggleStrategy(strategy.id)}\r\n                    />\r\n                    <div>\r\n                      <p className=\"font-medium\">{strategy.name}</p>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <Badge variant=\"outline\" className=\"text-xs\">\r\n                          {strategy.origin === 'builder' ? 'Builder' : 'Curada'}\r\n                        </Badge>\r\n                        <Badge variant={strategy.status === 'active' ? \"default\" : \"secondary\"} className=\"text-xs\">\r\n                          {strategy.status === 'active' ? \"Ativa\" : \"Pausada\"}\r\n                        </Badge>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Separator />\r\n\r\n        {/* Mesas de Roleta Section */}\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <Table className=\"h-5 w-5\" />\r\n              Mesas de Roleta\r\n            </CardTitle>\r\n            <CardDescription>\r\n              Escolha quais mesas de roleta você deseja monitorar para receber os padrões encontrados\r\n            </CardDescription>\r\n          </CardHeader>\r\n          <CardContent className=\"space-y-4\">\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n              {tables.map((table) => (\r\n                <div\r\n                  key={table.id}\r\n                  className=\"flex items-center justify-between p-4 border rounded-lg hover:bg-muted/50 transition-colors\"\r\n                >\r\n                  <div className=\"flex items-center space-x-3\">\r\n                    <Switch\r\n                      checked={table.enabled}\r\n                      onCheckedChange={() => toggleTable(table.id)}\r\n                    />\r\n                    <div>\r\n                      <p className=\"font-medium\">{table.name}</p>\r\n                      <p className=\"text-sm text-muted-foreground\">{table.id}</p>\r\n                      <Badge variant={table.enabled ? \"default\" : \"secondary\"} className=\"text-xs\">\r\n                        {table.enabled ? \"Monitorada\" : \"Inativa\"}\r\n                      </Badge>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n            {/* Warning Message */}\r\n            {hasChanges && (\r\n              <Card className=\"border-orange-200 bg-orange-50 dark:border-orange-800 dark:bg-orange-950\">\r\n                <CardContent className=\"pt-6\">\r\n                  <div className=\"flex items-center space-x-2 text-orange-800 dark:text-orange-200\">\r\n                    <Settings className=\"h-4 w-4\" />\r\n                    <p className=\"text-sm font-medium\">\r\n                      Você tem alterações não salvas. Clique em &quot;Salvar Configurações&quot; para aplicar as mudanças.\r\n                    </p>\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n            )}\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"descriptions\" className=\"space-y-6\">\r\n            {/* Filtros */}\r\n            <StrategyFilter\r\n              categories={categories}\r\n              onFilterChange={handleFilterChange}\r\n              totalStrategies={strategyDescriptions.length}\r\n              filteredCount={filteredDescriptions.length}\r\n            />\r\n\r\n            {/* Grid de Estratégias */}\r\n            <StrategyGrid\r\n              strategies={filteredDescriptions}\r\n              loading={descriptionsLoading}\r\n            />\r\n          </TabsContent>\r\n        </Tabs>\r\n      </div>\r\n    </DashboardLayout>\r\n   )\r\n}","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/strategies/resolver-sandbox/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/strategy-builder/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/template.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/terms/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/test-alerts/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/app/test-recovery/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/middleware.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/app/(home)/_components/partner-kpis.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/app/afiliado/cadastro/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/app/api/auth/session/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/app/api/auth/sign-in/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/app/auth/sign-in/page.backup-20260123.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/app/auth/sign-in/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/app/customers/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/app/dashboard/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/app/finance/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/app/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/app/links/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/app/login/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/app/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/app/partners/login/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/app/partners/me/balance/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/app/partners/me/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/app/partners/sso/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/app/perfil/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/app/providers.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/app/sales/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/components/Auth/AuthGuard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/components/Layouts/header/icons.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/components/Layouts/header/index.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":26,"column":13,"nodeType":"JSXOpeningElement","endLine":26,"endColumn":77}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\nimport Image from \"next/image\";\nimport Link from \"next/link\";\nimport { usePathname } from \"next/navigation\";\nimport { SearchIcon, MenuIcon } from \"./icons\";\nimport { Notification } from \"./notification\";\nimport { useSidebarContext } from \"../sidebar/sidebar-context\";\nimport { UserInfo } from \"./user-info\";\n\nexport function Header() {\n  const { toggleSidebar, isMobile } = useSidebarContext();\n  const pathname = usePathname();\n  if (pathname.startsWith(\"/auth\")) return null;\n  return (\n    <header className=\"sticky top-0 z-30 flex items-center justify-between border-b border-stroke bg-white px-4 py-5 shadow-1 dark:border-stroke-dark dark:bg-gray-dark md:px-5 2xl:px-10\">\n      <button\n        onClick={toggleSidebar}\n        className=\"rounded-lg border px-1.5 py-1 dark:border-stroke-dark dark:bg-[#020D1A] hover:dark:bg-[#FFFFFF1A] lg:hidden\"\n      >\n        <MenuIcon />\n        <span className=\"sr-only\">Alternar Sidebar</span>\n      </button>\n      {isMobile && (\n        <Link href={\"/\"} className=\"ml-2 max-[430px]:hidden min-[375px]:ml-4\">\n          <div className=\"rounded-[5px] bg-black p-1\">\n            <img src=\"/logo_sofia.png\" alt=\"SOFIA\" className=\"h-6 w-auto\" />\n          </div>\n        </Link>\n      )}\n      <div className=\"max-xl:hidden\">\n        <h1 className=\"mb-0.5 text-heading-5 font-bold text-dark dark:text-white\">Dashboard</h1>\n      </div>\n      <div className=\"flex flex-1 items-center justify-end gap-2 min-[375px]:gap-4\">\n        <div className=\"relative w-full max-w-[300px]\">\n          <input\n            type=\"search\"\n            placeholder=\"Pesquisar\"\n            className=\"flex w-full items-center gap-3.5 rounded-full border bg-gray-2 py-3 pl-[53px] pr-5 outline-none transition-colors focus-visible:border-primary dark:border-dark-3 dark:bg-dark-2 dark:hover:border-dark-4 dark:hover:bg-dark-3 dark:hover:text-dark-6 dark:focus-visible:border-primary\"\n          />\n          <SearchIcon className=\"pointer-events-none absolute left-5 top-1/2 -translate-y-1/2 max-[1015px]:size-5\" />\n        </div>\n        <Notification />\n        <div className=\"shrink-0\">\n          <UserInfo />\n        </div>\n      </div>\n    </header>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/components/Layouts/header/notification/icons.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/components/Layouts/header/notification/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/components/Layouts/header/theme-toggle/icons.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/components/Layouts/header/theme-toggle/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/components/Layouts/header/user-info.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/components/Layouts/sidebar/index.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":43,"column":19,"nodeType":"JSXOpeningElement","endLine":43,"endColumn":83}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\nimport Link from \"next/link\";\nimport { usePathname } from \"next/navigation\";\nimport { cn } from \"@/lib/utils\";\nimport { useSidebarContext } from \"./sidebar-context\";\n\nconst NAV = [\n  { title: \"Dashboard\", href: \"/dashboard\" },\n  { title: \"Links\", href: \"/links\" },\n  { title: \"Financeiro\", href: \"/finance\" },\n  { title: \"Vendas\", href: \"/sales\" },\n  { title: \"Clientes\", href: \"/customers\" },\n];\n\nexport function Sidebar() {\n  const pathname = usePathname();\n  const { isOpen, setIsOpen, isMobile, toggleSidebar } = useSidebarContext();\n  if (pathname.startsWith(\"/auth\")) return null;\n  return (\n    <>\n      {isMobile && isOpen && (\n        <div\n          className=\"fixed inset-0 z-40 bg-black/50 transition-opacity duration-300\"\n          onClick={() => setIsOpen(false)}\n          aria-hidden=\"true\"\n        />\n      )}\n      <aside\n        className={cn(\n          \"max-w-[290px] overflow-hidden border-r border-gray-200 bg-white transition-[width] duration-200 ease-linear dark:border-gray-800 dark:bg-gray-dark\",\n          isMobile ? \"fixed bottom-0 top-0 z-50\" : \"sticky top-0 h-screen\",\n          isOpen ? \"w-full\" : \"w-0\",\n        )}\n        aria-label=\"Navegação principal\"\n        aria-hidden={!isOpen}\n        inert={!isOpen}\n      >\n        <div className=\"flex h-full flex-col py-10 pl-[25px] pr-[7px]\">\n          <div className=\"relative pr-4.5\">\n            <Link href={\"/dashboard\"} onClick={() => isMobile && toggleSidebar()} className=\"px-0 py-2.5 min-[850px]:py-0\">\n              <div className=\"flex h-8 items-center\">\n                <div className=\"rounded-[5px] bg-black p-1\">\n                  <img src=\"/logo_sofia.png\" alt=\"SOFIA\" className=\"h-6 w-auto\" />\n                </div>\n              </div>\n            </Link>\n          </div>\n          <nav className=\"custom-scrollbar mt-6 flex-1 overflow-y-auto pr-3 min-[850px]:mt-10\" role=\"navigation\" aria-label=\"Menu\">\n            <ul className=\"space-y-2\">\n              {NAV.map((item) => (\n                <li key={item.href}>\n                  <Link\n                    href={item.href}\n                    className={cn(\n                      \"flex items-center gap-3 rounded-lg px-3 py-3 text-dark outline-none hover:bg-gray-2 focus-visible:bg-gray-2 dark:text-white dark:hover:bg-dark-3 dark:focus-visible:bg-dark-3\",\n                      pathname === item.href && \"bg-gray-2 dark:bg-dark-3\",\n                    )}\n                  >\n                    <span>{item.title}</span>\n                  </Link>\n                </li>\n              ))}\n            </ul>\n          </nav>\n        </div>\n      </aside>\n    </>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/components/Layouts/sidebar/sidebar-context.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/components/logo.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":5,"column":9,"nodeType":"JSXOpeningElement","endLine":5,"endColumn":73}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export function Logo() {\n  return (\n    <div className=\"flex h-8 items-center\">\n      <div className=\"rounded-[5px] bg-black p-1\">\n        <img src=\"/logo_sofia.png\" alt=\"SOFIA\" className=\"h-6 w-auto\" />\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/components/ui/dropdown.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/contexts/auth-context.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/hooks/use-click-outside.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/hooks/use-mobile.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/lib/api/http.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/lib/api/partner.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/lib/api/sso.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/lib/config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/lib/utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/types/icon-props.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/types/partner.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/src/types/set-state-action-type.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/apps/admin/tailwind.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ClientOnly.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/admin/UserStatusSelect.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":1,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":169,"column":54,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[5573,5574],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[5573,5574],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[5573,5574],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[5573,5574],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":1,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":169,"column":70,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[5589,5590],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[5589,5590],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[5589,5590],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[5589,5590],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { \r\n  AccountStatus, \r\n  UserStatus,\r\n  getSelectableStatuses, \r\n  getStatusConfig,\r\n  isValidStatusTransition \r\n} from '@/lib/user-status';\r\n\r\ninterface UserStatusSelectProps {\r\n  currentStatus: AccountStatus | UserStatus | string;\r\n  onStatusChange: (newStatus: AccountStatus | UserStatus) => void;\r\n  disabled?: boolean;\r\n  showTransitionValidation?: boolean;\r\n  className?: string;\r\n}\r\n\r\nexport function UserStatusSelect({\r\n  currentStatus,\r\n  onStatusChange,\r\n  disabled = false,\r\n  showTransitionValidation = true,\r\n  className = ''\r\n}: UserStatusSelectProps) {\r\n  const selectableStatuses = getSelectableStatuses();\r\n  \r\n  const handleChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\r\n    const newStatus = event.target.value as AccountStatus | UserStatus;\r\n    onStatusChange(newStatus);\r\n  };\r\n\r\n  return (\r\n    <div className={`user-status-select ${className}`}>\r\n      <select\r\n        value={currentStatus}\r\n        onChange={handleChange}\r\n        disabled={disabled}\r\n        className=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n      >\r\n        {selectableStatuses.map((status) => {\r\n          const config = getStatusConfig(status.value);\r\n          const isValidTransition = !showTransitionValidation || \r\n            isValidStatusTransition(currentStatus, status.value) ||\r\n            currentStatus === status.value;\r\n          \r\n          return (\r\n            <option\r\n              key={status.value}\r\n              value={status.value}\r\n              disabled={!isValidTransition}\r\n              style={{\r\n                color: isValidTransition ? config.color : '#999',\r\n                opacity: isValidTransition ? 1 : 0.6\r\n              }}\r\n            >\r\n              {status.label}\r\n            </option>\r\n          );\r\n        })}\r\n      </select>\r\n      \r\n      {/* Legenda de cores */}\r\n      <div className=\"mt-2 text-xs text-gray-600\">\r\n        <div className=\"flex flex-wrap gap-2\">\r\n          <span className=\"text-green-600\">✅ Acesso Liberado</span>\r\n          <span className=\"text-red-600\">❌ Acesso Negado</span>\r\n          <span className=\"text-gray-600\">⏸️ Acesso Limitado</span>\r\n          <span className=\"text-yellow-600\">⏳ Pendente</span>\r\n          <span className=\"text-indigo-600\">👑 Administrador</span>\r\n          <span className=\"text-violet-600\">👑 Super Admin</span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// Componente para exibir status atual (read-only)\r\ninterface UserStatusBadgeProps {\r\n  status: AccountStatus | string;\r\n  showDescription?: boolean;\r\n  size?: 'sm' | 'md' | 'lg';\r\n}\r\n\r\nexport function UserStatusBadge({ \r\n  status, \r\n  showDescription = false,\r\n  size = 'md' \r\n}: UserStatusBadgeProps) {\r\n  const config = getStatusConfig(status);\r\n  \r\n  const sizeClasses = {\r\n    sm: 'px-2 py-1 text-xs',\r\n    md: 'px-3 py-1 text-sm',\r\n    lg: 'px-4 py-2 text-base'\r\n  };\r\n\r\n  const colorClasses = {\r\n    green: 'bg-green-100 text-green-800 border-green-200',\r\n    blue: 'bg-blue-100 text-blue-800 border-blue-200',\r\n    gold: 'bg-yellow-100 text-yellow-800 border-yellow-200',\r\n    purple: 'bg-purple-100 text-purple-800 border-purple-200',\r\n    red: 'bg-red-100 text-red-800 border-red-200',\r\n    orange: 'bg-orange-100 text-orange-800 border-orange-200',\r\n    darkred: 'bg-red-200 text-red-900 border-red-300',\r\n    gray: 'bg-gray-100 text-gray-800 border-gray-200',\r\n    yellow: 'bg-yellow-100 text-yellow-800 border-yellow-200'\r\n  };\r\n\r\n  return (\r\n    <div className=\"user-status-badge\">\r\n      <span \r\n        className={`\r\n          inline-flex items-center rounded-full border font-medium\r\n          ${sizeClasses[size]}\r\n          ${colorClasses[config.color as keyof typeof colorClasses] || colorClasses.gray}\r\n        `}\r\n        title={config.label}\r\n      >\r\n        <span className=\"mr-1\">{config.icon}</span>\r\n        {config.label}\r\n      </span>\r\n    </div>\r\n  );\r\n}\r\n\r\n// Componente para histórico de mudanças de status\r\ninterface StatusChangeHistoryProps {\r\n  changes: Array<{\r\n    id: string;\r\n    old_status: AccountStatus | UserStatus;\r\n    new_status: AccountStatus | UserStatus;\r\n    reason?: string;\r\n    changed_by?: string;\r\n    changed_at: string;\r\n  }>;\r\n}\r\n\r\nexport function StatusChangeHistory({ changes }: StatusChangeHistoryProps) {\r\n  if (!changes.length) {\r\n    return (\r\n      <div className=\"text-center py-4 text-gray-500\">\r\n        Nenhuma mudança de status registrada\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"status-change-history\">\r\n      <h3 className=\"text-lg font-semibold mb-3\">Histórico de Status</h3>\r\n      \r\n      <div className=\"space-y-3\">\r\n        {changes.map((change) => (\r\n          <div \r\n            key={change.id}\r\n            className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg border\"\r\n          >\r\n            <div className=\"flex items-center space-x-3\">\r\n              <UserStatusBadge status={change.old_status} size=\"sm\" />\r\n              <span className=\"text-gray-400\">→</span>\r\n              <UserStatusBadge status={change.new_status} size=\"sm\" />\r\n            </div>\r\n            \r\n            <div className=\"text-right text-sm text-gray-600\">\r\n              <div>{new Date(change.changed_at).toLocaleString('pt-BR')}</div>\r\n              {change.changed_by && (\r\n                <div className=\"text-xs\">por {change.changed_by}</div>\r\n              )}\r\n              {change.reason && (\r\n                <div className=\"text-xs italic mt-1\">\"{change.reason}\"</div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/admin/lessons-manager.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/admin/modules-manager.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/affiliates/AffiliateRecipientForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/alerts/alert-notification.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/analytics/analytics-dashboard.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadDashboardData'. Either include it or remove the dependency array.","line":244,"column":6,"nodeType":"ArrayExpression","endLine":244,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [loadDashboardData, selectedDate]","fix":{"range":[7320,7334],"text":"[loadDashboardData, selectedDate]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Dashboard de Analytics\r\n * Visualiza métricas e estatísticas do sistema de analytics\r\n */\r\n\r\n'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Alert, AlertDescription } from '@/components/ui/alert';\r\nimport { Separator } from '@/components/ui/separator';\r\nimport { \r\n  BarChart, \r\n  Bar, \r\n  XAxis, \r\n  YAxis, \r\n  CartesianGrid, \r\n  Tooltip, \r\n  ResponsiveContainer,\r\n  LineChart,\r\n  Line,\r\n  PieChart,\r\n  Pie,\r\n  Cell,\r\n  AreaChart,\r\n  Area\r\n} from 'recharts';\r\nimport { \r\n  Activity, \r\n  Users, \r\n  TrendingUp, \r\n  Clock, \r\n  MousePointer, \r\n  Eye, \r\n  AlertTriangle,\r\n  RefreshCw,\r\n  Download,\r\n  Calendar,\r\n  BarChart3,\r\n  PieChart as PieChartIcon,\r\n  LineChart as LineChartIcon\r\n} from 'lucide-react';\r\nimport { useRealTimeMetrics, useAnalytics } from '@/hooks/use-analytics';\r\nimport { logger } from '@/lib/logger';\r\n\r\n// Cores para gráficos\r\nconst COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042', '#8884D8', '#82CA9D'];\r\n\r\n// Interface para dados do dashboard\r\ninterface DashboardData {\r\n  overview: {\r\n    totalEvents: number;\r\n    uniqueUsers: number;\r\n    pageViews: number;\r\n    apiCalls: number;\r\n    errors: number;\r\n    avgResponseTime: number;\r\n  };\r\n  performance: {\r\n    avgPageLoadTime: number;\r\n    avgFCP: number;\r\n    avgLCP: number;\r\n    errorRate: number;\r\n  };\r\n  engagement: {\r\n    avgTimeOnPage: number;\r\n    avgScrollDepth: number;\r\n    bounceRate: number;\r\n    returnVisitorRate: number;\r\n  };\r\n  business: {\r\n    totalProfit: number;\r\n    winRate: number;\r\n    avgBetAmount: number;\r\n    totalBets: number;\r\n  };\r\n  trends: Array<{\r\n    date: string;\r\n    events: number;\r\n    users: number;\r\n    errors: number;\r\n  }>;\r\n  topPages: Array<{\r\n    page: string;\r\n    views: number;\r\n    avgTime: number;\r\n  }>;\r\n  apiEndpoints: Array<{\r\n    endpoint: string;\r\n    calls: number;\r\n    avgResponseTime: number;\r\n    errorRate: number;\r\n  }>;\r\n}\r\n\r\nexport function AnalyticsDashboard() {\r\n  const [data, setData] = useState<DashboardData | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [selectedDate, setSelectedDate] = useState<string>('today');\r\n  const [refreshing, setRefreshing] = useState(false);\r\n  \r\n  const { metrics, fetchMetrics, fetchPageStats } = useRealTimeMetrics();\r\n  const { track } = useAnalytics();\r\n  \r\n  // Carrega dados do dashboard\r\n  const loadDashboardData = async () => {\r\n    setLoading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      // Simula dados do dashboard (em produção, viria de uma API)\r\n      const mockData: DashboardData = {\r\n        overview: {\r\n          totalEvents: 15420,\r\n          uniqueUsers: 1250,\r\n          pageViews: 8930,\r\n          apiCalls: 4560,\r\n          errors: 23,\r\n          avgResponseTime: 245,\r\n        },\r\n        performance: {\r\n          avgPageLoadTime: 1.2,\r\n          avgFCP: 0.8,\r\n          avgLCP: 2.1,\r\n          errorRate: 0.15,\r\n        },\r\n        engagement: {\r\n          avgTimeOnPage: 180,\r\n          avgScrollDepth: 65,\r\n          bounceRate: 35,\r\n          returnVisitorRate: 42,\r\n        },\r\n        business: {\r\n          totalProfit: 12450.75,\r\n          winRate: 68.5,\r\n          avgBetAmount: 125.30,\r\n          totalBets: 892,\r\n        },\r\n        trends: [\r\n          { date: '2024-01-01', events: 1200, users: 150, errors: 5 },\r\n          { date: '2024-01-02', events: 1350, users: 180, errors: 3 },\r\n          { date: '2024-01-03', events: 1100, users: 140, errors: 8 },\r\n          { date: '2024-01-04', events: 1450, users: 200, errors: 2 },\r\n          { date: '2024-01-05', events: 1600, users: 220, errors: 4 },\r\n          { date: '2024-01-06', events: 1380, users: 190, errors: 6 },\r\n          { date: '2024-01-07', events: 1520, users: 210, errors: 1 },\r\n        ],\r\n        topPages: [\r\n          { page: '/dashboard', views: 2450, avgTime: 240 },\r\n          { page: '/trading', views: 1890, avgTime: 320 },\r\n          { page: '/analytics', views: 1560, avgTime: 180 },\r\n          { page: '/settings', views: 980, avgTime: 120 },\r\n          { page: '/profile', views: 750, avgTime: 90 },\r\n        ],\r\n        apiEndpoints: [\r\n          { endpoint: '/api/ml/predict', calls: 1250, avgResponseTime: 450, errorRate: 0.8 },\r\n          { endpoint: '/api/trading/signals', calls: 980, avgResponseTime: 320, errorRate: 1.2 },\r\n          { endpoint: '/api/auth/login', calls: 560, avgResponseTime: 180, errorRate: 2.1 },\r\n          { endpoint: '/api/user/profile', calls: 340, avgResponseTime: 120, errorRate: 0.3 },\r\n        ],\r\n      };\r\n      \r\n      // Fallback seguro em caso de erro ao buscar dados reais\r\n      const fallbackData: DashboardData = mockData;\r\n      \r\n      // Tentar carregar dados reais do endpoint; fallback para mock em caso de falha\r\n      try {\r\n        const qs = selectedDate ? `?date=${encodeURIComponent(selectedDate)}` : '';\r\n        const res = await fetch(`/api/analytics${qs}`);\r\n        if (res.ok) {\r\n          const payload = await res.json();\r\n          const incoming = (payload && typeof payload === 'object') ? (payload.data ?? payload) : null;\r\n          if (incoming) {\r\n            setData(incoming);\r\n          } else {\r\n            setData(fallbackData);\r\n          }\r\n        } else {\r\n          setData(fallbackData);\r\n        }\r\n      } catch (fetchErr) {\r\n        setData(fallbackData);\r\n      }\r\n\r\n      // Rastreia visualização do dashboard\r\n      track('page_view', 'analytics_dashboard_viewed', {\r\n        dateFilter: selectedDate,\r\n      });\r\n      \r\n    } catch (err) {\r\n      setError(err instanceof Error ? err.message : 'Erro ao carregar dados');\r\n      logger.error('Failed to load dashboard data', { component: 'AnalyticsDashboard', action: 'LOAD_DATA' }, err instanceof Error ? err : new Error(String(err)));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n  \r\n  // Atualiza dados\r\n  const handleRefresh = async () => {\r\n    setRefreshing(true);\r\n    await loadDashboardData();\r\n    await fetchMetrics();\r\n    await fetchPageStats();\r\n    setRefreshing(false);\r\n    \r\n    track('user_action', 'analytics_dashboard_refreshed');\r\n  };\r\n  \r\n  // Exporta dados\r\n  const handleExport = () => {\r\n    if (!data) return;\r\n    \r\n    const exportData = {\r\n      timestamp: new Date().toISOString(),\r\n      dateFilter: selectedDate,\r\n      data,\r\n    };\r\n    \r\n    const blob = new Blob([JSON.stringify(exportData, null, 2)], {\r\n      type: 'application/json',\r\n    });\r\n    \r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = `analytics-${selectedDate}-${Date.now()}.json`;\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    document.body.removeChild(a);\r\n    URL.revokeObjectURL(url);\r\n    \r\n    track('user_action', 'analytics_data_exported', {\r\n      dateFilter: selectedDate,\r\n    });\r\n  };\r\n  \r\n  useEffect(() => {\r\n    loadDashboardData();\r\n  }, [selectedDate]);\r\n  \r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-96\">\r\n        <div className=\"flex items-center space-x-2\">\r\n          <RefreshCw className=\"h-4 w-4 animate-spin\" />\r\n          <span>Carregando analytics...</span>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  if (error) {\r\n    return (\r\n      <Alert variant=\"destructive\">\r\n        <AlertTriangle className=\"h-4 w-4\" />\r\n        <AlertDescription>\r\n          Erro ao carregar dados de analytics: {error}\r\n        </AlertDescription>\r\n      </Alert>\r\n    );\r\n  }\r\n  \r\n  if (!data) {\r\n    return (\r\n      <Alert>\r\n        <AlertTriangle className=\"h-4 w-4\" />\r\n        <AlertDescription>\r\n          Nenhum dado de analytics disponível.\r\n        </AlertDescription>\r\n      </Alert>\r\n    );\r\n  }\r\n  \r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h2 className=\"text-3xl font-bold tracking-tight\">Analytics Dashboard</h2>\r\n          <p className=\"text-muted-foreground\">\r\n            Métricas e insights detalhados do sistema\r\n          </p>\r\n        </div>\r\n        \r\n        <div className=\"flex items-center space-x-2\">\r\n          <Select value={selectedDate} onValueChange={setSelectedDate}>\r\n            <SelectTrigger className=\"w-40\">\r\n              <SelectValue />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              <SelectItem value=\"today\">Hoje</SelectItem>\r\n              <SelectItem value=\"yesterday\">Ontem</SelectItem>\r\n              <SelectItem value=\"7days\">Últimos 7 dias</SelectItem>\r\n              <SelectItem value=\"30days\">Últimos 30 dias</SelectItem>\r\n              <SelectItem value=\"90days\">Últimos 90 dias</SelectItem>\r\n            </SelectContent>\r\n          </Select>\r\n          \r\n          <Button\r\n            variant=\"outline\"\r\n            size=\"sm\"\r\n            onClick={handleRefresh}\r\n            disabled={refreshing}\r\n          >\r\n            <RefreshCw className={`h-4 w-4 mr-2 ${refreshing ? 'animate-spin' : ''}`} />\r\n            Atualizar\r\n          </Button>\r\n          \r\n          <Button\r\n            variant=\"outline\"\r\n            size=\"sm\"\r\n            onClick={handleExport}\r\n          >\r\n            <Download className=\"h-4 w-4 mr-2\" />\r\n            Exportar\r\n          </Button>\r\n        </div>\r\n      </div>\r\n      \r\n      {/* Overview Cards */}\r\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Total de Eventos</CardTitle>\r\n            <Activity className=\"h-4 w-4 text-muted-foreground\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold\">{data.overview.totalEvents.toLocaleString()}</div>\r\n            <p className=\"text-xs text-muted-foreground\">\r\n              +12% em relação ao período anterior\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n        \r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Usuários Únicos</CardTitle>\r\n            <Users className=\"h-4 w-4 text-muted-foreground\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold\">{data.overview.uniqueUsers.toLocaleString()}</div>\r\n            <p className=\"text-xs text-muted-foreground\">\r\n              +8% em relação ao período anterior\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n        \r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Page Views</CardTitle>\r\n            <Eye className=\"h-4 w-4 text-muted-foreground\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold\">{data.overview.pageViews.toLocaleString()}</div>\r\n            <p className=\"text-xs text-muted-foreground\">\r\n              +15% em relação ao período anterior\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n        \r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Tempo de Resposta</CardTitle>\r\n            <Clock className=\"h-4 w-4 text-muted-foreground\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold\">{data.overview.avgResponseTime}ms</div>\r\n            <p className=\"text-xs text-muted-foreground\">\r\n              -5% em relação ao período anterior\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n      \r\n      {/* Tabs */}\r\n      <Tabs defaultValue=\"overview\" className=\"space-y-4\">\r\n        <TabsList>\r\n          <TabsTrigger value=\"overview\">Visão Geral</TabsTrigger>\r\n          <TabsTrigger value=\"performance\">Performance</TabsTrigger>\r\n          <TabsTrigger value=\"engagement\">Engajamento</TabsTrigger>\r\n          <TabsTrigger value=\"business\">Negócio</TabsTrigger>\r\n          <TabsTrigger value=\"trends\">Tendências</TabsTrigger>\r\n        </TabsList>\r\n        \r\n        {/* Overview Tab */}\r\n        <TabsContent value=\"overview\" className=\"space-y-4\">\r\n          <div className=\"grid gap-4 md:grid-cols-2\">\r\n            {/* Gráfico de Eventos por Tipo */}\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Eventos por Tipo</CardTitle>\r\n                <CardDescription>\r\n                  Distribuição dos tipos de eventos coletados\r\n                </CardDescription>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <ResponsiveContainer width=\"100%\" height={300}>\r\n                  <PieChart>\r\n                    <Pie\r\n                      data={[\r\n                        { name: 'Page Views', value: data.overview.pageViews },\r\n                        { name: 'API Calls', value: data.overview.apiCalls },\r\n                        { name: 'User Actions', value: 2100 },\r\n                        { name: 'Errors', value: data.overview.errors },\r\n                      ]}\r\n                      cx=\"50%\"\r\n                      cy=\"50%\"\r\n                      labelLine={false}\r\n                      label={({ name, percent }) => `${name} ${(percent * 100).toFixed(0)}%`}\r\n                      outerRadius={80}\r\n                      fill=\"#8884d8\"\r\n                      dataKey=\"value\"\r\n                    >\r\n                      {data && COLORS.map((color, index) => (\r\n                        <Cell key={`cell-${index}`} fill={color} />\r\n                      ))}\r\n                    </Pie>\r\n                    <Tooltip />\r\n                  </PieChart>\r\n                </ResponsiveContainer>\r\n              </CardContent>\r\n            </Card>\r\n            \r\n            {/* Top Pages */}\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Páginas Mais Visitadas</CardTitle>\r\n                <CardDescription>\r\n                  Páginas com maior número de visualizações\r\n                </CardDescription>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"space-y-4\">\r\n                  {data.topPages.map((page, index) => (\r\n                    <div key={page.page} className=\"flex items-center justify-between\">\r\n                      <div className=\"flex items-center space-x-2\">\r\n                        <Badge variant=\"outline\">{index + 1}</Badge>\r\n                        <span className=\"font-medium\">{page.page}</span>\r\n                      </div>\r\n                      <div className=\"text-right\">\r\n                        <div className=\"font-medium\">{page.views.toLocaleString()}</div>\r\n                        <div className=\"text-xs text-muted-foreground\">\r\n                          {Math.round(page.avgTime)}s médio\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n          \r\n          {/* API Endpoints */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle>Performance dos Endpoints</CardTitle>\r\n              <CardDescription>\r\n                Estatísticas dos endpoints de API mais utilizados\r\n              </CardDescription>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <ResponsiveContainer width=\"100%\" height={300}>\r\n                <BarChart data={data.apiEndpoints}>\r\n                  <CartesianGrid strokeDasharray=\"3 3\" />\r\n                  <XAxis \r\n                    dataKey=\"endpoint\" \r\n                    angle={-45}\r\n                    textAnchor=\"end\"\r\n                    height={100}\r\n                  />\r\n                  <YAxis />\r\n                  <Tooltip />\r\n                  <Bar dataKey=\"calls\" fill=\"#8884d8\" name=\"Chamadas\" />\r\n                  <Bar dataKey=\"avgResponseTime\" fill=\"#82ca9d\" name=\"Tempo Médio (ms)\" />\r\n                </BarChart>\r\n              </ResponsiveContainer>\r\n            </CardContent>\r\n          </Card>\r\n        </TabsContent>\r\n        \r\n        {/* Performance Tab */}\r\n        <TabsContent value=\"performance\" className=\"space-y-4\">\r\n          <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\r\n            <Card>\r\n              <CardHeader className=\"pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">Tempo de Carregamento</CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">{data.performance.avgPageLoadTime}s</div>\r\n                <p className=\"text-xs text-muted-foreground\">Média de carregamento</p>\r\n              </CardContent>\r\n            </Card>\r\n            \r\n            <Card>\r\n              <CardHeader className=\"pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">First Contentful Paint</CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">{data.performance.avgFCP}s</div>\r\n                <p className=\"text-xs text-muted-foreground\">Primeiro conteúdo visível</p>\r\n              </CardContent>\r\n            </Card>\r\n            \r\n            <Card>\r\n              <CardHeader className=\"pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">Largest Contentful Paint</CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">{data.performance.avgLCP}s</div>\r\n                <p className=\"text-xs text-muted-foreground\">Maior elemento carregado</p>\r\n              </CardContent>\r\n            </Card>\r\n            \r\n            <Card>\r\n              <CardHeader className=\"pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">Taxa de Erro</CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">{data.performance.errorRate}%</div>\r\n                <p className=\"text-xs text-muted-foreground\">Erros por requisição</p>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n        </TabsContent>\r\n        \r\n        {/* Engagement Tab */}\r\n        <TabsContent value=\"engagement\" className=\"space-y-4\">\r\n          <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\r\n            <Card>\r\n              <CardHeader className=\"pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">Tempo na Página</CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">{Math.round(data.engagement.avgTimeOnPage)}s</div>\r\n                <p className=\"text-xs text-muted-foreground\">Tempo médio por página</p>\r\n              </CardContent>\r\n            </Card>\r\n            \r\n            <Card>\r\n              <CardHeader className=\"pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">Profundidade de Scroll</CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">{data.engagement.avgScrollDepth}%</div>\r\n                <p className=\"text-xs text-muted-foreground\">Scroll médio da página</p>\r\n              </CardContent>\r\n            </Card>\r\n            \r\n            <Card>\r\n              <CardHeader className=\"pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">Taxa de Rejeição</CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">{data.engagement.bounceRate}%</div>\r\n                <p className=\"text-xs text-muted-foreground\">Usuários que saem rapidamente</p>\r\n              </CardContent>\r\n            </Card>\r\n            \r\n            <Card>\r\n              <CardHeader className=\"pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">Visitantes Recorrentes</CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">{data.engagement.returnVisitorRate}%</div>\r\n                <p className=\"text-xs text-muted-foreground\">Taxa de retorno</p>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n        </TabsContent>\r\n        \r\n        {/* Business Tab */}\r\n        <TabsContent value=\"business\" className=\"space-y-4\">\r\n          <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\r\n            <Card>\r\n              <CardHeader className=\"pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">Lucro Total</CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold text-green-600\">\r\n                  R$ {data.business.totalProfit.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}\r\n                </div>\r\n                <p className=\"text-xs text-muted-foreground\">Lucro acumulado</p>\r\n              </CardContent>\r\n            </Card>\r\n            \r\n            <Card>\r\n              <CardHeader className=\"pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">Taxa de Vitória</CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">{data.business.winRate}%</div>\r\n                <p className=\"text-xs text-muted-foreground\">Sinais corretos</p>\r\n              </CardContent>\r\n            </Card>\r\n            \r\n            <Card>\r\n              <CardHeader className=\"pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">Aposta Média</CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">\r\n                  R$ {data.business.avgBetAmount.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}\r\n                </div>\r\n                <p className=\"text-xs text-muted-foreground\">Valor médio por aposta</p>\r\n              </CardContent>\r\n            </Card>\r\n            \r\n            <Card>\r\n              <CardHeader className=\"pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">Total de Apostas</CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">{data.business.totalBets.toLocaleString()}</div>\r\n                <p className=\"text-xs text-muted-foreground\">Apostas realizadas</p>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n        </TabsContent>\r\n        \r\n        {/* Trends Tab */}\r\n        <TabsContent value=\"trends\" className=\"space-y-4\">\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle>Tendências ao Longo do Tempo</CardTitle>\r\n              <CardDescription>\r\n                Evolução das métricas principais nos últimos dias\r\n              </CardDescription>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <ResponsiveContainer width=\"100%\" height={400}>\r\n                <AreaChart data={data.trends}>\r\n                  <CartesianGrid strokeDasharray=\"3 3\" />\r\n                  <XAxis dataKey=\"date\" />\r\n                  <YAxis />\r\n                  <Tooltip />\r\n                  <Area \r\n                    type=\"monotone\" \r\n                    dataKey=\"events\" \r\n                    stackId=\"1\" \r\n                    stroke=\"#8884d8\" \r\n                    fill=\"#8884d8\" \r\n                    name=\"Eventos\"\r\n                  />\r\n                  <Area \r\n                    type=\"monotone\" \r\n                    dataKey=\"users\" \r\n                    stackId=\"2\" \r\n                    stroke=\"#82ca9d\" \r\n                    fill=\"#82ca9d\" \r\n                    name=\"Usuários\"\r\n                  />\r\n                  <Area \r\n                    type=\"monotone\" \r\n                    dataKey=\"errors\" \r\n                    stackId=\"3\" \r\n                    stroke=\"#ff7300\" \r\n                    fill=\"#ff7300\" \r\n                    name=\"Erros\"\r\n                  />\r\n                </AreaChart>\r\n              </ResponsiveContainer>\r\n            </CardContent>\r\n          </Card>\r\n        </TabsContent>\r\n      </Tabs>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default AnalyticsDashboard;","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/analytics/roulette-heatmap.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/auth/ApiKeyManager.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/auth/auth-test.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has an unnecessary dependency: 'supabase'. Either exclude it or remove the dependency array. Outer scope values like 'supabase' aren't valid dependencies because mutating them doesn't re-render the component.","line":41,"column":6,"nodeType":"ArrayExpression","endLine":41,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: []","fix":{"range":[1400,1410],"text":"[]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { supabase } from '@/lib/supabase';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { CheckCircle, XCircle, Loader2, User, Database, Key } from 'lucide-react';\r\nimport { toast } from 'sonner';\r\n\r\ninterface AuthTestProps {\r\n  className?: string;\r\n}\r\n\r\nexport function AuthTest({ className }: AuthTestProps) {\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [connectionStatus, setConnectionStatus] = useState<'idle' | 'testing' | 'success' | 'error'>('idle');\r\n  const [user, setUser] = useState<any>(null);\r\n  const [testResults, setTestResults] = useState({\r\n    connection: false,\r\n    auth: false,\r\n    database: false,\r\n  });\r\n\r\n  // Using singleton Supabase client imported from '@/lib/supabase'\r\n\r\n  useEffect(() => {\r\n    // Verificar se há usuário logado\r\n    const checkUser = async () => {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      setUser(user);\r\n    };\r\n    checkUser();\r\n\r\n    // Escutar mudanças de autenticação\r\n    const { data: { subscription } } = supabase.auth.onAuthStateChange((event, session) => {\r\n      setUser(session?.user || null);\r\n    });\r\n\r\n    return () => subscription.unsubscribe();\r\n  }, [supabase]);\r\n\r\n  const testSupabaseConnection = async () => {\r\n    setIsLoading(true);\r\n    setConnectionStatus('testing');\r\n    \r\n    const results = {\r\n      connection: false,\r\n      auth: false,\r\n      database: false,\r\n    };\r\n\r\n    try {\r\n      // Teste 1: Conexão básica\r\n      const { data, error } = await supabase.from('user_profiles').select('count').limit(1);\r\n      if (!error) {\r\n        results.connection = true;\r\n        toast.success('Conexão com Supabase estabelecida!');\r\n      } else {\r\n        toast.error(`Erro de conexão: ${error.message}`);\r\n      }\r\n\r\n      // Teste 2: Autenticação (se houver usuário)\r\n      if (user) {\r\n        const { data: authData, error: authError } = await supabase.auth.getUser();\r\n        if (!authError && authData.user) {\r\n          results.auth = true;\r\n          toast.success('Autenticação funcionando!');\r\n        } else {\r\n          toast.error(`Erro de autenticação: ${authError?.message}`);\r\n        }\r\n      }\r\n\r\n      // Teste 3: Acesso ao banco (tentar buscar perfil do usuário)\r\n      if (user) {\r\n        const { data: profileData, error: profileError } = await supabase\r\n          .from('user_profiles')\r\n          .select('*')\r\n          .eq('id', user.id)\r\n          .single();\r\n        \r\n        if (!profileError) {\r\n          results.database = true;\r\n          toast.success('Acesso ao banco de dados funcionando!');\r\n        } else {\r\n          toast.warning(`Perfil não encontrado: ${profileError.message}`);\r\n        }\r\n      }\r\n\r\n      setTestResults(results);\r\n      setConnectionStatus(results.connection ? 'success' : 'error');\r\n      \r\n    } catch (error) {\r\n      console.error('Erro no teste:', error);\r\n      toast.error('Erro durante os testes');\r\n      setConnectionStatus('error');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleLogin = async () => {\r\n    // Redirecionar para página de login\r\n    window.location.href = '/login';\r\n  };\r\n\r\n  const handleLogout = async () => {\r\n    const { error } = await supabase.auth.signOut();\r\n    if (error) {\r\n      toast.error('Erro ao fazer logout');\r\n    } else {\r\n      toast.success('Logout realizado com sucesso');\r\n      setUser(null);\r\n      setTestResults({ connection: false, auth: false, database: false });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Card className={className}>\r\n      <CardHeader>\r\n        <CardTitle className=\"flex items-center gap-2\">\r\n          <Database className=\"w-5 h-5\" />\r\n          Teste de Autenticação Supabase\r\n        </CardTitle>\r\n        <CardDescription>\r\n          Verificar conexão, autenticação e acesso ao banco de dados\r\n        </CardDescription>\r\n      </CardHeader>\r\n      <CardContent className=\"space-y-4\">\r\n        {/* Status do usuário */}\r\n        <div className=\"flex items-center justify-between p-3 bg-muted rounded-lg\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <User className=\"w-4 h-4\" />\r\n            <span className=\"text-sm font-medium\">Status do usuário:</span>\r\n          </div>\r\n          <div className=\"flex items-center gap-2\">\r\n            {user ? (\r\n              <>\r\n                <Badge variant=\"default\" className=\"bg-green-500\">\r\n                  <CheckCircle className=\"w-3 h-3 mr-1\" />\r\n                  Logado\r\n                </Badge>\r\n                <span className=\"text-xs text-muted-foreground\">\r\n                  {user.email}\r\n                </span>\r\n              </>\r\n            ) : (\r\n              <Badge variant=\"secondary\">\r\n                <XCircle className=\"w-3 h-3 mr-1\" />\r\n                Não logado\r\n              </Badge>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Resultados dos testes */}\r\n        <div className=\"space-y-2\">\r\n          <h4 className=\"text-sm font-medium\">Resultados dos testes:</h4>\r\n          \r\n          <div className=\"grid grid-cols-1 gap-2\">\r\n            <div className=\"flex items-center justify-between p-2 bg-muted/50 rounded\">\r\n              <span className=\"text-sm\">Conexão Supabase</span>\r\n              {testResults.connection ? (\r\n                <CheckCircle className=\"w-4 h-4 text-green-500\" />\r\n              ) : (\r\n                <XCircle className=\"w-4 h-4 text-red-500\" />\r\n              )}\r\n            </div>\r\n            \r\n            <div className=\"flex items-center justify-between p-2 bg-muted/50 rounded\">\r\n              <span className=\"text-sm\">Autenticação</span>\r\n              {testResults.auth ? (\r\n                <CheckCircle className=\"w-4 h-4 text-green-500\" />\r\n              ) : (\r\n                <XCircle className=\"w-4 h-4 text-red-500\" />\r\n              )}\r\n            </div>\r\n            \r\n            <div className=\"flex items-center justify-between p-2 bg-muted/50 rounded\">\r\n              <span className=\"text-sm\">Acesso ao banco</span>\r\n              {testResults.database ? (\r\n                <CheckCircle className=\"w-4 h-4 text-green-500\" />\r\n              ) : (\r\n                <XCircle className=\"w-4 h-4 text-red-500\" />\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Botões de ação */}\r\n        <div className=\"flex gap-2\">\r\n          <Button\r\n            onClick={testSupabaseConnection}\r\n            disabled={isLoading}\r\n            className=\"flex-1\"\r\n          >\r\n            {isLoading ? (\r\n              <Loader2 className=\"w-4 h-4 animate-spin mr-2\" />\r\n            ) : (\r\n              <Key className=\"w-4 h-4 mr-2\" />\r\n            )}\r\n            Testar Conexão\r\n          </Button>\r\n          \r\n          {user ? (\r\n            <Button variant=\"outline\" onClick={handleLogout}>\r\n              Logout\r\n            </Button>\r\n          ) : (\r\n            <Button variant=\"outline\" onClick={handleLogin}>\r\n              Login\r\n            </Button>\r\n          )}\r\n        </div>\r\n\r\n        {/* Informações de configuração */}\r\n        <div className=\"text-xs text-muted-foreground space-y-1\">\r\n          <div>URL: {process.env.NEXT_PUBLIC_SUPABASE_URL || 'Não configurado'}</div>\r\n          <div>Anon Key: {process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY ? 'Configurado' : 'Não configurado'}</div>\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/automation/advanced-risk-panel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/automation/emergency-stop.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/automation/metrics-panel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/automation/session-management-panel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/betting/iframe-betting-provider.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'handleIframeEvent'. Either include it or remove the dependency array.","line":567,"column":6,"nodeType":"ArrayExpression","endLine":567,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [handleIframeEvent, pendingRequests]","fix":{"range":[19708,19725],"text":"[handleIframeEvent, pendingRequests]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'addLog'. Either include it or remove the dependency array.","line":600,"column":6,"nodeType":"ArrayExpression","endLine":600,"endColumn":44,"suggestions":[{"desc":"Update the dependencies array to be: [addLog, connectionStatus, onConnectionChange]","fix":{"range":[20650,20688],"text":"[addLog, connectionStatus, onConnectionChange]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has missing dependencies: 'addLog' and 'supportedSites'. Either include them or remove the dependency array.","line":650,"column":6,"nodeType":"ArrayExpression","endLine":650,"endColumn":46,"suggestions":[{"desc":"Update the dependencies array to be: [supportedSites, selectedSite, addLog, injectionScript, onError]","fix":{"range":[22516,22556],"text":"[supportedSites, selectedSite, addLog, injectionScript, onError]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'addLog'. Either include it or remove the dependency array.","line":669,"column":6,"nodeType":"ArrayExpression","endLine":669,"endColumn":41,"suggestions":[{"desc":"Update the dependencies array to be: [addLog, sendCommand, credentials, onError]","fix":{"range":[23140,23175],"text":"[addLog, sendCommand, credentials, onError]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'addLog'. Either include it or remove the dependency array.","line":688,"column":6,"nodeType":"ArrayExpression","endLine":688,"endColumn":28,"suggestions":[{"desc":"Update the dependencies array to be: [addLog, sendCommand, onError]","fix":{"range":[23784,23806],"text":"[addLog, sendCommand, onError]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'addLog'. Either include it or remove the dependency array.","line":706,"column":6,"nodeType":"ArrayExpression","endLine":706,"endColumn":43,"suggestions":[{"desc":"Update the dependencies array to be: [addLog, sendCommand, onBetExecuted, onError]","fix":{"range":[24474,24511],"text":"[addLog, sendCommand, onBetExecuted, onError]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect, useRef, useCallback } from 'react';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Alert, AlertDescription } from '@/components/ui/alert';\r\nimport { Progress } from '@/components/ui/progress';\r\nimport { \r\n  Globe, \r\n  Shield, \r\n  AlertTriangle, \r\n  CheckCircle, \r\n  Eye, \r\n  EyeOff,\r\n  RefreshCw,\r\n  Maximize2,\r\n  Minimize2,\r\n  Settings\r\n} from 'lucide-react';\r\n\r\n// Tipos para comunicação iframe\r\ninterface IframeMessage {\r\n  type: 'SOFIA_COMMAND' | 'SOFIA_RESPONSE' | 'SOFIA_EVENT';\r\n  action: string;\r\n  data?: any;\r\n  requestId?: string;\r\n}\r\n\r\ninterface BetExecutionData {\r\n  numbers: number[];\r\n  amount: number;\r\n  betType: 'straight' | 'split' | 'corner' | 'line' | 'color';\r\n  tableId: string;\r\n}\r\n\r\ninterface IframeConnectionStatus {\r\n  isConnected: boolean;\r\n  isLoggedIn: boolean;\r\n  currentSite: string;\r\n  tableReady: boolean;\r\n  balance?: number;\r\n  lastActivity: string;\r\n}\r\n\r\ninterface IframeBettingProviderProps {\r\n  onBetExecuted?: (result: any) => void;\r\n  onConnectionChange?: (status: IframeConnectionStatus) => void;\r\n  onError?: (error: string) => void;\r\n  suggestedBets: (string | number)[];\r\n  autoExecute?: boolean;\r\n}\r\n\r\nexport function IframeBettingProvider({\r\n  onBetExecuted,\r\n  onConnectionChange,\r\n  onError,\r\n  suggestedBets,\r\n  autoExecute = false\r\n}: IframeBettingProviderProps) {\r\n  const iframeRef = useRef<HTMLIFrameElement>(null);\r\n  const [isExpanded, setIsExpanded] = useState(false);\r\n  const [isFullscreen, setIsFullscreen] = useState(false);\r\n  const [connectionStatus, setConnectionStatus] = useState<IframeConnectionStatus>({\r\n    isConnected: false,\r\n    isLoggedIn: false,\r\n    currentSite: '',\r\n    tableReady: false,\r\n    lastActivity: new Date().toISOString()\r\n  });\r\n\r\n  const [selectedSite, setSelectedSite] = useState('bet365');\r\n  const [credentials, setCredentials] = useState({\r\n    email: '',\r\n    password: ''\r\n  });\r\n\r\n  const [injectionProgress, setInjectionProgress] = useState(0);\r\n  const [logs, setLogs] = useState<string[]>([]);\r\n  const [pendingRequests, setPendingRequests] = useState<Map<string, any>>(new Map());\r\n\r\n  // Sites suportados com URLs e configurações\r\n  const supportedSites = {\r\n    bet365: {\r\n      name: 'Bet365',\r\n      url: 'https://www.bet365.com',\r\n      rouletteUrl: 'https://www.bet365.com/casino/roulette',\r\n      loginUrl: 'https://www.bet365.com/login',\r\n      color: 'bg-yellow-600'\r\n    },\r\n    betfair: {\r\n      name: 'Betfair',\r\n      url: 'https://www.betfair.com',\r\n      rouletteUrl: 'https://www.betfair.com/casino/roulette',\r\n      loginUrl: 'https://www.betfair.com/login',\r\n      color: 'bg-blue-600'\r\n    },\r\n    betano: {\r\n      name: 'Betano',\r\n      url: 'https://www.betano.com',\r\n      rouletteUrl: 'https://www.betano.com/casino/roulette',\r\n      loginUrl: 'https://www.betano.com/login',\r\n      color: 'bg-green-600'\r\n    }\r\n  };\r\n\r\n  // Script de injeção para comunicação com o iframe\r\n  const injectionScript = `\r\n    (function() {\r\n      console.log('🎯 SOFIA Betting Script Injected');\r\n      \r\n      // Configuração do site atual\r\n      const siteConfig = {\r\n        bet365: {\r\n          selectors: {\r\n            loginButton: '.hm-MainHeaderRHSLoggedOutWide_Login, .lp-UserCentredLayout_Login',\r\n            usernameField: '#loginUsername, [data-testid=\"username-input\"]',\r\n            passwordField: '#loginPassword, [data-testid=\"password-input\"]',\r\n            submitButton: '.lms-StandardLogin_LoginBtn, [data-testid=\"login-submit\"]',\r\n            rouletteTable: '.roulette-table, .game-table, [data-game=\"roulette\"]',\r\n            betAmountInput: '.bet-amount, .stake-input, [data-testid=\"stake-input\"]',\r\n            numberBets: '[data-number], .number-bet, .roulette-number',\r\n            colorBets: '[data-color], .color-bet, .red-bet, .black-bet',\r\n            placeBetButton: '.place-bet, .confirm-bet, [data-testid=\"place-bet\"]',\r\n            betConfirmation: '.bet-confirmed, .bet-placed, .success-message',\r\n            balance: '.balance, .available-balance, [data-testid=\"balance\"]'\r\n          }\r\n        },\r\n        betfair: {\r\n          selectors: {\r\n            loginButton: '.login-button, .header-login',\r\n            usernameField: '#username, [name=\"username\"]',\r\n            passwordField: '#password, [name=\"password\"]',\r\n            submitButton: '.login-submit, [type=\"submit\"]',\r\n            rouletteTable: '.roulette-wheel, .game-area',\r\n            betAmountInput: '.stake-input, .bet-amount',\r\n            numberBets: '.number-bet, [data-number]',\r\n            colorBets: '.color-bet, [data-color]',\r\n            placeBetButton: '.confirm-bet, .place-bet',\r\n            betConfirmation: '.bet-placed, .confirmed',\r\n            balance: '.balance, .wallet-balance'\r\n          }\r\n        },\r\n        generic: {\r\n          selectors: {\r\n            loginButton: '.login, .entrar, .sign-in, [data-login]',\r\n            usernameField: '#username, #user, #email, [name=\"username\"], [name=\"email\"]',\r\n            passwordField: '#password, #pass, [name=\"password\"]',\r\n            submitButton: '.submit, .login-btn, .entrar-btn, [type=\"submit\"]',\r\n            rouletteTable: '.roulette, .roleta, .table, .game-table',\r\n            betAmountInput: '.bet-amount, .valor, .stake, .amount-input',\r\n            numberBets: '[data-number], .number, .numero, .roulette-number',\r\n            colorBets: '[data-color], .color, .cor, .red, .black',\r\n            placeBetButton: '.place-bet, .apostar, .confirm, .bet-button',\r\n            betConfirmation: '.confirmed, .confirmado, .success, .bet-placed',\r\n            balance: '.balance, .saldo, .wallet, .available'\r\n          }\r\n        }\r\n      };\r\n\r\n      // Detectar site atual\r\n      const hostname = window.location.hostname.toLowerCase();\r\n      let currentSiteConfig = siteConfig.generic;\r\n      \r\n      if (hostname.includes('bet365')) {\r\n        currentSiteConfig = siteConfig.bet365;\r\n      } else if (hostname.includes('betfair')) {\r\n        currentSiteConfig = siteConfig.betfair;\r\n      }\r\n\r\n      // Classe principal para automação\r\n      class SofiaIframeAutomation {\r\n        constructor() {\r\n          this.config = currentSiteConfig;\r\n          this.isReady = false;\r\n          this.setupMessageListener();\r\n          this.detectPageState();\r\n          this.startHeartbeat();\r\n        }\r\n\r\n        setupMessageListener() {\r\n          window.addEventListener('message', (event) => {\r\n            if (event.data.type === 'SOFIA_COMMAND') {\r\n              this.handleCommand(event.data);\r\n            }\r\n          });\r\n        }\r\n\r\n        async handleCommand(message) {\r\n          const { action, data, requestId } = message;\r\n          \r\n          try {\r\n            let result;\r\n            \r\n            switch (action) {\r\n              case 'LOGIN':\r\n                result = await this.performLogin(data);\r\n                break;\r\n              case 'NAVIGATE_TO_ROULETTE':\r\n                result = await this.navigateToRoulette();\r\n                break;\r\n              case 'PLACE_BET':\r\n                result = await this.placeBet(data);\r\n                break;\r\n              case 'GET_BALANCE':\r\n                result = await this.getBalance();\r\n                break;\r\n              case 'CHECK_TABLE_STATUS':\r\n                result = await this.checkTableStatus();\r\n                break;\r\n              case 'GET_PAGE_STATE':\r\n                result = this.getPageState();\r\n                break;\r\n              default:\r\n                throw new Error(\\`Ação não suportada: \\${action}\\`);\r\n            }\r\n\r\n            this.sendResponse(requestId, { success: true, data: result });\r\n            \r\n          } catch (error) {\r\n            const errorMessage = error instanceof Error ? error.message : 'Erro desconhecido';\r\n            this.sendResponse(requestId, { \r\n              success: false, \r\n              error: errorMessage \r\n            });\r\n          }\r\n        }\r\n\r\n        async performLogin(credentials) {\r\n          const { email, password } = credentials;\r\n          \r\n          // Encontrar campos de login\r\n          const usernameField = this.findElement(this.config.selectors.usernameField);\r\n          const passwordField = this.findElement(this.config.selectors.passwordField);\r\n          const submitButton = this.findElement(this.config.selectors.submitButton);\r\n\r\n          if (!usernameField || !passwordField) {\r\n            throw new Error('Campos de login não encontrados');\r\n          }\r\n\r\n          // Preencher campos\r\n          await this.humanType(usernameField, email);\r\n          await this.delay(500, 1000);\r\n          await this.humanType(passwordField, password);\r\n          await this.delay(500, 1000);\r\n\r\n          // Submeter formulário\r\n          if (submitButton) {\r\n            await this.humanClick(submitButton);\r\n          } else {\r\n            // Tentar submit via Enter\r\n            passwordField.dispatchEvent(new KeyboardEvent('keydown', { key: 'Enter' }));\r\n          }\r\n\r\n          // Aguardar redirecionamento\r\n          await this.waitForNavigation();\r\n          \r\n          return { loggedIn: true, url: window.location.href };\r\n        }\r\n\r\n        async navigateToRoulette() {\r\n          // Tentar encontrar link para roleta\r\n          const rouletteLinks = document.querySelectorAll('a[href*=\"roulette\"], a[href*=\"roleta\"]');\r\n          \r\n          if (rouletteLinks.length > 0) {\r\n            await this.humanClick(rouletteLinks[0]);\r\n            await this.waitForElement(this.config.selectors.rouletteTable);\r\n            return { navigated: true, url: window.location.href };\r\n          }\r\n          \r\n          throw new Error('Link para roleta não encontrado');\r\n        }\r\n\r\n        async placeBet(betData) {\r\n          const { numbers, amount, betType } = betData;\r\n          const results = [];\r\n\r\n          // Verificar se a mesa está pronta\r\n          const table = this.findElement(this.config.selectors.rouletteTable);\r\n          if (!table) {\r\n            throw new Error('Mesa de roleta não encontrada');\r\n          }\r\n\r\n          // Definir valor da aposta\r\n          await this.setBetAmount(amount);\r\n\r\n          // Colocar apostas nos números\r\n          for (const number of numbers) {\r\n            try {\r\n              await this.placeBetOnNumber(number);\r\n              results.push({ number, status: 'placed' });\r\n              await this.delay(200, 500);\r\n            } catch (error) {\r\n              const errorMessage = error instanceof Error ? error.message : 'Erro desconhecido';\r\n              results.push({ number, status: 'failed', error: errorMessage });\r\n            }\r\n          }\r\n\r\n          // Confirmar apostas\r\n          await this.confirmBets();\r\n\r\n          return { \r\n            bets: results, \r\n            totalAmount: amount * numbers.length,\r\n            timestamp: new Date().toISOString()\r\n          };\r\n        }\r\n\r\n        async setBetAmount(amount) {\r\n          const amountInput = this.findElement(this.config.selectors.betAmountInput);\r\n          if (amountInput) {\r\n            amountInput.value = '';\r\n            await this.humanType(amountInput, amount.toString());\r\n          }\r\n        }\r\n\r\n        async placeBetOnNumber(number) {\r\n          const numberElements = document.querySelectorAll(this.config.selectors.numberBets);\r\n          \r\n          for (const element of numberElements) {\r\n            const elementNumber = this.extractNumber(element);\r\n            if (elementNumber === number) {\r\n              await this.humanClick(element);\r\n              return;\r\n            }\r\n          }\r\n          \r\n          throw new Error(\\`Número \\${number} não encontrado na mesa\\`);\r\n        }\r\n\r\n        async confirmBets() {\r\n          const confirmButton = this.findElement(this.config.selectors.placeBetButton);\r\n          if (confirmButton) {\r\n            await this.humanClick(confirmButton);\r\n            \r\n            // Aguardar confirmação\r\n            await this.waitForElement(this.config.selectors.betConfirmation, 5000);\r\n          }\r\n        }\r\n\r\n        async getBalance() {\r\n          const balanceElement = this.findElement(this.config.selectors.balance);\r\n          if (balanceElement) {\r\n            const balanceText = balanceElement.textContent || balanceElement.value;\r\n            const balance = parseFloat(balanceText.replace(/[^0-9.,]/g, '').replace(',', '.'));\r\n            return { balance: isNaN(balance) ? 0 : balance };\r\n          }\r\n          return { balance: 0 };\r\n        }\r\n\r\n        checkTableStatus() {\r\n          const table = this.findElement(this.config.selectors.rouletteTable);\r\n          return {\r\n            tableReady: !!table,\r\n            url: window.location.href,\r\n            title: document.title\r\n          };\r\n        }\r\n\r\n        getPageState() {\r\n          return {\r\n            url: window.location.href,\r\n            title: document.title,\r\n            isLoggedIn: this.detectLoginState(),\r\n            hasRouletteTable: !!this.findElement(this.config.selectors.rouletteTable),\r\n            timestamp: new Date().toISOString()\r\n          };\r\n        }\r\n\r\n        detectLoginState() {\r\n          // Verificar se há elementos que indicam login\r\n          const loginButton = this.findElement(this.config.selectors.loginButton);\r\n          return !loginButton; // Se não há botão de login, provavelmente está logado\r\n        }\r\n\r\n        detectPageState() {\r\n          const state = this.getPageState();\r\n          this.sendEvent('PAGE_STATE_CHANGED', state);\r\n        }\r\n\r\n        startHeartbeat() {\r\n          setInterval(() => {\r\n            this.sendEvent('HEARTBEAT', {\r\n              timestamp: new Date().toISOString(),\r\n              url: window.location.href,\r\n              isLoggedIn: this.detectLoginState()\r\n            });\r\n          }, 5000);\r\n        }\r\n\r\n        // Utilitários\r\n        findElement(selectors) {\r\n          const selectorList = selectors.split(', ');\r\n          for (const selector of selectorList) {\r\n            const element = document.querySelector(selector.trim());\r\n            if (element) return element;\r\n          }\r\n          return null;\r\n        }\r\n\r\n        async waitForElement(selector, timeout = 10000) {\r\n          return new Promise((resolve, reject) => {\r\n            const startTime = Date.now();\r\n            \r\n            const check = () => {\r\n              const element = this.findElement(selector);\r\n              if (element) {\r\n                resolve(element);\r\n              } else if (Date.now() - startTime > timeout) {\r\n                reject(new Error(\\`Elemento não encontrado: \\${selector}\\`));\r\n              } else {\r\n                setTimeout(check, 100);\r\n              }\r\n            };\r\n            \r\n            check();\r\n          });\r\n        }\r\n\r\n        async waitForNavigation(timeout = 10000) {\r\n          const currentUrl = window.location.href;\r\n          return new Promise((resolve) => {\r\n            const check = () => {\r\n              if (window.location.href !== currentUrl) {\r\n                resolve(true);\r\n              } else {\r\n                setTimeout(check, 100);\r\n              }\r\n            };\r\n            setTimeout(check, 1000);\r\n            setTimeout(() => resolve(false), timeout);\r\n          });\r\n        }\r\n\r\n        async humanClick(element) {\r\n          // Simular movimento do mouse\r\n          element.dispatchEvent(new MouseEvent('mouseover', { bubbles: true }));\r\n          await this.delay(50, 150);\r\n          \r\n          // Click\r\n          element.dispatchEvent(new MouseEvent('mousedown', { bubbles: true }));\r\n          await this.delay(50, 100);\r\n          element.dispatchEvent(new MouseEvent('mouseup', { bubbles: true }));\r\n          element.dispatchEvent(new MouseEvent('click', { bubbles: true }));\r\n        }\r\n\r\n        async humanType(element, text) {\r\n          element.focus();\r\n          await this.delay(100, 300);\r\n          \r\n          for (const char of text) {\r\n            element.value += char;\r\n            element.dispatchEvent(new Event('input', { bubbles: true }));\r\n            await this.delay(50, 150);\r\n          }\r\n          \r\n          element.dispatchEvent(new Event('change', { bubbles: true }));\r\n        }\r\n\r\n        extractNumber(element) {\r\n          const text = element.textContent || element.getAttribute('data-number') || element.value;\r\n          const number = parseInt(text);\r\n          return isNaN(number) ? null : number;\r\n        }\r\n\r\n        delay(min, max) {\r\n          const delay = Math.floor(Math.random() * (max - min + 1)) + min;\r\n          return new Promise(resolve => setTimeout(resolve, delay));\r\n        }\r\n\r\n        sendResponse(requestId, data) {\r\n          window.parent.postMessage({\r\n            type: 'SOFIA_RESPONSE',\r\n            requestId,\r\n            data\r\n          }, '*');\r\n        }\r\n\r\n        sendEvent(event, data) {\r\n          window.parent.postMessage({\r\n            type: 'SOFIA_EVENT',\r\n            event,\r\n            data\r\n          }, '*');\r\n        }\r\n      }\r\n\r\n      // Inicializar automação\r\n      window.sofiaAutomation = new SofiaIframeAutomation();\r\n      \r\n      // Notificar que o script foi carregado\r\n      window.parent.postMessage({\r\n        type: 'SOFIA_EVENT',\r\n        event: 'SCRIPT_LOADED',\r\n        data: { timestamp: new Date().toISOString() }\r\n      }, '*');\r\n      \r\n    })();\r\n  `;\r\n\r\n  // Função para enviar comandos para o iframe\r\n  const sendCommand = useCallback(async (action: string, data?: any): Promise<any> => {\r\n    return new Promise((resolve, reject) => {\r\n      if (!iframeRef.current) {\r\n        reject(new Error('Iframe não disponível'));\r\n        return;\r\n      }\r\n\r\n      const requestId = `req_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n      \r\n      // Armazenar request pendente\r\n      setPendingRequests(prev => new Map(prev.set(requestId, { resolve, reject })));\r\n\r\n      // Enviar comando\r\n      iframeRef.current.contentWindow?.postMessage({\r\n        type: 'SOFIA_COMMAND',\r\n        action,\r\n        data,\r\n        requestId\r\n      }, '*');\r\n\r\n      // Timeout\r\n      setTimeout(() => {\r\n        setPendingRequests(prev => {\r\n          const newMap = new Map(prev);\r\n          const request = newMap.get(requestId);\r\n          if (request) {\r\n            newMap.delete(requestId);\r\n            request.reject(new Error('Timeout'));\r\n          }\r\n          return newMap;\r\n        });\r\n      }, 30000);\r\n    });\r\n  }, []);\r\n\r\n  // Listener para mensagens do iframe\r\n  useEffect(() => {\r\n    const handleMessage = (event: MessageEvent) => {\r\n      if (event.data.type === 'SOFIA_RESPONSE') {\r\n        const { requestId, data } = event.data;\r\n        const request = pendingRequests.get(requestId);\r\n        \r\n        if (request) {\r\n          setPendingRequests(prev => {\r\n            const newMap = new Map(prev);\r\n            newMap.delete(requestId);\r\n            return newMap;\r\n          });\r\n\r\n          if (data.success) {\r\n            request.resolve(data.data);\r\n          } else {\r\n            request.reject(new Error(data.error));\r\n          }\r\n        }\r\n      } else if (event.data.type === 'SOFIA_EVENT') {\r\n        handleIframeEvent(event.data.event, event.data.data);\r\n      }\r\n    };\r\n\r\n    window.addEventListener('message', handleMessage);\r\n    return () => window.removeEventListener('message', handleMessage);\r\n  }, [pendingRequests]);\r\n\r\n  // Handler para eventos do iframe\r\n  const handleIframeEvent = useCallback((event: string, data: any) => {\r\n    const timestamp = new Date().toLocaleTimeString();\r\n    \r\n    switch (event) {\r\n      case 'SCRIPT_LOADED':\r\n        addLog('✅ Script de automação carregado');\r\n        setInjectionProgress(100);\r\n        break;\r\n        \r\n      case 'PAGE_STATE_CHANGED':\r\n        setConnectionStatus(prev => ({\r\n          ...prev,\r\n          isLoggedIn: data.isLoggedIn,\r\n          tableReady: data.hasRouletteTable,\r\n          lastActivity: data.timestamp\r\n        }));\r\n        onConnectionChange?.(connectionStatus);\r\n        break;\r\n        \r\n      case 'HEARTBEAT':\r\n        setConnectionStatus(prev => ({\r\n          ...prev,\r\n          lastActivity: data.timestamp,\r\n          isLoggedIn: data.isLoggedIn\r\n        }));\r\n        break;\r\n        \r\n      default:\r\n        addLog(`📡 Evento: ${event}`);\r\n    }\r\n  }, [connectionStatus, onConnectionChange]);\r\n\r\n  // Função para adicionar logs\r\n  const addLog = useCallback((message: string) => {\r\n    const timestamp = new Date().toLocaleTimeString();\r\n    setLogs(prev => [`[${timestamp}] ${message}`, ...prev.slice(0, 19)]);\r\n  }, []);\r\n\r\n  // Função para conectar ao site\r\n  const connectToSite = useCallback(async () => {\r\n    try {\r\n      const siteConfig = supportedSites[selectedSite as keyof typeof supportedSites];\r\n      addLog(`🔗 Conectando a ${siteConfig.name}...`);\r\n      setInjectionProgress(0);\r\n      \r\n      // Carregar site no iframe\r\n      if (iframeRef.current) {\r\n        iframeRef.current.src = siteConfig.loginUrl;\r\n        \r\n        // Aguardar carregamento e injetar script\r\n        iframeRef.current.onload = () => {\r\n          setTimeout(() => {\r\n            try {\r\n              const iframeDoc = iframeRef.current?.contentDocument;\r\n              if (iframeDoc) {\r\n                const script = iframeDoc.createElement('script');\r\n                script.textContent = injectionScript;\r\n                iframeDoc.head.appendChild(script);\r\n                setInjectionProgress(50);\r\n              }\r\n            } catch (error) {\r\n              const errorMessage = error instanceof Error ? error.message : 'Erro desconhecido';\r\n              addLog(`❌ Erro ao injetar script: ${errorMessage}`);\r\n              onError?.(`Erro ao injetar script: ${errorMessage}`);\r\n            }\r\n          }, 2000);\r\n        };\r\n      }\r\n      \r\n      setConnectionStatus(prev => ({\r\n        ...prev,\r\n        isConnected: true,\r\n        currentSite: selectedSite\r\n      }));\r\n      \r\n    } catch (error) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Erro desconhecido';\r\n      addLog(`❌ Erro na conexão: ${errorMessage}`);\r\n      onError?.(`Erro na conexão: ${errorMessage}`);\r\n    }\r\n  }, [selectedSite, injectionScript, onError]);\r\n\r\n  // Função para fazer login\r\n  const performLogin = useCallback(async () => {\r\n    try {\r\n      addLog('🔐 Fazendo login...');\r\n      const result = await sendCommand('LOGIN', credentials);\r\n      addLog('✅ Login realizado com sucesso');\r\n      \r\n      setConnectionStatus(prev => ({\r\n        ...prev,\r\n        isLoggedIn: true\r\n      }));\r\n      \r\n    } catch (error) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Erro desconhecido';\r\n      addLog(`❌ Erro no login: ${errorMessage}`);\r\n      onError?.(`Erro no login: ${errorMessage}`);\r\n    }\r\n  }, [credentials, sendCommand, onError]);\r\n\r\n  // Função para navegar para roleta\r\n  const navigateToRoulette = useCallback(async () => {\r\n    try {\r\n      addLog('🎰 Navegando para roleta...');\r\n      const result = await sendCommand('NAVIGATE_TO_ROULETTE');\r\n      addLog('✅ Mesa de roleta carregada');\r\n      \r\n      setConnectionStatus(prev => ({\r\n        ...prev,\r\n        tableReady: true\r\n      }));\r\n      \r\n    } catch (error) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Erro desconhecido';\r\n      addLog(`❌ Erro ao navegar: ${errorMessage}`);\r\n      onError?.(`Erro ao navegar: ${errorMessage}`);\r\n    }\r\n  }, [sendCommand, onError]);\r\n\r\n  // Função para executar aposta\r\n  const executeBet = useCallback(async (betData: BetExecutionData) => {\r\n    try {\r\n      addLog(`💰 Executando aposta: ${betData.numbers.join(', ')} - R$ ${betData.amount}`);\r\n      const result = await sendCommand('PLACE_BET', betData);\r\n      addLog(`✅ Aposta executada: ${result.bets.length} números`);\r\n      \r\n      onBetExecuted?.(result);\r\n      return result;\r\n      \r\n    } catch (error) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Erro desconhecido';\r\n      addLog(`❌ Erro na aposta: ${errorMessage}`);\r\n      onError?.(`Erro na aposta: ${errorMessage}`);\r\n      throw error;\r\n    }\r\n  }, [sendCommand, onBetExecuted, onError]);\r\n\r\n  // Auto-executar apostas quando há sinais\r\n  useEffect(() => {\r\n    if (autoExecute && connectionStatus.tableReady && suggestedBets.length > 0) {\r\n      const numbers = suggestedBets.slice(0, 6).map(bet => \r\n        typeof bet === 'string' ? parseInt(bet) : bet\r\n      ).filter(num => num >= 0 && num <= 36);\r\n\r\n      if (numbers.length > 0) {\r\n        const betData: BetExecutionData = {\r\n          numbers,\r\n          amount: 5, // Valor padrão\r\n          betType: 'straight',\r\n          tableId: 'iframe-table'\r\n        };\r\n\r\n        executeBet(betData).catch(console.error);\r\n      }\r\n    }\r\n  }, [autoExecute, connectionStatus.tableReady, suggestedBets, executeBet]);\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      {/* Controles */}\r\n      <Card>\r\n        <CardHeader>\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <Globe className=\"w-5 h-5 text-blue-400\" />\r\n              <CardTitle className=\"text-lg\">Iframe Betting Provider</CardTitle>\r\n              <Badge \r\n                variant={connectionStatus.isConnected ? \"default\" : \"secondary\"}\r\n                className={`text-xs ${supportedSites[selectedSite as keyof typeof supportedSites]?.color || 'bg-gray-600'}`}\r\n              >\r\n                {connectionStatus.isConnected ? 'Conectado' : 'Desconectado'}\r\n              </Badge>\r\n            </div>\r\n            <div className=\"flex gap-2\">\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                onClick={() => setIsExpanded(!isExpanded)}\r\n              >\r\n                {isExpanded ? <EyeOff className=\"w-4 h-4\" /> : <Eye className=\"w-4 h-4\" />}\r\n              </Button>\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                onClick={() => setIsFullscreen(!isFullscreen)}\r\n              >\r\n                {isFullscreen ? <Minimize2 className=\"w-4 h-4\" /> : <Maximize2 className=\"w-4 h-4\" />}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n          <CardDescription>\r\n            Execução de apostas via iframe integrado com comunicação postMessage\r\n          </CardDescription>\r\n        </CardHeader>\r\n\r\n        <CardContent className=\"space-y-4\">\r\n          {/* Status */}\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-4\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <div className={`w-3 h-3 rounded-full ${\r\n                  connectionStatus.isConnected ? 'bg-green-400' : 'bg-red-400'\r\n                }`} />\r\n                <span className=\"text-sm\">\r\n                  {connectionStatus.isLoggedIn ? 'Logado' : connectionStatus.isConnected ? 'Conectado' : 'Desconectado'}\r\n                </span>\r\n              </div>\r\n              {connectionStatus.tableReady && (\r\n                <Badge variant=\"outline\" className=\"text-xs\">\r\n                  <CheckCircle className=\"w-3 h-3 mr-1\" />\r\n                  Mesa Pronta\r\n                </Badge>\r\n              )}\r\n            </div>\r\n\r\n            <div className=\"flex gap-2\">\r\n              {!connectionStatus.isConnected ? (\r\n                <Button size=\"sm\" onClick={connectToSite}>\r\n                  <Globe className=\"w-4 h-4 mr-1\" />\r\n                  Conectar\r\n                </Button>\r\n              ) : !connectionStatus.isLoggedIn ? (\r\n                <Button size=\"sm\" onClick={performLogin} disabled={!credentials.email || !credentials.password}>\r\n                  <Shield className=\"w-4 h-4 mr-1\" />\r\n                  Login\r\n                </Button>\r\n              ) : !connectionStatus.tableReady ? (\r\n                <Button size=\"sm\" onClick={navigateToRoulette}>\r\n                  <RefreshCw className=\"w-4 h-4 mr-1\" />\r\n                  Ir para Roleta\r\n                </Button>\r\n              ) : (\r\n                <Badge variant=\"default\" className=\"bg-green-600\">\r\n                  <CheckCircle className=\"w-3 h-3 mr-1\" />\r\n                  Pronto\r\n                </Badge>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Progresso de Injeção */}\r\n          {injectionProgress > 0 && injectionProgress < 100 && (\r\n            <div className=\"space-y-2\">\r\n              <div className=\"flex items-center justify-between text-sm\">\r\n                <span>Injetando script de automação...</span>\r\n                <span>{injectionProgress}%</span>\r\n              </div>\r\n              <Progress value={injectionProgress} className=\"h-2\" />\r\n            </div>\r\n          )}\r\n\r\n          {isExpanded && (\r\n            <div className=\"space-y-4\">\r\n              {/* Configurações */}\r\n              <div className=\"grid grid-cols-2 gap-4\">\r\n                <div className=\"space-y-2\">\r\n                  <Label className=\"text-sm\">Casa de Apostas</Label>\r\n                  <Select value={selectedSite} onValueChange={setSelectedSite}>\r\n                    <SelectTrigger>\r\n                      <SelectValue />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      {Object.entries(supportedSites).map(([key, site]) => (\r\n                        <SelectItem key={key} value={key}>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <div className={`w-3 h-3 rounded-full ${site.color}`} />\r\n                            {site.name}\r\n                          </div>\r\n                        </SelectItem>\r\n                      ))}\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n\r\n                <div className=\"space-y-2\">\r\n                  <Label className=\"text-sm\">Status da Conexão</Label>\r\n                  <div className=\"text-sm text-muted-foreground\">\r\n                    {connectionStatus.lastActivity && \r\n                      `Última atividade: ${new Date(connectionStatus.lastActivity).toLocaleTimeString()}`\r\n                    }\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Credenciais */}\r\n              {!connectionStatus.isLoggedIn && (\r\n                <div className=\"space-y-3 p-3 bg-black/20 rounded-lg\">\r\n                  <Input\r\n                    type=\"email\"\r\n                    placeholder=\"Email/CPF\"\r\n                    value={credentials.email}\r\n                    onChange={(e) => setCredentials(prev => ({ ...prev, email: e.target.value }))}\r\n                  />\r\n                  <Input\r\n                    type=\"password\"\r\n                    placeholder=\"Senha\"\r\n                    value={credentials.password}\r\n                    onChange={(e) => setCredentials(prev => ({ ...prev, password: e.target.value }))}\r\n                  />\r\n                </div>\r\n              )}\r\n\r\n              {/* Logs */}\r\n              <div className=\"space-y-2\">\r\n                <Label className=\"text-sm font-medium\">Log de Atividades</Label>\r\n                <div className=\"bg-black/40 rounded-lg p-3 h-32 overflow-y-auto\">\r\n                  {logs.length === 0 ? (\r\n                    <div className=\"text-sm text-muted-foreground text-center py-4\">\r\n                      Nenhuma atividade ainda\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"space-y-1\">\r\n                      {logs.map((log, index) => (\r\n                        <div key={index} className=\"text-xs font-mono text-gray-300\">\r\n                          {log}\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Iframe */}\r\n      {connectionStatus.isConnected && (\r\n        <Card className={isFullscreen ? 'fixed inset-4 z-50' : ''}>\r\n          <CardHeader className=\"pb-2\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <CardTitle className=\"text-sm\">\r\n                {supportedSites[selectedSite as keyof typeof supportedSites]?.name} - Iframe\r\n              </CardTitle>\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                onClick={() => setIsFullscreen(!isFullscreen)}\r\n              >\r\n                {isFullscreen ? <Minimize2 className=\"w-4 h-4\" /> : <Maximize2 className=\"w-4 h-4\" />}\r\n              </Button>\r\n            </div>\r\n          </CardHeader>\r\n          <CardContent className=\"p-0\">\r\n            <iframe\r\n              ref={iframeRef}\r\n              className={`w-full border-0 rounded-b-lg ${\r\n                isFullscreen ? 'h-[calc(100vh-8rem)]' : 'h-96'\r\n              }`}\r\n              sandbox=\"allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox\"\r\n              title={`${supportedSites[selectedSite as keyof typeof supportedSites]?.name} Betting Interface`}\r\n            />\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Alertas */}\r\n      {suggestedBets.length > 0 && !connectionStatus.tableReady && (\r\n        <Alert>\r\n          <AlertTriangle className=\"h-4 w-4\" />\r\n          <AlertDescription>\r\n            Há {suggestedBets.length} sinais disponíveis! Configure a conexão para executar apostas automaticamente.\r\n          </AlertDescription>\r\n        </Alert>\r\n      )}\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/betting/iframe-integration.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/chat/live-chat.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/dashboard/active-pattern-skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/dashboard/active-signal-hero.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/dashboard/automation-dashboard.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'connectProviders'. Either include it or remove the dependency array.","line":292,"column":6,"nodeType":"ArrayExpression","endLine":292,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [addLog, config, connectProviders]","fix":{"range":[7312,7328],"text":"[addLog, config, connectProviders]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect, useCallback, useRef } from 'react';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Switch } from '@/components/ui/switch';\nimport { Separator } from '@/components/ui/separator';\nimport { Progress } from '@/components/ui/progress';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { \n  Bot, \n  Globe, \n  Zap, \n  Shield, \n  Play, \n  Pause, \n  Settings, \n  AlertTriangle, \n  CheckCircle, \n  Clock,\n  Target,\n  Activity,\n  Eye,\n  EyeOff,\n  TrendingUp,\n  DollarSign,\n  RefreshCw,\n  Monitor,\n  Chrome,\n  StopCircle,\n  Power,\n  Gauge,\n  BarChart3,\n  Users,\n  Server,\n  Wifi,\n  WifiOff\n} from 'lucide-react';\n\n// Interfaces\ninterface AutomationSession {\n  id: string;\n  tableId: string;\n  strategy: string;\n  status: 'active' | 'paused' | 'stopped' | 'error';\n  provider: string;\n  startTime: string;\n  stats: {\n    totalBets: number;\n    wins: number;\n    losses: number;\n    profit: number;\n    winRate: number;\n  };\n}\n\ninterface BettingProvider {\n  id: string;\n  name: string;\n  type: 'api' | 'puppeteer' | 'iframe';\n  status: 'connected' | 'disconnected' | 'error' | 'connecting';\n  priority: number;\n  capabilities: {\n    maxStake: number;\n    minStake: number;\n    supportsConcurrentBets: boolean;\n    executionSpeed: 'fast' | 'medium' | 'slow';\n    reliability: 'high' | 'medium' | 'low';\n  };\n  stats: {\n    totalBets: number;\n    successRate: number;\n    avgResponseTime: number;\n  };\n}\n\ninterface AutomationConfig {\n  maxConcurrentSessions: number;\n  defaultStake: number;\n  maxStake: number;\n  stopLossLimit: number;\n  takeProfitLimit: number;\n  maxConsecutiveLosses: number;\n  betDelay: number;\n  riskLevel: 'conservative' | 'moderate' | 'aggressive';\n  autoRestart: boolean;\n  emergencyStop: boolean;\n}\n\ninterface SystemStatus {\n  isInitialized: boolean;\n  isRunning: boolean;\n  connectedProviders: string[];\n  activeSessions: number;\n  queueSize: number;\n  totalProfit: number;\n  systemHealth: 'healthy' | 'warning' | 'error';\n  lastUpdate: Date;\n}\n\ninterface AutomationDashboardProps {\n  tableId?: string;\n  suggestedBets?: (string | number)[];\n  strategyName?: string;\n  systemStatus?: SystemStatus;\n  onStatusChange?: (status: SystemStatus) => void;\n}\n\nexport function AutomationDashboard({\n  tableId = 'default',\n  suggestedBets = [],\n  strategyName = 'Default Strategy',\n  systemStatus: externalStatus,\n  onStatusChange\n}: AutomationDashboardProps) {\n  // Estados principais\n  const [systemStatus, setSystemStatus] = useState<SystemStatus>(\n    externalStatus || {\n      isInitialized: false,\n      isRunning: false,\n      connectedProviders: [],\n      activeSessions: 0,\n      queueSize: 0,\n      totalProfit: 0,\n      systemHealth: 'healthy',\n      lastUpdate: new Date()\n    }\n  );\n\n  // Sync with external status\n  useEffect(() => {\n    if (externalStatus) {\n      setSystemStatus(externalStatus);\n    }\n  }, [externalStatus]);\n\n  const [isSystemActive, setIsSystemActive] = useState(false);\n  const [emergencyStop, setEmergencyStop] = useState(false);\n  const [activeTab, setActiveTab] = useState('overview');\n  \n  // Estados de configuração\n  const [config, setConfig] = useState<AutomationConfig>({\n    maxConcurrentSessions: 3,\n    defaultStake: 5,\n    maxStake: 50,\n    stopLossLimit: 100,\n    takeProfitLimit: 200,\n    maxConsecutiveLosses: 5,\n    betDelay: 3000,\n    riskLevel: 'moderate',\n    autoRestart: true,\n    emergencyStop: false\n  });\n\n  // Estados de dados\n  const [sessions, setSessions] = useState<AutomationSession[]>([]);\n  const [providers, setProviders] = useState<BettingProvider[]>([\n    {\n      id: 'api-primary',\n      name: 'API Primary',\n      type: 'api',\n      status: 'disconnected',\n      priority: 1,\n      capabilities: {\n        maxStake: 1000,\n        minStake: 1,\n        supportsConcurrentBets: true,\n        executionSpeed: 'fast',\n        reliability: 'high'\n      },\n      stats: {\n        totalBets: 0,\n        successRate: 0,\n        avgResponseTime: 0\n      }\n    },\n    {\n      id: 'puppeteer-betgorillas',\n      name: 'BetGorillas (Puppeteer)',\n      type: 'puppeteer',\n      status: 'disconnected',\n      priority: 2,\n      capabilities: {\n        maxStake: 500,\n        minStake: 1,\n        supportsConcurrentBets: false,\n        executionSpeed: 'slow',\n        reliability: 'medium'\n      },\n      stats: {\n        totalBets: 0,\n        successRate: 0,\n        avgResponseTime: 0\n      }\n    },\n    {\n      id: 'iframe-fallback',\n      name: 'iFrame Fallback',\n      type: 'iframe',\n      status: 'disconnected',\n      priority: 3,\n      capabilities: {\n        maxStake: 100,\n        minStake: 1,\n        supportsConcurrentBets: false,\n        executionSpeed: 'medium',\n        reliability: 'low'\n      },\n      stats: {\n        totalBets: 0,\n        successRate: 0,\n        avgResponseTime: 0\n      }\n    }\n  ]);\n\n  const [systemMetrics, setSystemMetrics] = useState({\n    totalSessions: 0,\n    activeSessions: 0,\n    totalBets: 0,\n    totalProfit: 0,\n    systemUptime: '00:00:00',\n    queueSize: 0,\n    avgResponseTime: 0\n  });\n\n  const [logs, setLogs] = useState<Array<{\n    id: string;\n    timestamp: string;\n    level: 'info' | 'success' | 'warning' | 'error';\n    message: string;\n    source: string;\n  }>>([]);\n\n  // Refs\n  const logEndRef = useRef<HTMLDivElement>(null);\n\n  // Função para adicionar logs\n  const addLog = useCallback((message: string, level: 'info' | 'success' | 'warning' | 'error' = 'info', source: string = 'system') => {\n    const newLog = {\n      id: `log_${Date.now()}_${Math.random().toString(36).substr(2, 6)}`,\n      timestamp: new Date().toLocaleTimeString(),\n      level,\n      message,\n      source\n    };\n    \n    setLogs(prev => [...prev.slice(-99), newLog]); // Manter apenas os últimos 100 logs\n  }, []);\n\n  // Auto-scroll dos logs\n  useEffect(() => {\n    logEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [logs]);\n\n  // Inicializar sistema de automação\n  const initializeSystem = useCallback(async () => {\n    try {\n      addLog('🚀 Inicializando sistema de automação...', 'info');\n      \n      const response = await fetch('/api/automation/initialize', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ config })\n      });\n\n      if (!response.ok) {\n        throw new Error('Falha ao inicializar sistema');\n      }\n\n      const result = await response.json();\n      \n      if (result.success) {\n        setIsSystemActive(true);\n        addLog('✅ Sistema de automação inicializado com sucesso', 'success');\n        \n        // Conectar provedores\n        await connectProviders();\n      } else {\n        throw new Error(result.error || 'Erro desconhecido');\n      }\n\n    } catch (error) {\n      addLog(`❌ Erro ao inicializar sistema: ${error}`, 'error');\n    }\n  }, [config, addLog]);\n\n  // Conectar provedores\n  const connectProviders = useCallback(async () => {\n    for (const provider of providers) {\n      try {\n        addLog(`🔌 Conectando ${provider.name}...`, 'info', provider.id);\n        \n        setProviders(prev => prev.map(p => \n          p.id === provider.id ? { ...p, status: 'connecting' } : p\n        ));\n\n        const response = await fetch(`/api/automation/providers/${provider.id}/connect`, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' }\n        });\n\n        const result = await response.json();\n\n        if (result.success) {\n          setProviders(prev => prev.map(p => \n            p.id === provider.id ? { ...p, status: 'connected' } : p\n          ));\n          addLog(`✅ ${provider.name} conectado`, 'success', provider.id);\n        } else {\n          throw new Error(result.error || 'Falha na conexão');\n        }\n\n      } catch (error) {\n        setProviders(prev => prev.map(p => \n          p.id === provider.id ? { ...p, status: 'error' } : p\n        ));\n        addLog(`❌ Erro ao conectar ${provider.name}: ${error}`, 'error', provider.id);\n      }\n    }\n  }, [providers, addLog]);\n\n  // Parar sistema (emergência)\n  const emergencyStopSystem = useCallback(async () => {\n    try {\n      addLog('🚨 PARADA DE EMERGÊNCIA ATIVADA', 'warning');\n      \n      setEmergencyStop(true);\n      setIsSystemActive(false);\n\n      const response = await fetch('/api/automation/emergency-stop', {\n        method: 'POST'\n      });\n\n      if (response.ok) {\n        addLog('✅ Sistema parado com segurança', 'success');\n        setSessions([]);\n      } else {\n        addLog('⚠️ Erro na parada de emergência - verificar manualmente', 'error');\n      }\n\n    } catch (error) {\n      addLog(`❌ Erro na parada de emergência: ${error}`, 'error');\n    }\n  }, [addLog]);\n\n  // Iniciar sessão de automação\n  const startAutomationSession = useCallback(async () => {\n    if (!isSystemActive) {\n      addLog('❌ Sistema não está ativo', 'error');\n      return;\n    }\n\n    try {\n      addLog(`🎯 Iniciando sessão para ${strategyName}...`, 'info');\n\n      const response = await fetch('/api/automation/sessions/start', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          tableId,\n          strategy: strategyName,\n          suggestedBets,\n          config: {\n            stake: config.defaultStake,\n            maxStake: config.maxStake,\n            stopLoss: config.stopLossLimit,\n            takeProfit: config.takeProfitLimit\n          }\n        })\n      });\n\n      const result = await response.json();\n\n      if (result.success) {\n        const newSession: AutomationSession = {\n          id: result.sessionId,\n          tableId,\n          strategy: strategyName,\n          status: 'active',\n          provider: result.provider,\n          startTime: new Date().toISOString(),\n          stats: {\n            totalBets: 0,\n            wins: 0,\n            losses: 0,\n            profit: 0,\n            winRate: 0\n          }\n        };\n\n        setSessions(prev => [...prev, newSession]);\n        addLog(`✅ Sessão ${result.sessionId} iniciada`, 'success');\n      } else {\n        throw new Error(result.error || 'Falha ao iniciar sessão');\n      }\n\n    } catch (error) {\n      addLog(`❌ Erro ao iniciar sessão: ${error}`, 'error');\n    }\n  }, [isSystemActive, tableId, strategyName, suggestedBets, config, addLog]);\n\n  // Parar sessão específica\n  const stopSession = useCallback(async (sessionId: string) => {\n    try {\n      addLog(`🛑 Parando sessão ${sessionId}...`, 'info');\n\n      const response = await fetch(`/api/automation/sessions/${sessionId}/stop`, {\n        method: 'POST'\n      });\n\n      if (response.ok) {\n        setSessions(prev => prev.map(s => \n          s.id === sessionId ? { ...s, status: 'stopped' } : s\n        ));\n        addLog(`✅ Sessão ${sessionId} parada`, 'success');\n      } else {\n        throw new Error('Falha ao parar sessão');\n      }\n\n    } catch (error) {\n      addLog(`❌ Erro ao parar sessão: ${error}`, 'error');\n    }\n  }, [addLog]);\n\n  // Atualizar métricas do sistema\n  useEffect(() => {\n    if (!isSystemActive) return;\n\n    const interval = setInterval(async () => {\n      try {\n        const response = await fetch('/api/automation/metrics');\n        if (response.ok) {\n          const metrics = await response.json();\n          setSystemMetrics(metrics);\n        }\n      } catch (error) {\n        console.error('Erro ao buscar métricas:', error);\n      }\n    }, 5000);\n\n    return () => clearInterval(interval);\n  }, [isSystemActive]);\n\n  // Renderizar status do provedor\n  const renderProviderStatus = (provider: BettingProvider) => {\n    const statusColors = {\n      connected: 'bg-green-500',\n      disconnected: 'bg-gray-500',\n      connecting: 'bg-yellow-500',\n      error: 'bg-red-500'\n    };\n\n    const statusIcons = {\n      connected: <Wifi className=\"h-4 w-4\" />,\n      disconnected: <WifiOff className=\"h-4 w-4\" />,\n      connecting: <RefreshCw className=\"h-4 w-4 animate-spin\" />,\n      error: <AlertTriangle className=\"h-4 w-4\" />\n    };\n\n    return (\n      <div className=\"flex items-center justify-between p-3 border rounded-lg\">\n        <div className=\"flex items-center space-x-3\">\n          <div className={`w-3 h-3 rounded-full ${statusColors[provider.status]}`} />\n          <div>\n            <div className=\"font-medium\">{provider.name}</div>\n            <div className=\"text-sm text-gray-500\">\n              {provider.type.toUpperCase()} • Prioridade {provider.priority}\n            </div>\n          </div>\n        </div>\n        <div className=\"flex items-center space-x-2\">\n          {statusIcons[provider.status]}\n          <Badge variant={provider.status === 'connected' ? 'default' : 'secondary'}>\n            {provider.status}\n          </Badge>\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header de Controle */}\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <CardTitle className=\"flex items-center space-x-2\">\n                <Bot className=\"h-5 w-5\" />\n                <span>Sistema de Automação SOFIA</span>\n              </CardTitle>\n              <CardDescription>\n                Controle unificado de automação de apostas\n              </CardDescription>\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              <Badge variant={isSystemActive ? 'default' : 'secondary'}>\n                {isSystemActive ? 'ATIVO' : 'INATIVO'}\n              </Badge>\n              {isSystemActive && (\n                <Button\n                  variant=\"destructive\"\n                  size=\"sm\"\n                  onClick={emergencyStopSystem}\n                  className=\"bg-red-600 hover:bg-red-700\"\n                >\n                  <StopCircle className=\"h-4 w-4 mr-1\" />\n                  EMERGÊNCIA\n                </Button>\n              )}\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex items-center space-x-4\">\n            {!isSystemActive ? (\n              <Button onClick={initializeSystem} className=\"bg-green-600 hover:bg-green-700\">\n                <Power className=\"h-4 w-4 mr-2\" />\n                Inicializar Sistema\n              </Button>\n            ) : (\n              <Button onClick={startAutomationSession}>\n                <Play className=\"h-4 w-4 mr-2\" />\n                Nova Sessão\n              </Button>\n            )}\n            \n            <div className=\"flex items-center space-x-2 text-sm text-gray-600\">\n              <Activity className=\"h-4 w-4\" />\n              <span>Sessões Ativas: {systemMetrics.activeSessions}</span>\n            </div>\n            \n            <div className=\"flex items-center space-x-2 text-sm text-gray-600\">\n              <DollarSign className=\"h-4 w-4\" />\n              <span>Lucro Total: R$ {Number(systemMetrics.totalProfit ?? 0).toFixed(2)}</span>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Tabs de Controle */}\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList className=\"grid w-full grid-cols-4\">\n          <TabsTrigger value=\"overview\">Visão Geral</TabsTrigger>\n          <TabsTrigger value=\"sessions\">Sessões</TabsTrigger>\n          <TabsTrigger value=\"providers\">Provedores</TabsTrigger>\n          <TabsTrigger value=\"logs\">Logs</TabsTrigger>\n        </TabsList>\n\n        {/* Visão Geral */}\n        <TabsContent value=\"overview\" className=\"space-y-4\">\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <Card>\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm font-medium\">Métricas do Sistema</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-sm\">Uptime:</span>\n                    <span className=\"text-sm font-mono\">{systemMetrics.systemUptime}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-sm\">Fila:</span>\n                    <span className=\"text-sm\">{systemMetrics.queueSize} apostas</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-sm\">Resp. Média:</span>\n                    <span className=\"text-sm\">{systemMetrics.avgResponseTime}ms</span>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm font-medium\">Configuração Atual</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-sm\">Aposta Padrão:</span>\n                    <span className=\"text-sm\">R$ {config.defaultStake}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-sm\">Stop Loss:</span>\n                    <span className=\"text-sm\">R$ {config.stopLossLimit}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-sm\">Risco:</span>\n                    <Badge variant=\"outline\" className=\"text-xs\">\n                      {config.riskLevel}\n                    </Badge>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm font-medium\">Status dos Provedores</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2\">\n                  {providers.map(provider => (\n                    <div key={provider.id} className=\"flex items-center justify-between\">\n                      <span className=\"text-sm\">{provider.name}:</span>\n                      <div className={`w-2 h-2 rounded-full ${\n                        provider.status === 'connected' ? 'bg-green-500' :\n                        provider.status === 'connecting' ? 'bg-yellow-500' : 'bg-red-500'\n                      }`} />\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n\n        {/* Sessões Ativas */}\n        <TabsContent value=\"sessions\" className=\"space-y-4\">\n          <div className=\"space-y-4\">\n            {sessions.length === 0 ? (\n              <Card>\n                <CardContent className=\"pt-6\">\n                  <div className=\"text-center text-gray-500\">\n                    <Bot className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                    <p>Nenhuma sessão ativa</p>\n                    <p className=\"text-sm\">Inicie uma nova sessão para começar a automação</p>\n                  </div>\n                </CardContent>\n              </Card>\n            ) : (\n              sessions.map(session => (\n                <Card key={session.id}>\n                  <CardHeader>\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <CardTitle className=\"text-lg\">{session.strategy}</CardTitle>\n                        <CardDescription>\n                          Mesa: {session.tableId} • Provedor: {session.provider}\n                        </CardDescription>\n                      </div>\n                      <div className=\"flex items-center space-x-2\">\n                        <Badge variant={session.status === 'active' ? 'default' : 'secondary'}>\n                          {session.status}\n                        </Badge>\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => stopSession(session.id)}\n                        >\n                          <Pause className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"grid grid-cols-2 md:grid-cols-5 gap-4 text-sm\">\n                      <div>\n                        <div className=\"text-gray-500\">Apostas</div>\n                        <div className=\"font-medium\">{session.stats.totalBets}</div>\n                      </div>\n                      <div>\n                        <div className=\"text-gray-500\">Vitórias</div>\n                        <div className=\"font-medium text-green-600\">{session.stats.wins}</div>\n                      </div>\n                      <div>\n                        <div className=\"text-gray-500\">Derrotas</div>\n                        <div className=\"font-medium text-red-600\">{session.stats.losses}</div>\n                      </div>\n                      <div>\n                        <div className=\"text-gray-500\">Taxa de Acerto</div>\n                        <div className=\"font-medium\">{session.stats.winRate.toFixed(1)}%</div>\n                      </div>\n                      <div>\n                        <div className=\"text-gray-500\">Lucro</div>\n                        <div className={`font-medium ${session.stats.profit >= 0 ? 'text-green-600' : 'text-red-600'}`}>\n                          R$ {session.stats.profit.toFixed(2)}\n                        </div>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))\n            )}\n          </div>\n        </TabsContent>\n\n        {/* Provedores */}\n        <TabsContent value=\"providers\" className=\"space-y-4\">\n          <div className=\"space-y-4\">\n            {providers.map(provider => renderProviderStatus(provider))}\n          </div>\n        </TabsContent>\n\n        {/* Logs */}\n        <TabsContent value=\"logs\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"text-lg\">Logs do Sistema</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <ScrollArea className=\"h-96 w-full\">\n                <div className=\"space-y-1\">\n                  {logs.map(log => (\n                    <div key={log.id} className=\"flex items-start space-x-2 text-sm font-mono\">\n                      <span className=\"text-gray-500 shrink-0\">[{log.timestamp}]</span>\n                      <span className={`shrink-0 ${\n                        log.level === 'error' ? 'text-red-600' :\n                        log.level === 'warning' ? 'text-yellow-600' :\n                        log.level === 'success' ? 'text-green-600' : 'text-gray-600'\n                      }`}>\n                        [{log.level.toUpperCase()}]\n                      </span>\n                      <span className=\"text-gray-500 shrink-0\">[{log.source}]</span>\n                      <span>{log.message}</span>\n                    </div>\n                  ))}\n                  <div ref={logEndRef} />\n                </div>\n              </ScrollArea>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/dashboard/bet-validation-system.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/dashboard/betting-automation-panel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/dashboard/cache-manager.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'updateStats' function makes the dependencies of useEffect Hook (at line 94) change on every render. To fix this, wrap the definition of 'updateStats' in its own useCallback() Hook.","line":46,"column":9,"nodeType":"VariableDeclarator","endLine":54,"endColumn":4,"suggestions":[{"desc":"Wrap the definition of 'updateStats' in its own useCallback() Hook.","fix":{"range":[1348,1596],"text":"useCallback(async () => {\r\n    try {\r\n      const cacheStats = rouletteCacheUtils.getStats();\r\n      setStats(cacheStats);\r\n      setLastUpdate(new Date());\r\n    } catch (error) {\r\n      console.error('Erro ao obter estatísticas do cache:', error);\r\n    }\r\n  })"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'updateStats' function makes the dependencies of useEffect Hook (at line 104) change on every render. To fix this, wrap the definition of 'updateStats' in its own useCallback() Hook.","line":46,"column":9,"nodeType":"VariableDeclarator","endLine":54,"endColumn":4,"suggestions":[{"desc":"Wrap the definition of 'updateStats' in its own useCallback() Hook.","fix":{"range":[1348,1596],"text":"useCallback(async () => {\r\n    try {\r\n      const cacheStats = rouletteCacheUtils.getStats();\r\n      setStats(cacheStats);\r\n      setLastUpdate(new Date());\r\n    } catch (error) {\r\n      console.error('Erro ao obter estatísticas do cache:', error);\r\n    }\r\n  })"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect, memo } from 'react';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Progress } from '@/components/ui/progress';\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\r\nimport { \r\n  Database, \r\n  RefreshCw, \r\n  Trash2, \r\n  Activity, \r\n  Clock, \r\n  Zap,\r\n  TrendingUp,\r\n  AlertCircle,\r\n  CheckCircle,\r\n  Info\r\n} from 'lucide-react';\r\nimport { rouletteCacheUtils } from '@/lib/roulette-cache';\r\nimport { cacheUtils } from '@/lib/api-cache';\r\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '@/components/ui/tooltip';\r\n\r\ninterface CacheManagerProps {\r\n  className?: string;\r\n  showAdvanced?: boolean;\r\n}\r\n\r\n/**\r\n * Componente para gerenciar e monitorar o sistema de cache\r\n */\r\nfunction CacheManagerComponent({ className, showAdvanced = false }: CacheManagerProps) {\r\n  const [stats, setStats] = useState({\r\n    hits: 0,\r\n    misses: 0,\r\n    size: 0,\r\n    hitRate: 0,\r\n    realtimeActive: false,\r\n    subscribersCount: 0\r\n  });\r\n  const [isRefreshing, setIsRefreshing] = useState(false);\r\n  const [lastUpdate, setLastUpdate] = useState<Date | null>(null);\r\n\r\n  // Atualizar estatísticas\r\n  const updateStats = async () => {\r\n    try {\r\n      const cacheStats = rouletteCacheUtils.getStats();\r\n      setStats(cacheStats);\r\n      setLastUpdate(new Date());\r\n    } catch (error) {\r\n      console.error('Erro ao obter estatísticas do cache:', error);\r\n    }\r\n  };\r\n\r\n  // Refresh completo do cache\r\n  const handleFullRefresh = async () => {\r\n    setIsRefreshing(true);\r\n    try {\r\n      rouletteCacheUtils.forceRefresh();\r\n      await new Promise(resolve => setTimeout(resolve, 1000)); // Aguardar refresh\r\n      await updateStats();\r\n    } catch (error) {\r\n      console.error('Erro ao fazer refresh do cache:', error);\r\n    } finally {\r\n      setIsRefreshing(false);\r\n    }\r\n  };\r\n\r\n  // Limpar cache específico\r\n  const handleClearCache = (type: string) => {\r\n    switch (type) {\r\n      case 'realtime':\r\n        cacheUtils.invalidateRealtime();\r\n        break;\r\n      case 'historical':\r\n        cacheUtils.invalidateHistorical();\r\n        break;\r\n      case 'strategies':\r\n        cacheUtils.invalidateStrategies();\r\n        break;\r\n      case 'all':\r\n        cacheUtils.invalidateAll();\r\n        break;\r\n    }\r\n    updateStats();\r\n  };\r\n\r\n  // Atualizar estatísticas periodicamente\r\n  useEffect(() => {\r\n    updateStats();\r\n    const interval = setInterval(updateStats, 5000); // A cada 5 segundos\r\n    return () => clearInterval(interval);\r\n  }, [updateStats]);\r\n\r\n  // Subscrever a atualizações do cache\r\n  useEffect(() => {\r\n    const unsubscribe = rouletteCacheUtils.subscribe((data) => {\r\n      if (data.type === 'realtime_update') {\r\n        updateStats();\r\n      }\r\n    });\r\n    return unsubscribe;\r\n  }, [updateStats]);\r\n\r\n  const hitRateColor = stats.hitRate >= 80 ? 'text-green-600' : \r\n                      stats.hitRate >= 60 ? 'text-yellow-600' : 'text-red-600';\r\n\r\n  if (!showAdvanced) {\r\n    // Versão simplificada\r\n    return (\r\n      <Card className={className}>\r\n        <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n          <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\r\n            <Database className=\"h-4 w-4\" />\r\n            Cache do Sistema\r\n          </CardTitle>\r\n          <div className=\"flex items-center gap-2\">\r\n            <Badge variant={stats.realtimeActive ? 'default' : 'secondary'}>\r\n              {stats.realtimeActive ? 'Ativo' : 'Inativo'}\r\n            </Badge>\r\n            <Button \r\n              onClick={handleFullRefresh} \r\n              variant=\"ghost\" \r\n              size=\"sm\"\r\n              disabled={isRefreshing}\r\n            >\r\n              <RefreshCw className={`h-4 w-4 ${isRefreshing ? 'animate-spin' : ''}`} />\r\n            </Button>\r\n          </div>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"grid grid-cols-3 gap-4 text-sm\">\r\n            <div>\r\n              <p className=\"text-muted-foreground\">Taxa de Acerto</p>\r\n              <p className={`font-medium ${hitRateColor}`}>\r\n                {stats.hitRate.toFixed(1)}%\r\n              </p>\r\n            </div>\r\n            <div>\r\n              <p className=\"text-muted-foreground\">Entradas</p>\r\n              <p className=\"font-medium\">{stats.size}</p>\r\n            </div>\r\n            <div>\r\n              <p className=\"text-muted-foreground\">Acessos</p>\r\n              <p className=\"font-medium\">{stats.hits + stats.misses}</p>\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  // Versão avançada\r\n  return (\r\n    <Card className={className}>\r\n      <CardHeader>\r\n        <CardTitle className=\"flex items-center gap-2\">\r\n          <Database className=\"h-5 w-5\" />\r\n          Gerenciador de Cache\r\n        </CardTitle>\r\n      </CardHeader>\r\n      <CardContent>\r\n        <Tabs defaultValue=\"overview\" className=\"w-full\">\r\n          <TabsList className=\"grid w-full grid-cols-3\">\r\n            <TabsTrigger value=\"overview\">Visão Geral</TabsTrigger>\r\n            <TabsTrigger value=\"performance\">Performance</TabsTrigger>\r\n            <TabsTrigger value=\"controls\">Controles</TabsTrigger>\r\n          </TabsList>\r\n          \r\n          <TabsContent value=\"overview\" className=\"space-y-4\">\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n              <div className=\"space-y-2\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <span className=\"text-sm text-muted-foreground\">Status do Sistema</span>\r\n                  <Badge variant={stats.realtimeActive ? 'default' : 'secondary'}>\r\n                    {stats.realtimeActive ? (\r\n                      <><CheckCircle className=\"h-3 w-3 mr-1\" />Ativo</>\r\n                    ) : (\r\n                      <><AlertCircle className=\"h-3 w-3 mr-1\" />Inativo</>\r\n                    )}\r\n                  </Badge>\r\n                </div>\r\n                \r\n                <div className=\"flex items-center justify-between\">\r\n                  <span className=\"text-sm text-muted-foreground\">Entradas no Cache</span>\r\n                  <span className=\"font-medium\">{stats.size}</span>\r\n                </div>\r\n                \r\n                <div className=\"flex items-center justify-between\">\r\n                  <span className=\"text-sm text-muted-foreground\">Subscribers Ativos</span>\r\n                  <span className=\"font-medium\">{stats.subscribersCount}</span>\r\n                </div>\r\n              </div>\r\n              \r\n              <div className=\"space-y-2\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <span className=\"text-sm text-muted-foreground\">Taxa de Acerto</span>\r\n                  <span className={`font-medium ${hitRateColor}`}>\r\n                    {stats.hitRate.toFixed(1)}%\r\n                  </span>\r\n                </div>\r\n                \r\n                <Progress value={stats.hitRate} className=\"h-2\" />\r\n                \r\n                <div className=\"flex justify-between text-xs text-muted-foreground\">\r\n                  <span>Hits: {stats.hits}</span>\r\n                  <span>Misses: {stats.misses}</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            \r\n            {lastUpdate && (\r\n              <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\r\n                <Clock className=\"h-3 w-3\" />\r\n                Última atualização: {lastUpdate.toLocaleTimeString()}\r\n              </div>\r\n            )}\r\n          </TabsContent>\r\n          \r\n          <TabsContent value=\"performance\" className=\"space-y-4\">\r\n            <div className=\"grid grid-cols-1 gap-4\">\r\n              <div className=\"space-y-2\">\r\n                <h4 className=\"text-sm font-medium flex items-center gap-2\">\r\n                  <TrendingUp className=\"h-4 w-4\" />\r\n                  Métricas de Performance\r\n                </h4>\r\n                \r\n                <div className=\"grid grid-cols-2 gap-4 text-sm\">\r\n                  <div className=\"space-y-1\">\r\n                    <span className=\"text-muted-foreground\">Eficiência do Cache</span>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <Progress value={stats.hitRate} className=\"h-1 flex-1\" />\r\n                      <span className={`text-xs ${hitRateColor}`}>\r\n                        {stats.hitRate > 80 ? 'Excelente' : \r\n                         stats.hitRate > 60 ? 'Bom' : 'Precisa Melhorar'}\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  <div className=\"space-y-1\">\r\n                    <span className=\"text-muted-foreground\">Utilização</span>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <Progress value={(stats.size / 200) * 100} className=\"h-1 flex-1\" />\r\n                      <span className=\"text-xs\">{stats.size}/200</span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              \r\n              <div className=\"space-y-2\">\r\n                <h4 className=\"text-sm font-medium flex items-center gap-2\">\r\n                  <Activity className=\"h-4 w-4\" />\r\n                  Atividade em Tempo Real\r\n                </h4>\r\n                \r\n                <div className=\"flex items-center justify-between p-2 bg-muted rounded\">\r\n                  <span className=\"text-sm\">Atualizações Automáticas</span>\r\n                  <Badge variant={stats.realtimeActive ? 'default' : 'secondary'}>\r\n                    {stats.realtimeActive ? 'Habilitado' : 'Desabilitado'}\r\n                  </Badge>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </TabsContent>\r\n          \r\n          <TabsContent value=\"controls\" className=\"space-y-4\">\r\n            <div className=\"space-y-4\">\r\n              <div>\r\n                <h4 className=\"text-sm font-medium mb-2\">Ações Rápidas</h4>\r\n                <div className=\"grid grid-cols-2 gap-2\">\r\n                  <Button \r\n                    onClick={handleFullRefresh} \r\n                    variant=\"outline\" \r\n                    size=\"sm\"\r\n                    disabled={isRefreshing}\r\n                  >\r\n                    <RefreshCw className={`h-4 w-4 mr-2 ${isRefreshing ? 'animate-spin' : ''}`} />\r\n                    Refresh Completo\r\n                  </Button>\r\n                  \r\n                  <TooltipProvider>\r\n                    <Tooltip>\r\n                      <TooltipTrigger asChild>\r\n                        <Button \r\n                          onClick={() => handleClearCache('all')} \r\n                          variant=\"outline\" \r\n                          size=\"sm\"\r\n                        >\r\n                          <Trash2 className=\"h-4 w-4 mr-2\" />\r\n                          Limpar Tudo\r\n                        </Button>\r\n                      </TooltipTrigger>\r\n                      <TooltipContent>\r\n                        <p>Remove todas as entradas do cache</p>\r\n                      </TooltipContent>\r\n                    </Tooltip>\r\n                  </TooltipProvider>\r\n                </div>\r\n              </div>\r\n              \r\n              <div>\r\n                <h4 className=\"text-sm font-medium mb-2\">Limpeza Seletiva</h4>\r\n                <div className=\"space-y-2\">\r\n                  <Button \r\n                    onClick={() => handleClearCache('realtime')} \r\n                    variant=\"ghost\" \r\n                    size=\"sm\" \r\n                    className=\"w-full justify-start\"\r\n                  >\r\n                    <Zap className=\"h-4 w-4 mr-2\" />\r\n                    Dados em Tempo Real\r\n                  </Button>\r\n                  \r\n                  <Button \r\n                    onClick={() => handleClearCache('historical')} \r\n                    variant=\"ghost\" \r\n                    size=\"sm\" \r\n                    className=\"w-full justify-start\"\r\n                  >\r\n                    <Clock className=\"h-4 w-4 mr-2\" />\r\n                    Dados Históricos\r\n                  </Button>\r\n                  \r\n                  <Button \r\n                    onClick={() => handleClearCache('strategies')} \r\n                    variant=\"ghost\" \r\n                    size=\"sm\" \r\n                    className=\"w-full justify-start\"\r\n                  >\r\n                    <TrendingUp className=\"h-4 w-4 mr-2\" />\r\n                    Estratégias\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </TabsContent>\r\n        </Tabs>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n}\r\n\r\nexport const CacheManager = memo(CacheManagerComponent);","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/dashboard/chips-badge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/dashboard/dashboard-skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/dashboard/error-recovery-system.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/dashboard/header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/dashboard/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/dashboard/live-signals-cached.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/dashboard/live-signals.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/dashboard/main-skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/dashboard/performance-chart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/dashboard/quick-controls.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/dashboard/real-betting-automation.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has missing dependencies: 'injectAutomationScript' and 'performLogin'. Either include them or remove the dependency array.","line":173,"column":6,"nodeType":"ArrayExpression","endLine":173,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [config.credentials.email, config.credentials.password, config.site, addLog, performLogin, injectAutomationScript]","fix":{"range":[5209,5225],"text":"[config.credentials.email, config.credentials.password, config.site, addLog, performLogin, injectAutomationScript]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'calculateBetAmount'. Either include it or remove the dependency array.","line":348,"column":6,"nodeType":"ArrayExpression","endLine":348,"endColumn":31,"suggestions":[{"desc":"Update the dependencies array to be: [config.strategy, addLog, calculateBetAmount]","fix":{"range":[11335,11360],"text":"[config.strategy, addLog, calculateBetAmount]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'simulateBetResult'. Either include it or remove the dependency array.","line":414,"column":6,"nodeType":"ArrayExpression","endLine":414,"endColumn":49,"suggestions":[{"desc":"Update the dependencies array to be: [connectionStatus, config.strategy, addLog, simulateBetResult]","fix":{"range":[13490,13533],"text":"[connectionStatus, config.strategy, addLog, simulateBetResult]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'startStatusMonitoring'. Either include it or remove the dependency array.","line":1173,"column":6,"nodeType":"ArrayExpression","endLine":1173,"endColumn":50,"suggestions":[{"desc":"Update the dependencies array to be: [config.credentials.email, config.credentials.password, addLog, availableStrategies.length, startStatusMonitoring]","fix":{"range":[40572,40616],"text":"[config.credentials.email, config.credentials.password, addLog, availableStrategies.length, startStatusMonitoring]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect, useCallback, useRef } from 'react';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Alert, AlertDescription } from '@/components/ui/alert';\r\nimport { Progress } from '@/components/ui/progress';\r\nimport { Switch } from '@/components/ui/switch';\r\nimport { Separator } from '@/components/ui/separator';\r\nimport { \r\n  Play, \r\n  Pause, \r\n  StopCircle, \r\n  Target, \r\n  TrendingUp, \r\n  TrendingDown,\r\n  Clock,\r\n  DollarSign,\r\n  AlertTriangle,\r\n  CheckCircle,\r\n  Globe,\r\n  Zap,\r\n  Activity,\r\n  Settings,\r\n  Brain,\r\n  BarChart3,\r\n  Shield,\r\n  RefreshCw\r\n} from 'lucide-react';\r\n\r\ninterface BettingConfig {\r\n  site: 'betgorillas' | 'bet365' | 'betfair' | 'betano';\r\n  credentials: {\r\n    email: string;\r\n    password: string;\r\n  };\r\n  betAmount: number;\r\n  strategy: string;\r\n  autoMode: boolean;\r\n  maxConsecutiveLosses: number;\r\n  stopLossAmount: number;\r\n  takeProfitAmount: number;\r\n}\r\n\r\ninterface BettingSession {\r\n  id: string;\r\n  startTime: number;\r\n  endTime?: number;\r\n  totalBets: number;\r\n  wins: number;\r\n  losses: number;\r\n  profit: number;\r\n  maxDrawdown: number;\r\n  winRate: number;\r\n  avgBetAmount: number;\r\n  status: 'active' | 'paused' | 'stopped';\r\n}\r\n\r\ninterface LiveBet {\r\n  id: string;\r\n  timestamp: number;\r\n  type: 'red' | 'black' | 'green' | 'number';\r\n  value: string;\r\n  amount: number;\r\n  confidence: number;\r\n  strategy: string;\r\n  status: 'pending' | 'won' | 'lost';\r\n  result?: string;\r\n  payout?: number;\r\n}\r\n\r\ninterface RouletteResult {\r\n  number: number;\r\n  color: 'red' | 'black' | 'green';\r\n  timestamp: number;\r\n}\r\n\r\nimport { BetValidationSystem } from './bet-validation-system';\r\nimport { ErrorRecoverySystem } from './error-recovery-system';\r\n\r\nfunction RealBettingAutomationOld() {\r\n  const [config, setConfig] = useState<BettingConfig>({\r\n    site: 'betgorillas',\r\n    credentials: { email: '', password: '' },\r\n    betAmount: 10,\r\n    strategy: 'martingale',\r\n    autoMode: false,\r\n    maxConsecutiveLosses: 3,\r\n    stopLossAmount: 100,\r\n    takeProfitAmount: 200\r\n  });\r\n\r\n  const [session, setSession] = useState<BettingSession>({\r\n    id: '',\r\n    startTime: 0,\r\n    totalBets: 0,\r\n    wins: 0,\r\n    losses: 0,\r\n    profit: 0,\r\n    maxDrawdown: 0,\r\n    winRate: 0,\r\n    avgBetAmount: 0,\r\n    status: 'stopped'\r\n  });\r\n\r\n  const [liveBets, setLiveBets] = useState<LiveBet[]>([]);\r\n  const [recentResults, setRecentResults] = useState<RouletteResult[]>([]);\r\n  const [connectionStatus, setConnectionStatus] = useState<'disconnected' | 'connecting' | 'connected' | 'reconnecting'>('disconnected');\r\n  const [currentBalance, setCurrentBalance] = useState(1000);\r\n  const [logs, setLogs] = useState<string[]>([]);\r\n  const [isAutomationActive, setIsAutomationActive] = useState(false);\r\n  const [nextBetPrediction, setNextBetPrediction] = useState<{type: string, confidence: number, amount: number} | null>(null);\r\n\r\n  const iframeRef = useRef<HTMLIFrameElement>(null);\r\n  const automationIntervalRef = useRef<NodeJS.Timeout | null>(null);\r\n  const strategyEngineRef = useRef<any>(null);\r\n\r\n  // Adicionar log\r\n  const addLog = useCallback((message: string, type: 'info' | 'success' | 'error' | 'warning' = 'info') => {\r\n    const timestamp = new Date().toLocaleTimeString();\r\n    const logMessage = `[${timestamp}] ${message}`;\r\n    setLogs(prev => [logMessage, ...prev].slice(0, 100));\r\n    console.log(`[BETTING-AUTO] ${logMessage}`);\r\n  }, []);\r\n\r\n  // Conectar ao site de apostas\r\n  const connectToSite = useCallback(async () => {\r\n    if (!config.credentials.email || !config.credentials.password) {\r\n      addLog('Credenciais não fornecidas', 'error');\r\n      return;\r\n    }\r\n\r\n    setConnectionStatus('connecting');\r\n    addLog(`Conectando ao ${config.site}...`);\r\n\r\n    try {\r\n      // Simular conexão real - em produção, isso seria uma conexão real via iframe/puppeteer\r\n      await new Promise(resolve => setTimeout(resolve, 2000));\r\n      \r\n      if (config.site === 'betgorillas') {\r\n        // URL real fornecida pelo usuário\r\n        const siteUrl = 'https://betgorillas.bet.br/games/imaginelive/roleta-brasileira';\r\n        \r\n        if (iframeRef.current) {\r\n          iframeRef.current.src = siteUrl;\r\n          \r\n          // Aguardar carregamento do iframe\r\n          await new Promise((resolve) => {\r\n            if (iframeRef.current) {\r\n              iframeRef.current.onload = resolve;\r\n            }\r\n          });\r\n          \r\n          // Injetar script de automação no iframe\r\n          await injectAutomationScript();\r\n        }\r\n      }\r\n\r\n      setConnectionStatus('connected');\r\n      addLog(`Conectado com sucesso ao ${config.site}`, 'success');\r\n      \r\n      // Simular login\r\n      await performLogin();\r\n      \r\n    } catch (error) {\r\n      setConnectionStatus('disconnected');\r\n      addLog(`Erro ao conectar: ${error}`, 'error');\r\n    }\r\n  }, [config, addLog]);\r\n\r\n  // Injetar script de automação no iframe\r\n  const injectAutomationScript = useCallback(async () => {\r\n    if (!iframeRef.current) return;\r\n\r\n    const automationScript = `\r\n      (function() {\r\n        console.log('SOFIA Automation Script Loaded');\r\n        \r\n        // Detectar elementos da roleta\r\n        const detectRouletteElements = () => {\r\n          const betButtons = {\r\n            red: document.querySelector('[data-bet=\"red\"], .red-bet, .bet-red'),\r\n            black: document.querySelector('[data-bet=\"black\"], .black-bet, .bet-black'),\r\n            numbers: document.querySelectorAll('[data-bet^=\"number\"], .number-bet')\r\n          };\r\n          \r\n          const balanceElement = document.querySelector('.balance, .saldo, [data-balance]');\r\n          const resultElement = document.querySelector('.result, .resultado, [data-result]');\r\n          \r\n          return { betButtons, balanceElement, resultElement };\r\n        };\r\n        \r\n        // Executar aposta\r\n        const placeBet = (type, amount) => {\r\n          const elements = detectRouletteElements();\r\n          \r\n          if (type === 'red' && elements.betButtons.red) {\r\n            elements.betButtons.red.click();\r\n            return true;\r\n          } else if (type === 'black' && elements.betButtons.black) {\r\n            elements.betButtons.black.click();\r\n            return true;\r\n          }\r\n          \r\n          return false;\r\n        };\r\n        \r\n        // Obter resultado da roleta\r\n        const getLastResult = () => {\r\n          const elements = detectRouletteElements();\r\n          if (elements.resultElement) {\r\n            return elements.resultElement.textContent || elements.resultElement.innerText;\r\n          }\r\n          return null;\r\n        };\r\n        \r\n        // Obter saldo atual\r\n        const getCurrentBalance = () => {\r\n          const elements = detectRouletteElements();\r\n          if (elements.balanceElement) {\r\n            const balanceText = elements.balanceElement.textContent || elements.balanceElement.innerText;\r\n            const balance = parseFloat(balanceText.replace(/[^0-9.,]/g, '').replace(',', '.'));\r\n            return isNaN(balance) ? 0 : balance;\r\n          }\r\n          return 0;\r\n        };\r\n        \r\n        // Comunicação com o componente pai\r\n        window.addEventListener('message', (event) => {\r\n          if (event.data.type === 'PLACE_BET') {\r\n            const success = placeBet(event.data.betType, event.data.amount);\r\n            parent.postMessage({\r\n              type: 'BET_PLACED',\r\n              success,\r\n              betId: event.data.betId\r\n            }, '*');\r\n          } else if (event.data.type === 'GET_BALANCE') {\r\n            const balance = getCurrentBalance();\r\n            parent.postMessage({\r\n              type: 'BALANCE_UPDATE',\r\n              balance\r\n            }, '*');\r\n          } else if (event.data.type === 'GET_RESULT') {\r\n            const result = getLastResult();\r\n            parent.postMessage({\r\n              type: 'RESULT_UPDATE',\r\n              result\r\n            }, '*');\r\n          }\r\n        });\r\n        \r\n        // Monitorar mudanças na página\r\n        const observer = new MutationObserver((mutations) => {\r\n          mutations.forEach((mutation) => {\r\n            if (mutation.type === 'childList') {\r\n              const result = getLastResult();\r\n              if (result) {\r\n                parent.postMessage({\r\n                  type: 'RESULT_UPDATE',\r\n                  result\r\n                }, '*');\r\n              }\r\n              \r\n              const balance = getCurrentBalance();\r\n              if (balance > 0) {\r\n                parent.postMessage({\r\n                  type: 'BALANCE_UPDATE',\r\n                  balance\r\n                }, '*');\r\n              }\r\n            }\r\n          });\r\n        });\r\n        \r\n        observer.observe(document.body, {\r\n          childList: true,\r\n          subtree: true\r\n        });\r\n        \r\n        // Heartbeat\r\n        setInterval(() => {\r\n          parent.postMessage({\r\n            type: 'HEARTBEAT',\r\n            timestamp: Date.now()\r\n          }, '*');\r\n        }, 5000);\r\n        \r\n      })();\r\n    `;\r\n\r\n    try {\r\n      // Em um cenário real, isso seria injetado via postMessage ou extensão\r\n      addLog('Script de automação injetado com sucesso', 'success');\r\n    } catch (error) {\r\n      addLog(`Erro ao injetar script: ${error}`, 'error');\r\n    }\r\n  }, [addLog]);\r\n\r\n  // Realizar login\r\n  const performLogin = useCallback(async () => {\r\n    addLog('Realizando login...');\r\n    \r\n    // Simular processo de login\r\n    await new Promise(resolve => setTimeout(resolve, 1500));\r\n    \r\n    // Simular obtenção do saldo\r\n    setCurrentBalance(1000);\r\n    addLog('Login realizado com sucesso', 'success');\r\n    addLog(`Saldo atual: R$ ${currentBalance.toFixed(2)}`, 'info');\r\n  }, [currentBalance, addLog]);\r\n\r\n  // Inicializar motor de estratégias\r\n  const initializeStrategyEngine = useCallback(() => {\r\n    // Simular carregamento das estratégias existentes\r\n    const strategies = [\r\n      'Martingale Adaptativo',\r\n      'Fibonacci Inteligente', \r\n      'Padrão de Cores',\r\n      'Análise de Frequência',\r\n      'ML Prediction'\r\n    ];\r\n    \r\n    strategyEngineRef.current = {\r\n      currentStrategy: config.strategy,\r\n      analyze: (history: RouletteResult[]) => {\r\n        // Simular análise baseada no histórico\r\n        const recentColors = history.slice(0, 10).map(r => r.color);\r\n        const redCount = recentColors.filter(c => c === 'red').length;\r\n        const blackCount = recentColors.filter(c => c === 'black').length;\r\n        \r\n        // Lógica simples: apostar na cor menos frequente\r\n        const prediction = redCount > blackCount ? 'black' : 'red';\r\n        const confidence = Math.abs(redCount - blackCount) * 10 + 50;\r\n        \r\n        return {\r\n          type: prediction,\r\n          confidence: Math.min(confidence, 95),\r\n          amount: calculateBetAmount(confidence)\r\n        };\r\n      }\r\n    };\r\n    \r\n    addLog(`Motor de estratégias inicializado: ${config.strategy}`, 'success');\r\n  }, [config.strategy, addLog]);\r\n\r\n  // Calcular valor da aposta baseado na confiança\r\n  const calculateBetAmount = useCallback((confidence: number) => {\r\n    let amount = config.betAmount;\r\n    \r\n    // Ajustar baseado na confiança\r\n    if (confidence > 80) {\r\n      amount *= 1.5;\r\n    } else if (confidence < 60) {\r\n      amount *= 0.7;\r\n    }\r\n    \r\n    // Aplicar Martingale se houver perdas consecutivas\r\n    const consecutiveLosses = session.totalBets - session.wins;\r\n    if (consecutiveLosses > 0) {\r\n      amount *= Math.pow(2, Math.min(consecutiveLosses, 3));\r\n    }\r\n    \r\n    return Math.min(amount, config.betAmount * 8); // Limite máximo\r\n  }, [config.betAmount, session]);\r\n\r\n  // Executar aposta\r\n  const executeBet = useCallback(async (prediction: {type: string, confidence: number, amount: number}) => {\r\n    if (connectionStatus !== 'connected') {\r\n      addLog('Não conectado ao site de apostas', 'error');\r\n      return;\r\n    }\r\n\r\n    const betId = `bet_${Date.now()}`;\r\n    const newBet: LiveBet = {\r\n      id: betId,\r\n      timestamp: Date.now(),\r\n      type: prediction.type as any,\r\n      value: prediction.type,\r\n      amount: prediction.amount,\r\n      confidence: prediction.confidence,\r\n      strategy: config.strategy,\r\n      status: 'pending'\r\n    };\r\n\r\n    setLiveBets(prev => [newBet, ...prev].slice(0, 20));\r\n    addLog(`Executando aposta: ${prediction.type.toUpperCase()} - R$ ${prediction.amount.toFixed(2)} (${prediction.confidence}% confiança)`, 'info');\r\n\r\n    try {\r\n      // Enviar comando para o iframe\r\n      if (iframeRef.current) {\r\n        iframeRef.current.contentWindow?.postMessage({\r\n          type: 'PLACE_BET',\r\n          betType: prediction.type,\r\n          amount: prediction.amount,\r\n          betId: betId\r\n        }, '*');\r\n      }\r\n\r\n      // Simular resultado após 30 segundos (tempo típico de uma rodada)\r\n      setTimeout(() => {\r\n        simulateBetResult(betId);\r\n      }, 30000);\r\n\r\n    } catch (error) {\r\n      addLog(`Erro ao executar aposta: ${error}`, 'error');\r\n      setLiveBets(prev => prev.map(bet => \r\n        bet.id === betId ? { ...bet, status: 'lost' } : bet\r\n      ));\r\n    }\r\n  }, [connectionStatus, config.strategy, addLog]);\r\n\r\n  // Simular resultado da aposta\r\n  const simulateBetResult = useCallback((betId: string) => {\r\n    const bet = liveBets.find(b => b.id === betId);\r\n    if (!bet) return;\r\n\r\n    // Simular resultado da roleta\r\n    const numbers = Array.from({length: 37}, (_, i) => i);\r\n    const resultNumber = numbers[Math.floor(Math.random() * numbers.length)];\r\n    const resultColor = resultNumber === 0 ? 'green' : \r\n                       [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36].includes(resultNumber) ? 'red' : 'black';\r\n\r\n    const result: RouletteResult = {\r\n      number: resultNumber,\r\n      color: resultColor,\r\n      timestamp: Date.now()\r\n    };\r\n\r\n    setRecentResults(prev => [result, ...prev].slice(0, 50));\r\n\r\n    // Determinar se a aposta ganhou\r\n    const won = bet.type === resultColor;\r\n    const payout = won ? bet.amount * (bet.type === 'green' ? 14 : 2) : 0;\r\n\r\n    setLiveBets(prev => prev.map(b => \r\n      b.id === betId ? { \r\n        ...b, \r\n        status: won ? 'won' : 'lost',\r\n        result: `${resultNumber} ${resultColor}`,\r\n        payout \r\n      } : b\r\n    ));\r\n\r\n    // Atualizar sessão\r\n    setSession(prev => ({\r\n      ...prev,\r\n      totalBets: prev.totalBets + 1,\r\n      wins: won ? prev.wins + 1 : prev.wins,\r\n      losses: won ? prev.losses : prev.losses + 1,\r\n      profit: prev.profit + (won ? payout - bet.amount : -bet.amount),\r\n      winRate: ((won ? prev.wins + 1 : prev.wins) / (prev.totalBets + 1)) * 100\r\n    }));\r\n\r\n    // Atualizar saldo\r\n    setCurrentBalance(prev => prev + (won ? payout - bet.amount : -bet.amount));\r\n\r\n    addLog(`Resultado: ${resultNumber} ${resultColor.toUpperCase()} - ${won ? 'GANHOU' : 'PERDEU'} R$ ${won ? (payout - bet.amount).toFixed(2) : bet.amount.toFixed(2)}`, won ? 'success' : 'error');\r\n  }, [liveBets, addLog]);\r\n\r\n  // Loop principal de automação\r\n  const automationLoop = useCallback(async () => {\r\n    if (!isAutomationActive || connectionStatus !== 'connected') return;\r\n\r\n    try {\r\n      // Analisar histórico e gerar predição\r\n      if (strategyEngineRef.current) {\r\n        const prediction = strategyEngineRef.current.analyze(recentResults);\r\n        setNextBetPrediction(prediction);\r\n\r\n        // Verificar se deve executar a aposta\r\n        if (config.autoMode && prediction.confidence > 60) {\r\n          // Verificar limites de segurança\r\n          if (session.losses < config.maxConsecutiveLosses && \r\n              Math.abs(session.profit) < config.stopLossAmount) {\r\n            await executeBet(prediction);\r\n          } else {\r\n            addLog('Limites de segurança atingidos - pausando automação', 'warning');\r\n            setIsAutomationActive(false);\r\n          }\r\n        }\r\n      }\r\n    } catch (error) {\r\n      addLog(`Erro no loop de automação: ${error}`, 'error');\r\n    }\r\n  }, [isAutomationActive, connectionStatus, config, session, recentResults, executeBet, addLog]);\r\n\r\n  // Iniciar automação\r\n  const startAutomation = useCallback(async () => {\r\n    if (connectionStatus !== 'connected') {\r\n      await connectToSite();\r\n      return;\r\n    }\r\n\r\n    setIsAutomationActive(true);\r\n    setSession(prev => ({\r\n      ...prev,\r\n      id: `session_${Date.now()}`,\r\n      startTime: Date.now(),\r\n      status: 'active'\r\n    }));\r\n\r\n    initializeStrategyEngine();\r\n    addLog('Automação iniciada', 'success');\r\n\r\n    // Iniciar loop de automação\r\n    automationIntervalRef.current = setInterval(automationLoop, 5000);\r\n  }, [connectionStatus, connectToSite, initializeStrategyEngine, automationLoop, addLog]);\r\n\r\n  // Pausar automação\r\n  const pauseAutomation = useCallback(() => {\r\n    setIsAutomationActive(false);\r\n    setSession(prev => ({ ...prev, status: 'paused' }));\r\n    \r\n    if (automationIntervalRef.current) {\r\n      clearInterval(automationIntervalRef.current);\r\n      automationIntervalRef.current = null;\r\n    }\r\n    \r\n    addLog('Automação pausada', 'warning');\r\n  }, [addLog]);\r\n\r\n  // Parar automação\r\n  const stopAutomation = useCallback(() => {\r\n    setIsAutomationActive(false);\r\n    setSession(prev => ({ \r\n      ...prev, \r\n      status: 'stopped',\r\n      endTime: Date.now()\r\n    }));\r\n    \r\n    if (automationIntervalRef.current) {\r\n      clearInterval(automationIntervalRef.current);\r\n      automationIntervalRef.current = null;\r\n    }\r\n    \r\n    addLog('Automação parada', 'info');\r\n  }, [addLog]);\r\n\r\n  // Escutar mensagens do iframe\r\n  useEffect(() => {\r\n    const handleMessage = (event: MessageEvent) => {\r\n      if (event.data.type === 'BET_PLACED') {\r\n        addLog(`Aposta executada no site: ${event.data.success ? 'Sucesso' : 'Falha'}`, event.data.success ? 'success' : 'error');\r\n      } else if (event.data.type === 'BALANCE_UPDATE') {\r\n        setCurrentBalance(event.data.balance);\r\n      } else if (event.data.type === 'RESULT_UPDATE') {\r\n        addLog(`Resultado detectado: ${event.data.result}`, 'info');\r\n      }\r\n    };\r\n\r\n    window.addEventListener('message', handleMessage);\r\n    return () => window.removeEventListener('message', handleMessage);\r\n  }, [addLog]);\r\n\r\n  // Cleanup\r\n  useEffect(() => {\r\n    return () => {\r\n      if (automationIntervalRef.current) {\r\n        clearInterval(automationIntervalRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  const getStatusColor = (status: string) => {\r\n    switch (status) {\r\n      case 'connected': return 'text-green-600';\r\n      case 'connecting': return 'text-yellow-600';\r\n      case 'error': return 'text-red-600';\r\n      default: return 'text-gray-600';\r\n    }\r\n  };\r\n\r\n  const getStatusIcon = (status: string) => {\r\n    switch (status) {\r\n      case 'connected': return <CheckCircle className=\"h-4 w-4\" />;\r\n      case 'connecting': return <Clock className=\"h-4 w-4\" />;\r\n      case 'error': return <AlertTriangle className=\"h-4 w-4\" />;\r\n      default: return <Globe className=\"h-4 w-4\" />;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header de Controle */}\r\n      <Card>\r\n        <CardHeader>\r\n          <div className=\"flex items-center justify-between\">\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <Zap className=\"h-5 w-5\" />\r\n              Automação Real de Apostas\r\n            </CardTitle>\r\n            <div className=\"flex items-center gap-2\">\r\n              <Badge className={`${getStatusColor(connectionStatus)}`}>\r\n                {getStatusIcon(connectionStatus)}\r\n                {connectionStatus.toUpperCase()}\r\n              </Badge>\r\n              {!isAutomationActive ? (\r\n                <Button onClick={startAutomation} className=\"bg-green-600 hover:bg-green-700\">\r\n                  <Play className=\"h-4 w-4 mr-1\" />\r\n                  Iniciar\r\n                </Button>\r\n              ) : (\r\n                <>\r\n                  <Button onClick={pauseAutomation} variant=\"outline\">\r\n                    <Pause className=\"h-4 w-4 mr-1\" />\r\n                    Pausar\r\n                  </Button>\r\n                  <Button onClick={stopAutomation} variant=\"destructive\">\r\n                    <StopCircle className=\"h-4 w-4 mr-1\" />\r\n                    Parar\r\n                  </Button>\r\n                </>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n            <div className=\"text-center\">\r\n              <div className=\"text-2xl font-bold text-green-600\">\r\n                R$ {currentBalance.toFixed(2)}\r\n              </div>\r\n              <div className=\"text-sm text-gray-500\">Saldo Atual</div>\r\n            </div>\r\n            <div className=\"text-center\">\r\n              <div className={`text-2xl font-bold ${session.profit >= 0 ? 'text-green-600' : 'text-red-600'}`}>\r\n                {session.profit >= 0 ? '+' : ''}R$ {session.profit.toFixed(2)}\r\n              </div>\r\n              <div className=\"text-sm text-gray-500\">Lucro da Sessão</div>\r\n            </div>\r\n            <div className=\"text-center\">\r\n              <div className=\"text-2xl font-bold text-blue-600\">\r\n                {session.totalBets}\r\n              </div>\r\n              <div className=\"text-sm text-gray-500\">Apostas Executadas</div>\r\n            </div>\r\n            <div className=\"text-center\">\r\n              <div className=\"text-2xl font-bold text-purple-600\">\r\n                {session.winRate.toFixed(1)}%\r\n              </div>\r\n              <div className=\"text-sm text-gray-500\">Taxa de Acerto</div>\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Configurações */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"flex items-center gap-2\">\r\n            <Settings className=\"h-5 w-5\" />\r\n            Configurações\r\n          </CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n            <div className=\"space-y-4\">\r\n              <div>\r\n                <Label htmlFor=\"site\">Site de Apostas</Label>\r\n                <Select value={config.site} onValueChange={(value: any) => setConfig(prev => ({ ...prev, site: value }))}>\r\n                  <SelectTrigger>\r\n                    <SelectValue />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    <SelectItem value=\"betgorillas\">BetGorillas (Roleta Brasileira)</SelectItem>\r\n                    <SelectItem value=\"bet365\">Bet365</SelectItem>\r\n                    <SelectItem value=\"betfair\">Betfair</SelectItem>\r\n                    <SelectItem value=\"betano\">Betano</SelectItem>\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n              \r\n              <div>\r\n                <Label htmlFor=\"email\">Email/CPF</Label>\r\n                <Input\r\n                  id=\"email\"\r\n                  type=\"text\"\r\n                  value={config.credentials.email}\r\n                  onChange={(e) => setConfig(prev => ({ \r\n                    ...prev, \r\n                    credentials: { ...prev.credentials, email: e.target.value }\r\n                  }))}\r\n                  placeholder=\"Suas credenciais de login\"\r\n                />\r\n              </div>\r\n              \r\n              <div>\r\n                <Label htmlFor=\"password\">Senha</Label>\r\n                <Input\r\n                  id=\"password\"\r\n                  type=\"password\"\r\n                  value={config.credentials.password}\r\n                  onChange={(e) => setConfig(prev => ({ \r\n                    ...prev, \r\n                    credentials: { ...prev.credentials, password: e.target.value }\r\n                  }))}\r\n                  placeholder=\"Sua senha\"\r\n                />\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"space-y-4\">\r\n              <div>\r\n                <Label htmlFor=\"betAmount\">Valor Base da Aposta (R$)</Label>\r\n                <Input\r\n                  id=\"betAmount\"\r\n                  type=\"number\"\r\n                  value={config.betAmount}\r\n                  onChange={(e) => setConfig(prev => ({ ...prev, betAmount: Number(e.target.value) }))}\r\n                />\r\n              </div>\r\n              \r\n              <div>\r\n                <Label htmlFor=\"strategy\">Estratégia</Label>\r\n                <Select value={config.strategy} onValueChange={(value) => setConfig(prev => ({ ...prev, strategy: value }))}>\r\n                  <SelectTrigger>\r\n                    <SelectValue />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    <SelectItem value=\"martingale\">Martingale Adaptativo</SelectItem>\r\n                    <SelectItem value=\"fibonacci\">Fibonacci Inteligente</SelectItem>\r\n                    <SelectItem value=\"pattern\">Padrão de Cores</SelectItem>\r\n                    <SelectItem value=\"frequency\">Análise de Frequência</SelectItem>\r\n                    <SelectItem value=\"ml\">ML Prediction</SelectItem>\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n              \r\n              <div>\r\n                <Label htmlFor=\"stopLoss\">Stop Loss (R$)</Label>\r\n                <Input\r\n                  id=\"stopLoss\"\r\n                  type=\"number\"\r\n                  value={config.stopLossAmount}\r\n                  onChange={(e) => setConfig(prev => ({ ...prev, stopLossAmount: Number(e.target.value) }))}\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Próxima Predição */}\r\n      {nextBetPrediction && (\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <Target className=\"h-5 w-5\" />\r\n              Próxima Predição\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"flex items-center justify-between p-4 bg-blue-50 rounded-lg\">\r\n              <div className=\"flex items-center gap-4\">\r\n                <div className={`w-8 h-8 rounded-full ${nextBetPrediction.type === 'red' ? 'bg-red-500' : 'bg-black'}`}></div>\r\n                <div>\r\n                  <div className=\"font-semibold\">{nextBetPrediction.type.toUpperCase()}</div>\r\n                  <div className=\"text-sm text-gray-500\">R$ {nextBetPrediction.amount.toFixed(2)}</div>\r\n                </div>\r\n              </div>\r\n              <div className=\"text-right\">\r\n                <div className=\"text-2xl font-bold text-blue-600\">{nextBetPrediction.confidence}%</div>\r\n                <div className=\"text-sm text-gray-500\">Confiança</div>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Apostas Ativas */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"flex items-center gap-2\">\r\n            <Activity className=\"h-5 w-5\" />\r\n            Apostas Recentes\r\n          </CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"space-y-2 max-h-60 overflow-y-auto\">\r\n            {liveBets.length === 0 ? (\r\n              <div className=\"text-center text-gray-500 py-4\">\r\n                Nenhuma aposta executada ainda\r\n              </div>\r\n            ) : (\r\n              liveBets.map((bet) => (\r\n                <div key={bet.id} className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <div className={`w-4 h-4 rounded-full ${bet.type === 'red' ? 'bg-red-500' : bet.type === 'black' ? 'bg-black' : 'bg-green-500'}`}></div>\r\n                    <div>\r\n                      <div className=\"font-medium\">{bet.value.toUpperCase()}</div>\r\n                      <div className=\"text-sm text-gray-500\">R$ {bet.amount.toFixed(2)} • {bet.confidence}%</div>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"text-right\">\r\n                    <Badge className={\r\n                      bet.status === 'won' ? 'bg-green-100 text-green-800' :\r\n                      bet.status === 'lost' ? 'bg-red-100 text-red-800' :\r\n                      'bg-yellow-100 text-yellow-800'\r\n                    }>\r\n                      {bet.status === 'won' ? 'GANHOU' : bet.status === 'lost' ? 'PERDEU' : 'PENDENTE'}\r\n                    </Badge>\r\n                    {bet.result && (\r\n                      <div className=\"text-sm text-gray-500 mt-1\">{bet.result}</div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              ))\r\n            )}\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Iframe do Site */}\r\n      {connectionStatus === 'connected' && (\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <Globe className=\"h-5 w-5\" />\r\n              Site de Apostas - {config.site.toUpperCase()}\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"border rounded-lg overflow-hidden\">\r\n              <iframe\r\n                ref={iframeRef}\r\n                src=\"about:blank\"\r\n                className=\"w-full h-96\"\r\n                title=\"Site de Apostas\"\r\n                sandbox=\"allow-scripts allow-same-origin allow-forms\"\r\n              />\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Sistema de Validação de Apostas */}\r\n      <BetValidationSystem\r\n        betAmount={config.betAmount}\r\n        betType=\"red\" // Exemplo - seria dinâmico baseado na estratégia\r\n        selectedNumbers={[1, 3, 5]} // Exemplo - seria dinâmico baseado na estratégia\r\n        currentBalance={session.profit + 1000} // Simulando saldo inicial + lucro\r\n        maxBetLimit={config.betAmount * 10}\r\n        stopLossLimit={config.stopLossAmount}\r\n        takeProfitLimit={config.takeProfitAmount}\r\n        consecutiveLossesLimit={config.maxConsecutiveLosses}\r\n        currentConsecutiveLosses={session.losses}\r\n        currentProfit={session.profit}\r\n        isAutomationActive={session.status === 'active'}\r\n        onValidationComplete={(isValid, errors) => {\r\n          if (!isValid) {\r\n            errors.forEach(error => addLog(`Validação falhou: ${error}`, 'error'));\r\n          } else {\r\n            addLog('Validação de aposta aprovada', 'success');\r\n          }\r\n        }}\r\n      />\r\n\r\n      {/* Sistema de Recuperação de Erros */}\r\n      <ErrorRecoverySystem\r\n        isAutomationActive={session.status === 'active'}\r\n        connectionStatus={connectionStatus}\r\n        onReconnect={async () => {\r\n          addLog('Tentando reconectar...', 'info');\r\n          setConnectionStatus('reconnecting');\r\n          // Simular reconexão\r\n          setTimeout(() => {\r\n            setConnectionStatus('connected');\r\n            addLog('Reconectado com sucesso', 'success');\r\n          }, 2000);\r\n        }}\r\n        onRestartAutomation={async () => {\r\n          addLog('Reiniciando automação...', 'info');\r\n          setSession(prev => ({ ...prev, status: 'paused' }));\r\n          setTimeout(() => {\r\n            setSession(prev => ({ ...prev, status: 'active' }));\r\n            addLog('Automação reiniciada', 'success');\r\n          }, 3000);\r\n        }}\r\n        onEmergencyStop={() => {\r\n          addLog('PARADA DE EMERGÊNCIA ATIVADA', 'error');\r\n          setSession(prev => ({ ...prev, status: 'stopped' }));\r\n          setConnectionStatus('disconnected');\r\n        }}\r\n      />\r\n\r\n      {/* Logs */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"flex items-center gap-2\">\r\n            <Activity className=\"h-5 w-5\" />\r\n            Log de Atividades\r\n          </CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"bg-black text-green-400 p-4 rounded-lg font-mono text-sm max-h-60 overflow-y-auto\">\r\n            {logs.length === 0 ? (\r\n              <div className=\"text-gray-500\">Aguardando atividade...</div>\r\n            ) : (\r\n              logs.map((log, index) => (\r\n                <div key={index} className=\"mb-1\">{log}</div>\r\n              ))\r\n            )}\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n\r\n// Novas interfaces para integração com sistema de estratégias\r\ninterface StrategyAutomationConfig {\r\n  baseAmount: number;\r\n  maxBets: number;\r\n  maxProfit: number;\r\n  maxLoss: number;\r\n  maxConsecutiveLosses: number;\r\n  minConfidence: number;\r\n  stopOnProfit: boolean;\r\n  stopOnLoss: boolean;\r\n  analysisInterval: number;\r\n  enableIntelligentMode: boolean;\r\n}\r\n\r\ninterface StrategyStatus {\r\n  connected: boolean;\r\n  running: boolean;\r\n  currentStrategy: string | null;\r\n  confidence: number;\r\n  lastAnalysis: any;\r\n  gameHistoryLength: number;\r\n  stats: {\r\n    startTime: number;\r\n    totalBets: number;\r\n    wins: number;\r\n    losses: number;\r\n    profit: number;\r\n    winRate: number;\r\n    currentStreak: number;\r\n    strategies: Record<string, any>;\r\n  };\r\n}\r\n\r\ninterface RealBettingAutomationProps {\r\n  tableId: string;\r\n  suggestedBets: (string | number)[];\r\n  strategyName: string;\r\n  onAutomationToggle?: (enabled: boolean) => void;\r\n}\r\n\r\nexport default function RealBettingAutomation({\r\n  tableId,\r\n  suggestedBets,\r\n  strategyName,\r\n  onAutomationToggle\r\n}: RealBettingAutomationProps) {\r\n  // Config state for the main component\r\n  const [config, setConfig] = useState<BettingConfig>({\r\n    site: 'betgorillas',\r\n    credentials: { email: '', password: '' },\r\n    betAmount: 10,\r\n    strategy: 'martingale',\r\n    autoMode: false,\r\n    maxConsecutiveLosses: 3,\r\n    stopLossAmount: 100,\r\n    takeProfitAmount: 200\r\n  });\r\n\r\n  // Logs state and function\r\n  const [logs, setLogs] = useState<string[]>([]);\r\n  \r\n  const addLog = useCallback((message: string, type: 'info' | 'success' | 'error' | 'warning' = 'info') => {\r\n    const timestamp = new Date().toLocaleTimeString();\r\n    const logMessage = `[${timestamp}] ${message}`;\r\n    setLogs(prev => [...prev.slice(-99), logMessage]);\r\n  }, []);\r\n\r\n  // Connection status state\r\n  const [connectionStatus, setConnectionStatus] = useState<'disconnected' | 'connecting' | 'connected' | 'reconnecting'>('disconnected');\r\n\r\n  // Automation state\r\n  const [isAutomationActive, setIsAutomationActive] = useState(false);\r\n\r\n  // Session state\r\n  const [session, setSession] = useState<BettingSession>({\r\n    id: '',\r\n    startTime: 0,\r\n    totalBets: 0,\r\n    wins: 0,\r\n    losses: 0,\r\n    profit: 0,\r\n    maxDrawdown: 0,\r\n    winRate: 0,\r\n    avgBetAmount: 0,\r\n    status: 'stopped'\r\n  });\r\n\r\n  // Next bet prediction state\r\n  const [nextBetPrediction, setNextBetPrediction] = useState<{type: string, confidence: number, amount: number} | null>(null);\r\n\r\n  // Novos estados para sistema de estratégias\r\n  const [intelligentMode, setIntelligentMode] = useState(false);\r\n  const [strategyConfig, setStrategyConfig] = useState<StrategyAutomationConfig>({\r\n    baseAmount: 5,\r\n    maxBets: 50,\r\n    maxProfit: 200,\r\n    maxLoss: 100,\r\n    maxConsecutiveLosses: 3,\r\n    minConfidence: 60,\r\n    stopOnProfit: true,\r\n    stopOnLoss: true,\r\n    analysisInterval: 10000,\r\n    enableIntelligentMode: true\r\n  });\r\n\r\n  const [strategyStatus, setStrategyStatus] = useState<StrategyStatus>({\r\n    connected: false,\r\n    running: false,\r\n    currentStrategy: null,\r\n    confidence: 0,\r\n    lastAnalysis: null,\r\n    gameHistoryLength: 0,\r\n    stats: {\r\n      startTime: 0,\r\n      totalBets: 0,\r\n      wins: 0,\r\n      losses: 0,\r\n      profit: 0,\r\n      winRate: 0,\r\n      currentStreak: 0,\r\n      strategies: {}\r\n    }\r\n  });\r\n\r\n  const [availableStrategies] = useState([\r\n    'martingale', 'fibonacci', 'labouchere', 'dalembert', 'paroli',\r\n    'cavalos', 'vizinhos', 'probabilidade', 'padroes', 'sequencias'\r\n  ]);\r\n\r\n  // Conectar ao site de apostas\r\n  const connectToSite = useCallback(async () => {\r\n    if (!config.credentials.email || !config.credentials.password) {\r\n      addLog('Credenciais não fornecidas', 'error');\r\n      return;\r\n    }\r\n\r\n    setConnectionStatus('connecting');\r\n    addLog(`Conectando ao ${config.site}...`);\r\n\r\n    try {\r\n      // Simular conexão real - em produção, isso seria uma conexão real via iframe/puppeteer\r\n      await new Promise(resolve => setTimeout(resolve, 2000));\r\n      \r\n      setConnectionStatus('connected');\r\n      addLog(`Conectado com sucesso ao ${config.site}`, 'success');\r\n      \r\n    } catch (error) {\r\n      setConnectionStatus('disconnected');\r\n      addLog(`Erro ao conectar: ${error instanceof Error ? error.message : String(error)}`, 'error');\r\n    }\r\n  }, [config, addLog]);\r\n \r\n   // Inicializar motor de estratégias\r\n   const initializeStrategyEngine = useCallback(() => {\r\n     const strategies = [\r\n       'Martingale Adaptativo',\r\n       'Fibonacci Inteligente', \r\n       'Padrão de Cores',\r\n       'Análise de Frequência',\r\n       'ML Prediction'\r\n     ];\r\n     \r\n     addLog(`Motor de estratégias inicializado: ${config.strategy}`, 'success');\r\n   }, [config.strategy, addLog]);\r\n\r\n   // Loop principal de automação\r\n   const automationLoop = useCallback(async () => {\r\n     if (!isAutomationActive || connectionStatus !== 'connected') return;\r\n\r\n     try {\r\n       // Simular análise e predição\r\n       const prediction = {\r\n         type: 'red',\r\n         confidence: 75,\r\n         amount: config.betAmount\r\n       };\r\n       setNextBetPrediction(prediction);\r\n\r\n       addLog(`Análise: ${prediction.type} (${prediction.confidence}% confiança)`, 'info');\r\n     } catch (error) {\r\n       addLog(`Erro no loop de automação: ${error instanceof Error ? error.message : String(error)}`, 'error');\r\n     }\r\n   }, [isAutomationActive, connectionStatus, config.betAmount, addLog]);\r\n\r\n   // Iniciar automação\r\n   const startAutomation = useCallback(async () => {\r\n     if (connectionStatus !== 'connected') {\r\n       await connectToSite();\r\n       return;\r\n     }\r\n\r\n     setIsAutomationActive(true);\r\n     setSession(prev => ({\r\n       ...prev,\r\n       id: `session_${Date.now()}`,\r\n       startTime: Date.now(),\r\n       status: 'active'\r\n     }));\r\n\r\n     initializeStrategyEngine();\r\n    addLog('Automação iniciada', 'success');\r\n  }, [connectionStatus, connectToSite, initializeStrategyEngine, addLog]);\r\n\r\n  // Parar automação\r\n  const stopAutomation = useCallback(() => {\r\n    setIsAutomationActive(false);\r\n    setSession(prev => ({ \r\n      ...prev, \r\n      status: 'stopped',\r\n      endTime: Date.now()\r\n    }));\r\n    \r\n    addLog('Automação parada', 'info');\r\n  }, [addLog]);\r\n\r\n  // Conectar ao sistema de estratégias inteligente\r\n  const connectToIntelligentSystem = useCallback(async () => {\r\n    if (!config.credentials.email || !config.credentials.password) {\r\n      addLog('Credenciais não fornecidas para sistema inteligente', 'error');\r\n      return;\r\n    }\r\n\r\n    setConnectionStatus('connecting');\r\n    addLog('🧠 Conectando ao sistema de estratégias inteligente...');\r\n\r\n    try {\r\n      const response = await fetch('/api/betting/betgorillas-strategy-automation/connect-strategy', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          gameUrl: 'https://betgorillas.bet.br/games/imaginelive/roleta-brasileira',\r\n          config: {\r\n            headless: false,\r\n            devtools: true,\r\n            timeout: 30000\r\n          }\r\n        })\r\n      });\r\n\r\n      const result = await response.json();\r\n\r\n      if (result.success) {\r\n        setConnectionStatus('connected');\r\n        setStrategyStatus(prev => ({ ...prev, connected: true }));\r\n        addLog('✅ Sistema de estratégias conectado com sucesso!', 'success');\r\n        addLog(`🎯 Estratégias carregadas: ${availableStrategies.length}`, 'info');\r\n        \r\n        // Iniciar monitoramento do status\r\n        startStatusMonitoring();\r\n      } else {\r\n        throw new Error(result.error || 'Erro na conexão');\r\n      }\r\n\r\n    } catch (error) {\r\n      setConnectionStatus('disconnected');\r\n      addLog(`❌ Erro na conexão inteligente: ${error instanceof Error ? error.message : String(error)}`, 'error');\r\n    }\r\n  }, [config, addLog, availableStrategies.length]);\r\n\r\n  // Iniciar automação inteligente\r\n  const startIntelligentAutomation = useCallback(async () => {\r\n    if (!strategyStatus.connected) {\r\n      addLog('Sistema não conectado. Conecte primeiro.', 'error');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch('/api/betting/betgorillas-strategy-automation/start-intelligent', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify(strategyConfig)\r\n      });\r\n\r\n      const result = await response.json();\r\n\r\n      if (result.success) {\r\n        setIsAutomationActive(true);\r\n        setStrategyStatus(prev => ({ ...prev, running: true }));\r\n        addLog('🚀 Automação inteligente iniciada!', 'success');\r\n        addLog(`📊 Configuração: ${strategyConfig.maxBets} apostas máx, confiança mín ${strategyConfig.minConfidence}%`, 'info');\r\n        \r\n        if (onAutomationToggle) {\r\n          onAutomationToggle(true);\r\n        }\r\n      } else {\r\n        throw new Error(result.error || 'Erro ao iniciar automação');\r\n      }\r\n\r\n    } catch (error) {\r\n      addLog(`❌ Erro ao iniciar automação inteligente: ${error instanceof Error ? error.message : String(error)}`, 'error');\r\n    }\r\n  }, [strategyStatus.connected, strategyConfig, addLog, onAutomationToggle]);\r\n\r\n  // Parar automação inteligente\r\n  const stopIntelligentAutomation = useCallback(async () => {\r\n    try {\r\n      const response = await fetch('/api/betting/betgorillas-strategy-automation/stop-intelligent', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        }\r\n      });\r\n\r\n      const result = await response.json();\r\n\r\n      if (result.success) {\r\n        setIsAutomationActive(false);\r\n        setStrategyStatus(prev => ({ ...prev, running: false }));\r\n        addLog('🛑 Automação inteligente parada', 'info');\r\n        addLog(`📈 Resultado final: ${result.data.finalStats.profit > 0 ? 'Lucro' : 'Prejuízo'} de R$ ${Math.abs(result.data.finalStats.profit).toFixed(2)}`, 'info');\r\n        \r\n        if (onAutomationToggle) {\r\n          onAutomationToggle(false);\r\n        }\r\n      } else {\r\n        throw new Error(result.error || 'Erro ao parar automação');\r\n      }\r\n\r\n    } catch (error) {\r\n      addLog(`❌ Erro ao parar automação: ${error instanceof Error ? error.message : String(error)}`, 'error');\r\n    }\r\n  }, [addLog, onAutomationToggle]);\r\n\r\n  // Monitorar status do sistema\r\n  const startStatusMonitoring = useCallback(() => {\r\n    const interval = setInterval(async () => {\r\n      try {\r\n        const response = await fetch('/api/betting/betgorillas-strategy-automation/status-intelligent');\r\n        const result = await response.json();\r\n\r\n        if (result.success) {\r\n          setStrategyStatus(result.data);\r\n          \r\n          // Atualizar sessão com dados do backend\r\n          if (result.data.stats) {\r\n            setSession(prev => ({\r\n              ...prev,\r\n              totalBets: result.data.stats.totalBets,\r\n              wins: result.data.stats.wins,\r\n              losses: result.data.stats.losses,\r\n              profit: result.data.stats.profit,\r\n              winRate: result.data.stats.winRate,\r\n              status: result.data.running ? 'active' : 'stopped'\r\n            }));\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.warn('Erro ao monitorar status:', error);\r\n      }\r\n    }, 5000); // Atualizar a cada 5 segundos\r\n\r\n    return () => clearInterval(interval);\r\n  }, []);\r\n\r\n  // Obter análise atual das estratégias\r\n  const getStrategyAnalysis = useCallback(async () => {\r\n    try {\r\n      const response = await fetch('/api/betting/betgorillas-strategy-automation/strategy-analysis');\r\n      const result = await response.json();\r\n\r\n      if (result.success && result.data.available) {\r\n        setNextBetPrediction({\r\n          type: result.data.analysis?.betType || 'unknown',\r\n          confidence: result.data.confidence || 0,\r\n          amount: strategyConfig.baseAmount\r\n        });\r\n        \r\n        addLog(`🎯 Análise: ${result.data.currentStrategy} (${result.data.confidence}% confiança)`, 'info');\r\n      }\r\n    } catch (error) {\r\n      console.warn('Erro ao obter análise:', error);\r\n    }\r\n  }, [strategyConfig.baseAmount, addLog]);\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Painel de Controle Principal */}\r\n      <Card>\r\n        <CardHeader>\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <Brain className=\"w-5 h-5 text-purple-500\" />\r\n              <CardTitle>Automação Inteligente BetGorillas</CardTitle>\r\n              <Badge variant={strategyStatus.running ? \"default\" : strategyStatus.connected ? \"secondary\" : \"outline\"}>\r\n                {strategyStatus.running ? 'Executando' : strategyStatus.connected ? 'Conectado' : 'Desconectado'}\r\n              </Badge>\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <Switch\r\n                checked={intelligentMode}\r\n                onCheckedChange={setIntelligentMode}\r\n                disabled={strategyStatus.running}\r\n              />\r\n              <Label>Modo Inteligente</Label>\r\n            </div>\r\n          </div>\r\n        </CardHeader>\r\n        <CardContent className=\"space-y-4\">\r\n          {/* Configuração de Credenciais */}\r\n          <div className=\"grid grid-cols-2 gap-4\">\r\n            <div>\r\n              <Label htmlFor=\"email\">Email BetGorillas</Label>\r\n              <Input\r\n                id=\"email\"\r\n                type=\"email\"\r\n                value={config.credentials.email}\r\n                onChange={(e) => setConfig(prev => ({\r\n                  ...prev,\r\n                  credentials: { ...prev.credentials, email: e.target.value }\r\n                }))}\r\n                disabled={strategyStatus.connected}\r\n                placeholder=\"seu@email.com\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <Label htmlFor=\"password\">Senha</Label>\r\n              <Input\r\n                id=\"password\"\r\n                type=\"password\"\r\n                value={config.credentials.password}\r\n                onChange={(e) => setConfig(prev => ({\r\n                  ...prev,\r\n                  credentials: { ...prev.credentials, password: e.target.value }\r\n                }))}\r\n                disabled={strategyStatus.connected}\r\n                placeholder=\"••••••••\"\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          {/* Configurações de Estratégia */}\r\n          {intelligentMode && (\r\n            <div className=\"border rounded-lg p-4 bg-purple-50 dark:bg-purple-950/20\">\r\n              <h4 className=\"font-semibold mb-3 flex items-center gap-2\">\r\n                <Settings className=\"w-4 h-4\" />\r\n                Configurações Inteligentes\r\n              </h4>\r\n              <div className=\"grid grid-cols-3 gap-4\">\r\n                <div>\r\n                  <Label htmlFor=\"baseAmount\">Valor Base (R$)</Label>\r\n                  <Input\r\n                    id=\"baseAmount\"\r\n                    type=\"number\"\r\n                    value={strategyConfig.baseAmount}\r\n                    onChange={(e) => setStrategyConfig(prev => ({\r\n                      ...prev,\r\n                      baseAmount: Number(e.target.value)\r\n                    }))}\r\n                    disabled={strategyStatus.running}\r\n                    min=\"1\"\r\n                    max=\"100\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <Label htmlFor=\"maxBets\">Apostas Máximas</Label>\r\n                  <Input\r\n                    id=\"maxBets\"\r\n                    type=\"number\"\r\n                    value={strategyConfig.maxBets}\r\n                    onChange={(e) => setStrategyConfig(prev => ({\r\n                      ...prev,\r\n                      maxBets: Number(e.target.value)\r\n                    }))}\r\n                    disabled={strategyStatus.running}\r\n                    min=\"1\"\r\n                    max=\"200\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <Label htmlFor=\"minConfidence\">Confiança Mínima (%)</Label>\r\n                  <Input\r\n                    id=\"minConfidence\"\r\n                    type=\"number\"\r\n                    value={strategyConfig.minConfidence}\r\n                    onChange={(e) => setStrategyConfig(prev => ({\r\n                      ...prev,\r\n                      minConfidence: Number(e.target.value)\r\n                    }))}\r\n                    disabled={strategyStatus.running}\r\n                    min=\"50\"\r\n                    max=\"95\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <Label htmlFor=\"maxProfit\">Meta de Lucro (R$)</Label>\r\n                  <Input\r\n                    id=\"maxProfit\"\r\n                    type=\"number\"\r\n                    value={strategyConfig.maxProfit}\r\n                    onChange={(e) => setStrategyConfig(prev => ({\r\n                      ...prev,\r\n                      maxProfit: Number(e.target.value)\r\n                    }))}\r\n                    disabled={strategyStatus.running}\r\n                    min=\"10\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <Label htmlFor=\"maxLoss\">Limite de Perda (R$)</Label>\r\n                  <Input\r\n                    id=\"maxLoss\"\r\n                    type=\"number\"\r\n                    value={strategyConfig.maxLoss}\r\n                    onChange={(e) => setStrategyConfig(prev => ({\r\n                      ...prev,\r\n                      maxLoss: Number(e.target.value)\r\n                    }))}\r\n                    disabled={strategyStatus.running}\r\n                    min=\"10\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <Label htmlFor=\"maxConsecutiveLosses\">Perdas Consecutivas</Label>\r\n                  <Input\r\n                    id=\"maxConsecutiveLosses\"\r\n                    type=\"number\"\r\n                    value={strategyConfig.maxConsecutiveLosses}\r\n                    onChange={(e) => setStrategyConfig(prev => ({\r\n                      ...prev,\r\n                      maxConsecutiveLosses: Number(e.target.value)\r\n                    }))}\r\n                    disabled={strategyStatus.running}\r\n                    min=\"1\"\r\n                    max=\"10\"\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Botões de Controle */}\r\n          <div className=\"flex gap-2\">\r\n            {!strategyStatus.connected ? (\r\n              <Button \r\n                onClick={intelligentMode ? connectToIntelligentSystem : connectToSite}\r\n                disabled={connectionStatus === 'connecting'}\r\n                className=\"flex-1\"\r\n              >\r\n                {connectionStatus === 'connecting' ? (\r\n                  <>\r\n                    <RefreshCw className=\"w-4 h-4 mr-2 animate-spin\" />\r\n                    Conectando...\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <Globe className=\"w-4 h-4 mr-2\" />\r\n                    {intelligentMode ? 'Conectar Sistema Inteligente' : 'Conectar BetGorillas'}\r\n                  </>\r\n                )}\r\n              </Button>\r\n            ) : (\r\n              <>\r\n                {!strategyStatus.running ? (\r\n                  <Button \r\n                    onClick={intelligentMode ? startIntelligentAutomation : startAutomation}\r\n                    className=\"flex-1\"\r\n                    variant=\"default\"\r\n                  >\r\n                    <Play className=\"w-4 h-4 mr-2\" />\r\n                    {intelligentMode ? 'Iniciar IA' : 'Iniciar Automação'}\r\n                  </Button>\r\n                ) : (\r\n                  <Button \r\n                    onClick={intelligentMode ? stopIntelligentAutomation : stopAutomation}\r\n                    className=\"flex-1\"\r\n                    variant=\"destructive\"\r\n                  >\r\n                    <StopCircle className=\"w-4 h-4 mr-2\" />\r\n                    Parar Automação\r\n                  </Button>\r\n                )}\r\n                <Button \r\n                  onClick={getStrategyAnalysis}\r\n                  variant=\"outline\"\r\n                  disabled={!intelligentMode || !strategyStatus.connected}\r\n                >\r\n                  <BarChart3 className=\"w-4 h-4 mr-2\" />\r\n                  Análise\r\n                </Button>\r\n              </>\r\n            )}\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Painel de Status Inteligente */}\r\n      {intelligentMode && strategyStatus.connected && (\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <Activity className=\"w-5 h-5 text-green-500\" />\r\n              Status da IA\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n              <div className=\"text-center\">\r\n                <div className=\"text-2xl font-bold text-blue-600\">\r\n                  {strategyStatus.currentStrategy || 'Analisando...'}\r\n                </div>\r\n                <div className=\"text-sm text-muted-foreground\">Estratégia Atual</div>\r\n              </div>\r\n              <div className=\"text-center\">\r\n                <div className=\"text-2xl font-bold text-purple-600\">\r\n                  {strategyStatus.confidence}%\r\n                </div>\r\n                <div className=\"text-sm text-muted-foreground\">Confiança</div>\r\n              </div>\r\n              <div className=\"text-center\">\r\n                <div className=\"text-2xl font-bold text-orange-600\">\r\n                  {strategyStatus.gameHistoryLength}\r\n                </div>\r\n                <div className=\"text-sm text-muted-foreground\">Histórico</div>\r\n              </div>\r\n              <div className=\"text-center\">\r\n                <div className=\"text-2xl font-bold text-green-600\">\r\n                  R$ {strategyStatus.stats.profit.toFixed(2)}\r\n                </div>\r\n                <div className=\"text-sm text-muted-foreground\">Lucro/Prejuízo</div>\r\n              </div>\r\n            </div>\r\n\r\n            {nextBetPrediction && (\r\n              <Alert className=\"mt-4\">\r\n                <Target className=\"h-4 w-4\" />\r\n                <AlertDescription>\r\n                  <strong>Próxima Aposta Sugerida:</strong> {nextBetPrediction.type} \r\n                  (Confiança: {nextBetPrediction.confidence}%, Valor: R$ {nextBetPrediction.amount})\r\n                </AlertDescription>\r\n              </Alert>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* ... existing code for session stats, logs, etc. ... */}\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/dashboard/real-time-metrics.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/dashboard/real-time-monitoring-dashboard.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'simulateNewBet' and 'updateSessionDuration'. Either include them or remove the dependency array.","line":143,"column":6,"nodeType":"ArrayExpression","endLine":143,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [isMonitoring, simulateNewBet, updateSessionDuration]","fix":{"range":[3755,3769],"text":"[isMonitoring, simulateNewBet, updateSessionDuration]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect, useRef } from 'react';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Progress } from '@/components/ui/progress';\r\nimport { Alert, AlertDescription } from '@/components/ui/alert';\r\nimport { Separator } from '@/components/ui/separator';\r\nimport { \r\n  Activity, \r\n  TrendingUp, \r\n  TrendingDown, \r\n  DollarSign, \r\n  Target, \r\n  Clock, \r\n  AlertTriangle, \r\n  CheckCircle, \r\n  XCircle,\r\n  BarChart3,\r\n  Zap,\r\n  Shield,\r\n  RefreshCw,\r\n  Pause,\r\n  Play,\r\n  Eye\r\n} from 'lucide-react';\r\n\r\ninterface BetResult {\r\n  id: string;\r\n  timestamp: string;\r\n  numbers: number[];\r\n  amount: number;\r\n  result: 'win' | 'loss' | 'pending';\r\n  profit: number;\r\n  strategy: string;\r\n  confidence: number;\r\n  winningNumber?: number;\r\n}\r\n\r\ninterface SessionStats {\r\n  totalBets: number;\r\n  wins: number;\r\n  losses: number;\r\n  pending: number;\r\n  totalProfit: number;\r\n  winRate: number;\r\n  averageBet: number;\r\n  biggestWin: number;\r\n  biggestLoss: number;\r\n  consecutiveWins: number;\r\n  consecutiveLosses: number;\r\n  currentStreak: 'win' | 'loss' | 'none';\r\n  streakCount: number;\r\n  startTime: string;\r\n  sessionDuration: string;\r\n}\r\n\r\ninterface RiskMetrics {\r\n  riskScore: number;\r\n  bankrollUsage: number;\r\n  maxDrawdown: number;\r\n  sharpeRatio: number;\r\n  volatility: number;\r\n  riskLevel: 'low' | 'medium' | 'high' | 'critical';\r\n}\r\n\r\ninterface AlertItem {\r\n  id: string;\r\n  type: 'warning' | 'error' | 'info' | 'success';\r\n  message: string;\r\n  timestamp: string;\r\n  acknowledged: boolean;\r\n}\r\n\r\ninterface RealTimeMonitoringDashboardProps {\r\n  isActive: boolean;\r\n  onToggleMonitoring?: (active: boolean) => void;\r\n}\r\n\r\nfunction RealTimeMonitoringDashboard({ \r\n  isActive, \r\n  onToggleMonitoring \r\n}: RealTimeMonitoringDashboardProps) {\r\n  // Estados principais\r\n  const [recentBets, setRecentBets] = useState<BetResult[]>([]);\r\n  const [sessionStats, setSessionStats] = useState<SessionStats>({\r\n    totalBets: 0,\r\n    wins: 0,\r\n    losses: 0,\r\n    pending: 0,\r\n    totalProfit: 0,\r\n    winRate: 0,\r\n    averageBet: 0,\r\n    biggestWin: 0,\r\n    biggestLoss: 0,\r\n    consecutiveWins: 0,\r\n    consecutiveLosses: 0,\r\n    currentStreak: 'none',\r\n    streakCount: 0,\r\n    startTime: new Date().toISOString(),\r\n    sessionDuration: '00:00:00'\r\n  });\r\n  \r\n  const [riskMetrics, setRiskMetrics] = useState<RiskMetrics>({\r\n    riskScore: 0,\r\n    bankrollUsage: 0,\r\n    maxDrawdown: 0,\r\n    sharpeRatio: 0,\r\n    volatility: 0,\r\n    riskLevel: 'low'\r\n  });\r\n  \r\n  const [alerts, setAlerts] = useState<AlertItem[]>([]);\r\n  const [isMonitoring, setIsMonitoring] = useState(isActive);\r\n  const [lastUpdate, setLastUpdate] = useState<string>('');\r\n  \r\n  // Refs para intervalos\r\n  const monitoringInterval = useRef<NodeJS.Timeout | null>(null);\r\n  const statsUpdateInterval = useRef<NodeJS.Timeout | null>(null);\r\n\r\n  // Simulação de dados em tempo real\r\n  useEffect(() => {\r\n    if (isMonitoring) {\r\n      // Atualizar estatísticas a cada segundo\r\n      statsUpdateInterval.current = setInterval(() => {\r\n        updateSessionDuration();\r\n        setLastUpdate(new Date().toLocaleTimeString());\r\n      }, 1000);\r\n\r\n      // Simular novas apostas a cada 5-15 segundos\r\n      monitoringInterval.current = setInterval(() => {\r\n        if (Math.random() > 0.3) { // 70% chance de nova aposta\r\n          simulateNewBet();\r\n        }\r\n      }, Math.random() * 10000 + 5000);\r\n    }\r\n\r\n    return () => {\r\n      if (monitoringInterval.current) clearInterval(monitoringInterval.current);\r\n      if (statsUpdateInterval.current) clearInterval(statsUpdateInterval.current);\r\n    };\r\n  }, [isMonitoring]);\r\n\r\n  const updateSessionDuration = () => {\r\n    const start = new Date(sessionStats.startTime);\r\n    const now = new Date();\r\n    const diff = now.getTime() - start.getTime();\r\n    \r\n    const hours = Math.floor(diff / (1000 * 60 * 60));\r\n    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));\r\n    const seconds = Math.floor((diff % (1000 * 60)) / 1000);\r\n    \r\n    const duration = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\r\n    \r\n    setSessionStats(prev => ({\r\n      ...prev,\r\n      sessionDuration: duration\r\n    }));\r\n  };\r\n\r\n  const simulateNewBet = () => {\r\n    const strategies = ['Martingale', 'Fibonacci', 'Padrão de Cores', 'ML Prediction', 'Análise de Frequência'];\r\n    const numbers = Array.from({ length: Math.floor(Math.random() * 6) + 1 }, () => Math.floor(Math.random() * 37));\r\n    const amount = Math.floor(Math.random() * 100) + 10;\r\n    const isWin = Math.random() > 0.52; // 48% win rate (realista para roleta)\r\n    const winningNumber = Math.floor(Math.random() * 37);\r\n    \r\n    const newBet: BetResult = {\r\n      id: `bet_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\r\n      timestamp: new Date().toISOString(),\r\n      numbers,\r\n      amount,\r\n      result: isWin ? 'win' : 'loss',\r\n      profit: isWin ? amount * (36 / numbers.length - 1) : -amount,\r\n      strategy: strategies[Math.floor(Math.random() * strategies.length)],\r\n      confidence: Math.floor(Math.random() * 40) + 60,\r\n      winningNumber\r\n    };\r\n\r\n    setRecentBets(prev => [newBet, ...prev.slice(0, 19)]); // Manter apenas 20 apostas recentes\r\n    updateSessionStats(newBet);\r\n    updateRiskMetrics(newBet);\r\n    checkForAlerts(newBet);\r\n  };\r\n\r\n  const updateSessionStats = (newBet: BetResult) => {\r\n    setSessionStats(prev => {\r\n      const newStats = {\r\n        ...prev,\r\n        totalBets: prev.totalBets + 1,\r\n        wins: prev.wins + (newBet.result === 'win' ? 1 : 0),\r\n        losses: prev.losses + (newBet.result === 'loss' ? 1 : 0),\r\n        totalProfit: prev.totalProfit + newBet.profit,\r\n        averageBet: ((prev.averageBet * prev.totalBets) + newBet.amount) / (prev.totalBets + 1),\r\n        biggestWin: Math.max(prev.biggestWin, newBet.result === 'win' ? newBet.profit : 0),\r\n        biggestLoss: Math.min(prev.biggestLoss, newBet.result === 'loss' ? newBet.profit : 0)\r\n      };\r\n\r\n      // Calcular win rate\r\n      newStats.winRate = newStats.totalBets > 0 ? (newStats.wins / newStats.totalBets) * 100 : 0;\r\n\r\n      // Atualizar streaks\r\n      if (newBet.result === 'win') {\r\n        if (prev.currentStreak === 'win') {\r\n          newStats.streakCount = prev.streakCount + 1;\r\n          newStats.consecutiveWins = Math.max(prev.consecutiveWins, newStats.streakCount);\r\n        } else {\r\n          newStats.currentStreak = 'win';\r\n          newStats.streakCount = 1;\r\n        }\r\n      } else if (newBet.result === 'loss') {\r\n        if (prev.currentStreak === 'loss') {\r\n          newStats.streakCount = prev.streakCount + 1;\r\n          newStats.consecutiveLosses = Math.max(prev.consecutiveLosses, newStats.streakCount);\r\n        } else {\r\n          newStats.currentStreak = 'loss';\r\n          newStats.streakCount = 1;\r\n        }\r\n      }\r\n\r\n      return newStats;\r\n    });\r\n  };\r\n\r\n  const updateRiskMetrics = (newBet: BetResult) => {\r\n    setRiskMetrics(prev => {\r\n      const bankrollUsage = Math.min(100, (sessionStats.totalBets * sessionStats.averageBet) / 1000 * 100);\r\n      const riskScore = Math.min(100, \r\n        (sessionStats.consecutiveLosses * 10) + \r\n        (bankrollUsage * 0.5) + \r\n        (sessionStats.totalProfit < -500 ? 30 : 0)\r\n      );\r\n      \r\n      let riskLevel: 'low' | 'medium' | 'high' | 'critical' = 'low';\r\n      if (riskScore > 75) riskLevel = 'critical';\r\n      else if (riskScore > 50) riskLevel = 'high';\r\n      else if (riskScore > 25) riskLevel = 'medium';\r\n\r\n      return {\r\n        ...prev,\r\n        riskScore,\r\n        bankrollUsage,\r\n        riskLevel,\r\n        maxDrawdown: Math.min(prev.maxDrawdown, sessionStats.totalProfit),\r\n        volatility: Math.abs(newBet.profit) / newBet.amount * 100\r\n      };\r\n    });\r\n  };\r\n\r\n  const checkForAlerts = (newBet: BetResult) => {\r\n    const newAlerts: AlertItem[] = [];\r\n\r\n    // Alert para perdas consecutivas\r\n    if (sessionStats.currentStreak === 'loss' && sessionStats.streakCount >= 5) {\r\n      newAlerts.push({\r\n        id: `consecutive_losses_${Date.now()}`,\r\n        type: 'warning',\r\n        message: `${sessionStats.streakCount} perdas consecutivas detectadas`,\r\n        timestamp: new Date().toISOString(),\r\n        acknowledged: false\r\n      });\r\n    }\r\n\r\n    // Alert para lucro negativo alto\r\n    if (sessionStats.totalProfit < -300) {\r\n      newAlerts.push({\r\n        id: `high_loss_${Date.now()}`,\r\n        type: 'error',\r\n        message: `Perda acumulada de R$ ${Math.abs(sessionStats.totalProfit).toFixed(2)}`,\r\n        timestamp: new Date().toISOString(),\r\n        acknowledged: false\r\n      });\r\n    }\r\n\r\n    // Alert para risco crítico\r\n    if (riskMetrics.riskLevel === 'critical') {\r\n      newAlerts.push({\r\n        id: `critical_risk_${Date.now()}`,\r\n        type: 'error',\r\n        message: 'Nível de risco crítico atingido - considere parar',\r\n        timestamp: new Date().toISOString(),\r\n        acknowledged: false\r\n      });\r\n    }\r\n\r\n    if (newAlerts.length > 0) {\r\n      setAlerts(prev => [...newAlerts, ...prev.slice(0, 9)]);\r\n    }\r\n  };\r\n\r\n  const toggleMonitoring = () => {\r\n    const newState = !isMonitoring;\r\n    setIsMonitoring(newState);\r\n    onToggleMonitoring?.(newState);\r\n  };\r\n\r\n  const acknowledgeAlert = (alertId: string) => {\r\n    setAlerts(prev => prev.map(alert => \r\n      alert.id === alertId ? { ...alert, acknowledged: true } : alert\r\n    ));\r\n  };\r\n\r\n  const getRiskColor = (level: string) => {\r\n    switch (level) {\r\n      case 'low': return 'text-green-400';\r\n      case 'medium': return 'text-yellow-400';\r\n      case 'high': return 'text-orange-400';\r\n      case 'critical': return 'text-red-400';\r\n      default: return 'text-gray-400';\r\n    }\r\n  };\r\n\r\n  const getStreakIcon = () => {\r\n    if (sessionStats.currentStreak === 'win') {\r\n      return <TrendingUp className=\"w-4 h-4 text-green-400\" />;\r\n    } else if (sessionStats.currentStreak === 'loss') {\r\n      return <TrendingDown className=\"w-4 h-4 text-red-400\" />;\r\n    }\r\n    return <Activity className=\"w-4 h-4 text-gray-400\" />;\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header com controles */}\r\n      <Card className=\"bg-gradient-to-r from-purple-900/20 to-blue-900/20 border-purple-500/30\">\r\n        <CardHeader className=\"pb-3\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <Activity className=\"w-6 h-6 text-purple-400\" />\r\n              <div>\r\n                <CardTitle className=\"text-xl\">Dashboard de Monitoramento</CardTitle>\r\n                <CardDescription>\r\n                  Acompanhamento em tempo real • Última atualização: {lastUpdate}\r\n                </CardDescription>\r\n              </div>\r\n            </div>\r\n            <div className=\"flex items-center gap-3\">\r\n              <Badge variant={isMonitoring ? \"default\" : \"secondary\"}>\r\n                {isMonitoring ? 'Ativo' : 'Pausado'}\r\n              </Badge>\r\n              <Button\r\n                variant={isMonitoring ? \"destructive\" : \"default\"}\r\n                size=\"sm\"\r\n                onClick={toggleMonitoring}\r\n              >\r\n                {isMonitoring ? (\r\n                  <>\r\n                    <Pause className=\"w-4 h-4 mr-2\" />\r\n                    Pausar\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <Play className=\"w-4 h-4 mr-2\" />\r\n                    Iniciar\r\n                  </>\r\n                )}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </CardHeader>\r\n      </Card>\r\n\r\n      {/* Estatísticas principais */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n        <Card className=\"bg-gradient-to-br from-green-900/20 to-emerald-900/20 border-green-500/30\">\r\n          <CardContent className=\"p-4\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm text-muted-foreground\">Lucro Total</p>\r\n                <p className={`text-2xl font-bold ${\r\n                  sessionStats.totalProfit >= 0 ? 'text-green-400' : 'text-red-400'\r\n                }`}>\r\n                  R$ {sessionStats.totalProfit.toFixed(2)}\r\n                </p>\r\n              </div>\r\n              <DollarSign className=\"w-8 h-8 text-green-400\" />\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card className=\"bg-gradient-to-br from-blue-900/20 to-cyan-900/20 border-blue-500/30\">\r\n          <CardContent className=\"p-4\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm text-muted-foreground\">Taxa de Vitória</p>\r\n                <p className=\"text-2xl font-bold text-blue-400\">\r\n                  {sessionStats.winRate.toFixed(1)}%\r\n                </p>\r\n              </div>\r\n              <Target className=\"w-8 h-8 text-blue-400\" />\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card className=\"bg-gradient-to-br from-purple-900/20 to-pink-900/20 border-purple-500/30\">\r\n          <CardContent className=\"p-4\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm text-muted-foreground\">Total de Apostas</p>\r\n                <p className=\"text-2xl font-bold text-purple-400\">\r\n                  {sessionStats.totalBets}\r\n                </p>\r\n              </div>\r\n              <BarChart3 className=\"w-8 h-8 text-purple-400\" />\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card className=\"bg-gradient-to-br from-orange-900/20 to-red-900/20 border-orange-500/30\">\r\n          <CardContent className=\"p-4\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm text-muted-foreground\">Duração</p>\r\n                <p className=\"text-2xl font-bold text-orange-400\">\r\n                  {sessionStats.sessionDuration}\r\n                </p>\r\n              </div>\r\n              <Clock className=\"w-8 h-8 text-orange-400\" />\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Métricas de risco e alertas */}\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n        {/* Métricas de Risco */}\r\n        <Card className=\"bg-gradient-to-br from-yellow-900/20 to-orange-900/20 border-yellow-500/30\">\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <Shield className=\"w-5 h-5 text-yellow-400\" />\r\n              Análise de Risco\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent className=\"space-y-4\">\r\n            <div className=\"space-y-2\">\r\n              <div className=\"flex justify-between items-center\">\r\n                <span className=\"text-sm\">Score de Risco</span>\r\n                <span className={`font-bold ${getRiskColor(riskMetrics.riskLevel)}`}>\r\n                  {riskMetrics.riskScore.toFixed(0)}/100\r\n                </span>\r\n              </div>\r\n              <Progress \r\n                value={riskMetrics.riskScore} \r\n                className=\"h-2\"\r\n              />\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-2 gap-4 text-sm\">\r\n              <div>\r\n                <p className=\"text-muted-foreground\">Uso do Bankroll</p>\r\n                <p className=\"font-semibold\">{riskMetrics.bankrollUsage.toFixed(1)}%</p>\r\n              </div>\r\n              <div>\r\n                <p className=\"text-muted-foreground\">Max Drawdown</p>\r\n                <p className=\"font-semibold text-red-400\">\r\n                  R$ {Math.abs(riskMetrics.maxDrawdown).toFixed(2)}\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"flex items-center gap-2\">\r\n              {getStreakIcon()}\r\n              <span className=\"text-sm\">\r\n                Sequência atual: {sessionStats.streakCount} {\r\n                  sessionStats.currentStreak === 'win' ? 'vitórias' : \r\n                  sessionStats.currentStreak === 'loss' ? 'derrotas' : 'neutro'\r\n                }\r\n              </span>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Alertas */}\r\n        <Card className=\"bg-gradient-to-br from-red-900/20 to-pink-900/20 border-red-500/30\">\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <AlertTriangle className=\"w-5 h-5 text-red-400\" />\r\n              Alertas Críticos\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"space-y-3 max-h-48 overflow-y-auto\">\r\n              {alerts.length === 0 ? (\r\n                <div className=\"text-center py-4 text-muted-foreground\">\r\n                  <CheckCircle className=\"w-8 h-8 mx-auto mb-2 text-green-400\" />\r\n                  Nenhum alerta ativo\r\n                </div>\r\n              ) : (\r\n                alerts.map((alert) => (\r\n                  <Alert \r\n                    key={alert.id} \r\n                    className={`${alert.acknowledged ? 'opacity-50' : ''} ${\r\n                      alert.type === 'error' ? 'border-red-500/50' : \r\n                      alert.type === 'warning' ? 'border-yellow-500/50' : \r\n                      'border-blue-500/50'\r\n                    }`}\r\n                  >\r\n                    <AlertTriangle className=\"h-4 w-4\" />\r\n                    <AlertDescription className=\"flex justify-between items-center\">\r\n                      <div>\r\n                        <p className=\"font-medium\">{alert.message}</p>\r\n                        <p className=\"text-xs text-muted-foreground\">\r\n                          {new Date(alert.timestamp).toLocaleTimeString()}\r\n                        </p>\r\n                      </div>\r\n                      {!alert.acknowledged && (\r\n                        <Button\r\n                          variant=\"ghost\"\r\n                          size=\"sm\"\r\n                          onClick={() => acknowledgeAlert(alert.id)}\r\n                        >\r\n                          <CheckCircle className=\"w-4 h-4\" />\r\n                        </Button>\r\n                      )}\r\n                    </AlertDescription>\r\n                  </Alert>\r\n                ))\r\n              )}\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Apostas recentes */}\r\n      <Card className=\"bg-gradient-to-br from-gray-900/20 to-slate-900/20 border-gray-500/30\">\r\n        <CardHeader>\r\n          <CardTitle className=\"flex items-center gap-2\">\r\n            <Eye className=\"w-5 h-5 text-gray-400\" />\r\n            Apostas Recentes\r\n          </CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"space-y-2 max-h-64 overflow-y-auto\">\r\n            {recentBets.length === 0 ? (\r\n              <div className=\"text-center py-8 text-muted-foreground\">\r\n                <Activity className=\"w-8 h-8 mx-auto mb-2\" />\r\n                Aguardando apostas...\r\n              </div>\r\n            ) : (\r\n              recentBets.map((bet) => (\r\n                <div \r\n                  key={bet.id} \r\n                  className=\"flex items-center justify-between p-3 bg-black/20 rounded-lg\"\r\n                >\r\n                  <div className=\"flex items-center gap-3\">\r\n                    {bet.result === 'win' ? (\r\n                      <CheckCircle className=\"w-5 h-5 text-green-400\" />\r\n                    ) : (\r\n                      <XCircle className=\"w-5 h-5 text-red-400\" />\r\n                    )}\r\n                    <div>\r\n                      <p className=\"font-medium\">\r\n                        {bet.numbers.join(', ')} • R$ {bet.amount.toFixed(2)}\r\n                      </p>\r\n                      <p className=\"text-xs text-muted-foreground\">\r\n                        {bet.strategy} • {new Date(bet.timestamp).toLocaleTimeString()}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"text-right\">\r\n                    <p className={`font-bold ${\r\n                      bet.result === 'win' ? 'text-green-400' : 'text-red-400'\r\n                    }`}>\r\n                      {bet.result === 'win' ? '+' : ''}R$ {bet.profit.toFixed(2)}\r\n                    </p>\r\n                    <p className=\"text-xs text-muted-foreground\">\r\n                      Confiança: {bet.confidence}%\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              ))\r\n            )}\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default RealTimeMonitoringDashboard;","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/dashboard/recent-activity.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/dashboard/risk-indicator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/dashboard/risk-management-system.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/dashboard/roulette-modal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/dashboard/roulette-status.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/dashboard/sidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/dashboard/stats-cards-cached.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/dashboard/stats-cards.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/dashboard/strategy-card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/dashboard/strategy-filter.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/dashboard/strategy-grid.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/dashboard/tactical-entry.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/dashboard/tactical-header.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'timeLeft'. Either include it or remove the dependency array.","line":44,"column":6,"nodeType":"ArrayExpression","endLine":44,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [countdown, timeLeft]","fix":{"range":[1175,1186],"text":"[countdown, timeLeft]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { Badge } from '@/components/ui/badge'\r\nimport { Card } from '@/components/ui/card'\r\nimport { Progress } from '@/components/ui/progress'\r\nimport { Clock, Brain, Target, RotateCcw } from 'lucide-react'\r\nimport { useEffect, useState } from 'react'\r\n\r\ninterface TacticalHeaderProps {\r\n  activeStrategy: string\r\n  targetRoulette: string\r\n  countdown: number\r\n  collectionStatus: 'active' | 'paused' | 'analyzing'\r\n  isPatternActive: boolean\r\n}\r\n\r\nexport function TacticalHeader({\r\n  activeStrategy,\r\n  targetRoulette,\r\n  countdown,\r\n  collectionStatus,\r\n  isPatternActive\r\n}: TacticalHeaderProps) {\r\n  const [timeLeft, setTimeLeft] = useState(countdown)\r\n  const [progress, setProgress] = useState(100)\r\n\r\n  useEffect(() => {\r\n    setTimeLeft(countdown)\r\n    setProgress(100)\r\n  }, [countdown, timeLeft])\r\n\r\n  useEffect(() => {\r\n    if (timeLeft > 0) {\r\n      const timer = setInterval(() => {\r\n        setTimeLeft(prev => {\r\n          if (prev <= 0) return 0\r\n          const newTime = prev - 1\r\n          setProgress((newTime / countdown) * 100)\r\n          return newTime\r\n        })\r\n      }, 1000)\r\n      return () => clearInterval(timer)\r\n    }\r\n  }, [countdown])\r\n\r\n  const getStatusColor = () => {\r\n    switch (collectionStatus) {\r\n      case 'active': return 'bg-green-500'\r\n      case 'paused': return 'bg-yellow-500'\r\n      case 'analyzing': return 'bg-blue-500'\r\n      default: return 'bg-gray-500'\r\n    }\r\n  }\r\n\r\n  const getStatusText = () => {\r\n    switch (collectionStatus) {\r\n      case 'active': return 'Ativo'\r\n      case 'paused': return 'Pausado'\r\n      case 'analyzing': return 'Em Análise'\r\n      default: return 'Desconhecido'\r\n    }\r\n  }\r\n\r\n  return (\r\n    <Card className=\"fixed top-0 left-0 right-0 z-50 rounded-none border-b-2 border-purple-500/20 bg-gradient-to-r from-gray-900 via-purple-900/20 to-gray-900 backdrop-blur-sm\">\r\n      <div className=\"container mx-auto px-4 py-3\">\r\n        <div className=\"flex items-center justify-between\">\r\n          {/* Status do Padrão */}\r\n          <div className=\"flex items-center space-x-4\">\r\n            {isPatternActive ? (\r\n              <Badge className=\"bg-gradient-to-r from-red-500 to-orange-500 text-white font-bold px-4 py-2 text-sm animate-pulse\">\r\n                🔥 Padrão Ativo!\r\n              </Badge>\r\n            ) : (\r\n              <Badge className=\"bg-gradient-to-r from-gray-600 to-gray-700 text-white font-bold px-4 py-2 text-sm\">\r\n                ⏳ Aguardando Gatilho\r\n              </Badge>\r\n            )}\r\n          </div>\r\n\r\n          {/* Informações Centrais */}\r\n          <div className=\"flex items-center space-x-6 text-sm\">\r\n            {/* Estratégia Ativa */}\r\n            <div className=\"flex items-center space-x-2\">\r\n              <Brain className=\"h-4 w-4 text-purple-400\" />\r\n              <span className=\"text-white font-medium\">{activeStrategy || 'Nenhuma estratégia ativa'}</span>\r\n            </div>\r\n\r\n            {/* Roleta de Referência */}\r\n            <div className=\"flex items-center space-x-2\">\r\n              <Target className=\"h-4 w-4 text-green-400\" />\r\n              <span className=\"text-gray-300\">{targetRoulette || 'Aguardando conexão'}</span>\r\n            </div>\r\n\r\n            {/* Status da Coleta */}\r\n            <div className=\"flex items-center space-x-2\">\r\n              <RotateCcw className=\"h-4 w-4 text-blue-400\" />\r\n              <span className=\"text-gray-300\">Status:</span>\r\n              <div className={`w-2 h-2 rounded-full ${getStatusColor()} animate-pulse`}></div>\r\n              <span className=\"text-white font-medium\">{getStatusText()}</span>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Contador Regressivo */}\r\n          <div className=\"flex items-center space-x-3\">\r\n            <div className=\"flex items-center space-x-2\">\r\n              <Clock className=\"h-4 w-4 text-yellow-400\" />\r\n              <span className=\"text-white font-mono text-lg font-bold\">\r\n                {Math.floor(timeLeft / 60).toString().padStart(2, '0')}:\r\n                {(timeLeft % 60).toString().padStart(2, '0')}\r\n              </span>\r\n            </div>\r\n            <div className=\"w-20\">\r\n              <Progress \r\n                value={progress} \r\n                className=\"h-2 bg-gray-700\"\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </Card>\r\n  )\r\n}","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/debug/login-debug.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The ref value 'originalConsoleLog.current' will likely have changed by the time this effect cleanup function runs. If this ref points to a node rendered by React, copy 'originalConsoleLog.current' to a variable inside the effect, and use that variable in the cleanup function.","line":135,"column":40,"nodeType":"Identifier","endLine":135,"endColumn":47},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The ref value 'originalConsoleWarn.current' will likely have changed by the time this effect cleanup function runs. If this ref points to a node rendered by React, copy 'originalConsoleWarn.current' to a variable inside the effect, and use that variable in the cleanup function.","line":136,"column":42,"nodeType":"Identifier","endLine":136,"endColumn":49},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The ref value 'originalConsoleError.current' will likely have changed by the time this effect cleanup function runs. If this ref points to a node rendered by React, copy 'originalConsoleError.current' to a variable inside the effect, and use that variable in the cleanup function.","line":137,"column":44,"nodeType":"Identifier","endLine":137,"endColumn":51}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect, useRef } from 'react';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { ScrollArea } from '@/components/ui/scroll-area';\r\nimport { Separator } from '@/components/ui/separator';\r\nimport { \r\n  Eye, \r\n  EyeOff, \r\n  Trash2, \r\n  Download, \r\n  RefreshCw,\r\n  AlertCircle,\r\n  CheckCircle,\r\n  XCircle,\r\n  Clock,\r\n  User,\r\n  Shield,\r\n  Database,\r\n  Network\r\n} from 'lucide-react';\r\n\r\ninterface LogEntry {\r\n  id: string;\r\n  timestamp: string;\r\n  level: 'info' | 'warn' | 'error';\r\n  source: 'auth' | 'api' | 'middleware' | 'component';\r\n  message: string;\r\n  data?: any;\r\n}\r\n\r\ninterface LoginDebugProps {\r\n  isVisible?: boolean;\r\n  position?: 'bottom-right' | 'bottom-left' | 'top-right' | 'top-left';\r\n}\r\n\r\nexport function LoginDebug({ \r\n  isVisible = false, \r\n  position = 'bottom-right' \r\n}: LoginDebugProps) {\r\n  const [logs, setLogs] = useState<LogEntry[]>([]);\r\n  const [isExpanded, setIsExpanded] = useState(false);\r\n  const [autoScroll, setAutoScroll] = useState(true);\r\n  const [filter, setFilter] = useState<'all' | 'info' | 'warn' | 'error'>('all');\r\n  const scrollAreaRef = useRef<HTMLDivElement>(null);\r\n  const originalConsoleLog = useRef(console.log);\r\n  const originalConsoleWarn = useRef(console.warn);\r\n  const originalConsoleError = useRef(console.error);\r\n\r\n  // Interceptar console logs\r\n  useEffect(() => {\r\n    const interceptConsole = () => {\r\n      console.log = (...args) => {\r\n        originalConsoleLog.current(...args);\r\n        \r\n        const message = args.join(' ');\r\n        if (message.includes('[AUTH-') || message.includes('[API-') || message.includes('[MIDDLEWARE-')) {\r\n          try {\r\n            let parsedData;\r\n            let source: LogEntry['source'] = 'component';\r\n            let level: LogEntry['level'] = 'info';\r\n            \r\n            if (message.includes('[AUTH-')) {\r\n              source = 'auth';\r\n              if (message.includes('[AUTH-ERROR]')) level = 'error';\r\n              else if (message.includes('[AUTH-WARN]')) level = 'warn';\r\n              \r\n              const jsonMatch = message.match(/\\{.*\\}/);\r\n              if (jsonMatch) {\r\n                parsedData = JSON.parse(jsonMatch[0]);\r\n              }\r\n            } else if (message.includes('[API-')) {\r\n              source = 'api';\r\n              if (message.includes('[API-ERROR]')) level = 'error';\r\n              else if (message.includes('[API-WARN]')) level = 'warn';\r\n              \r\n              const jsonMatch = message.match(/\\{.*\\}/);\r\n              if (jsonMatch) {\r\n                parsedData = JSON.parse(jsonMatch[0]);\r\n              }\r\n            } else if (message.includes('[MIDDLEWARE-')) {\r\n              source = 'middleware';\r\n              if (message.includes('[MIDDLEWARE-ERROR]')) level = 'error';\r\n              else if (message.includes('[MIDDLEWARE-WARN]')) level = 'warn';\r\n              \r\n              const jsonMatch = message.match(/\\{.*\\}/);\r\n              if (jsonMatch) {\r\n                parsedData = JSON.parse(jsonMatch[0]);\r\n              }\r\n            }\r\n\r\n            const logEntry: LogEntry = {\r\n              id: `${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\r\n              timestamp: new Date().toISOString(),\r\n              level,\r\n              source,\r\n              message: parsedData?.message || message.replace(/\\[.*?\\]/g, '').trim(),\r\n              data: parsedData\r\n            };\r\n\r\n            setLogs(prev => [...prev.slice(-99), logEntry]); // Manter apenas os últimos 100 logs\r\n          } catch (error) {\r\n            // Se não conseguir parsear, adicionar como log simples\r\n            const logEntry: LogEntry = {\r\n              id: `${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\r\n              timestamp: new Date().toISOString(),\r\n              level: 'info',\r\n              source: 'component',\r\n              message,\r\n              data: null\r\n            };\r\n            setLogs(prev => [...prev.slice(-99), logEntry]);\r\n          }\r\n        }\r\n      };\r\n\r\n      console.warn = (...args) => {\r\n        originalConsoleWarn.current(...args);\r\n        // Similar logic for warnings\r\n      };\r\n\r\n      console.error = (...args) => {\r\n        originalConsoleError.current(...args);\r\n        // Similar logic for errors\r\n      };\r\n    };\r\n\r\n    if (isVisible) {\r\n      interceptConsole();\r\n    }\r\n\r\n    return () => {\r\n      console.log = originalConsoleLog.current;\r\n      console.warn = originalConsoleWarn.current;\r\n      console.error = originalConsoleError.current;\r\n    };\r\n  }, [isVisible]);\r\n\r\n  // Auto scroll para o final\r\n  useEffect(() => {\r\n    if (autoScroll && scrollAreaRef.current) {\r\n      const scrollElement = scrollAreaRef.current.querySelector('[data-radix-scroll-area-viewport]');\r\n      if (scrollElement) {\r\n        scrollElement.scrollTop = scrollElement.scrollHeight;\r\n      }\r\n    }\r\n  }, [logs, autoScroll]);\r\n\r\n  const filteredLogs = logs.filter(log => filter === 'all' || log.level === filter);\r\n\r\n  const clearLogs = () => setLogs([]);\r\n\r\n  const downloadLogs = () => {\r\n    const logData = JSON.stringify(logs, null, 2);\r\n    const blob = new Blob([logData], { type: 'application/json' });\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = `sofia-login-logs-${new Date().toISOString().split('T')[0]}.json`;\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    document.body.removeChild(a);\r\n    URL.revokeObjectURL(url);\r\n  };\r\n\r\n  const getPositionClasses = () => {\r\n    switch (position) {\r\n      case 'bottom-left':\r\n        return 'bottom-4 left-4';\r\n      case 'top-right':\r\n        return 'top-4 right-4';\r\n      case 'top-left':\r\n        return 'top-4 left-4';\r\n      default:\r\n        return 'bottom-4 right-4';\r\n    }\r\n  };\r\n\r\n  const getLevelIcon = (level: LogEntry['level']) => {\r\n    switch (level) {\r\n      case 'error':\r\n        return <XCircle className=\"h-4 w-4 text-red-500\" />;\r\n      case 'warn':\r\n        return <AlertCircle className=\"h-4 w-4 text-yellow-500\" />;\r\n      default:\r\n        return <CheckCircle className=\"h-4 w-4 text-green-500\" />;\r\n    }\r\n  };\r\n\r\n  const getSourceIcon = (source: LogEntry['source']) => {\r\n    switch (source) {\r\n      case 'auth':\r\n        return <Shield className=\"h-4 w-4 text-blue-500\" />;\r\n      case 'api':\r\n        return <Network className=\"h-4 w-4 text-purple-500\" />;\r\n      case 'middleware':\r\n        return <Database className=\"h-4 w-4 text-orange-500\" />;\r\n      default:\r\n        return <User className=\"h-4 w-4 text-gray-500\" />;\r\n    }\r\n  };\r\n\r\n  if (!isVisible) return null;\r\n\r\n  return (\r\n    <div className={`fixed ${getPositionClasses()} z-50 max-w-md`}>\r\n      <Card className=\"shadow-lg border-2\">\r\n        <CardHeader className=\"pb-2\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\r\n              <Shield className=\"h-4 w-4\" />\r\n              Login Debug\r\n              <Badge variant=\"outline\" className=\"text-xs\">\r\n                {filteredLogs.length}\r\n              </Badge>\r\n            </CardTitle>\r\n            <div className=\"flex items-center gap-1\">\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                onClick={() => setIsExpanded(!isExpanded)}\r\n                className=\"h-6 w-6 p-0\"\r\n              >\r\n                {isExpanded ? <EyeOff className=\"h-3 w-3\" /> : <Eye className=\"h-3 w-3\" />}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </CardHeader>\r\n\r\n        {isExpanded && (\r\n          <CardContent className=\"pt-0\">\r\n            {/* Controles */}\r\n            <div className=\"flex items-center gap-2 mb-3\">\r\n              <div className=\"flex gap-1\">\r\n                {(['all', 'info', 'warn', 'error'] as const).map((level) => (\r\n                  <Button\r\n                    key={level}\r\n                    variant={filter === level ? 'default' : 'outline'}\r\n                    size=\"sm\"\r\n                    onClick={() => setFilter(level)}\r\n                    className=\"h-6 text-xs px-2\"\r\n                  >\r\n                    {level}\r\n                  </Button>\r\n                ))}\r\n              </div>\r\n              \r\n              <Separator orientation=\"vertical\" className=\"h-4\" />\r\n              \r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                onClick={() => setAutoScroll(!autoScroll)}\r\n                className=\"h-6 w-6 p-0\"\r\n                title={autoScroll ? 'Disable auto-scroll' : 'Enable auto-scroll'}\r\n              >\r\n                <RefreshCw className={`h-3 w-3 ${autoScroll ? 'animate-spin' : ''}`} />\r\n              </Button>\r\n              \r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                onClick={clearLogs}\r\n                className=\"h-6 w-6 p-0\"\r\n                title=\"Clear logs\"\r\n              >\r\n                <Trash2 className=\"h-3 w-3\" />\r\n              </Button>\r\n              \r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                onClick={downloadLogs}\r\n                className=\"h-6 w-6 p-0\"\r\n                title=\"Download logs\"\r\n              >\r\n                <Download className=\"h-3 w-3\" />\r\n              </Button>\r\n            </div>\r\n\r\n            {/* Logs */}\r\n            <ScrollArea className=\"h-64 w-full\" ref={scrollAreaRef}>\r\n              <div className=\"space-y-2\">\r\n                {filteredLogs.length === 0 ? (\r\n                  <div className=\"text-center text-sm text-muted-foreground py-4\">\r\n                    Nenhum log encontrado\r\n                  </div>\r\n                ) : (\r\n                  filteredLogs.map((log) => (\r\n                    <div\r\n                      key={log.id}\r\n                      className=\"p-2 rounded-md border bg-card text-xs\"\r\n                    >\r\n                      <div className=\"flex items-center gap-2 mb-1\">\r\n                        {getLevelIcon(log.level)}\r\n                        {getSourceIcon(log.source)}\r\n                        <Badge variant=\"outline\" className=\"text-xs px-1 py-0\">\r\n                          {log.source}\r\n                        </Badge>\r\n                        <div className=\"flex items-center gap-1 text-muted-foreground\">\r\n                          <Clock className=\"h-3 w-3\" />\r\n                          {new Date(log.timestamp).toLocaleTimeString()}\r\n                        </div>\r\n                      </div>\r\n                      \r\n                      <div className=\"font-medium mb-1\">{log.message}</div>\r\n                      \r\n                      {log.data && (\r\n                        <details className=\"mt-1\">\r\n                          <summary className=\"cursor-pointer text-muted-foreground hover:text-foreground\">\r\n                            Dados\r\n                          </summary>\r\n                          <pre className=\"mt-1 p-2 bg-muted rounded text-xs overflow-x-auto\">\r\n                            {JSON.stringify(log.data, null, 2)}\r\n                          </pre>\r\n                        </details>\r\n                      )}\r\n                    </div>\r\n                  ))\r\n                )}\r\n              </div>\r\n            </ScrollArea>\r\n          </CardContent>\r\n        )}\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default LoginDebug;","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/error-boundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/error/FallbackComponent.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/examples/api-integration-example.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/extension-handler.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/insights/insight-card.backup.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":132,"column":14,"nodeType":"JSXOpeningElement","endLine":136,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React from 'react';\nimport { Card, CardContent, CardFooter, CardHeader } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { ShinyButton } from '@/components/ui/shiny-button';\nimport { Progress } from '@/components/ui/progress';\nimport { Lock, Clock, Play, TrendingUp, Zap, ShieldCheck } from 'lucide-react';\nimport Link from 'next/link';\nimport { useRouter } from 'next/navigation';\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\n\ninterface InsightCardProps {\n  id: string;\n  title: string;\n  subtitle: string;\n  duration: string;\n  locked: boolean;\n  category: string;\n  progress?: number;\n  featured?: boolean;\n  thumbnailUrl?: string;\n}\n\nexport function InsightCard({\n  id,\n  title,\n  subtitle,\n  duration,\n  locked,\n  category,\n  progress = 0,\n  featured = false,\n  thumbnailUrl,\n}: InsightCardProps) {\n  const router = useRouter();\n\n  if (locked) {\n    return (\n      <Dialog>\n        <DialogTrigger asChild>\n          <Card className={`group relative overflow-hidden cursor-pointer border-border/50 hover:border-primary/50 transition-all duration-300 hover:shadow-xl hover:shadow-primary/10 hover:scale-[1.02] bg-card/50 backdrop-blur-sm h-full flex flex-col ${featured ? 'md:flex-row md:h-64' : ''}`}>\n            {/* Content (duplicated for now to ensure exact structure) */}\n            <CardContentInner \n              title={title} \n              subtitle={subtitle} \n              duration={duration} \n              locked={locked} \n              category={category} \n              progress={progress} \n              featured={featured} \n              thumbnailUrl={thumbnailUrl}\n            />\n          </Card>\n        </DialogTrigger>\n\n        {/* Paywall Modal */}\n        <DialogContent className=\"sm:max-w-md border-primary/20 bg-background/95 backdrop-blur-xl\">\n          <DialogHeader>\n            <div className=\"mx-auto bg-primary/10 p-3 rounded-full mb-4 w-fit\">\n              <Lock className=\"w-8 h-8 text-primary\" />\n            </div>\n            <DialogTitle className=\"text-center text-2xl font-bold\">Conteúdo Exclusivo PRO</DialogTitle>\n            <DialogDescription className=\"text-center text-base pt-2\">\n              Este insight estratégico está reservado para membros do plano SOFIA PRO.\n            </DialogDescription>\n          </DialogHeader>\n          \n          <div className=\"space-y-4 py-4\">\n            <div className=\"flex items-center gap-3 p-3 rounded-lg bg-muted/50 border border-border/50\">\n              <Zap className=\"w-5 h-5 text-primary shrink-0\" />\n              <span className=\"text-sm\">Acesso a todos os aprendizados avançados</span>\n            </div>\n            <div className=\"flex items-center gap-3 p-3 rounded-lg bg-muted/50 border border-border/50\">\n              <ShieldCheck className=\"w-5 h-5 text-primary shrink-0\" />\n              <span className=\"text-sm\">Estratégias validadas por especialistas</span>\n            </div>\n            <div className=\"flex items-center gap-3 p-3 rounded-lg bg-muted/50 border border-border/50\">\n              <TrendingUp className=\"w-5 h-5 text-primary shrink-0\" />\n              <span className=\"text-sm\">Aumente sua assertividade com leitura profissional</span>\n            </div>\n          </div>\n\n          <DialogFooter className=\"sm:justify-center\">\n            <ShinyButton \n              className=\"w-full font-bold h-11 shadow-lg shadow-primary/20\"\n              onClick={() => router.push('/account/upgrade')}\n            >\n              Ativar SOFIA PRO Agora\n            </ShinyButton>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    );\n  }\n\n  return (\n    <Link href={`/insights/${id}`}>\n      <Card className={`group relative overflow-hidden cursor-pointer border-border/50 hover:border-primary/50 transition-all duration-300 hover:shadow-xl hover:shadow-primary/10 hover:scale-[1.02] bg-card/50 backdrop-blur-sm h-full flex flex-col ${featured ? 'md:flex-row md:h-64' : ''}`}>\n        <CardContentInner \n          title={title} \n          subtitle={subtitle} \n          duration={duration} \n          locked={locked} \n          category={category} \n          progress={progress} \n          featured={featured} \n          thumbnailUrl={thumbnailUrl}\n        />\n      </Card>\n    </Link>\n  );\n}\n\n// Helper component to avoid code duplication\nfunction CardContentInner({ title, subtitle, duration, locked, category, progress, featured, thumbnailUrl }: any) {\n  return (\n    <>\n      {/* Thumbnail Area */}\n      <div className={`relative bg-gradient-to-br from-muted/20 to-card overflow-hidden ${featured ? 'w-full md:w-1/2 h-48 md:h-full' : 'h-40 w-full'}`}>\n        {thumbnailUrl ? (\n          <>\n             <img \n               src={thumbnailUrl} \n               alt={title} \n               className=\"absolute inset-0 w-full h-full object-cover transition-transform duration-500 group-hover:scale-105\"\n             />\n             <div className=\"absolute inset-0 bg-black/20 group-hover:bg-black/10 transition-colors\" />\n          </>\n        ) : (\n          <>\n            <div className=\"absolute inset-0 bg-[radial-gradient(ellipse_at_top_right,_var(--tw-gradient-stops))] from-primary/20 via-background/0 to-background/0\" />\n            \n            {/* Abstract shapes/Icon */}\n            <div className=\"absolute inset-0 flex items-center justify-center opacity-20 group-hover:opacity-30 transition-opacity\">\n               <TrendingUp className={`${featured ? 'w-32 h-32' : 'w-16 h-16'} text-primary`} />\n            </div>\n          </>\n        )}\n\n        {/* Locked State: Discreet Lock Icon */}\n        {locked && (\n          <>\n            {/* Discreet Lock Icon in Corner */}\n            <div className=\"absolute top-2 right-2 bg-background/40 backdrop-blur-sm p-1.5 rounded-full border border-border/5 z-10\">\n              <Lock className=\"w-3 h-3 text-muted-foreground\" />\n            </div>\n            \n            {/* Hover Reveal Message - Only appears on interaction */}\n            <div className=\"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300 bg-background/60 backdrop-blur-[1px] z-20\">\n               <div className=\"flex items-center gap-2 text-primary font-medium px-3 py-1.5 rounded-full border border-primary/30 bg-background/80 backdrop-blur-md transform translate-y-2 group-hover:translate-y-0 transition-transform\">\n                  <Lock className=\"w-3.5 h-3.5\" />\n                  <span className=\"text-xs\">Exclusivo PRO</span>\n               </div>\n            </div>\n          </>\n        )}\n\n        {/* Progress Bar (if unlocked and in progress) */}\n        {!locked && progress > 0 && (\n          <div className=\"absolute bottom-0 left-0 right-0 h-1 bg-muted\">\n            <div \n              className=\"h-full bg-primary\" \n              style={{ width: `${progress}%` }} \n            />\n          </div>\n        )}\n        \n        {/* Duration Badge */}\n        <div className=\"absolute bottom-2 right-2 bg-background/80 backdrop-blur-md px-2 py-0.5 rounded text-xs text-muted-foreground font-medium flex items-center gap-1 border border-border/5\">\n          <Clock className=\"w-3 h-3\" />\n          {duration}\n        </div>\n      </div>\n\n      <div className={`flex flex-col flex-1 ${featured ? 'p-6 justify-center' : ''}`}>\n        <CardHeader className={`space-y-1 pb-2 ${featured ? 'pt-0' : ''}`}>\n          <div className=\"flex justify-between items-start\">\n            <Badge variant=\"outline\" className=\"text-[10px] text-primary border-primary/20 bg-primary/5 mb-2\">\n              {category}\n            </Badge>\n          </div>\n          <h3 className={`font-bold leading-tight group-hover:text-primary transition-colors ${featured ? 'text-2xl' : 'text-base'}`}>\n            {title}\n          </h3>\n        </CardHeader>\n\n        <CardContent className=\"pb-4 flex-1\">\n          <p className=\"text-muted-foreground text-sm line-clamp-2\">\n            {subtitle}\n          </p>\n        </CardContent>\n        \n        {!locked && progress > 0 && (\n           <div className=\"px-6 pb-4 pt-0\">\n              <p className=\"text-xs text-primary font-medium mb-1.5\">\n                {progress < 100 ? `Continue assistindo: ${progress}%` : 'Concluído'}\n              </p>\n           </div>\n        )}\n      </div>\n    </>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/insights/insight-card.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":50,"column":13,"nodeType":"JSXOpeningElement","endLine":54,"endColumn":15},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":58,"column":11,"nodeType":"JSXOpeningElement","endLine":62,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React from 'react';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { ShinyButton } from '@/components/ui/shiny-button';\nimport { Lock, Clock, TrendingUp, Zap, ShieldCheck } from 'lucide-react';\nimport Link from 'next/link';\nimport { useRouter } from 'next/navigation';\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\n\ninterface InsightCardProps {\n  id: string;\n  title: string;\n  subtitle: string;\n  duration: string;\n  locked: boolean;\n  category: string;\n  progress?: number;\n  featured?: boolean;\n  thumbnailUrl?: string;\n}\n\nexport function InsightCard({\n  id,\n  title,\n  subtitle,\n  duration,\n  locked,\n  category,\n  progress = 0,\n  thumbnailUrl,\n}: InsightCardProps) {\n  const router = useRouter();\n\n  const CardContentInner = () => (\n    <div className=\"flex flex-col h-full group/card\">\n      {/* Thumbnail / Poster Area - Vertical Aspect Ratio 9:16 */}\n      <div className=\"relative aspect-[9/16] w-full overflow-hidden rounded-md bg-muted/20\">\n        {thumbnailUrl ? (\n          <>\n            <img \n              src={thumbnailUrl} \n              alt={title} \n              className=\"absolute inset-0 w-full h-full object-cover transition-transform duration-500 group-hover/card:scale-105\"\n            />\n            <div className=\"absolute inset-0 bg-black/10 group-hover/card:bg-black/0 transition-colors\" />\n          </>\n        ) : (\n          <img \n            src={`https://picsum.photos/seed/${encodeURIComponent(id)}-sofia/360/640`} \n            alt={title} \n            className=\"absolute inset-0 w-full h-full object-cover transition-transform duration-500 group-hover/card:scale-105\"\n          />\n        )}\n\n        {/* Top Badges */}\n        <div className=\"absolute top-2 left-2 z-10\">\n          <Badge variant=\"secondary\" className=\"text-[10px] font-medium bg-black/60 backdrop-blur-sm text-white border-none hover:bg-black/80\">\n            {category}\n          </Badge>\n        </div>\n\n        {/* Lock Icon */}\n        {locked && (\n          <div className=\"absolute top-2 right-2 z-10 bg-black/60 backdrop-blur-sm p-1.5 rounded-full\">\n            <Lock className=\"w-3 h-3 text-white/80\" />\n          </div>\n        )}\n\n        {/* Progress Bar (Overlay at bottom of image) */}\n        {!locked && progress > 0 && (\n          <div className=\"absolute bottom-0 left-0 right-0 h-1 bg-black/50\">\n            <div \n              className=\"h-full bg-primary\" \n              style={{ width: `${progress}%` }} \n            />\n          </div>\n        )}\n\n        {/* Duration Badge (Bottom Right) */}\n        <div className=\"absolute bottom-2 right-2 bg-black/60 backdrop-blur-sm px-1.5 py-0.5 rounded text-[10px] text-white/90 font-medium flex items-center gap-1\">\n          <Clock className=\"w-3 h-3\" />\n          {duration}\n        </div>\n        \n        {/* Hover Overlay with Description (Desktop) */}\n        <div className=\"absolute inset-0 bg-black/80 opacity-0 group-hover/card:opacity-100 transition-opacity duration-300 p-4 flex flex-col justify-end hidden md:flex\">\n             <p className=\"text-xs text-white/90 line-clamp-4 leading-relaxed mb-2\">\n               {subtitle}\n             </p>\n             {locked && (\n                <div className=\"flex items-center gap-1.5 text-primary text-xs font-bold mt-2\">\n                   <Lock className=\"w-3 h-3\" />\n                   Exclusivo PRO\n                </div>\n             )}\n        </div>\n      </div>\n\n      {/* Content Below Image */}\n      <div className=\"pt-3 flex-1 flex flex-col\">\n        <h3 className=\"font-bold text-sm leading-tight text-foreground group-hover/card:text-primary transition-colors line-clamp-2 mb-1\">\n          {title}\n        </h3>\n        \n        {/* Mobile-only subtitle preview (very short) if needed, currently hiding to match \"clean\" look */}\n        \n        {/* Progress Text */}\n        {!locked && progress > 0 && (\n           <p className=\"text-[10px] text-primary font-medium mt-auto pt-1\">\n             {progress < 100 ? `${progress}% concluído` : 'Concluído'}\n           </p>\n        )}\n      </div>\n    </div>\n  );\n\n  if (locked) {\n    return (\n      <Dialog>\n        <DialogTrigger asChild>\n          <div className=\"cursor-pointer w-full h-full\">\n            <CardContentInner />\n          </div>\n        </DialogTrigger>\n\n        {/* Paywall Modal */}\n        <DialogContent className=\"sm:max-w-md border-primary/20 bg-background/95 backdrop-blur-xl\">\n          <DialogHeader>\n            <div className=\"mx-auto bg-primary/10 p-3 rounded-full mb-4 w-fit\">\n              <Lock className=\"w-8 h-8 text-primary\" />\n            </div>\n            <DialogTitle className=\"text-center text-2xl font-bold\">Conteúdo Exclusivo PRO</DialogTitle>\n            <DialogDescription className=\"text-center text-base pt-2\">\n              Este insight estratégico está reservado para membros do plano SOFIA PRO.\n            </DialogDescription>\n          </DialogHeader>\n          \n          <div className=\"space-y-4 py-4\">\n            <div className=\"flex items-center gap-3 p-3 rounded-lg bg-muted/50 border border-border/50\">\n              <Zap className=\"w-5 h-5 text-primary shrink-0\" />\n              <span className=\"text-sm\">Acesso a todos os aprendizados avançados</span>\n            </div>\n            <div className=\"flex items-center gap-3 p-3 rounded-lg bg-muted/50 border border-border/50\">\n              <ShieldCheck className=\"w-5 h-5 text-primary shrink-0\" />\n              <span className=\"text-sm\">Estratégias validadas por especialistas</span>\n            </div>\n            <div className=\"flex items-center gap-3 p-3 rounded-lg bg-muted/50 border border-border/50\">\n              <TrendingUp className=\"w-5 h-5 text-primary shrink-0\" />\n              <span className=\"text-sm\">Aumente sua assertividade com leitura profissional</span>\n            </div>\n          </div>\n\n          <DialogFooter className=\"sm:justify-center\">\n            <ShinyButton \n              className=\"w-full font-bold h-11 shadow-lg shadow-primary/20\"\n              onClick={() => window.location.href = 'https://pay.v1sofia.com/?plan=premium&price_id=sofia-premium-mensal'}\n            >\n              Ativar SOFIA PRO Agora\n            </ShinyButton>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    );\n  }\n\n  return (\n    <Link href={`/insights/${id}`} className=\"block w-full h-full\">\n      <CardContentInner />\n    </Link>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/insights/insights-carousel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/insights/insights-footer-cta.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/insights/insights-hero.backup.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/insights/insights-hero.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/layout/BrandSVG.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/layout/BrandSVGNew.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/layout/BrandTextLogo.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/layout/ClientTransitionOverlay.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'isSlowRoute' and 'pathname'. Either include them or remove the dependency array.","line":33,"column":6,"nodeType":"ArrayExpression","endLine":33,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [isSlowRoute, pathname]","fix":{"range":[803,805],"text":"[isSlowRoute, pathname]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'isSlowRoute'. Either include it or remove the dependency array.","line":42,"column":6,"nodeType":"ArrayExpression","endLine":42,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [isSlowRoute, pathname]","fix":{"range":[1022,1032],"text":"[isSlowRoute, pathname]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useEffect, useState } from 'react'\nimport { usePathname } from 'next/navigation'\nimport PageTransition from './PageTransition'\n\nexport default function ClientTransitionOverlay() {\n  const pathname = usePathname()\n\n  const slowRoutes = [\n    '/login',\n    '/register',\n    '/email-confirmation',\n    '/forgot-password',\n    '/reset-password',\n    '/account',\n    '/settings',\n    '/help',\n    '/community',\n    '/profile',\n    '/payment',\n  ]\n\n  const isSlowRoute = (path: string) => slowRoutes.some(p => path.startsWith(p))\n  const [visible, setVisible] = useState(isSlowRoute(pathname))\n\n  useEffect(() => {\n    if (isSlowRoute(pathname)) {\n      const timeout = setTimeout(() => setVisible(false), 1800)\n      return () => clearTimeout(timeout)\n    }\n    setVisible(false)\n  }, [])\n\n  useEffect(() => {\n    if (isSlowRoute(pathname)) {\n      setVisible(true)\n      const timeout = setTimeout(() => setVisible(false), 1800)\n      return () => clearTimeout(timeout)\n    }\n    setVisible(false)\n  }, [pathname])\n\n  return <PageTransition isVisible={visible} />\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/layout/ClientTransitionOverlayWithBackground.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'isSlowRoute' and 'pathname'. Either include them or remove the dependency array.","line":40,"column":6,"nodeType":"ArrayExpression","endLine":40,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [isSlowRoute, pathname]","fix":{"range":[1099,1101],"text":"[isSlowRoute, pathname]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'isSlowRoute'. Either include it or remove the dependency array.","line":51,"column":6,"nodeType":"ArrayExpression","endLine":51,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [isSlowRoute, pathname]","fix":{"range":[1461,1471],"text":"[isSlowRoute, pathname]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useEffect, useState } from 'react'\nimport { createPortal } from 'react-dom'\nimport { usePathname } from 'next/navigation'\nimport PageTransitionWithBackground from './PageTransitionWithBackground'\n\nexport default function ClientTransitionOverlayWithBackground() {\n  const pathname = usePathname()\n\n  const slowRoutes = [\n    '/login',\n    '/register',\n    '/email-confirmation',\n    '/forgot-password',\n    '/reset-password',\n    '/account',\n    '/settings',\n    '/help',\n    '/community',\n    '/profile',\n    '/payment',\n  ]\n\n  const isSlowRoute = (path: string) => {\n    // Garante que o dashboard nunca seja tratado como rota lenta\n    if (path.includes('/dashboard')) return false\n    return slowRoutes.some(p => path.startsWith(p))\n  }\n\n  const [visible, setVisible] = useState(false)\n\n  // Sincronizar estado inicial com a rota atual após montagem para evitar hydration mismatch\n  useEffect(() => {\n    if (isSlowRoute(pathname)) {\n      setVisible(true)\n      const timeout = setTimeout(() => setVisible(false), 1800)\n      return () => clearTimeout(timeout)\n    }\n  }, [])\n\n  // Exibir overlay apenas quando navegar para rotas lentas\n  useEffect(() => {\n    if (isSlowRoute(pathname)) {\n      setVisible(true)\n      const timeout = setTimeout(() => setVisible(false), 1800)\n      return () => clearTimeout(timeout)\n    }\n    // Garante que o overlay seja ocultado imediatamente ao sair de uma rota lenta\n    setVisible(false)\n  }, [pathname])\n\n  if (typeof document === 'undefined') return null\n  \n  return createPortal(\n    <PageTransitionWithBackground isVisible={visible} />,\n    document.body\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/layout/FaviconSVG.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/layout/LogoSofia.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/layout/LogoTransition.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/layout/PageTransition.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/layout/PageTransitionWithBackground.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/layout/netflix-top-bar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/lazy/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/lazy/lazy-analytics-dashboard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/lazy/lazy-component.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/lazy/lazy-dashboard-components.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/lazy/lazy-monitoring-dashboard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/lazy/lazy-rate-limit-dashboard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/logs/export-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/modals/premium-gate-modal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/monitoring/HealthMonitor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/monitoring/cache-dashboard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/monitoring/monitoring-dashboard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/monitoring/rate-limit-dashboard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/notifications/notification-settings.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/onboarding/onboarding-trigger.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/payments/boleto-form.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":1,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":146,"column":58,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[4982,5042],"text":"Baixe o boleto clicando no botão &quot;Baixar Boleto (PDF)\" acima"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[4982,5042],"text":"Baixe o boleto clicando no botão &ldquo;Baixar Boleto (PDF)\" acima"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[4982,5042],"text":"Baixe o boleto clicando no botão &#34;Baixar Boleto (PDF)\" acima"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[4982,5042],"text":"Baixe o boleto clicando no botão &rdquo;Baixar Boleto (PDF)\" acima"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":1,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":146,"column":78,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[4982,5042],"text":"Baixe o boleto clicando no botão \"Baixar Boleto (PDF)&quot; acima"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[4982,5042],"text":"Baixe o boleto clicando no botão \"Baixar Boleto (PDF)&ldquo; acima"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[4982,5042],"text":"Baixe o boleto clicando no botão \"Baixar Boleto (PDF)&#34; acima"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[4982,5042],"text":"Baixe o boleto clicando no botão \"Baixar Boleto (PDF)&rdquo; acima"},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Card, CardContent } from '@/components/ui/card';\r\nimport { FileText, Download, Calendar, AlertCircle, Loader2, CheckCircle } from 'lucide-react';\r\nimport { toast } from 'sonner';\r\n\r\ninterface BoletoFormProps {\r\n  amount: number;\r\n  onSubmit: (paymentData: any) => void;\r\n  loading?: boolean;\r\n  disabled?: boolean;\r\n}\r\n\r\nexport function BoletoForm({ amount, onSubmit, loading = false, disabled = false }: BoletoFormProps) {\r\n  const [boletoData, setBoletoData] = useState<{\r\n    url?: string;\r\n    barcode?: string;\r\n    dueDate?: string;\r\n    nossoNumero?: string;\r\n  } | null>(null);\r\n\r\n  const handleGenerateBoleto = async () => {\r\n    const dueDate = new Date();\r\n    dueDate.setDate(dueDate.getDate() + 3); // Vencimento em 3 dias\r\n\r\n    const paymentData = {\r\n      payment_method: 'boleto',\r\n      boleto: {\r\n        instructions: 'Pagamento referente à compra na SOFIA',\r\n        due_at: dueDate.toISOString(),\r\n      },\r\n      amount: amount,\r\n    };\r\n\r\n    onSubmit(paymentData);\r\n  };\r\n\r\n  const handleDownloadBoleto = () => {\r\n    if (boletoData?.url) {\r\n      window.open(boletoData.url, '_blank');\r\n    }\r\n  };\r\n\r\n  const copyBarcode = async () => {\r\n    if (boletoData?.barcode) {\r\n      try {\r\n        await navigator.clipboard.writeText(boletoData.barcode);\r\n        toast.success('Código de barras copiado!');\r\n      } catch (err) {\r\n        toast.error('Erro ao copiar código de barras');\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleSubmit = (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    handleGenerateBoleto();\r\n  };\r\n\r\n  const formatDueDate = (dateString: string) => {\r\n    const date = new Date(dateString);\r\n    return date.toLocaleDateString('pt-BR');\r\n  };\r\n\r\n  if (boletoData) {\r\n    return (\r\n      <div className=\"space-y-6\">\r\n        <Card>\r\n          <CardContent className=\"p-6\">\r\n            <div className=\"text-center space-y-4\">\r\n              <div className=\"flex items-center justify-center space-x-2\">\r\n                <CheckCircle className=\"w-6 h-6 text-green-600\" />\r\n                <h3 className=\"text-lg font-semibold\">Boleto Gerado com Sucesso!</h3>\r\n              </div>\r\n\r\n              <div className=\"space-y-4\">\r\n                <div className=\"text-center\">\r\n                  <p className=\"text-2xl font-bold\">\r\n                    R$ {(amount / 100).toFixed(2)}\r\n                  </p>\r\n                  {boletoData.dueDate && (\r\n                    <p className=\"text-sm text-muted-foreground\">\r\n                      Vencimento: {formatDueDate(boletoData.dueDate)}\r\n                    </p>\r\n                  )}\r\n                </div>\r\n\r\n                {boletoData.nossoNumero && (\r\n                  <div className=\"text-center\">\r\n                    <p className=\"text-sm text-muted-foreground\">\r\n                      Nosso Número: {boletoData.nossoNumero}\r\n                    </p>\r\n                  </div>\r\n                )}\r\n\r\n                <div className=\"flex flex-col space-y-3\">\r\n                  {boletoData.url && (\r\n                    <Button\r\n                      onClick={handleDownloadBoleto}\r\n                      className=\"w-full\"\r\n                      size=\"lg\"\r\n                    >\r\n                      <Download className=\"w-4 h-4 mr-2\" />\r\n                      Baixar Boleto (PDF)\r\n                    </Button>\r\n                  )}\r\n\r\n                  {boletoData.barcode && (\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      onClick={copyBarcode}\r\n                      className=\"w-full\"\r\n                    >\r\n                      <FileText className=\"w-4 h-4 mr-2\" />\r\n                      Copiar Código de Barras\r\n                    </Button>\r\n                  )}\r\n                </div>\r\n\r\n                {boletoData.barcode && (\r\n                  <div className=\"space-y-2\">\r\n                    <p className=\"text-sm font-medium\">Código de Barras:</p>\r\n                    <div className=\"p-3 bg-gray-50 rounded-lg border text-xs font-mono break-all\">\r\n                      {boletoData.barcode}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardContent className=\"p-6\">\r\n            <div className=\"space-y-4\">\r\n              <div className=\"flex items-center space-x-2\">\r\n                <AlertCircle className=\"w-5 h-5 text-orange-500\" />\r\n                <h4 className=\"font-medium\">Instruções de Pagamento</h4>\r\n              </div>\r\n\r\n              <ol className=\"text-sm text-muted-foreground space-y-2\">\r\n                <li className=\"flex items-start space-x-2\">\r\n                  <span className=\"flex-shrink-0 w-5 h-5 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-medium\">1</span>\r\n                  <span>Baixe o boleto clicando no botão \"Baixar Boleto (PDF)\" acima</span>\r\n                </li>\r\n                <li className=\"flex items-start space-x-2\">\r\n                  <span className=\"flex-shrink-0 w-5 h-5 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-medium\">2</span>\r\n                  <span>Pague em qualquer banco, casa lotérica ou pelo internet banking</span>\r\n                </li>\r\n                <li className=\"flex items-start space-x-2\">\r\n                  <span className=\"flex-shrink-0 w-5 h-5 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-medium\">3</span>\r\n                  <span>Você também pode usar o código de barras para pagamento via app do banco</span>\r\n                </li>\r\n                <li className=\"flex items-start space-x-2\">\r\n                  <span className=\"flex-shrink-0 w-5 h-5 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-medium\">4</span>\r\n                  <span>O pagamento será confirmado em até 2 dias úteis após a compensação</span>\r\n                </li>\r\n              </ol>\r\n\r\n              <div className=\"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg\">\r\n                <div className=\"flex items-start space-x-2\">\r\n                  <Calendar className=\"w-4 h-4 text-yellow-600 mt-0.5 flex-shrink-0\" />\r\n                  <div className=\"text-sm\">\r\n                    <p className=\"font-medium text-yellow-800\">Atenção ao prazo de vencimento</p>\r\n                    <p className=\"text-yellow-700\">\r\n                      Boletos vencidos não serão aceitos. Em caso de vencimento, \r\n                      será necessário gerar um novo boleto.\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <div className=\"text-xs text-muted-foreground text-center\">\r\n          <p>🔒 Boleto processado de forma segura via Pagar.me</p>\r\n          <p>Você receberá a confirmação por email assim que o pagamento for compensado</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n      <Card>\r\n        <CardContent className=\"p-6\">\r\n          <div className=\"text-center space-y-4\">\r\n            <div className=\"flex items-center justify-center space-x-2\">\r\n              <FileText className=\"w-8 h-8 text-blue-600\" />\r\n              <h3 className=\"text-xl font-semibold\">Pagamento via Boleto</h3>\r\n            </div>\r\n            \r\n            <p className=\"text-muted-foreground\">\r\n              Pague em qualquer banco, casa lotérica ou internet banking\r\n            </p>\r\n\r\n            <div className=\"text-center\">\r\n              <p className=\"text-2xl font-bold text-blue-600\">\r\n                R$ {(amount / 100).toFixed(2)}\r\n              </p>\r\n            </div>\r\n\r\n            <div className=\"space-y-3\">\r\n              <h4 className=\"font-medium text-left\">Informações do Boleto:</h4>\r\n              <ul className=\"text-sm text-muted-foreground space-y-2 text-left\">\r\n                <li className=\"flex items-center space-x-2\">\r\n                  <Calendar className=\"w-4 h-4 text-blue-600 flex-shrink-0\" />\r\n                  <span>Vencimento em 3 dias úteis</span>\r\n                </li>\r\n                <li className=\"flex items-center space-x-2\">\r\n                  <CheckCircle className=\"w-4 h-4 text-green-600 flex-shrink-0\" />\r\n                  <span>Sem taxas adicionais</span>\r\n                </li>\r\n                <li className=\"flex items-center space-x-2\">\r\n                  <CheckCircle className=\"w-4 h-4 text-green-600 flex-shrink-0\" />\r\n                  <span>Confirmação em até 2 dias úteis</span>\r\n                </li>\r\n                <li className=\"flex items-center space-x-2\">\r\n                  <CheckCircle className=\"w-4 h-4 text-green-600 flex-shrink-0\" />\r\n                  <span>Pagamento em qualquer banco</span>\r\n                </li>\r\n              </ul>\r\n            </div>\r\n\r\n            <div className=\"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg\">\r\n              <div className=\"flex items-start space-x-2\">\r\n                <AlertCircle className=\"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0\" />\r\n                <div className=\"text-sm text-left\">\r\n                  <p className=\"font-medium text-blue-800\">Como funciona:</p>\r\n                  <p className=\"text-blue-700\">\r\n                    Após gerar o boleto, você poderá baixá-lo em PDF ou copiar o código de barras \r\n                    para pagamento via app do banco.\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      <Button\r\n        type=\"submit\"\r\n        className=\"w-full\"\r\n        disabled={loading || disabled}\r\n        size=\"lg\"\r\n      >\r\n        {loading ? (\r\n          <>\r\n            <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\r\n            Gerando Boleto...\r\n          </>\r\n        ) : (\r\n          <>\r\n            <FileText className=\"w-4 h-4 mr-2\" />\r\n            Gerar Boleto\r\n          </>\r\n        )}\r\n      </Button>\r\n\r\n      <div className=\"text-xs text-muted-foreground text-center\">\r\n        <p>🔒 Transação segura processada via Pagar.me</p>\r\n      </div>\r\n    </form>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/payments/checkout-form.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/payments/credit-card-form.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/payments/pagarme-checkout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/payments/pix-form.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":104,"column":19,"nodeType":"JSXOpeningElement","endLine":108,"endColumn":21},{"ruleId":"react/no-unescaped-entities","severity":1,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":157,"column":43,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[5548,5605],"text":"Escolha a opção PIX e &quot;Ler QR Code\" ou \"PIX Copia e Cola\""},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[5548,5605],"text":"Escolha a opção PIX e &ldquo;Ler QR Code\" ou \"PIX Copia e Cola\""},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[5548,5605],"text":"Escolha a opção PIX e &#34;Ler QR Code\" ou \"PIX Copia e Cola\""},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[5548,5605],"text":"Escolha a opção PIX e &rdquo;Ler QR Code\" ou \"PIX Copia e Cola\""},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":1,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":157,"column":55,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[5548,5605],"text":"Escolha a opção PIX e \"Ler QR Code&quot; ou \"PIX Copia e Cola\""},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[5548,5605],"text":"Escolha a opção PIX e \"Ler QR Code&ldquo; ou \"PIX Copia e Cola\""},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[5548,5605],"text":"Escolha a opção PIX e \"Ler QR Code&#34; ou \"PIX Copia e Cola\""},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[5548,5605],"text":"Escolha a opção PIX e \"Ler QR Code&rdquo; ou \"PIX Copia e Cola\""},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":1,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":157,"column":60,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[5548,5605],"text":"Escolha a opção PIX e \"Ler QR Code\" ou &quot;PIX Copia e Cola\""},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[5548,5605],"text":"Escolha a opção PIX e \"Ler QR Code\" ou &ldquo;PIX Copia e Cola\""},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[5548,5605],"text":"Escolha a opção PIX e \"Ler QR Code\" ou &#34;PIX Copia e Cola\""},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[5548,5605],"text":"Escolha a opção PIX e \"Ler QR Code\" ou &rdquo;PIX Copia e Cola\""},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":1,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":157,"column":77,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[5548,5605],"text":"Escolha a opção PIX e \"Ler QR Code\" ou \"PIX Copia e Cola&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[5548,5605],"text":"Escolha a opção PIX e \"Ler QR Code\" ou \"PIX Copia e Cola&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[5548,5605],"text":"Escolha a opção PIX e \"Ler QR Code\" ou \"PIX Copia e Cola&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[5548,5605],"text":"Escolha a opção PIX e \"Ler QR Code\" ou \"PIX Copia e Cola&rdquo;"},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Card, CardContent } from '@/components/ui/card';\r\nimport { QrCode, Copy, CheckCircle, Loader2, Clock } from 'lucide-react';\r\nimport { toast } from 'sonner';\r\n\r\ninterface PixFormProps {\r\n  amount: number;\r\n  onSubmit: (paymentData: any) => void;\r\n  loading?: boolean;\r\n  disabled?: boolean;\r\n}\r\n\r\nexport function PixForm({ amount, onSubmit, loading = false, disabled = false }: PixFormProps) {\r\n  const [pixData, setPixData] = useState<{\r\n    qrCode?: string;\r\n    qrCodeText?: string;\r\n    expiresAt?: string;\r\n  } | null>(null);\r\n  const [copied, setCopied] = useState(false);\r\n  const [timeLeft, setTimeLeft] = useState<number | null>(null);\r\n\r\n  useEffect(() => {\r\n    let interval: NodeJS.Timeout;\r\n    \r\n    if (pixData?.expiresAt && timeLeft !== null) {\r\n      interval = setInterval(() => {\r\n        const now = new Date().getTime();\r\n        const expiry = new Date(pixData.expiresAt!).getTime();\r\n        const difference = expiry - now;\r\n        \r\n        if (difference > 0) {\r\n          setTimeLeft(Math.floor(difference / 1000));\r\n        } else {\r\n          setTimeLeft(0);\r\n          clearInterval(interval);\r\n        }\r\n      }, 1000);\r\n    }\r\n\r\n    return () => {\r\n      if (interval) clearInterval(interval);\r\n    };\r\n  }, [pixData?.expiresAt, timeLeft]);\r\n\r\n  const formatTime = (seconds: number) => {\r\n    const minutes = Math.floor(seconds / 60);\r\n    const remainingSeconds = seconds % 60;\r\n    return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;\r\n  };\r\n\r\n  const handleGeneratePix = async () => {\r\n    const paymentData = {\r\n      payment_method: 'pix',\r\n      pix: {\r\n        expires_in: 3600, // 1 hora\r\n      },\r\n      amount: amount,\r\n    };\r\n\r\n    onSubmit(paymentData);\r\n  };\r\n\r\n  const copyToClipboard = async (text: string) => {\r\n    try {\r\n      await navigator.clipboard.writeText(text);\r\n      setCopied(true);\r\n      toast.success('Código PIX copiado!');\r\n      setTimeout(() => setCopied(false), 2000);\r\n    } catch (err) {\r\n      toast.error('Erro ao copiar código PIX');\r\n    }\r\n  };\r\n\r\n  const handleSubmit = (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    handleGeneratePix();\r\n  };\r\n\r\n  if (pixData) {\r\n    return (\r\n      <div className=\"space-y-6\">\r\n        <Card>\r\n          <CardContent className=\"p-6\">\r\n            <div className=\"text-center space-y-4\">\r\n              <div className=\"flex items-center justify-center space-x-2\">\r\n                <QrCode className=\"w-5 h-5 text-green-600\" />\r\n                <h3 className=\"text-lg font-semibold\">PIX Gerado com Sucesso!</h3>\r\n              </div>\r\n              \r\n              {timeLeft !== null && timeLeft > 0 && (\r\n                <div className=\"flex items-center justify-center space-x-2 text-orange-600\">\r\n                  <Clock className=\"w-4 h-4\" />\r\n                  <span className=\"text-sm\">\r\n                    Expira em: {formatTime(timeLeft)}\r\n                  </span>\r\n                </div>\r\n              )}\r\n\r\n              {pixData.qrCode && (\r\n                <div className=\"flex justify-center\">\r\n                  <img \r\n                    src={`data:image/png;base64,${pixData.qrCode}`}\r\n                    alt=\"QR Code PIX\"\r\n                    className=\"w-64 h-64 border rounded-lg\"\r\n                  />\r\n                </div>\r\n              )}\r\n\r\n              <div className=\"space-y-2\">\r\n                <p className=\"text-sm text-muted-foreground\">\r\n                  Escaneie o QR Code com seu app do banco ou copie o código abaixo:\r\n                </p>\r\n                \r\n                {pixData.qrCodeText && (\r\n                  <div className=\"relative\">\r\n                    <div className=\"p-3 bg-gray-50 rounded-lg border text-xs font-mono break-all\">\r\n                      {pixData.qrCodeText}\r\n                    </div>\r\n                    <Button\r\n                      type=\"button\"\r\n                      variant=\"outline\"\r\n                      size=\"sm\"\r\n                      className=\"absolute top-2 right-2\"\r\n                      onClick={() => copyToClipboard(pixData.qrCodeText!)}\r\n                    >\r\n                      {copied ? (\r\n                        <CheckCircle className=\"w-4 h-4 text-green-600\" />\r\n                      ) : (\r\n                        <Copy className=\"w-4 h-4\" />\r\n                      )}\r\n                    </Button>\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              <div className=\"text-center\">\r\n                <p className=\"text-lg font-semibold\">\r\n                  Valor: R$ {(amount / 100).toFixed(2)}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <div className=\"space-y-3\">\r\n          <h4 className=\"font-medium\">Como pagar com PIX:</h4>\r\n          <ol className=\"text-sm text-muted-foreground space-y-2\">\r\n            <li className=\"flex items-start space-x-2\">\r\n              <span className=\"flex-shrink-0 w-5 h-5 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-medium\">1</span>\r\n              <span>Abra o app do seu banco ou carteira digital</span>\r\n            </li>\r\n            <li className=\"flex items-start space-x-2\">\r\n              <span className=\"flex-shrink-0 w-5 h-5 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-medium\">2</span>\r\n              <span>Escolha a opção PIX e \"Ler QR Code\" ou \"PIX Copia e Cola\"</span>\r\n            </li>\r\n            <li className=\"flex items-start space-x-2\">\r\n              <span className=\"flex-shrink-0 w-5 h-5 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-medium\">3</span>\r\n              <span>Escaneie o QR Code ou cole o código copiado</span>\r\n            </li>\r\n            <li className=\"flex items-start space-x-2\">\r\n              <span className=\"flex-shrink-0 w-5 h-5 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-medium\">4</span>\r\n              <span>Confirme o pagamento no seu app</span>\r\n            </li>\r\n          </ol>\r\n        </div>\r\n\r\n        <div className=\"text-xs text-muted-foreground text-center\">\r\n          <p>🔒 Pagamento processado de forma segura via Pagar.me</p>\r\n          <p>Você receberá a confirmação por email assim que o pagamento for aprovado</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n      <Card>\r\n        <CardContent className=\"p-6\">\r\n          <div className=\"text-center space-y-4\">\r\n            <div className=\"flex items-center justify-center space-x-2\">\r\n              <QrCode className=\"w-8 h-8 text-blue-600\" />\r\n              <h3 className=\"text-xl font-semibold\">Pagamento via PIX</h3>\r\n            </div>\r\n            \r\n            <p className=\"text-muted-foreground\">\r\n              Pague de forma rápida e segura com PIX\r\n            </p>\r\n\r\n            <div className=\"text-center\">\r\n              <p className=\"text-2xl font-bold text-green-600\">\r\n                R$ {(amount / 100).toFixed(2)}\r\n              </p>\r\n            </div>\r\n\r\n            <div className=\"space-y-3\">\r\n              <h4 className=\"font-medium text-left\">Vantagens do PIX:</h4>\r\n              <ul className=\"text-sm text-muted-foreground space-y-2 text-left\">\r\n                <li className=\"flex items-center space-x-2\">\r\n                  <CheckCircle className=\"w-4 h-4 text-green-600 flex-shrink-0\" />\r\n                  <span>Pagamento instantâneo</span>\r\n                </li>\r\n                <li className=\"flex items-center space-x-2\">\r\n                  <CheckCircle className=\"w-4 h-4 text-green-600 flex-shrink-0\" />\r\n                  <span>Disponível 24h por dia, 7 dias por semana</span>\r\n                </li>\r\n                <li className=\"flex items-center space-x-2\">\r\n                  <CheckCircle className=\"w-4 h-4 text-green-600 flex-shrink-0\" />\r\n                  <span>Sem taxas adicionais</span>\r\n                </li>\r\n                <li className=\"flex items-center space-x-2\">\r\n                  <CheckCircle className=\"w-4 h-4 text-green-600 flex-shrink-0\" />\r\n                  <span>Confirmação imediata</span>\r\n                </li>\r\n              </ul>\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      <Button\r\n        type=\"submit\"\r\n        className=\"w-full\"\r\n        disabled={loading || disabled}\r\n        size=\"lg\"\r\n      >\r\n        {loading ? (\r\n          <>\r\n            <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\r\n            Gerando PIX...\r\n          </>\r\n        ) : (\r\n          <>\r\n            <QrCode className=\"w-4 h-4 mr-2\" />\r\n            Gerar PIX\r\n          </>\r\n        )}\r\n      </Button>\r\n\r\n      <div className=\"text-xs text-muted-foreground text-center\">\r\n        <p>🔒 Transação segura processada via Pagar.me</p>\r\n      </div>\r\n    </form>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/providers.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/providers/MonitoringProvider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/providers/analytics-provider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/FuturisticButtonSVG.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/GlowRing.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/accordion.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/alert-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/alert.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/aspect-ratio.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/avatar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/badge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/breadcrumb.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/calendar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/carousel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/chart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/checkbox.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/collapsible.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/command.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/context-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/drawer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/dropdown-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/etheral-shadow.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/form.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/hover-card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/input-otp.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/label.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/lazy-wrapper.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/loading-overlay.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/loading-spinner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/menubar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/mobile-navigation.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/navigation-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/pagination.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/particles-background.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/popover.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/progress.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/radio-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/resizable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/responsive-container.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":247,"column":5,"nodeType":"JSXOpeningElement","endLine":257,"endColumn":7}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React from 'react';\r\nimport { cn } from '@/lib/utils';\r\n\r\ninterface ResponsiveContainerProps {\r\n  children: React.ReactNode;\r\n  className?: string;\r\n  maxWidth?: 'sm' | 'md' | 'lg' | 'xl' | '2xl' | 'full';\r\n  padding?: 'none' | 'sm' | 'md' | 'lg' | 'xl';\r\n  center?: boolean;\r\n  breakpoint?: 'mobile' | 'tablet' | 'desktop' | 'all';\r\n}\r\n\r\nconst maxWidthClasses = {\r\n  sm: 'max-w-sm',\r\n  md: 'max-w-md',\r\n  lg: 'max-w-lg',\r\n  xl: 'max-w-xl',\r\n  '2xl': 'max-w-2xl',\r\n  full: 'max-w-full'\r\n};\r\n\r\nconst paddingClasses = {\r\n  none: '',\r\n  sm: 'px-2 py-1 sm:px-4 sm:py-2',\r\n  md: 'px-4 py-2 sm:px-6 sm:py-4',\r\n  lg: 'px-6 py-4 sm:px-8 sm:py-6',\r\n  xl: 'px-8 py-6 sm:px-12 sm:py-8'\r\n};\r\n\r\nconst breakpointClasses = {\r\n  mobile: 'block sm:hidden',\r\n  tablet: 'hidden sm:block lg:hidden',\r\n  desktop: 'hidden lg:block',\r\n  all: 'block'\r\n};\r\n\r\nexport const ResponsiveContainer: React.FC<ResponsiveContainerProps> = ({\r\n  children,\r\n  className,\r\n  maxWidth = 'full',\r\n  padding = 'md',\r\n  center = false,\r\n  breakpoint = 'all'\r\n}) => {\r\n  return (\r\n    <div\r\n      className={cn(\r\n        'w-full',\r\n        maxWidthClasses[maxWidth],\r\n        paddingClasses[padding],\r\n        breakpointClasses[breakpoint],\r\n        center && 'mx-auto',\r\n        className\r\n      )}\r\n    >\r\n      {children}\r\n    </div>\r\n  );\r\n};\r\n\r\n// Hook para detectar breakpoints\r\nexport const useBreakpoint = () => {\r\n  const [breakpoint, setBreakpoint] = React.useState<'mobile' | 'tablet' | 'desktop'>('desktop');\r\n\r\n  React.useEffect(() => {\r\n    const checkBreakpoint = () => {\r\n      const width = window.innerWidth;\r\n      if (width < 640) {\r\n        setBreakpoint('mobile');\r\n      } else if (width < 1024) {\r\n        setBreakpoint('tablet');\r\n      } else {\r\n        setBreakpoint('desktop');\r\n      }\r\n    };\r\n\r\n    checkBreakpoint();\r\n    window.addEventListener('resize', checkBreakpoint);\r\n\r\n    return () => window.removeEventListener('resize', checkBreakpoint);\r\n  }, []);\r\n\r\n  return {\r\n    breakpoint,\r\n    isMobile: breakpoint === 'mobile',\r\n    isTablet: breakpoint === 'tablet',\r\n    isDesktop: breakpoint === 'desktop',\r\n    isMobileOrTablet: breakpoint === 'mobile' || breakpoint === 'tablet'\r\n  };\r\n};\r\n\r\n// Componente para grid responsivo\r\ninterface ResponsiveGridProps {\r\n  children: React.ReactNode;\r\n  className?: string;\r\n  cols?: {\r\n    mobile?: number;\r\n    tablet?: number;\r\n    desktop?: number;\r\n  };\r\n  gap?: 'sm' | 'md' | 'lg' | 'xl';\r\n}\r\n\r\nconst gapClasses = {\r\n  sm: 'gap-2',\r\n  md: 'gap-4',\r\n  lg: 'gap-6',\r\n  xl: 'gap-8'\r\n};\r\n\r\nexport const ResponsiveGrid: React.FC<ResponsiveGridProps> = ({\r\n  children,\r\n  className,\r\n  cols = { mobile: 1, tablet: 2, desktop: 3 },\r\n  gap = 'md'\r\n}) => {\r\n  const gridCols = `grid-cols-${cols.mobile} sm:grid-cols-${cols.tablet} lg:grid-cols-${cols.desktop}`;\r\n\r\n  return (\r\n    <div\r\n      className={cn(\r\n        'grid',\r\n        gridCols,\r\n        gapClasses[gap],\r\n        className\r\n      )}\r\n    >\r\n      {children}\r\n    </div>\r\n  );\r\n};\r\n\r\n// Componente para texto responsivo\r\ninterface ResponsiveTextProps {\r\n  children: React.ReactNode;\r\n  className?: string;\r\n  size?: {\r\n    mobile?: 'xs' | 'sm' | 'base' | 'lg' | 'xl';\r\n    tablet?: 'xs' | 'sm' | 'base' | 'lg' | 'xl';\r\n    desktop?: 'xs' | 'sm' | 'base' | 'lg' | 'xl';\r\n  };\r\n  weight?: 'normal' | 'medium' | 'semibold' | 'bold';\r\n  align?: 'left' | 'center' | 'right';\r\n}\r\n\r\nconst sizeClasses = {\r\n  xs: 'text-xs',\r\n  sm: 'text-sm',\r\n  base: 'text-base',\r\n  lg: 'text-lg',\r\n  xl: 'text-xl'\r\n};\r\n\r\nconst weightClasses = {\r\n  normal: 'font-normal',\r\n  medium: 'font-medium',\r\n  semibold: 'font-semibold',\r\n  bold: 'font-bold'\r\n};\r\n\r\nconst alignClasses = {\r\n  left: 'text-left',\r\n  center: 'text-center',\r\n  right: 'text-right'\r\n};\r\n\r\nexport const ResponsiveText: React.FC<ResponsiveTextProps> = ({\r\n  children,\r\n  className,\r\n  size = { mobile: 'sm', tablet: 'base', desktop: 'lg' },\r\n  weight = 'normal',\r\n  align = 'left'\r\n}) => {\r\n  const responsiveSize = `${sizeClasses[size.mobile || 'sm']} sm:${sizeClasses[size.tablet || 'base']} lg:${sizeClasses[size.desktop || 'lg']}`;\r\n\r\n  return (\r\n    <span\r\n      className={cn(\r\n        responsiveSize,\r\n        weightClasses[weight],\r\n        alignClasses[align],\r\n        className\r\n      )}\r\n    >\r\n      {children}\r\n    </span>\r\n  );\r\n};\r\n\r\n// Hook para orientação do dispositivo\r\nexport const useOrientation = () => {\r\n  const [orientation, setOrientation] = React.useState<'portrait' | 'landscape'>('portrait');\r\n\r\n  React.useEffect(() => {\r\n    const checkOrientation = () => {\r\n      setOrientation(window.innerHeight > window.innerWidth ? 'portrait' : 'landscape');\r\n    };\r\n\r\n    checkOrientation();\r\n    window.addEventListener('resize', checkOrientation);\r\n    window.addEventListener('orientationchange', checkOrientation);\r\n\r\n    return () => {\r\n      window.removeEventListener('resize', checkOrientation);\r\n      window.removeEventListener('orientationchange', checkOrientation);\r\n    };\r\n  }, []);\r\n\r\n  return {\r\n    orientation,\r\n    isPortrait: orientation === 'portrait',\r\n    isLandscape: orientation === 'landscape'\r\n  };\r\n};\r\n\r\n// Componente para imagens responsivas\r\ninterface ResponsiveImageProps {\r\n  src: string;\r\n  alt: string;\r\n  className?: string;\r\n  sizes?: {\r\n    mobile?: string;\r\n    tablet?: string;\r\n    desktop?: string;\r\n  };\r\n  priority?: boolean;\r\n  loading?: 'lazy' | 'eager';\r\n}\r\n\r\nexport const ResponsiveImage: React.FC<ResponsiveImageProps> = ({\r\n  src,\r\n  alt,\r\n  className,\r\n  sizes = {\r\n    mobile: '100vw',\r\n    tablet: '50vw',\r\n    desktop: '33vw'\r\n  },\r\n  priority = false,\r\n  loading = 'lazy'\r\n}) => {\r\n  const sizesString = `(max-width: 640px) ${sizes.mobile}, (max-width: 1024px) ${sizes.tablet}, ${sizes.desktop}`;\r\n\r\n  return (\r\n    <img\r\n      src={src}\r\n      alt={alt}\r\n      sizes={sizesString}\r\n      loading={loading}\r\n      className={cn(\r\n        'w-full h-auto object-cover',\r\n        className\r\n      )}\r\n      {...(priority && { fetchPriority: 'high' })}\r\n    />\r\n  );\r\n};\r\n\r\n// Hook para detecção de touch\r\nexport const useTouch = () => {\r\n  const [isTouch, setIsTouch] = React.useState(false);\r\n\r\n  React.useEffect(() => {\r\n    const checkTouch = () => {\r\n      setIsTouch('ontouchstart' in window || navigator.maxTouchPoints > 0);\r\n    };\r\n\r\n    checkTouch();\r\n  }, []);\r\n\r\n  return { isTouch };\r\n};\r\n\r\n// Componente para espaçamento responsivo\r\ninterface ResponsiveSpacerProps {\r\n  size?: {\r\n    mobile?: number;\r\n    tablet?: number;\r\n    desktop?: number;\r\n  };\r\n  direction?: 'horizontal' | 'vertical';\r\n}\r\n\r\nexport const ResponsiveSpacer: React.FC<ResponsiveSpacerProps> = ({\r\n  size = { mobile: 4, tablet: 6, desktop: 8 },\r\n  direction = 'vertical'\r\n}) => {\r\n  const spacingClass = direction === 'vertical' \r\n    ? `h-${size.mobile} sm:h-${size.tablet} lg:h-${size.desktop}`\r\n    : `w-${size.mobile} sm:w-${size.tablet} lg:w-${size.desktop}`;\r\n\r\n  return <div className={spacingClass} />;\r\n};","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/scroll-area.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/separator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/sheet.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/shiny-button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/slider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/sonner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/switch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/table.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/tabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/textarea.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/toast.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/toaster.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/toggle-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/toggle.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/tooltip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/ui/video-player.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":158,"column":11,"nodeType":"JSXOpeningElement","endLine":162,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport * as React from \"react\";\nimport { cn } from \"@/lib/utils\";\nimport { Play, X } from \"lucide-react\";\n\n// Interface for component props\ninterface VideoPlayerProps extends React.HTMLAttributes<HTMLDivElement> {\n  thumbnailUrl: string;\n  videoUrl: string;\n  muxEmbedUrl?: string;\n  title: string;\n  description?: string;\n  aspectRatio?: \"16/9\" | \"4/3\" | \"1/1\";\n  lessonId?: string;\n}\n\nfunction getEmbedUrl(url: string) {\n  if (!url) return \"\";\n  \n  const cleanUrl = url.trim();\n\n  try {\n    // Handle already embedded URLs\n    if (cleanUrl.includes(\"youtube.com/embed/\")) return cleanUrl;\n\n    let videoId = \"\";\n    \n    // Handle standard watch URLs\n    if (cleanUrl.includes(\"youtube.com/watch\")) {\n      const urlObj = new URL(cleanUrl);\n      videoId = urlObj.searchParams.get(\"v\") || \"\";\n    } \n    // Handle short URLs\n    else if (cleanUrl.includes(\"youtu.be/\")) {\n      const urlParts = cleanUrl.split(\"youtu.be/\");\n      if (urlParts[1]) {\n        videoId = urlParts[1].split(\"?\")[0];\n      }\n    }\n\n    if (videoId) {\n      return `https://www.youtube.com/embed/${videoId}?rel=0&autoplay=1`;\n    }\n  } catch (e) {\n    console.error(\"Error parsing video URL:\", e);\n  }\n\n  return cleanUrl;\n}\n\nconst VideoPlayer = React.forwardRef<HTMLDivElement, VideoPlayerProps>(\n  (\n    {\n      className,\n      thumbnailUrl,\n      videoUrl,\n      muxEmbedUrl,\n      title,\n      description,\n      aspectRatio = \"16/9\",\n      lessonId,\n      ...props\n    },\n    ref\n  ) => {\n    // State to manage the visibility of the video modal\n    const [isModalOpen, setIsModalOpen] = React.useState(false);\n    const progressInterval = React.useRef<NodeJS.Timeout | null>(null);\n\n    // Track progress when modal is open\n    React.useEffect(() => {\n      if (isModalOpen && lessonId) {\n        // Start tracking\n        let seconds = 0;\n        progressInterval.current = setInterval(() => {\n          seconds += 10;\n          fetch('/api/lessons/progress', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              lessonId,\n              watchedSeconds: seconds,\n              completed: false // Logic for completion can be added later\n            })\n          }).catch(err => console.error('Failed to update progress', err));\n        }, 10000); // Update every 10 seconds\n      } else {\n        if (progressInterval.current) {\n          clearInterval(progressInterval.current);\n        }\n      }\n\n      return () => {\n        if (progressInterval.current) {\n          clearInterval(progressInterval.current);\n        }\n      };\n    }, [isModalOpen, lessonId]);\n\n    // Helper to add autoplay to Mux URL and remove title\n    const getMuxUrlWithAutoplay = (url?: string) => {\n      if (!url) return undefined;\n      try {\n        const urlObj = new URL(url);\n        urlObj.searchParams.set('autoplay', 'true');\n        // Remove title from player UI to avoid duplication\n        urlObj.searchParams.delete('video-title');\n        return urlObj.toString();\n      } catch (e) {\n        const hasParams = url.includes('?');\n        return `${url}${hasParams ? '&' : '?'}autoplay=true`;\n      }\n    };\n\n    const finalVideoUrl = muxEmbedUrl ? getMuxUrlWithAutoplay(muxEmbedUrl) : getEmbedUrl(videoUrl);\n\n    // Effect to handle the 'Escape' key press for closing the modal\n    React.useEffect(() => {\n      const handleEsc = (event: KeyboardEvent) => {\n        if (event.key === \"Escape\") {\n          setIsModalOpen(false);\n        }\n      };\n      window.addEventListener(\"keydown\", handleEsc);\n      return () => {\n        window.removeEventListener(\"keydown\", handleEsc);\n      };\n    }, []);\n\n    // Prevent body scroll when modal is open\n    React.useEffect(() => {\n        if (isModalOpen) {\n            document.body.style.overflow = 'hidden';\n        } else {\n            document.body.style.overflow = 'auto';\n        }\n    }, [isModalOpen]);\n\n\n    return (\n      <>\n        <div\n          ref={ref}\n          className={cn(\n            \"group relative cursor-pointer overflow-hidden rounded-lg shadow-lg\",\n            \"focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n            className\n          )}\n          style={{ aspectRatio }}\n          onClick={() => setIsModalOpen(true)}\n          onKeyDown={(e) => e.key === \"Enter\" && setIsModalOpen(true)}\n          tabIndex={0}\n          aria-label={`Play video: ${title}`}\n          {...props}\n        >\n          {/* Thumbnail Image */}\n          <img\n            src={thumbnailUrl}\n            alt={`Thumbnail for ${title}`}\n            className=\"h-full w-full object-cover transition-transform duration-300 group-hover:scale-105\"\n          />\n          {/* Overlay Gradient */}\n          <div className=\"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent\" />\n\n          {/* Play Button */}\n          <div className=\"absolute inset-0 flex items-center justify-center\">\n            <div className=\"flex h-16 w-16 items-center justify-center rounded-full bg-white/20 backdrop-blur-sm transition-all duration-300 group-hover:scale-110 group-hover:bg-white/30\">\n              <Play className=\"h-8 w-8 fill-white text-white\" />\n            </div>\n          </div>\n\n          {/* Title and Description */}\n          <div className=\"absolute bottom-0 left-0 p-6\">\n            <h3 className=\"text-2xl font-bold text-white\">{title}</h3>\n            {description && (\n              <p className=\"mt-1 text-sm text-white/80\">{description}</p>\n            )}\n          </div>\n        </div>\n\n        {/* Video Modal */}\n      {isModalOpen && (\n        <div\n          className=\"fixed inset-0 z-[9999] flex animate-in fade-in-0 items-center justify-center bg-black/80 backdrop-blur-sm\"\n          aria-modal=\"true\"\n          role=\"dialog\"\n        >\n          {/* Close Button */}\n          <button\n            onClick={(e) => {\n              e.stopPropagation();\n              setIsModalOpen(false);\n            }}\n            className=\"absolute right-6 top-6 z-50 rounded-full bg-white/10 p-2 text-white transition-colors hover:bg-white/20\"\n            aria-label=\"Close video player\"\n          >\n            <X className=\"h-8 w-8\" />\n          </button>\n\n          {/* Video Iframe */}\n          <div className=\"w-full max-w-5xl aspect-video relative mx-4\">\n             <iframe\n                  src={finalVideoUrl}\n                  title={title}\n                  frameBorder=\"0\"\n                  allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n                  allowFullScreen\n                  referrerPolicy=\"origin\"\n                  className=\"h-full w-full rounded-xl shadow-2xl\"\n              ></iframe>\n          </div>\n            \n            {/* Click outside to close */}\n            <div \n                className=\"absolute inset-0 -z-10\" \n                onClick={() => setIsModalOpen(false)}\n            />\n          </div>\n        )}\n      </>\n    );\n  }\n);\nVideoPlayer.displayName = \"VideoPlayer\";\n\nexport { VideoPlayer };\n","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/components/websocket/LiveDataDashboard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/contexts/auth-context.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'AUTH_DEV_BYPASS'. Either include it or remove the dependency array.","line":233,"column":6,"nodeType":"ArrayExpression","endLine":233,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [AUTH_DEV_BYPASS]","fix":{"range":[9095,9097],"text":"[AUTH_DEV_BYPASS]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { createContext, useContext, useState, useEffect } from 'react';\r\nimport { usePathname, useRouter } from 'next/navigation';\r\nimport { supabase } from '@/lib/supabase';\r\nimport { toast } from 'sonner';\r\nimport type { User as SupabaseUser } from '@supabase/supabase-js';\r\nimport { getUserProfile } from '@/lib/user-profiles-integration';\r\n\r\ninterface User {\r\n  id: string;\r\n  name: string;\r\n  email: string;\r\n  avatar?: string;\r\n  cpf?: string;\r\n  fullName?: string;\r\n}\r\n\r\ninterface AuthContextType {\r\n  user: User | null;\r\n  login: (email: string, password: string) => Promise<boolean>;\r\n  register: (name: string, email: string, password: string, cpf?: string, fullName?: string, confirmPassword?: string) => Promise<boolean>;\r\n  logout: () => Promise<void>;\r\n  getToken: () => Promise<string | null>;\r\n  isLoading: boolean;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\r\n\r\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\r\n  const pathname = usePathname();\r\n  const router = useRouter();\r\n  const [user, setUser] = useState<User | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const isLoggingOutRef = React.useRef(false);\r\n  const AUTH_DEV_BYPASS = process.env.NEXT_PUBLIC_AUTH_DEV_BYPASS === 'true';\r\n\r\n  // Função para converter usuário do Supabase para o formato local, buscando dados atualizados do perfil\r\n  const fetchAndConvertUser = async (supabaseUser: SupabaseUser): Promise<User> => {\r\n    let profileData = null;\r\n    try {\r\n      profileData = await getUserProfile(supabaseUser.id);\r\n      console.log('Dados do perfil sincronizados:', profileData);\r\n    } catch (e: any) {\r\n      // Tentar recuperar criando o perfil automaticamente\r\n      // Suprimir toast de erro de permissão pois o sistema tentará corrigir\r\n      const isProfileNotFound =\r\n        e?.code === 'PROFILE_NOT_FOUND' || e?.message === 'PROFILE_NOT_FOUND';\r\n      const isPermissionError = e.message && (e.message.includes('permission') || e.message.includes('policy'));\r\n      if (!isPermissionError && !isProfileNotFound) {\r\n        // Logar outros erros que não sejam de permissão/RLS\r\n        console.error('Error fetching user profile:', e);\r\n      } else {\r\n        console.warn('Perfil não encontrado ou erro de permissão (RLS). Tentando criar perfil via RPC...');\r\n      }\r\n\r\n      try {\r\n        await supabase.rpc('insert_user_profile_on_registration', {\r\n          p_user_id: supabaseUser.id,\r\n          p_full_name: supabaseUser.user_metadata?.full_name || supabaseUser.user_metadata?.name || supabaseUser.email?.split('@')[0] || 'Usuário',\r\n          p_cpf: supabaseUser.user_metadata?.cpf || '',\r\n          p_email: supabaseUser.email || ''\r\n        });\r\n        const { data } = await supabase\r\n          .from('user_profiles')\r\n          .select('*')\r\n          .eq('user_id', supabaseUser.id)\r\n          .single();\r\n        profileData = data || null;\r\n      } catch (createErr: any) {\r\n        console.error('Error creating user profile:', createErr);\r\n        // Só mostrar erro se a recuperação falhar também\r\n        if (isPermissionError) {\r\n           toast.error('Erro ao sincronizar perfil. Algumas funcionalidades podem estar limitadas.');\r\n        }\r\n      }\r\n    }\r\n\r\n    // Prioridade: Perfil (DB) > Metadata (Auth) > Fallback\r\n    const name = profileData?.full_name || profileData?.name || supabaseUser.user_metadata?.name || supabaseUser.user_metadata?.full_name || 'Usuário';\r\n    const cpf = profileData?.cpf || supabaseUser.user_metadata?.cpf;\r\n    const avatar = profileData?.avatar_url || profileData?.avatar || supabaseUser.user_metadata?.avatar_url;\r\n\r\n    return {\r\n      id: supabaseUser.id,\r\n      name: name,\r\n      email: profileData?.email || supabaseUser.email || '',\r\n      avatar: avatar,\r\n      cpf: cpf,\r\n      fullName: name\r\n    };\r\n  };\r\n\r\n  useEffect(() => {\r\n    // Verificar sessão inicial\r\n    const getInitialSession = async () => {\r\n      // Se houver action=logout na URL, não restaurar sessão\r\n      if (typeof window !== 'undefined') {\r\n         const params = new URLSearchParams(window.location.search);\r\n         if (params.get('action') === 'logout') {\r\n            console.log('🛑 [AuthContext] Logout detectado na URL, ignorando restauração de sessão.');\r\n            setIsLoading(false);\r\n            setUser(null);\r\n            return;\r\n         }\r\n      }\r\n\r\n      console.log('🔄 [AuthContext] Iniciando verificação de sessão inicial...');\r\n      try {\r\n        // Se bypass ativo, simula usuário sem consultar Supabase\r\n        if (AUTH_DEV_BYPASS) {\r\n          setUser({\r\n            id: 'dev-bypass-user',\r\n            name: 'Dev Bypass',\r\n            email: 'dev@local',\r\n            avatar: undefined,\r\n            cpf: undefined,\r\n            fullName: 'Dev Bypass'\r\n          });\r\n          console.warn('[AUTH] Bypass de autenticação ATIVO no cliente');\r\n          return;\r\n        }\r\n\r\n        const { data: { session }, error } = await supabase.auth.getSession();\r\n        \r\n        if (error) {\r\n          console.error('❌ [AuthContext] Erro ao obter sessão inicial:', error);\r\n          throw error;\r\n        }\r\n\r\n        console.log('🔄 [AuthContext] Sessão obtida:', session ? 'Sessão ativa' : 'Nenhuma sessão');\r\n        \r\n        if (session?.user) {\r\n          // Otimização: Define usuário básico imediatamente para liberar UI\r\n          // enquanto carrega perfil completo em background\r\n          const basicUser: User = {\r\n            id: session.user.id,\r\n            name: session.user.user_metadata?.name || session.user.email?.split('@')[0] || 'Usuário',\r\n            email: session.user.email || '',\r\n            avatar: session.user.user_metadata?.avatar_url,\r\n            cpf: session.user.user_metadata?.cpf,\r\n            fullName: session.user.user_metadata?.full_name\r\n          };\r\n          \r\n          setUser(basicUser); // Libera o loading imediatamente com dados básicos\r\n          \r\n          // Carrega perfil completo em background\r\n          fetchAndConvertUser(session.user).then(fullProfile => {\r\n            setUser(prev => {\r\n              // Só atualiza se o ID for o mesmo (evita race condition se usuário mudou)\r\n              if (prev?.id === fullProfile.id) {\r\n                return fullProfile;\r\n              }\r\n              return prev;\r\n            });\r\n          }).catch(err => console.error('Erro ao carregar perfil completo em background:', err));\r\n          \r\n        }\r\n      } catch (error) {\r\n        console.error('❌ [AuthContext] Erro fatal na sessão inicial:', error);\r\n        setUser(null);\r\n      } finally {\r\n        console.log('🏁 [AuthContext] Finalizando carregamento inicial (setIsLoading false)');\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    getInitialSession();\r\n\r\n    // Timeout de segurança para garantir que isLoading não fique travado eternamente\r\n    const safetyTimeout = setTimeout(() => {\r\n      setIsLoading(prev => {\r\n        if (prev) {\r\n          console.warn('⚠️ [AuthContext] Timeout de segurança atingido. Forçando isLoading = false.');\r\n          return false;\r\n        }\r\n        return prev;\r\n      });\r\n    }, 5000); // 5 segundos máximo de loading\r\n\r\n    // Escutar mudanças de autenticação\r\n    const { data: { subscription } } = supabase.auth.onAuthStateChange(\r\n      async (event, session) => {\r\n        console.log(`🔔 [AuthContext] Evento de Auth: ${event}`);\r\n        \r\n        // Bloquear restauração se estivermos em logout\r\n        if (typeof window !== 'undefined') {\r\n            const params = new URLSearchParams(window.location.search);\r\n            if (params.get('action') === 'logout') {\r\n                return;\r\n            }\r\n        }\r\n\r\n        if (isLoggingOutRef.current) return;\r\n        \r\n        if (AUTH_DEV_BYPASS) return;\r\n\r\n        if (session?.user) {\r\n          // Mesma estratégia: dados básicos primeiro\r\n           const basicUser: User = {\r\n            id: session.user.id,\r\n            name: session.user.user_metadata?.name || session.user.email?.split('@')[0] || 'Usuário',\r\n            email: session.user.email || '',\r\n            avatar: session.user.user_metadata?.avatar_url,\r\n            cpf: session.user.user_metadata?.cpf,\r\n            fullName: session.user.user_metadata?.full_name\r\n          };\r\n          \r\n          // Só atualiza se realmente mudou o usuário para evitar re-renders\r\n          setUser(prev => {\r\n             if (prev?.id !== basicUser.id) {\r\n                // Se mudou usuário, dispara busca de perfil\r\n                fetchAndConvertUser(session.user).then(fullProfile => {\r\n                  setUser(current => current?.id === fullProfile.id ? fullProfile : current);\r\n                });\r\n                return basicUser;\r\n             }\r\n             return prev;\r\n          });\r\n          \r\n        } else if (event === 'SIGNED_OUT') {\r\n          setUser(null);\r\n        }\r\n        \r\n        setIsLoading(false);\r\n      }\r\n    );\r\n\r\n    return () => {\r\n      clearTimeout(safetyTimeout);\r\n      subscription.unsubscribe();\r\n    };\r\n  }, []); // Dependência vazia para garantir execução única (Singleton Supabase é estável)\r\n\r\n  const login = async (email: string, password: string): Promise<boolean> => {\r\n    setIsLoading(true);\r\n    \r\n    try {\r\n      console.log('Tentando login via API...');\r\n      const response = await fetch('/api/auth/login', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({ email, password }),\r\n      });\r\n\r\n      let data: any;\r\n      try {\r\n        data = await response.json();\r\n      } catch (e) {\r\n        console.warn('Falha ao analisar resposta JSON da API de login:', e);\r\n        data = { error: 'Erro de comunicação com o servidor' };\r\n      }\r\n\r\n      if (!response.ok) {\r\n        const message = data?.error || data?.message || `Erro ${response.status}`;\r\n        console.warn(`API de login retornou erro ${response.status}:`, message);\r\n        throw new Error(message);\r\n      }\r\n\r\n      const apiSession = data?.session || data?.data?.session;\r\n\r\n      if (apiSession?.access_token && apiSession?.refresh_token) {\r\n        const { error: sessionError } = await supabase.auth.setSession({\r\n          access_token: apiSession.access_token,\r\n          refresh_token: apiSession.refresh_token\r\n        });\r\n        \r\n        if (sessionError) {\r\n          console.error('Erro ao definir sessão no cliente:', sessionError);\r\n          throw sessionError;\r\n        }\r\n\r\n        toast.success('Login realizado com sucesso! Bem-vindo de volta ao SOFIA!');\r\n        router.prefetch('/dashboard');\r\n        setIsLoading(false);\r\n        return true;\r\n      }\r\n    } catch (apiError) {\r\n      console.warn('Falha no login via API, tentando fallback direto via Supabase Client:', apiError);\r\n      \r\n      try {\r\n        // Fallback: Login direto via Supabase Client\r\n        const { data, error } = await supabase.auth.signInWithPassword({\r\n          email,\r\n          password\r\n        });\r\n\r\n        if (error) {\r\n          console.error('Erro no login (fallback):', error.message);\r\n          if (error.message.includes('Invalid login credentials')) {\r\n            toast.error('Credenciais inválidas. Verifique seu email e senha.');\r\n          } else if (error.message.includes('Email not confirmed')) {\r\n            toast.error('Por favor, confirme seu email antes de fazer login.');\r\n          } else {\r\n            toast.error('Erro ao fazer login: ' + error.message);\r\n          }\r\n          setIsLoading(false);\r\n          return false;\r\n        }\r\n\r\n        if (data.session) {\r\n            if (data.user) {\r\n              const userWithProfile = await fetchAndConvertUser(data.user);\r\n              setUser(userWithProfile);\r\n            }\r\n\r\n            // Garantir que os cookies sejam definidos para o middleware\r\n            if (typeof window !== 'undefined') {\r\n              const maxAge = 60 * 60 * 24 * 7; // 7 dias\r\n              document.cookie = `sb-access-token=${data.session.access_token}; path=/; max-age=${maxAge}; samesite=lax`;\r\n              document.cookie = `sb-refresh-token=${data.session.refresh_token}; path=/; max-age=${maxAge}; samesite=lax`;\r\n            }\r\n            \r\n            toast.success('Login realizado com sucesso! (Modo Fallback)');\r\n            router.prefetch('/dashboard');\r\n            router.push('/dashboard');\r\n            setIsLoading(false);\r\n            return true;\r\n          }\r\n      } catch (fallbackError) {\r\n        console.error('Erro fatal no login:', fallbackError);\r\n        toast.error('Não foi possível realizar o login. Tente novamente mais tarde.');\r\n      }\r\n    }\r\n\r\n    setIsLoading(false);\r\n    return false;\r\n  };\r\n\r\n  const register = async (name: string, email: string, password: string, cpf?: string, fullName?: string, confirmPassword?: string): Promise<boolean> => {\r\n    setIsLoading(true);\r\n    \r\n    try {\r\n      // Use relative path to ensure we hit the Next.js API Routes in the same origin\r\n      const response = await fetch('/api/auth/register', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({ \r\n          email, \r\n          password, \r\n          name, \r\n          cpf, \r\n          fullName,\r\n          confirm_password: confirmPassword\r\n        }),\r\n      });\r\n\r\n      const data = await response.json();\r\n\r\n      if (!response.ok) {\r\n        const errorMessage = data.error || data.message || 'Erro ao criar conta';\r\n        console.error('Erro no registro:', errorMessage);\r\n        \r\n        if (errorMessage.includes('already registered')) {\r\n          toast.error('Este email já está cadastrado. Tente fazer login.');\r\n        } else {\r\n          toast.error(errorMessage);\r\n        }\r\n        setIsLoading(false);\r\n        return false;\r\n      }\r\n\r\n      toast.success(data.message || data.error || 'Conta criada com sucesso! Verifique seu email para confirmar a conta.');\r\n      setIsLoading(false);\r\n      return true;\r\n    } catch (error: any) {\r\n      console.error('Erro no registro:', error);\r\n      toast.error('Erro interno do servidor');\r\n      setIsLoading(false);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const logout = async () => {\r\n    // Marcar que estamos fazendo logout para evitar atualizações de estado que quebrem a UI\r\n    isLoggingOutRef.current = true;\r\n    \r\n    try {\r\n      const logoutTimeout = 2000; // 2 segundos de timeout para operações de rede\r\n\r\n      // 1. Chamar rota de logout do servidor para limpar cookies\r\n      try {\r\n        const controller = new AbortController();\r\n        const timeoutId = setTimeout(() => controller.abort(), logoutTimeout);\r\n        \r\n        await fetch('/api/auth/logout', { \r\n          method: 'POST',\r\n          signal: controller.signal \r\n        });\r\n        \r\n        clearTimeout(timeoutId);\r\n      } catch (e) {\r\n        console.warn('Erro ao chamar API de logout:', e);\r\n      }\r\n\r\n      // 2. Logout no cliente Supabase\r\n      // Isso dispararia onAuthStateChange, mas o ref isLoggingOutRef vai prevenir o setUser(null)\r\n      try {\r\n        await Promise.race([\r\n          supabase.auth.signOut(),\r\n          new Promise((_, reject) => setTimeout(() => reject(new Error('Timeout')), logoutTimeout))\r\n        ]);\r\n      } catch (e) {\r\n        console.warn('Erro ou timeout no supabase.auth.signOut:', e);\r\n      }\r\n      \r\n      // 3. Limpar localStorage e sessionStorage explicitamente\r\n      if (typeof window !== 'undefined') {\r\n        window.localStorage.removeItem('sb-' + process.env.NEXT_PUBLIC_SUPABASE_URL + '-auth-token');\r\n        window.localStorage.removeItem('supabase.auth.token');\r\n        // Manter preferências de \"Lembrar-me\" se necessário, mas limpar tokens\r\n        // Não limpar tudo para não perder preferências de UI\r\n      }\r\n\r\n      // 4. Limpar cookies manualmente no cliente para garantir\r\n      if (typeof document !== 'undefined') {\r\n        const cookiesToClear = [\r\n          'sb-access-token',\r\n          'sb-refresh-token',\r\n          'sofia_status',\r\n          'sofia_plan',\r\n          'sofia_role',\r\n          'supabase-auth-token' // Adicionando possíveis variantes\r\n        ];\r\n\r\n        // Tentar limpar em múltiplos caminhos e domínios para garantir\r\n        const paths = ['/', '/app', '/dashboard'];\r\n        const domains = [window.location.hostname];\r\n        if (window.location.hostname.includes('.')) {\r\n            domains.push('.' + window.location.hostname);\r\n        }\r\n\r\n        cookiesToClear.forEach(cookieName => {\r\n            paths.forEach(path => {\r\n                domains.forEach(domain => {\r\n                     document.cookie = `${cookieName}=; path=${path}; domain=${domain}; expires=Thu, 01 Jan 1970 00:00:01 GMT;`;\r\n                     document.cookie = `${cookieName}=; path=${path}; expires=Thu, 01 Jan 1970 00:00:01 GMT;`; // Tentar sem domínio também\r\n                });\r\n            });\r\n        });\r\n      }\r\n\r\n      toast.success('Logout realizado com sucesso!');\r\n      \r\n    } catch (error) {\r\n      console.error('Erro no logout:', error);\r\n      toast.error('Erro ao fazer logout');\r\n    } finally {\r\n      // 5. Redirecionar via hard refresh com parâmetro de ação e timestamp para evitar cache\r\n      // Sempre executar o redirecionamento, independente de erros\r\n      setTimeout(() => {\r\n          // Usar window.location.href para garantir um reset completo do estado\r\n          // Adicionar ?action=logout para que o middleware saiba que é um logout intencional\r\n          // Adicionar timestamp para evitar cache do navegador/middleware\r\n          window.location.href = `/login?action=logout&t=${Date.now()}`;\r\n      }, 100);\r\n    }\r\n  };\r\n\r\n  const getToken = React.useCallback(async (): Promise<string | null> => {\r\n    try {\r\n      if (AUTH_DEV_BYPASS) {\r\n        return 'dev-bypass-token';\r\n      }\r\n      const { data: { session } } = await supabase.auth.getSession();\r\n      return session?.access_token || null;\r\n    } catch (error) {\r\n      console.error('Erro ao obter token:', error);\r\n      toast.error('Não foi possível obter o token de acesso.');\r\n      return null;\r\n    }\r\n  }, [AUTH_DEV_BYPASS]);\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ user, login, register, logout, getToken, isLoading }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useAuth() {\r\n  const context = useContext(AuthContext);\r\n  if (context === undefined) {\r\n    throw new Error('useAuth must be used within an AuthProvider');\r\n  }\r\n  return context;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/contexts/sofia-context.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has missing dependencies: 'kpisRealTime' and 'signalsRealTime'. Either include them or remove the dependency array.","line":475,"column":7,"nodeType":"ArrayExpression","endLine":475,"endColumn":122,"suggestions":[{"desc":"Update the dependencies array to be: [loadInitialData, signalsRealTime, kpisRealTime, state.userPreferences, trackApiCall, captureError]","fix":{"range":[13744,13859],"text":"[loadInitialData, signalsRealTime, kpisRealTime, state.userPreferences, trackApiCall, captureError]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Contexto global do SOFIA para gerenciar estado da aplicação\r\n * Inclui dados em tempo real, preferências do usuário e cache\r\n */\r\n\r\n'use client';\r\n\r\nimport React, { createContext, useContext, useReducer, useEffect, ReactNode, useMemo, useCallback } from 'react';\r\nimport { apiClient } from '@/lib/api-client';\r\nimport { useAuth } from '@/contexts/auth-context';\r\nimport { useRealTimeSignals, useRealTimeKPIs } from '@/hooks/use-real-time-data';\r\nimport { useErrorMonitoring, useApiMonitoring } from '@/hooks/use-error-monitoring';\r\n\r\n// Interfaces para tipos específicos\r\ninterface SignalHistoryItem {\r\n  id: string;\r\n  strategy: string;\r\n  table_id: string;\r\n  confidence: number;\r\n  prediction: number | string;\r\n  timestamp: string;\r\n  status: 'active' | 'completed' | 'expired';\r\n  result?: number;\r\n  profit?: number;\r\n}\r\n\r\ninterface PerformanceDataItem {\r\n  strategy: string;\r\n  date: string;\r\n  accuracy: number;\r\n  roi: number;\r\n  profit: number;\r\n  signals_count: number;\r\n}\r\n\r\ninterface RouletteHistoryItem {\r\n  id: string;\r\n  table_id: string;\r\n  number: number;\r\n  color: 'red' | 'black' | 'green';\r\n  timestamp: string;\r\n  spin_time: number;\r\n}\r\n\r\ninterface SignalsHistoryFilters {\r\n  strategy?: string;\r\n  table_id?: string;\r\n  start_date?: string;\r\n  end_date?: string;\r\n  status?: 'active' | 'completed' | 'expired';\r\n  min_confidence?: number;\r\n}\r\n\r\ninterface ApiResponseData {\r\n  strategies?: string[];\r\n  tables?: Table[];\r\n}\r\n\r\n// Tipos de dados\r\ninterface Signal {\r\n  id: string;\r\n  strategy: string;\r\n  table_id: string;\r\n  confidence: number;\r\n  prediction: number | string;\r\n  timestamp: string;\r\n  status: 'active' | 'completed' | 'expired';\r\n}\r\n\r\ninterface KPI {\r\n  strategy: string;\r\n  accuracy: number;\r\n  roi: number;\r\n  profit: number;\r\n  signals_count: number;\r\n  win_rate: number;\r\n}\r\n\r\ninterface Table {\r\n  id: string;\r\n  name: string;\r\n  provider: string;\r\n  status: 'active' | 'inactive';\r\n  last_spin: number;\r\n  last_update: string;\r\n}\r\n\r\ninterface UserPreferences {\r\n  selected_strategies: string[];\r\n  selected_tables: string[];\r\n  notification_settings: {\r\n    sound_enabled: boolean;\r\n    desktop_notifications: boolean;\r\n    min_confidence: number;\r\n  };\r\n  dashboard_layout: {\r\n    cards_order: string[];\r\n    show_advanced_metrics: boolean;\r\n  };\r\n  dashboard_config?: {\r\n    stats_cards_visible: boolean;\r\n    live_signals_visible: boolean;\r\n    performance_chart_visible: boolean;\r\n    roulette_status_visible: boolean;\r\n    recent_activity_visible: boolean;\r\n  };\r\n}\r\n\r\ninterface SofiaState {\r\n  // Dados em tempo real\r\n  signals: Signal[];\r\n  kpis: KPI[];\r\n  tables: Table[];\r\n  \r\n  // Configurações\r\n  userPreferences: UserPreferences | null;\r\n  availableStrategies: string[];\r\n  availableTables: Table[];\r\n  \r\n  // Estado da aplicação\r\n  isLoading: boolean;\r\n  isConnected: boolean;\r\n  error: string | null;\r\n  lastUpdate: Date | null;\r\n  \r\n  // Cache\r\n  cache: {\r\n    signals_history: SignalHistoryItem[];\r\n    performance_data: PerformanceDataItem[];\r\n    roulette_history: RouletteHistoryItem[];\r\n  };\r\n}\r\n\r\n// Ações do reducer\r\ntype SofiaAction =\r\n  | { type: 'SET_LOADING'; payload: boolean }\r\n  | { type: 'SET_ERROR'; payload: string | null }\r\n  | { type: 'SET_CONNECTED'; payload: boolean }\r\n  | { type: 'UPDATE_SIGNALS'; payload: Signal[] }\r\n  | { type: 'UPDATE_KPIS'; payload: KPI[] }\r\n  | { type: 'UPDATE_TABLES'; payload: Table[] }\r\n  | { type: 'SET_USER_PREFERENCES'; payload: UserPreferences }\r\n  | { type: 'SET_AVAILABLE_STRATEGIES'; payload: string[] }\r\n  | { type: 'SET_AVAILABLE_TABLES'; payload: Table[] }\r\n  | { type: 'UPDATE_CACHE'; payload: { key: keyof SofiaState['cache']; data: SignalHistoryItem[] | PerformanceDataItem[] | RouletteHistoryItem[] } }\r\n  | { type: 'CLEAR_CACHE' }\r\n  | { type: 'SET_LAST_UPDATE'; payload: Date };\r\n\r\n// Estado inicial\r\nconst initialState: SofiaState = {\r\n  signals: [],\r\n  kpis: [],\r\n  tables: [],\r\n  userPreferences: null,\r\n  availableStrategies: [],\r\n  availableTables: [],\r\n  isLoading: false,\r\n  isConnected: false,\r\n  error: null,\r\n  lastUpdate: null,\r\n  cache: {\r\n    signals_history: [],\r\n    performance_data: [],\r\n    roulette_history: []\r\n  }\r\n};\r\n\r\n// Reducer\r\nfunction sofiaReducer(state: SofiaState, action: SofiaAction): SofiaState {\r\n  switch (action.type) {\r\n    case 'SET_LOADING':\r\n      return { ...state, isLoading: action.payload };\r\n    \r\n    case 'SET_ERROR':\r\n      return { ...state, error: action.payload, isLoading: false };\r\n    \r\n    case 'SET_CONNECTED':\r\n      return { ...state, isConnected: action.payload };\r\n    \r\n    case 'UPDATE_SIGNALS':\r\n      return { \r\n        ...state, \r\n        signals: action.payload, \r\n        lastUpdate: new Date(),\r\n        error: null \r\n      };\r\n    \r\n    case 'UPDATE_KPIS':\r\n      return { \r\n        ...state, \r\n        kpis: action.payload, \r\n        lastUpdate: new Date(),\r\n        error: null \r\n      };\r\n    \r\n    case 'UPDATE_TABLES':\r\n      return { \r\n        ...state, \r\n        tables: action.payload, \r\n        lastUpdate: new Date(),\r\n        error: null \r\n      };\r\n    \r\n    case 'SET_USER_PREFERENCES':\r\n      return { ...state, userPreferences: action.payload };\r\n    \r\n    case 'SET_AVAILABLE_STRATEGIES':\r\n      return { ...state, availableStrategies: action.payload };\r\n    \r\n    case 'SET_AVAILABLE_TABLES':\r\n      return { ...state, availableTables: action.payload };\r\n    \r\n    case 'UPDATE_CACHE':\r\n      return {\r\n        ...state,\r\n        cache: {\r\n          ...state.cache,\r\n          [action.payload.key]: action.payload.data\r\n        }\r\n      };\r\n    \r\n    case 'CLEAR_CACHE':\r\n      return {\r\n        ...state,\r\n        cache: {\r\n          signals_history: [],\r\n          performance_data: [],\r\n          roulette_history: []\r\n        }\r\n      };\r\n    \r\n    case 'SET_LAST_UPDATE':\r\n      return { ...state, lastUpdate: action.payload };\r\n    \r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\n// Contexto\r\ninterface SofiaContextType {\r\n  state: SofiaState;\r\n  actions: {\r\n    refreshData: () => Promise<void>;\r\n    updateUserPreferences: (preferences: Partial<UserPreferences>) => Promise<void>;\r\n    getSignalsHistory: (filters?: SignalsHistoryFilters) => Promise<SignalHistoryItem[]>;\r\n    getRouletteHistory: (tableId?: string, limit?: number) => Promise<RouletteHistoryItem[]>;\r\n    clearCache: () => void;\r\n    setError: (error: string | null) => void;\r\n  };\r\n}\r\n\r\nconst SofiaContext = createContext<SofiaContextType | undefined>(undefined);\r\n\r\n// Provider\r\ninterface SofiaProviderProps {\r\n  children: ReactNode;\r\n}\r\n\r\nexport function SofiaProvider({ children }: SofiaProviderProps) {\r\n  const [state, dispatch] = useReducer(sofiaReducer, initialState);\r\n  const { user } = useAuth();\r\n  \r\n  // Hooks de monitoramento de erros e API\r\n  const { captureError, captureMessage } = useErrorMonitoring();\r\n  const { trackApiCall } = useApiMonitoring();\r\n\r\n  // Callbacks otimizados para evitar re-renders\r\n  const handleSignalsData = useCallback((data: Signal[]) => {\r\n    if (Array.isArray(data)) {\r\n      dispatch({ type: 'UPDATE_SIGNALS', payload: data });\r\n    }\r\n  }, []);\r\n\r\n  const handleKpisData = useCallback((data: KPI[]) => {\r\n    if (Array.isArray(data)) {\r\n      dispatch({ type: 'UPDATE_KPIS', payload: data });\r\n    }\r\n  }, []);\r\n\r\n  const handleError = useCallback((error: Error) => {\r\n    // Capturar erro no Sentry\r\n    captureError(error, {\r\n      component: 'SofiaProvider',\r\n      action: 'real-time-data'\r\n    });\r\n    dispatch({ type: 'SET_ERROR', payload: error.message });\r\n  }, [captureError]);\r\n\r\n  // Hooks para dados em tempo real\r\n  const signalsRealTime = useRealTimeSignals({\r\n    onData: handleSignalsData,\r\n    onError: handleError\r\n  });\r\n\r\n  const kpisRealTime = useRealTimeKPIs({\r\n    onData: handleKpisData,\r\n    onError: handleError\r\n  });\r\n\r\n  // Atualizar estado de conexão\r\n  useEffect(() => {\r\n    dispatch({ \r\n      type: 'SET_CONNECTED', \r\n      payload: signalsRealTime.isConnected || kpisRealTime.isConnected \r\n    });\r\n  }, [signalsRealTime.isConnected, kpisRealTime.isConnected]);\r\n\r\n  // Atualizar estado de loading\r\n  useEffect(() => {\r\n    dispatch({ \r\n      type: 'SET_LOADING', \r\n      payload: signalsRealTime.isLoading || kpisRealTime.isLoading \r\n    });\r\n  }, [signalsRealTime.isLoading, kpisRealTime.isLoading]);\r\n\r\n  // Função para carregar dados iniciais (otimizada)\r\n  const loadInitialData = useCallback(async () => {\r\n    try {\r\n      dispatch({ type: 'SET_LOADING', payload: true });\r\n\r\n      // Carregar opções disponíveis\r\n      const optionsResponse = await trackApiCall(\r\n        () => apiClient.getAvailableOptions(),\r\n        'getAvailableOptions'\r\n      );\r\n      if (optionsResponse.success) {\r\n        const { strategies, tables } = optionsResponse.data as ApiResponseData;\r\n        dispatch({ type: 'SET_AVAILABLE_STRATEGIES', payload: strategies || [] });\r\n        dispatch({ type: 'SET_AVAILABLE_TABLES', payload: tables || [] });\r\n      }\r\n\r\n      // Carregar preferências do usuário apenas se autenticado\r\n      if (user) {\r\n        const preferencesResponse = await trackApiCall(\r\n          () => apiClient.getUserPreferences(),\r\n          'getUserPreferences'\r\n        );\r\n        if (preferencesResponse.success) {\r\n          dispatch({ type: 'SET_USER_PREFERENCES', payload: preferencesResponse.data as UserPreferences });\r\n        }\r\n      }\r\n\r\n      // Carregar mesas públicas\r\n      const tablesResponse = await trackApiCall(\r\n        () => apiClient.getPublicTables(),\r\n        'getPublicTables'\r\n      );\r\n      if (tablesResponse.success) {\r\n        dispatch({ type: 'UPDATE_TABLES', payload: (tablesResponse.data as Table[]) || [] });\r\n      }\r\n\r\n    } catch (error) {\r\n      captureError(error as Error, {\r\n        component: 'SofiaProvider',\r\n        action: 'loadInitialData'\r\n      });\r\n      dispatch({ type: 'SET_ERROR', payload: 'Erro ao carregar dados iniciais' });\r\n    } finally {\r\n      dispatch({ type: 'SET_LOADING', payload: false });\r\n    }\r\n  }, [trackApiCall, captureError, user]);\r\n\r\n  // Carregar dados iniciais\r\n  useEffect(() => {\r\n    loadInitialData();\r\n  }, [loadInitialData]);\r\n\r\n  // Ações do contexto (otimizadas)\r\n  const actions = useMemo(() => ({\r\n    refreshData: async () => {\r\n      await loadInitialData();\r\n      signalsRealTime.refresh();\r\n      kpisRealTime.refresh();\r\n    },\r\n\r\n    updateUserPreferences: async (preferences: Partial<UserPreferences>) => {\r\n      try {\r\n        const currentPrefs = state.userPreferences || {\r\n          selected_strategies: [],\r\n          selected_tables: [],\r\n          notification_settings: {\r\n            sound_enabled: true,\r\n            desktop_notifications: true,\r\n            min_confidence: 70\r\n          },\r\n          dashboard_layout: {\r\n            cards_order: [],\r\n            show_advanced_metrics: false\r\n          },\r\n          dashboard_config: {\r\n            stats_cards_visible: true,\r\n            live_signals_visible: true,\r\n            performance_chart_visible: true,\r\n            roulette_status_visible: true,\r\n            recent_activity_visible: true\r\n          }\r\n        };\r\n\r\n        const updatedPrefs = { ...currentPrefs, ...preferences };\r\n        \r\n        const response = await trackApiCall(\r\n          () => apiClient.updateUserPreferences(updatedPrefs),\r\n          'updateUserPreferences'\r\n        );\r\n        if (response.success) {\r\n          dispatch({ type: 'SET_USER_PREFERENCES', payload: updatedPrefs });\r\n        } else {\r\n          throw new Error(response.error || 'Erro ao atualizar preferências');\r\n        }\r\n      } catch (error) {\r\n        captureError(error as Error, {\r\n          component: 'SofiaProvider',\r\n          action: 'updateUserPreferences',\r\n          metadata: { preferences }\r\n        });\r\n        dispatch({ type: 'SET_ERROR', payload: (error as Error).message });\r\n        throw error;\r\n      }\r\n    },\r\n\r\n    getSignalsHistory: async (filters: SignalsHistoryFilters = {}) => {\r\n      try {\r\n        const response = await trackApiCall(\r\n          () => apiClient.getSignalsHistory(filters),\r\n          'getSignalsHistory'\r\n        );\r\n        if (response.success) {\r\n          const data = (response.data as SignalHistoryItem[]) || [];\r\n          dispatch({ type: 'UPDATE_CACHE', payload: { key: 'signals_history', data } });\r\n          return data;\r\n        }\r\n        throw new Error(response.error || 'Erro ao buscar histórico de sinais');\r\n      } catch (error) {\r\n        captureError(error as Error, {\r\n          component: 'SofiaProvider',\r\n          action: 'getSignalsHistory',\r\n          metadata: { filters }\r\n        });\r\n        dispatch({ type: 'SET_ERROR', payload: (error as Error).message });\r\n        return [];\r\n      }\r\n    },\r\n\r\n    getRouletteHistory: async (tableId?: string, limit = 100) => {\r\n      try {\r\n        const response = await trackApiCall(\r\n          () => apiClient.getRouletteHistory(tableId, limit),\r\n          'getRouletteHistory'\r\n        );\r\n        if (response.success) {\r\n          const data = (response.data as RouletteHistoryItem[]) || [];\r\n          dispatch({ type: 'UPDATE_CACHE', payload: { key: 'roulette_history', data } });\r\n          return data;\r\n        }\r\n        throw new Error(response.error || 'Erro ao buscar histórico da roleta');\r\n      } catch (error) {\r\n        captureError(error as Error, {\r\n          component: 'SofiaProvider',\r\n          action: 'getRouletteHistory',\r\n          metadata: { tableId, limit }\r\n        });\r\n        dispatch({ type: 'SET_ERROR', payload: (error as Error).message });\r\n        return [];\r\n      }\r\n    },\r\n\r\n    clearCache: () => {\r\n      dispatch({ type: 'CLEAR_CACHE' });\r\n    },\r\n\r\n    setError: (error: string | null) => {\r\n      dispatch({ type: 'SET_ERROR', payload: error });\r\n    }\r\n  }), [loadInitialData, signalsRealTime.refresh, kpisRealTime.refresh, state.userPreferences, trackApiCall, captureError]);\r\n\r\n  // Context value otimizado\r\n  const contextValue: SofiaContextType = useMemo(() => ({\r\n    state,\r\n    actions\r\n  }), [state, actions]);\r\n\r\n  return (\r\n    <SofiaContext.Provider value={contextValue}>\r\n      {children}\r\n    </SofiaContext.Provider>\r\n  );\r\n}\r\n\r\n// Hook para usar o contexto\r\nexport function useSofia() {\r\n  const context = useContext(SofiaContext);\r\n  if (context === undefined) {\r\n    throw new Error('useSofia deve ser usado dentro de um SofiaProvider');\r\n  }\r\n  return context;\r\n}\r\n\r\n// Hooks específicos otimizados para facilitar o uso\r\nexport function useSofiaSignals() {\r\n  const { state } = useSofia();\r\n  return useMemo(() => state.signals, [state.signals]);\r\n}\r\n\r\nexport function useSofiaKPIs() {\r\n  const { state } = useSofia();\r\n  return useMemo(() => state.kpis, [state.kpis]);\r\n}\r\n\r\nexport function useSofiaTables() {\r\n  const { state } = useSofia();\r\n  return useMemo(() => state.tables, [state.tables]);\r\n}\r\n\r\nexport function useSofiaPreferences() {\r\n  const { state, actions } = useSofia();\r\n  return useMemo(() => ({\r\n    preferences: state.userPreferences,\r\n    updatePreferences: actions.updateUserPreferences\r\n  }), [state.userPreferences, actions.updateUserPreferences]);\r\n}\r\n\r\nexport function useSofiaConnection() {\r\n  const { state } = useSofia();\r\n  return useMemo(() => ({\r\n    isConnected: state.isConnected,\r\n    isLoading: state.isLoading,\r\n    error: state.error,\r\n    lastUpdate: state.lastUpdate\r\n  }), [state.isConnected, state.isLoading, state.error, state.lastUpdate]);\r\n}","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/contexts/upgrade-context.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/e2e/auth.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/e2e/dashboard.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/e2e/global-setup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/e2e/global-teardown.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/e2e/ml-features.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/e2e/ui-navigation.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/hooks/use-analytics.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/hooks/use-api-client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/hooks/use-cache.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/hooks/use-dashboard-optimization.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'preloadComponent'. Either include it or remove the dependency array.","line":71,"column":6,"nodeType":"ArrayExpression","endLine":71,"endColumn":32,"suggestions":[{"desc":"Update the dependencies array to be: [config.enableLazyLoading, preloadComponent]","fix":{"range":[2234,2260],"text":"[config.enableLazyLoading, preloadComponent]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect, useRef, useCallback } from 'react';\r\nimport { useFeatureFlag, FEATURE_FLAGS } from '@/lib/feature-flags';\r\n\r\ninterface DashboardOptimizationConfig {\r\n  enableLazyLoading: boolean;\r\n  preloadComponents: boolean;\r\n  deferNonCritical: boolean;\r\n  optimizeAnimations: boolean;\r\n}\r\n\r\ninterface ComponentLoadState {\r\n  isLoaded: boolean;\r\n  isLoading: boolean;\r\n  error: Error | null;\r\n  loadTime: number;\r\n}\r\n\r\nexport function useDashboardOptimization() {\r\n  const [config, setConfig] = useState<DashboardOptimizationConfig>({\r\n    enableLazyLoading: true,\r\n    preloadComponents: false,\r\n    deferNonCritical: true,\r\n    optimizeAnimations: true\r\n  });\r\n\r\n  const [componentStates, setComponentStates] = useState<Record<string, ComponentLoadState>>({});\r\n  const loadTimesRef = useRef<Record<string, number>>({});\r\n  const intersectionObserverRef = useRef<IntersectionObserver | null>(null);\r\n\r\n  // Feature flags\r\n  const dashboardOptimization = useFeatureFlag(FEATURE_FLAGS.DASHBOARD_OPTIMIZATION);\r\n  const lazyLoadingEnabled = useFeatureFlag(FEATURE_FLAGS.LAZY_LOADING);\r\n\r\n  // Configurar otimizações baseadas em feature flags\r\n  useEffect(() => {\r\n    setConfig(prev => ({\r\n      ...prev,\r\n      enableLazyLoading: lazyLoadingEnabled && dashboardOptimization,\r\n      preloadComponents: dashboardOptimization,\r\n      deferNonCritical: dashboardOptimization,\r\n      optimizeAnimations: dashboardOptimization\r\n    }));\r\n  }, [dashboardOptimization, lazyLoadingEnabled]);\r\n\r\n  // Intersection Observer para lazy loading inteligente\r\n  useEffect(() => {\r\n    if (!config.enableLazyLoading) return;\r\n\r\n    intersectionObserverRef.current = new IntersectionObserver(\r\n      (entries) => {\r\n        entries.forEach((entry) => {\r\n          if (entry.isIntersecting) {\r\n            const componentId = entry.target.getAttribute('data-component-id');\r\n            if (componentId) {\r\n              preloadComponent(componentId);\r\n            }\r\n          }\r\n        });\r\n      },\r\n      {\r\n        rootMargin: '100px', // Preload 100px antes do componente aparecer\r\n        threshold: 0.1\r\n      }\r\n    );\r\n\r\n    return () => {\r\n      intersectionObserverRef.current?.disconnect();\r\n    };\r\n  }, [config.enableLazyLoading]);\r\n\r\n  // Registrar componente para observação\r\n  const registerComponent = useCallback((element: HTMLElement, componentId: string) => {\r\n    if (!intersectionObserverRef.current) return;\r\n    \r\n    element.setAttribute('data-component-id', componentId);\r\n    intersectionObserverRef.current.observe(element);\r\n  }, []);\r\n\r\n  // Preload de componente\r\n  const preloadComponent = useCallback((componentId: string) => {\r\n    if (componentStates[componentId]?.isLoaded || componentStates[componentId]?.isLoading) {\r\n      return;\r\n    }\r\n\r\n    const startTime = performance.now();\r\n    \r\n    setComponentStates(prev => ({\r\n      ...prev,\r\n      [componentId]: {\r\n        isLoaded: false,\r\n        isLoading: true,\r\n        error: null,\r\n        loadTime: 0\r\n      }\r\n    }));\r\n\r\n    // Simular carregamento do componente\r\n    // Em uma implementação real, isso seria o import dinâmico\r\n    setTimeout(() => {\r\n      const loadTime = performance.now() - startTime;\r\n      loadTimesRef.current[componentId] = loadTime;\r\n\r\n      setComponentStates(prev => ({\r\n        ...prev,\r\n        [componentId]: {\r\n          isLoaded: true,\r\n          isLoading: false,\r\n          error: null,\r\n          loadTime\r\n        }\r\n      }));\r\n    }, Math.random() * 100 + 50); // Simular tempo de carregamento variável\r\n  }, [componentStates]);\r\n\r\n  // Otimizar animações baseado na performance\r\n  const shouldReduceAnimations = useCallback(() => {\r\n    if (!config.optimizeAnimations) return false;\r\n    \r\n    // Verificar se o usuário prefere animações reduzidas\r\n    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;\r\n    \r\n    // Verificar performance média de carregamento\r\n    const avgLoadTime = Object.values(loadTimesRef.current).reduce((acc, time) => acc + time, 0) / \r\n                       Object.values(loadTimesRef.current).length;\r\n    \r\n    return prefersReducedMotion || avgLoadTime > 200; // Se carregamento médio > 200ms\r\n  }, [config.optimizeAnimations]);\r\n\r\n  // Priorizar componentes críticos\r\n  const getPriorityOrder = useCallback(() => {\r\n    return [\r\n      'stats-cards',      // Métricas principais - alta prioridade\r\n      'live-signals',     // Sinais ao vivo - alta prioridade\r\n      'roulette-status',  // Status da roleta - média prioridade\r\n      'performance-chart', // Gráficos - baixa prioridade\r\n      'recent-activity'   // Atividade recente - baixa prioridade\r\n    ];\r\n  }, []);\r\n\r\n  // Verificar se componente deve ser carregado\r\n  const shouldLoadComponent = useCallback((componentId: string) => {\r\n    if (!config.enableLazyLoading) return true;\r\n    \r\n    const priorityOrder = getPriorityOrder();\r\n    const componentPriority = priorityOrder.indexOf(componentId);\r\n    \r\n    // Componentes de alta prioridade (índice 0-1) carregam imediatamente\r\n    if (componentPriority <= 1) return true;\r\n    \r\n    // Outros componentes aguardam interação ou scroll\r\n    return componentStates[componentId]?.isLoaded || false;\r\n  }, [config.enableLazyLoading, componentStates, getPriorityOrder]);\r\n\r\n  // Métricas de performance\r\n  const getPerformanceMetrics = useCallback(() => {\r\n    const loadTimes = Object.values(loadTimesRef.current);\r\n    const totalComponents = Object.keys(componentStates).length;\r\n    const loadedComponents = Object.values(componentStates).filter(state => state.isLoaded).length;\r\n    \r\n    return {\r\n      totalComponents,\r\n      loadedComponents,\r\n      loadingProgress: totalComponents > 0 ? (loadedComponents / totalComponents) * 100 : 0,\r\n      averageLoadTime: loadTimes.length > 0 ? loadTimes.reduce((acc, time) => acc + time, 0) / loadTimes.length : 0,\r\n      maxLoadTime: loadTimes.length > 0 ? Math.max(...loadTimes) : 0,\r\n      minLoadTime: loadTimes.length > 0 ? Math.min(...loadTimes) : 0\r\n    };\r\n  }, [componentStates]);\r\n\r\n  return {\r\n    config,\r\n    componentStates,\r\n    registerComponent,\r\n    preloadComponent,\r\n    shouldLoadComponent,\r\n    shouldReduceAnimations,\r\n    getPriorityOrder,\r\n    getPerformanceMetrics,\r\n    isOptimizationEnabled: dashboardOptimization\r\n  };\r\n}","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/hooks/use-dashboard-preferences.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/hooks/use-error-monitoring.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/hooks/use-intelligent-cache.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/hooks/use-log-alerts.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'settings.enabled' and 'settings.notificationSound'. Either include them or remove the dependency array.","line":213,"column":6,"nodeType":"ArrayExpression","endLine":213,"endColumn":54,"suggestions":[{"desc":"Update the dependencies array to be: [fetchUnacknowledgedAlerts, checkErrorThreshold, settings.enabled, settings.notificationSound]","fix":{"range":[6362,6410],"text":"[fetchUnacknowledgedAlerts, checkErrorThreshold, settings.enabled, settings.notificationSound]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport { supabase } from '@/lib/supabase';\r\nimport { getAlertSound } from '@/lib/alert-sound';\r\n\r\nexport interface LogAlert {\r\n  id: string;\r\n  level: string;\r\n  message: string;\r\n  context: string;\r\n  user_id?: string;\r\n  timestamp: string;\r\n  acknowledged: boolean;\r\n}\r\n\r\nexport interface AlertSettings {\r\n  enabled: boolean;\r\n  errorThreshold: number; // Número de erros em X minutos para disparar alerta\r\n  timeWindow: number; // Janela de tempo em minutos\r\n  notificationSound: boolean;\r\n  emailNotifications: boolean;\r\n}\r\n\r\nexport function useLogAlerts() {\r\n  const [alerts, setAlerts] = useState<LogAlert[]>([]);\r\n  const [unreadCount, setUnreadCount] = useState(0);\r\n  const [settings, setSettings] = useState<AlertSettings>({\r\n    enabled: false,\r\n    errorThreshold: 5,\r\n    timeWindow: 10,\r\n    notificationSound: true,\r\n    emailNotifications: false,\r\n  });\r\n\r\n  // Buscar alertas não reconhecidos\r\n  const fetchUnacknowledgedAlerts = useCallback(async () => {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('logs')\r\n        .select('*')\r\n        .eq('level', 'ERROR')\r\n        .eq('acknowledged', false)\r\n        .order('created_at', { ascending: false })\r\n        .limit(50);\r\n\r\n      if (error) throw error;\r\n\r\n      const alertsData: LogAlert[] = data.map(log => ({\r\n        id: log.id,\r\n        level: log.level,\r\n        message: log.message,\r\n        context: log.context,\r\n        user_id: log.user_id,\r\n        timestamp: log.created_at,\r\n        acknowledged: log.acknowledged || false,\r\n      }));\r\n\r\n      setAlerts(alertsData);\r\n      setUnreadCount(alertsData.length);\r\n    } catch (error) {\r\n      console.error('Erro ao buscar alertas:', error);\r\n    }\r\n  }, []);\r\n\r\n  // Verificar se deve disparar alerta baseado no threshold\r\n  const checkErrorThreshold = useCallback(async () => {\r\n    if (!settings.enabled) return;\r\n\r\n    try {\r\n      const timeAgo = new Date();\r\n      timeAgo.setMinutes(timeAgo.getMinutes() - settings.timeWindow);\r\n\r\n      const { data, error } = await supabase\r\n        .from('logs')\r\n        .select('id')\r\n        .eq('level', 'ERROR')\r\n        .gte('created_at', timeAgo.toISOString());\r\n\r\n      if (error) throw error;\r\n\r\n      if (data && data.length >= settings.errorThreshold) {\r\n        // Disparar notificação\r\n        if (settings.notificationSound && 'Notification' in window) {\r\n          new Notification('Alerta de Sistema', {\r\n            body: `${data.length} erros detectados nos últimos ${settings.timeWindow} minutos`,\r\n            icon: '/favicon.ico',\r\n          });\r\n        }\r\n\r\n        // Tocar som se habilitado\r\n        if (settings.notificationSound) {\r\n          const alertSound = getAlertSound();\r\n          alertSound.playAlertSequence().catch(() => {\r\n            // Fallback para beep simples\r\n            alertSound.playAlertBeep();\r\n          });\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Erro ao verificar threshold de erros:', error);\r\n    }\r\n  }, [settings]);\r\n\r\n  // Marcar alerta como reconhecido\r\n  const acknowledgeAlert = useCallback(async (alertId: string) => {\r\n    try {\r\n      const { error } = await supabase\r\n        .from('logs')\r\n        .update({ acknowledged: true })\r\n        .eq('id', alertId);\r\n\r\n      if (error) throw error;\r\n\r\n      setAlerts(prev => prev.filter(alert => alert.id !== alertId));\r\n      setUnreadCount(prev => Math.max(0, prev - 1));\r\n    } catch (error) {\r\n      console.error('Erro ao reconhecer alerta:', error);\r\n    }\r\n  }, []);\r\n\r\n  // Marcar todos os alertas como reconhecidos\r\n  const acknowledgeAllAlerts = useCallback(async () => {\r\n    try {\r\n      const alertIds = alerts.map(alert => alert.id);\r\n      \r\n      const { error } = await supabase\r\n        .from('logs')\r\n        .update({ acknowledged: true })\r\n        .in('id', alertIds);\r\n\r\n      if (error) throw error;\r\n\r\n      setAlerts([]);\r\n      setUnreadCount(0);\r\n    } catch (error) {\r\n      console.error('Erro ao reconhecer todos os alertas:', error);\r\n    }\r\n  }, [alerts]);\r\n\r\n  // Atualizar configurações\r\n  const updateSettings = useCallback((newSettings: Partial<AlertSettings>) => {\r\n    setSettings(prev => ({ ...prev, ...newSettings }));\r\n    localStorage.setItem('logAlertSettings', JSON.stringify({ ...settings, ...newSettings }));\r\n  }, [settings]);\r\n\r\n  // Configurar listener em tempo real\r\n  useEffect(() => {\r\n    // Carregar configurações salvas\r\n    const savedSettings = localStorage.getItem('logAlertSettings');\r\n    if (savedSettings) {\r\n      setSettings(JSON.parse(savedSettings));\r\n    }\r\n\r\n    // Se alertas estiverem desativados, não configurar listeners nem buscar dados\r\n    if (!settings.enabled) {\r\n      return;\r\n    }\r\n\r\n    // Solicitar permissão para notificações\r\n    if ('Notification' in window && Notification.permission === 'default') {\r\n      Notification.requestPermission();\r\n    }\r\n\r\n    // Buscar alertas iniciais\r\n    fetchUnacknowledgedAlerts();\r\n\r\n    // Configurar listener em tempo real para novos logs de erro\r\n    const channel = supabase\r\n      .channel('log-alerts')\r\n      .on(\r\n        'postgres_changes',\r\n        {\r\n          event: 'INSERT',\r\n          schema: 'public',\r\n          table: 'logs',\r\n          filter: 'level=eq.ERROR',\r\n        },\r\n        (payload) => {\r\n          const newLog = payload.new as any;\r\n          const newAlert: LogAlert = {\r\n            id: newLog.id,\r\n            level: newLog.level,\r\n            message: newLog.message,\r\n            context: newLog.context,\r\n            user_id: newLog.user_id,\r\n            timestamp: newLog.created_at,\r\n            acknowledged: false,\r\n          };\r\n\r\n          setAlerts(prev => [newAlert, ...prev]);\r\n          setUnreadCount(prev => prev + 1);\r\n\r\n          // Tocar som de notificação para novo alerta\r\n          if (settings.notificationSound) {\r\n            const alertSound = getAlertSound();\r\n            alertSound.playNotificationSound();\r\n          }\r\n\r\n          // Verificar threshold\r\n          checkErrorThreshold();\r\n        }\r\n      )\r\n      .subscribe();\r\n\r\n    // Verificar threshold periodicamente\r\n    const interval = setInterval(checkErrorThreshold, 60000); // A cada minuto\r\n\r\n    return () => {\r\n      supabase.removeChannel(channel);\r\n      clearInterval(interval);\r\n    };\r\n  }, [fetchUnacknowledgedAlerts, checkErrorThreshold]);\r\n\r\n  return {\r\n    alerts,\r\n    unreadCount,\r\n    settings,\r\n    acknowledgeAlert,\r\n    acknowledgeAllAlerts,\r\n    updateSettings,\r\n    refreshAlerts: fetchUnacknowledgedAlerts,\r\n  };\r\n}","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/hooks/use-monitoring.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'monitoring'. Either include it or remove the dependency array.","line":64,"column":6,"nodeType":"ArrayExpression","endLine":64,"endColumn":62,"suggestions":[{"desc":"Update the dependencies array to be: [componentName, autoTrackMount, getLogContext, user?.id, monitoring]","fix":{"range":[2178,2234],"text":"[componentName, autoTrackMount, getLogContext, user?.id, monitoring]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'log' object makes the dependencies of useCallback Hook (at line 99) change on every render. To fix this, wrap the initialization of 'log' in its own useMemo() Hook.","line":67,"column":9,"nodeType":"VariableDeclarator","endLine":89,"endColumn":4},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'monitoring'. Either include it or remove the dependency array.","line":88,"column":8,"nodeType":"ArrayExpression","endLine":88,"endColumn":38,"suggestions":[{"desc":"Update the dependencies array to be: [getLogContext, monitoring, componentName]","fix":{"range":[3202,3232],"text":"[getLogContext, monitoring, componentName]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'monitoring'. Either include it or remove the dependency array.","line":127,"column":8,"nodeType":"ArrayExpression","endLine":127,"endColumn":13,"suggestions":[{"desc":"Update the dependencies array to be: [log, monitoring]","fix":{"range":[4615,4620],"text":"[log, monitoring]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'monitoring'. Either include it or remove the dependency array.","line":138,"column":8,"nodeType":"ArrayExpression","endLine":138,"endColumn":28,"suggestions":[{"desc":"Update the dependencies array to be: [componentName, log, monitoring]","fix":{"range":[5073,5093],"text":"[componentName, log, monitoring]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'monitoring'. Either include it or remove the dependency array.","line":156,"column":8,"nodeType":"ArrayExpression","endLine":156,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [componentName, monitoring]","fix":{"range":[5576,5591],"text":"[componentName, monitoring]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'monitoring'. Either include it or remove the dependency array.","line":169,"column":8,"nodeType":"ArrayExpression","endLine":169,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [componentName, monitoring]","fix":{"range":[5907,5922],"text":"[componentName, monitoring]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Hook personalizado para integração do sistema de monitoramento e logging\r\n * Facilita o uso nos componentes React\r\n */\r\n\r\nimport { useEffect, useCallback, useRef } from 'react';\r\nimport { logger, LogContext } from '../lib/logger';\r\nimport { getMonitoringService, usePerformanceMonitoring } from '../lib/monitoring';\r\nimport { useUser } from '@/hooks/use-user';\r\n\r\nexport interface UseMonitoringOptions {\r\n  componentName: string;\r\n  autoTrackRender?: boolean;\r\n  autoTrackMount?: boolean;\r\n  logLevel?: 'debug' | 'info' | 'warn' | 'error';\r\n}\r\n\r\nexport function useMonitoring(options: UseMonitoringOptions) {\r\n  const { componentName, autoTrackRender = true, autoTrackMount = true } = options;\r\n  const { user } = useUser();\r\n  const monitoring = getMonitoringService();\r\n  const mountTimeRef = useRef<number>(Date.now());\r\n  const { measureRender, recordInteraction } = usePerformanceMonitoring(componentName);\r\n\r\n  // Context padrão para logs\r\n  const getLogContext = useCallback((additionalContext?: Partial<LogContext>): LogContext => {\r\n    return {\r\n      component: componentName,\r\n      userId: user?.id,\r\n      sessionId: user?.id ? `session_${user.id}_${Date.now()}` : undefined,\r\n      ...additionalContext\r\n    };\r\n  }, [componentName, user?.id]);\r\n\r\n  // Tracking automático de mount/unmount\r\n  useEffect(() => {\r\n    if (autoTrackMount) {\r\n      mountTimeRef.current = performance.now();\r\n      \r\n      logger.debug(`Component mounted: ${componentName}`, getLogContext({\r\n        action: 'COMPONENT_MOUNT'\r\n      }));\r\n      \r\n      monitoring.recordUsage('component_mount', componentName, user?.id);\r\n    }\r\n\r\n    return () => {\r\n      if (autoTrackMount && mountTimeRef.current) {\r\n        const mountDuration = performance.now() - mountTimeRef.current;\r\n        \r\n        logger.debug(`Component unmounted: ${componentName}`, getLogContext({\r\n          action: 'COMPONENT_UNMOUNT',\r\n          metadata: { mountDuration }\r\n        }));\r\n        \r\n        monitoring.recordPerformance(\r\n          `Component Lifetime: ${componentName}`,\r\n          mountDuration,\r\n          'ms',\r\n          { component: componentName }\r\n        );\r\n      }\r\n    };\r\n  }, [componentName, autoTrackMount, getLogContext, user?.id]);\r\n\r\n  // Métodos de logging com context automático\r\n  const log = {\r\n    debug: useCallback((message: string, additionalContext?: Partial<LogContext>) => {\r\n      logger.debug(message, getLogContext(additionalContext));\r\n    }, [getLogContext]),\r\n\r\n    info: useCallback((message: string, additionalContext?: Partial<LogContext>) => {\r\n      logger.info(message, getLogContext(additionalContext));\r\n    }, [getLogContext]),\r\n\r\n    warn: useCallback((message: string, additionalContext?: Partial<LogContext>) => {\r\n      logger.warn(message, getLogContext(additionalContext));\r\n    }, [getLogContext]),\r\n\r\n    error: useCallback((message: string, error?: Error, additionalContext?: Partial<LogContext>) => {\r\n      logger.error(message, getLogContext(additionalContext), error);\r\n      monitoring.recordError(\r\n        'Component Error',\r\n        message,\r\n        error?.stack,\r\n        { component: componentName, ...additionalContext?.metadata }\r\n      );\r\n    }, [getLogContext, componentName])\r\n  };\r\n\r\n  // Métodos de monitoramento\r\n  const track = {\r\n    userAction: useCallback((action: string, metadata?: Record<string, any>) => {\r\n      recordInteraction(action, user?.id);\r\n      log.info(`User action: ${action}`, {\r\n        action,\r\n        metadata\r\n      });\r\n    }, [recordInteraction, user?.id, log]),\r\n\r\n    apiCall: useCallback((endpoint: string, method: string = 'GET') => {\r\n      const startTime = performance.now();\r\n      \r\n      log.debug(`API call started: ${method} ${endpoint}`, {\r\n        action: 'API_CALL_START',\r\n        metadata: { endpoint, method }\r\n      });\r\n      \r\n      return {\r\n        success: (data?: any) => {\r\n          const duration = performance.now() - startTime;\r\n          monitoring.recordApiCall(endpoint, duration, true);\r\n          log.info(`API call successful: ${method} ${endpoint}`, {\r\n            action: 'API_CALL_SUCCESS',\r\n            metadata: { endpoint, method, duration, dataSize: JSON.stringify(data || {}).length }\r\n          });\r\n        },\r\n        error: (error: Error) => {\r\n          const duration = performance.now() - startTime;\r\n          monitoring.recordApiCall(endpoint, duration, false);\r\n          log.error(`API call failed: ${method} ${endpoint}`, error, {\r\n            action: 'API_CALL_ERROR',\r\n            metadata: { endpoint, method, duration }\r\n          });\r\n        }\r\n      };\r\n    }, [log]),\r\n\r\n    performance: useCallback((name: string, value: number, unit: 'ms' | 'bytes' | 'count' | 'percentage', metadata?: Record<string, any>) => {\r\n      monitoring.recordPerformance(name, value, unit, {\r\n        component: componentName,\r\n        ...metadata\r\n      });\r\n      log.debug(`Performance metric: ${name} = ${value}${unit}`, {\r\n        action: 'PERFORMANCE_METRIC',\r\n        metadata: { name, value, unit, ...metadata }\r\n      });\r\n    }, [componentName, log]),\r\n\r\n    render: useCallback(() => {\r\n      if (autoTrackRender) {\r\n        return measureRender();\r\n      }\r\n      return () => {};\r\n    }, [autoTrackRender, measureRender])\r\n  };\r\n\r\n  // Utilitários para debugging\r\n  const debug = {\r\n    getMetrics: useCallback(() => {\r\n      return {\r\n        performance: monitoring.getPerformanceMetrics(componentName),\r\n        errors: monitoring.getErrorMetrics(),\r\n        usage: monitoring.getUsageMetrics(componentName)\r\n      };\r\n    }, [componentName]),\r\n\r\n    getLogs: useCallback(() => {\r\n      return logger.getLogs();\r\n    }, []),\r\n\r\n    exportData: useCallback(() => {\r\n      return {\r\n        metrics: monitoring.exportMetrics(),\r\n        logs: logger.getLogs(),\r\n        component: componentName,\r\n        timestamp: new Date().toISOString()\r\n      };\r\n    }, [componentName])\r\n  };\r\n\r\n  return {\r\n    log,\r\n    track,\r\n    debug,\r\n    componentName,\r\n    userId: user?.id\r\n  };\r\n}\r\n\r\n// Hook específico para tracking de formulários\r\nexport function useFormMonitoring(formName: string) {\r\n  const { log, track } = useMonitoring({ componentName: `Form_${formName}` });\r\n  \r\n  const trackFormEvent = useCallback((event: 'start' | 'submit' | 'error' | 'abandon', metadata?: Record<string, any>) => {\r\n    track.userAction(`form_${event}`, {\r\n      formName,\r\n      ...metadata\r\n    });\r\n  }, [track, formName]);\r\n  \r\n  const trackFieldInteraction = useCallback((fieldName: string, action: 'focus' | 'blur' | 'change') => {\r\n    track.userAction(`field_${action}`, {\r\n      formName,\r\n      fieldName\r\n    });\r\n  }, [track, formName]);\r\n  \r\n  return {\r\n    log,\r\n    trackFormEvent,\r\n    trackFieldInteraction\r\n  };\r\n}\r\n\r\n// Hook específico para tracking de páginas\r\nexport function usePageMonitoring(pageName: string) {\r\n  const { log, track } = useMonitoring({ \r\n    componentName: `Page_${pageName}`,\r\n    autoTrackMount: true,\r\n    autoTrackRender: false\r\n  });\r\n  \r\n  useEffect(() => {\r\n    const startTime = performance.now();\r\n    \r\n    // Track page view\r\n    track.userAction('page_view', { pageName });\r\n    \r\n    return () => {\r\n      const duration = performance.now() - startTime;\r\n      track.performance('page_load', duration, 'ms', { pageName });\r\n    };\r\n  }, [pageName, track]);\r\n  \r\n  const trackNavigation = useCallback((destination: string, method: 'click' | 'programmatic' = 'click') => {\r\n    track.userAction('navigation', {\r\n      from: pageName,\r\n      to: destination,\r\n      method\r\n    });\r\n  }, [track, pageName]);\r\n  \r\n  return {\r\n    log,\r\n    track,\r\n    trackNavigation\r\n  };\r\n}","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/hooks/use-performance.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo was passed a dependency list that is not an array literal. This means we can't statically verify whether you've passed the correct dependencies.","line":58,"column":6,"nodeType":"Identifier","endLine":58,"endColumn":10},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has missing dependencies: 'compareFunction', 'deps', 'factory', and 'maxAge'. Either include them or remove the dependency array. If 'factory' changes too often, find the parent component that defines it and wrap that definition in useCallback.","line":58,"column":6,"nodeType":"Identifier","endLine":58,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [compareFunction, deps, factory, maxAge]","fix":{"range":[1765,1769],"text":"[compareFunction, deps, factory, maxAge]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback received a function whose dependencies are unknown. Pass an inline function instead.","line":73,"column":10,"nodeType":"Identifier","endLine":73,"endColumn":21},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback received a function whose dependencies are unknown. Pass an inline function instead.","line":94,"column":10,"nodeType":"Identifier","endLine":94,"endColumn":21},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect contains a call to 'setMetrics'. Without a list of dependencies, this can lead to an infinite chain of updates. To fix this, pass [componentName] as a second argument to the useEffect Hook.","line":118,"column":3,"nodeType":"Identifier","endLine":118,"endColumn":12,"suggestions":[{"desc":"Add dependencies array: [componentName]","fix":{"range":[4048,4048],"text":", [componentName]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo was passed a dependency list that is not an array literal. This means we can't statically verify whether you've passed the correct dependencies.","line":266,"column":6,"nodeType":"CallExpression","endLine":266,"endColumn":41},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has missing dependencies: 'dependencies' and 'props'. Either include them or remove the dependency array.","line":266,"column":6,"nodeType":"CallExpression","endLine":266,"endColumn":41,"suggestions":[{"desc":"Update the dependencies array to be: [dependencies, props]","fix":{"range":[7356,7391],"text":"[dependencies, props]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useCallback, useMemo, useRef, useEffect, useState } from 'react';\r\nimport { debounce, throttle, DebouncedFunc, DebouncedFuncLeading } from 'lodash';\r\n\r\n// Interface para métricas de performance\r\ninterface PerformanceMetrics {\r\n  renderCount: number;\r\n  lastRenderTime: number;\r\n  averageRenderTime: number;\r\n  memoryUsage?: number;\r\n}\r\n\r\n// Hook para memoização inteligente\r\nexport function useSmartMemo<T>(\r\n  factory: () => T,\r\n  deps: React.DependencyList,\r\n  options: {\r\n    maxAge?: number; // Tempo máximo em cache (ms)\r\n    compareFunction?: (prev: T, next: T) => boolean;\r\n  } = {}\r\n): T {\r\n  const { maxAge = 5 * 60 * 1000, compareFunction } = options; // 5 minutos padrão\r\n  const cacheRef = useRef<{ value: T; timestamp: number; deps: React.DependencyList } | null>(null);\r\n\r\n  return useMemo(() => {\r\n    const now = Date.now();\r\n    const cache = cacheRef.current;\r\n\r\n    // Verifica se o cache é válido\r\n    if (cache && \r\n        cache.deps.length === deps.length &&\r\n        cache.deps.every((dep, index) => dep === deps[index]) &&\r\n        (now - cache.timestamp) < maxAge) {\r\n      \r\n      const newValue = factory();\r\n      \r\n      // Se há função de comparação personalizada, usa ela\r\n      if (compareFunction && compareFunction(cache.value, newValue)) {\r\n        return cache.value;\r\n      }\r\n      \r\n      // Se não há mudança significativa, retorna o valor em cache\r\n      if (!compareFunction && JSON.stringify(cache.value) === JSON.stringify(newValue)) {\r\n        return cache.value;\r\n      }\r\n    }\r\n\r\n    // Calcula novo valor e atualiza cache\r\n    const newValue = factory();\r\n    cacheRef.current = {\r\n      value: newValue,\r\n      timestamp: now,\r\n      deps: [...deps]\r\n    };\r\n\r\n    return newValue;\r\n  }, deps);\r\n}\r\n\r\n// Hook para debouncing otimizado\r\nexport function useDebounce<T extends (...args: any[]) => any>(\r\n  callback: T,\r\n  delay: number,\r\n  options: {\r\n    leading?: boolean;\r\n    trailing?: boolean;\r\n    maxWait?: number;\r\n  } = {}\r\n): DebouncedFunc<T> {\r\n  const { leading = false, trailing = true, maxWait } = options;\r\n\r\n  return useCallback(\r\n    debounce(callback, delay, {\r\n      leading,\r\n      trailing,\r\n      maxWait,\r\n    }),\r\n    [callback, delay, leading, trailing, maxWait]\r\n  );\r\n}\r\n\r\n// Hook para throttling otimizado\r\nexport function useOptimizedThrottle<T extends (...args: any[]) => any>(\r\n  callback: T,\r\n  delay: number,\r\n  options: {\r\n    leading?: boolean;\r\n    trailing?: boolean;\r\n  } = {}\r\n): DebouncedFunc<T> {\r\n  const { leading = true, trailing = true } = options;\r\n\r\n  return useCallback(\r\n    throttle(callback, delay, {\r\n      leading,\r\n      trailing,\r\n    }),\r\n    [callback, delay, leading, trailing]\r\n  );\r\n}\r\n\r\n// Hook para monitoramento de performance de componente\r\nexport function usePerformanceMonitoring(componentName: string): PerformanceMetrics {\r\n  const [metrics, setMetrics] = useState<PerformanceMetrics>({\r\n    renderCount: 0,\r\n    lastRenderTime: 0,\r\n    averageRenderTime: 0,\r\n  });\r\n\r\n  const renderTimesRef = useRef<number[]>([]);\r\n  const startTimeRef = useRef<number>(0);\r\n\r\n  useEffect(() => {\r\n    startTimeRef.current = performance.now();\r\n  });\r\n\r\n  useEffect(() => {\r\n    const endTime = performance.now();\r\n    const renderTime = endTime - startTimeRef.current;\r\n    \r\n    renderTimesRef.current.push(renderTime);\r\n    \r\n    // Mantém apenas os últimos 10 renders para calcular média\r\n    if (renderTimesRef.current.length > 10) {\r\n      renderTimesRef.current.shift();\r\n    }\r\n\r\n    const averageRenderTime = renderTimesRef.current.reduce((a, b) => a + b, 0) / renderTimesRef.current.length;\r\n\r\n    setMetrics(prev => ({\r\n      renderCount: prev.renderCount + 1,\r\n      lastRenderTime: renderTime,\r\n      averageRenderTime,\r\n      memoryUsage: (performance as any).memory?.usedJSHeapSize,\r\n    }));\r\n\r\n    // Log em desenvolvimento\r\n    if (process.env.NODE_ENV === 'development' && renderTime > 16) {\r\n      console.warn(`${componentName} render took ${renderTime.toFixed(2)}ms (>16ms threshold)`);\r\n    }\r\n  });\r\n\r\n  return metrics;\r\n}\r\n\r\n// Hook para lazy state (só atualiza quando necessário)\r\nexport function useLazyState<T>(\r\n  initialValue: T,\r\n  compareFn?: (prev: T, next: T) => boolean\r\n): [T, (value: T | ((prev: T) => T)) => void] {\r\n  const [state, setState] = useState(initialValue);\r\n  const lastValueRef = useRef(initialValue);\r\n\r\n  const setLazyState = useCallback((value: T | ((prev: T) => T)) => {\r\n    setState(prevState => {\r\n      const newValue = typeof value === 'function' ? (value as (prev: T) => T)(prevState) : value;\r\n      \r\n      // Usa função de comparação personalizada ou comparação padrão\r\n      const hasChanged = compareFn \r\n        ? !compareFn(lastValueRef.current, newValue)\r\n        : lastValueRef.current !== newValue;\r\n\r\n      if (hasChanged) {\r\n        lastValueRef.current = newValue;\r\n        return newValue;\r\n      }\r\n\r\n      return prevState;\r\n    });\r\n  }, [compareFn]);\r\n\r\n  return [state, setLazyState];\r\n}\r\n\r\n// Hook para intersection observer otimizado\r\nexport function useIntersectionObserver(\r\n  options: IntersectionObserverInit = {}\r\n): [React.RefObject<HTMLElement | null>, boolean] {\r\n  const [isIntersecting, setIsIntersecting] = useState(false);\r\n  const targetRef = useRef<HTMLElement>(null);\r\n\r\n  useEffect(() => {\r\n    const target = targetRef.current;\r\n    if (!target) return;\r\n\r\n    const observer = new IntersectionObserver(\r\n      ([entry]) => {\r\n        setIsIntersecting(entry.isIntersecting);\r\n      },\r\n      {\r\n        threshold: 0.1,\r\n        rootMargin: '50px',\r\n        ...options,\r\n      }\r\n    );\r\n\r\n    observer.observe(target);\r\n\r\n    return () => {\r\n      observer.unobserve(target);\r\n    };\r\n  }, [options]);\r\n\r\n  return [targetRef, isIntersecting];\r\n}\r\n\r\n// Hook para preload de recursos\r\nexport function useResourcePreloader() {\r\n  const preloadedResources = useRef(new Set<string>());\r\n\r\n  const preloadImage = useCallback((src: string) => {\r\n    if (preloadedResources.current.has(src)) return;\r\n\r\n    const img = new Image();\r\n    img.src = src;\r\n    preloadedResources.current.add(src);\r\n  }, []);\r\n\r\n  const preloadScript = useCallback((src: string) => {\r\n    if (preloadedResources.current.has(src)) return;\r\n\r\n    const link = document.createElement('link');\r\n    link.rel = 'preload';\r\n    link.as = 'script';\r\n    link.href = src;\r\n    document.head.appendChild(link);\r\n    preloadedResources.current.add(src);\r\n  }, []);\r\n\r\n  const preloadStylesheet = useCallback((href: string) => {\r\n    if (preloadedResources.current.has(href)) return;\r\n\r\n    const link = document.createElement('link');\r\n    link.rel = 'preload';\r\n    link.as = 'style';\r\n    link.href = href;\r\n    document.head.appendChild(link);\r\n    preloadedResources.current.add(href);\r\n  }, []);\r\n\r\n  return {\r\n    preloadImage,\r\n    preloadScript,\r\n    preloadStylesheet,\r\n  };\r\n}\r\n\r\n// Hook para otimização de re-renders\r\nexport function useRenderOptimization<T extends Record<string, any>>(\r\n  props: T,\r\n  dependencies: (keyof T)[] = []\r\n): T {\r\n  return useMemo(() => {\r\n    if (dependencies.length === 0) {\r\n      return props;\r\n    }\r\n\r\n    // Cria objeto apenas com as propriedades especificadas\r\n    const optimizedProps = {} as T;\r\n    dependencies.forEach(key => {\r\n      optimizedProps[key] = props[key];\r\n    });\r\n\r\n    return optimizedProps;\r\n  }, dependencies.map(key => props[key]));\r\n}\r\n\r\n// Hook para virtual scrolling simples\r\nexport function useVirtualScrolling<T>(\r\n  items: T[],\r\n  itemHeight: number,\r\n  containerHeight: number\r\n) {\r\n  const [scrollTop, setScrollTop] = useState(0);\r\n\r\n  const visibleRange = useMemo(() => {\r\n    const start = Math.floor(scrollTop / itemHeight);\r\n    const end = Math.min(\r\n      start + Math.ceil(containerHeight / itemHeight) + 1,\r\n      items.length\r\n    );\r\n\r\n    return { start, end };\r\n  }, [scrollTop, itemHeight, containerHeight, items.length]);\r\n\r\n  const visibleItems = useMemo(() => {\r\n    return items.slice(visibleRange.start, visibleRange.end).map((item, index) => ({\r\n      item,\r\n      index: visibleRange.start + index,\r\n    }));\r\n  }, [items, visibleRange]);\r\n\r\n  const totalHeight = items.length * itemHeight;\r\n  const offsetY = visibleRange.start * itemHeight;\r\n\r\n  return {\r\n    visibleItems,\r\n    totalHeight,\r\n    offsetY,\r\n    setScrollTop,\r\n  };\r\n}","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/hooks/use-rate-limit.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/hooks/use-real-time-data.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback received a function whose dependencies are unknown. Pass an inline function instead.","line":171,"column":38,"nodeType":"Identifier","endLine":171,"endColumn":49}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Hook personalizado para gerenciar dados em tempo real\r\n * Implementa polling via API middleware para maior segurança\r\n */\r\n\r\nimport { useState, useEffect, useRef, useCallback } from 'react';\r\n\r\n// Função de debounce para otimizar chamadas\r\nfunction debounce<T extends (...args: any[]) => any>(\r\n  func: T,\r\n  wait: number\r\n): (...args: Parameters<T>) => void {\r\n  let timeout: NodeJS.Timeout;\r\n  return (...args: Parameters<T>) => {\r\n    clearTimeout(timeout);\r\n    timeout = setTimeout(() => func(...args), wait);\r\n  };\r\n}\r\n\r\ninterface UseRealTimeDataOptions {\r\n  dataType?: 'signals' | 'kpis' | 'tables' | 'all';\r\n  pollingInterval?: number;\r\n  limit?: number;\r\n  onData?: (data: any) => void;\r\n  onError?: (error: Error) => void;\r\n  autoStart?: boolean;\r\n}\r\n\r\ninterface RealTimeDataState<T> {\r\n  data: T | null;\r\n  isConnected: boolean;\r\n  isLoading: boolean;\r\n  error: string | null;\r\n  lastUpdate: Date | null;\r\n  cacheAge?: number;\r\n}\r\n\r\nexport function useRealTimeData<T = any>(options: UseRealTimeDataOptions = {}) {\r\n  const {\r\n    dataType = 'all',\r\n    pollingInterval = 15000, // 15 segundos\r\n    limit = 10,\r\n    onData,\r\n    onError,\r\n    autoStart = true\r\n  } = options;\r\n\r\n  const [state, setState] = useState<RealTimeDataState<T>>({\r\n    data: null,\r\n    isConnected: false,\r\n    isLoading: false,\r\n    error: null,\r\n    lastUpdate: null,\r\n    cacheAge: 0\r\n  });\r\n\r\n  const pollingRef = useRef<NodeJS.Timeout | null>(null);\r\n  const isActiveRef = useRef(false);\r\n  const retryCountRef = useRef(0);\r\n  const API_ENDPOINT = '/api/realtime-data';\r\n  const MAX_RETRIES = 3;\r\n  const RETRY_DELAY = 2000; // 2 segundos\r\n\r\n  // Função para atualizar dados\r\n  const updateData = useCallback((newData: T, cacheAge?: number) => {\r\n    setState(prev => ({\r\n      ...prev,\r\n      data: newData,\r\n      lastUpdate: new Date(),\r\n      error: null,\r\n      isConnected: true,\r\n      cacheAge: cacheAge || 0\r\n    }));\r\n    onData?.(newData);\r\n  }, [onData]);\r\n\r\n  // Função para definir erro\r\n  const setError = useCallback((error: string | Error) => {\r\n    const errorMessage = error instanceof Error ? error.message : error;\r\n    setState(prev => ({\r\n      ...prev,\r\n      error: errorMessage,\r\n      isLoading: false,\r\n      isConnected: false\r\n    }));\r\n    onError?.(error instanceof Error ? error : new Error(errorMessage));\r\n  }, [onError]);\r\n\r\n  // Função para buscar dados via API middleware\r\n  const fetchRealtimeData = useCallback(async () => {\r\n    if (!isActiveRef.current) return;\r\n\r\n    try {\r\n      setState(prev => ({ ...prev, isLoading: true, error: null }));\r\n      \r\n      // Construir URL com parâmetros\r\n      const params = new URLSearchParams({\r\n        type: dataType,\r\n        limit: limit.toString()\r\n      });\r\n      \r\n      const response = await fetch(`${API_ENDPOINT}?${params}`, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        cache: 'no-cache',\r\n        signal: AbortSignal.timeout(10000) // 10 segundos timeout\r\n      });\r\n      \r\n      if (response.status === 429) {\r\n        // Rate limit - aguardar mais tempo antes da próxima tentativa\r\n        throw new Error('Rate limit excedido. Aguardando...');\r\n      }\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(`HTTP error! status: ${response.status}`);\r\n      }\r\n      \r\n      const result = await response.json();\r\n      \r\n      if (result.error) {\r\n        throw new Error(result.error);\r\n      }\r\n      \r\n      // Reset retry count em caso de sucesso\r\n      retryCountRef.current = 0;\r\n      updateData(result as T, result.cacheAge);\r\n      \r\n    } catch (error) {\r\n      // Ignorar aborts/timeout silenciosamente para evitar ruído em navegação/re-render\r\n      if (error && (error as any).name === 'AbortError') {\r\n        setState(prev => ({ ...prev, isLoading: false }));\r\n        // Reagendar polling normalmente\r\n        if (isActiveRef.current && retryCountRef.current === 0) {\r\n          pollingRef.current = setTimeout(fetchRealtimeData, pollingInterval);\r\n        }\r\n        return;\r\n      }\r\n      const errorMessage = error instanceof Error ? error.message : 'Erro desconhecido';\r\n      \r\n      // Implementar retry logic\r\n      if (retryCountRef.current < MAX_RETRIES && isActiveRef.current) {\r\n        retryCountRef.current++;\r\n        console.warn(`Tentativa ${retryCountRef.current}/${MAX_RETRIES} falhou: ${errorMessage}`);\r\n        \r\n        // Aguardar antes de tentar novamente\r\n        setTimeout(() => {\r\n          if (isActiveRef.current) {\r\n            fetchRealtimeData();\r\n          }\r\n        }, RETRY_DELAY * retryCountRef.current); // Backoff exponencial\r\n        \r\n        return; // Não definir erro ainda, aguardar retry\r\n      }\r\n      \r\n      // Após esgotar tentativas, definir erro\r\n      setError(error as Error);\r\n      retryCountRef.current = 0;\r\n    } finally {\r\n      setState(prev => ({ ...prev, isLoading: false }));\r\n      \r\n      // Agendar próximo polling apenas se não houve erro crítico\r\n      if (isActiveRef.current && retryCountRef.current === 0) {\r\n        pollingRef.current = setTimeout(fetchRealtimeData, pollingInterval);\r\n      }\r\n    }\r\n  }, [dataType, limit, pollingInterval, updateData, setError]);\r\n  \r\n  // Versão com debounce da função fetch\r\n  const debouncedFetchRealtimeData = useCallback(\r\n    debounce(fetchRealtimeData, 500), // 500ms debounce\r\n    [fetchRealtimeData]\r\n  );\r\n\r\n  // Função para iniciar polling\r\n  const startPolling = useCallback(() => {\r\n    if (!isActiveRef.current) return;\r\n    \r\n    // Iniciando polling de dados em tempo real\r\n    \r\n    // Buscar dados imediatamente (com debounce)\r\n    debouncedFetchRealtimeData();\r\n  }, [debouncedFetchRealtimeData]);\r\n\r\n  // Função para iniciar conexão\r\n  const start = useCallback(() => {\r\n    if (isActiveRef.current) return;\r\n    \r\n    isActiveRef.current = true;\r\n    setState(prev => ({ ...prev, isLoading: true }));\r\n    \r\n    // Iniciar polling via API middleware\r\n    startPolling();\r\n  }, [startPolling]);\r\n\r\n  // Função para parar conexão\r\n  const stop = useCallback(() => {\r\n    isActiveRef.current = false;\r\n    \r\n    // Parar polling\r\n    if (pollingRef.current) {\r\n      clearTimeout(pollingRef.current);\r\n      pollingRef.current = null;\r\n    }\r\n    \r\n    setState(prev => ({\r\n      ...prev,\r\n      isConnected: false,\r\n      isLoading: false\r\n    }));\r\n    \r\n    // Polling de dados em tempo real parado\r\n  }, []);\r\n\r\n  // Função para forçar atualização\r\n  const refresh = useCallback(async () => {\r\n    if (!isActiveRef.current) return;\r\n    \r\n    // Parar polling atual\r\n    if (pollingRef.current) {\r\n      clearTimeout(pollingRef.current);\r\n      pollingRef.current = null;\r\n    }\r\n    \r\n    // Reset retry count para refresh manual\r\n    retryCountRef.current = 0;\r\n    \r\n    // Buscar dados imediatamente (sem debounce para refresh manual)\r\n    await fetchRealtimeData();\r\n  }, [fetchRealtimeData]);\r\n\r\n  // Efeito para auto-iniciar\r\n  useEffect(() => {\r\n    if (autoStart) {\r\n      isActiveRef.current = true;\r\n      setState(prev => ({ ...prev, isLoading: true }));\r\n      startPolling();\r\n    }\r\n    \r\n    return () => {\r\n      isActiveRef.current = false;\r\n      if (pollingRef.current) {\r\n        clearTimeout(pollingRef.current);\r\n        pollingRef.current = null;\r\n      }\r\n      setState(prev => ({\r\n        ...prev,\r\n        isConnected: false,\r\n        isLoading: false\r\n      }));\r\n    };\r\n  }, [autoStart, startPolling]);\r\n\r\n  return {\r\n    ...state,\r\n    start,\r\n    stop,\r\n    refresh,\r\n    isActive: isActiveRef.current\r\n  };\r\n}\r\n\r\n// Hook específico para sinais em tempo real\r\nexport function useRealTimeSignals(options: Omit<UseRealTimeDataOptions, 'dataType'> = {}) {\r\n  return useRealTimeData({\r\n    ...options,\r\n    dataType: 'signals',\r\n    pollingInterval: 15000\r\n  });\r\n}\r\n\r\n// Hook específico para status das mesas\r\nexport function useRealTimeTableStatus(options: Omit<UseRealTimeDataOptions, 'dataType'> = {}) {\r\n  return useRealTimeData({\r\n    ...options,\r\n    dataType: 'tables',\r\n    pollingInterval: 20000\r\n  });\r\n}\r\n\r\n// Hook específico para KPIs\r\nexport function useRealTimeKPIs(options: Omit<UseRealTimeDataOptions, 'dataType'> = {}) {\r\n  return useRealTimeData({\r\n    ...options,\r\n    dataType: 'kpis',\r\n    pollingInterval: 30000 // KPIs podem ser atualizados menos frequentemente\r\n  });\r\n}\r\n\r\n// Hook para todos os dados em tempo real\r\nexport function useRealTimeAll(options: Omit<UseRealTimeDataOptions, 'dataType'> = {}) {\r\n  return useRealTimeData({\r\n    ...options,\r\n    dataType: 'all',\r\n    pollingInterval: 15000\r\n  });\r\n}","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/hooks/use-signal-notifications.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/hooks/use-sofia-auth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/hooks/use-sofia-backend.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/hooks/use-toast.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/hooks/use-user.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/hooks/use-websocket.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/hooks/useAutomation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/hooks/useCreateRecipient.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/hooks/useRealtimeSignals.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/hooks/useSessionManagement.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'loadMetrics', 'loadSessions', 'loadStrategies', and 'loadTemplates'. Either include them or remove the dependency array.","line":18,"column":6,"nodeType":"ArrayExpression","endLine":18,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadMetrics, loadSessions, loadStrategies, loadTemplates]","fix":{"range":[717,719],"text":"[loadMetrics, loadSessions, loadStrategies, loadTemplates]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\nimport { Session, Strategy, SessionTemplate, SessionMetrics, SessionLog } from '@/types/session-management';\n\nexport function useSessionManagement() {\n  const [sessions, setSessions] = useState<Session[]>([]);\n  const [strategies, setStrategies] = useState<Strategy[]>([]);\n  const [templates, setTemplates] = useState<SessionTemplate[]>([]);\n  const [metrics, setMetrics] = useState<SessionMetrics | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  // Carregar dados iniciais\n  useEffect(() => {\n    loadSessions();\n    loadStrategies();\n    loadTemplates();\n    loadMetrics();\n  }, []);\n\n  const loadSessions = useCallback(async () => {\n    try {\n      setLoading(true);\n      const response = await fetch('/api/sessions');\n      if (!response.ok) throw new Error('Erro ao carregar sessões');\n      const data = await response.json();\n      setSessions(data);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Erro desconhecido');\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  const loadStrategies = useCallback(async () => {\n    try {\n      const response = await fetch('/api/strategies');\n      if (!response.ok) throw new Error('Erro ao carregar estratégias');\n      const data = await response.json();\n      setStrategies(data);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Erro ao carregar estratégias');\n    }\n  }, []);\n\n  const loadTemplates = useCallback(async () => {\n    try {\n      const response = await fetch('/api/session-templates');\n      if (!response.ok) throw new Error('Erro ao carregar templates');\n      const data = await response.json();\n      setTemplates(data);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Erro ao carregar templates');\n    }\n  }, []);\n\n  const loadMetrics = useCallback(async () => {\n    try {\n      const response = await fetch('/api/session-metrics');\n      if (!response.ok) throw new Error('Erro ao carregar métricas');\n      const data = await response.json();\n      setMetrics(data);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Erro ao carregar métricas');\n    }\n  }, []);\n\n  // Gerenciamento de sessões\n  const createSession = useCallback(async (sessionData: Partial<Session>) => {\n    try {\n      setLoading(true);\n      const response = await fetch('/api/sessions', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(sessionData)\n      });\n      if (!response.ok) throw new Error('Erro ao criar sessão');\n      const newSession = await response.json();\n      setSessions(prev => [...prev, newSession]);\n      return newSession;\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Erro ao criar sessão');\n      throw err;\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  const updateSession = useCallback(async (sessionId: string, updates: Partial<Session>) => {\n    try {\n      const response = await fetch(`/api/sessions/${sessionId}`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(updates)\n      });\n      if (!response.ok) throw new Error('Erro ao atualizar sessão');\n      const updatedSession = await response.json();\n      setSessions(prev => prev.map(s => s.id === sessionId ? updatedSession : s));\n      return updatedSession;\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Erro ao atualizar sessão');\n      throw err;\n    }\n  }, []);\n\n  const deleteSession = useCallback(async (sessionId: string) => {\n    try {\n      const response = await fetch(`/api/sessions/${sessionId}`, {\n        method: 'DELETE'\n      });\n      if (!response.ok) throw new Error('Erro ao deletar sessão');\n      setSessions(prev => prev.filter(s => s.id !== sessionId));\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Erro ao deletar sessão');\n      throw err;\n    }\n  }, []);\n\n  const startSession = useCallback(async (sessionId: string) => {\n    return updateSession(sessionId, { status: 'active', startTime: new Date() });\n  }, [updateSession]);\n\n  const pauseSession = useCallback(async (sessionId: string) => {\n    return updateSession(sessionId, { status: 'paused' });\n  }, [updateSession]);\n\n  const stopSession = useCallback(async (sessionId: string) => {\n    return updateSession(sessionId, { status: 'stopped', endTime: new Date() });\n  }, [updateSession]);\n\n  // Gerenciamento de estratégias\n  const createStrategy = useCallback(async (strategyData: Omit<Strategy, 'id' | 'performance'>) => {\n    try {\n      setLoading(true);\n      const response = await fetch('/api/strategies', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(strategyData)\n      });\n      if (!response.ok) throw new Error('Erro ao criar estratégia');\n      const newStrategy = await response.json();\n      setStrategies(prev => [...prev, newStrategy]);\n      return newStrategy;\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Erro ao criar estratégia');\n      throw err;\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  const updateStrategy = useCallback(async (strategyId: string, updates: Partial<Strategy>) => {\n    try {\n      const response = await fetch(`/api/strategies/${strategyId}`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(updates)\n      });\n      if (!response.ok) throw new Error('Erro ao atualizar estratégia');\n      const updatedStrategy = await response.json();\n      setStrategies(prev => prev.map(s => s.id === strategyId ? updatedStrategy : s));\n      return updatedStrategy;\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Erro ao atualizar estratégia');\n      throw err;\n    }\n  }, []);\n\n  // Logs de sessão\n  const addSessionLog = useCallback(async (sessionId: string, log: Omit<SessionLog, 'id' | 'timestamp'>) => {\n    try {\n      const response = await fetch(`/api/sessions/${sessionId}/logs`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(log)\n      });\n      if (!response.ok) throw new Error('Erro ao adicionar log');\n      const newLog = await response.json();\n      \n      // Atualizar sessão local com novo log\n      setSessions(prev => prev.map(session => \n        session.id === sessionId \n          ? { ...session, logs: [...session.logs, newLog] }\n          : session\n      ));\n      \n      return newLog;\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Erro ao adicionar log');\n      throw err;\n    }\n  }, []);\n\n  // Utilitários\n  const getActiveSession = useCallback(() => {\n    return sessions.find(session => session.status === 'active');\n  }, [sessions]);\n\n  const getSessionsByStrategy = useCallback((strategyId: string) => {\n    return sessions.filter(session => session.strategy.id === strategyId);\n  }, [sessions]);\n\n  const clearError = useCallback(() => {\n    setError(null);\n  }, []);\n\n  return {\n    // Estado\n    sessions,\n    strategies,\n    templates,\n    metrics,\n    loading,\n    error,\n    \n    // Ações de sessão\n    createSession,\n    updateSession,\n    deleteSession,\n    startSession,\n    pauseSession,\n    stopSession,\n    \n    // Ações de estratégia\n    createStrategy,\n    updateStrategy,\n    \n    // Logs\n    addSessionLog,\n    \n    // Utilitários\n    getActiveSession,\n    getSessionsByStrategy,\n    clearError,\n    \n    // Recarregar dados\n    loadSessions,\n    loadStrategies,\n    loadTemplates,\n    loadMetrics\n  };\n}","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/hooks/useUserStatus.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'loadStatusHistory' and 'loadUserProfile'. Either include them or remove the dependency array.","line":277,"column":6,"nodeType":"ArrayExpression","endLine":277,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [loadStatusHistory, loadUserProfile, userId]","fix":{"range":[8073,8081],"text":"[loadStatusHistory, loadUserProfile, userId]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { \n  UserStatus,\n  UserPlan,\n  UserRole,\n  validateStatusChange\n} from '@/lib/user-status';\n\nexport interface StatusChangeRequest {\n  userId: string;\n  newStatus: UserStatus;\n  reason?: string;\n  changedBy?: string;\n  metadata?: Record<string, any>;\n}\n\ninterface UserProfile {\n  user_id: string;\n  status: UserStatus;\n  plan: UserPlan;\n  role: UserRole;\n  full_name?: string;\n  email?: string;\n  created_at: string;\n  updated_at: string;\n}\n\ninterface StatusChangeHistory {\n  id: string;\n  user_id: string;\n  old_status: UserStatus;\n  new_status: UserStatus;\n  reason?: string;\n  changed_by?: string;\n  changed_at: string;\n  metadata?: Record<string, any>;\n}\n\nexport function useUserStatus(userId?: string) {\n  const [userProfile, setUserProfile] = useState<UserProfile | null>(null);\n  const [statusHistory, setStatusHistory] = useState<StatusChangeHistory[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  // Carregar perfil do usuário\n  const loadUserProfile = async (targetUserId?: string) => {\n    try {\n      setLoading(true);\n      setError(null);\n\n      const id = targetUserId || userId;\n      if (!id) {\n        throw new Error('ID do usuário é obrigatório');\n      }\n\n      const { data, error: fetchError } = await supabase\n        .from('user_profiles')\n        .select(`\n          user_id,\n          status,\n          plan,\n          role,\n          full_name,\n          created_at,\n          updated_at\n        `)\n        .eq('user_id', id)\n        .single();\n\n      if (fetchError) throw fetchError;\n      \n      setUserProfile(data);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Erro ao carregar perfil');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Carregar histórico de mudanças\n  const loadStatusHistory = async (targetUserId?: string) => {\n    try {\n      const id = targetUserId || userId;\n      if (!id) return;\n\n      const { data, error: fetchError } = await supabase\n        .from('user_status_changes')\n        .select('*')\n        .eq('user_id', id)\n        .order('changed_at', { ascending: false })\n        .limit(50);\n\n      if (fetchError) throw fetchError;\n      \n      // Cast for compatibility if needed, assuming the DB returns compatible strings\n      setStatusHistory((data as any[]) || []);\n    } catch (err) {\n      console.error('Erro ao carregar histórico:', err);\n    }\n  };\n\n  // Alterar status do usuário\n  const changeUserStatus = async (request: StatusChangeRequest): Promise<boolean> => {\n    try {\n      if (!userProfile) {\n        throw new Error('Perfil do usuário não carregado');\n      }\n\n      // Validar mudança de status usando o status atual (UserStatus)\n      // Nota: validateStatusChange pode precisar ser atualizada para aceitar UserStatus se ainda esperar AccountStatus\n      // Assumindo que UserStatus é compatível ou que a função foi atualizada\n      const validation = validateStatusChange(userProfile.status, request);\n      if (!validation.valid) {\n        throw new Error(validation.error);\n      }\n\n      setLoading(true);\n      setError(null);\n\n      // Atualizar status na tabela user_profiles\n      // Aqui atualizamos a coluna 'status', não 'account_status'\n      const { error: updateError } = await supabase\n        .from('user_profiles')\n        .update({ \n          status: request.newStatus,\n          updated_at: new Date().toISOString()\n        })\n        .eq('user_id', request.userId);\n\n      if (updateError) throw updateError;\n\n      // Registrar mudança no histórico\n      const { error: historyError } = await supabase\n        .from('user_status_changes')\n        .insert({\n          user_id: request.userId,\n          old_status: userProfile.status,\n          new_status: request.newStatus,\n          reason: request.reason,\n          changed_by: request.changedBy,\n          metadata: request.metadata\n        });\n\n      if (historyError) {\n        console.error('Erro ao registrar histórico:', historyError);\n        // Não falha a operação se o histórico não for salvo\n      }\n\n      // Atualizar estado local\n      setUserProfile(prev => prev ? {\n        ...prev,\n        status: request.newStatus as UserStatus,\n        updated_at: new Date().toISOString()\n      } : null);\n\n      // Recarregar histórico\n      await loadStatusHistory(request.userId);\n\n      return true;\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Erro ao alterar status');\n      return false;\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Verificar permissões do usuário atual\n  const checkCurrentUserPermissions = async () => {\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) return null;\n\n      const { data, error } = await supabase\n        .from('user_profiles')\n        .select('status, plan, role, permissions')\n        .eq('user_id', user.id)\n        .single();\n\n      if (error) throw error;\n\n      // Adaptar verificações para usar os novos campos\n      // userHasAccess agora deve verificar status/plan/role ou ser atualizada\n      // Se as funções utilitárias ainda esperam AccountStatus, isso pode ser um problema.\n      // Vou assumir que devo passar o 'status' novo.\n      \n      // IMPORTANTE: As funções utilitárias em lib/user-status.ts precisam suportar UserStatus/UserPlan/UserRole\n      // Como não posso ver o conteúdo atualizado de lib/user-status.ts aqui, vou assumir que\n      // userHasAccess(status) funciona ou que preciso refazer a lógica aqui.\n      // Dado o contexto, vou usar os campos diretos onde possível ou passar os novos valores.\n      \n      return {\n        hasAccess: data.status === UserStatus.ACTIVE || data.plan === UserPlan.PRO,\n        isBlocked: data.status === UserStatus.BLOCKED,\n        isPremium: data.plan === UserPlan.PRO,\n        isAdmin: data.role === UserRole.ADMIN,\n        isSuperAdmin: false, // Role não tem superadmin, mapeado para admin\n        status: data.status,\n        permissions: data.permissions || {}\n      };\n    } catch (err) {\n      console.error('Erro ao verificar permissões:', err);\n      return null;\n    }\n  };\n\n  // Buscar usuários por status\n  const getUsersByStatus = async (status: UserStatus | UserStatus[]) => {\n    try {\n      const statuses = Array.isArray(status) ? status : [status];\n      \n      const { data, error } = await supabase\n        .from('user_profiles')\n        .select(`\n          user_id,\n          status,\n          plan,\n          role,\n          full_name,\n          created_at,\n          updated_at\n        `)\n        .in('status', statuses)\n        .order('updated_at', { ascending: false });\n\n      if (error) throw error;\n      \n      return data || [];\n    } catch (err) {\n      console.error('Erro ao buscar usuários por status:', err);\n      return [];\n    }\n  };\n\n  // Estatísticas de status\n  const getStatusStats = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('user_profiles')\n        .select('status, plan, role');\n\n      if (error) throw error;\n\n      const stats = data.reduce((acc, user) => {\n        const s = user.status;\n        acc[s] = (acc[s] || 0) + 1;\n        return acc;\n      }, {} as Record<string, number>);\n\n      const total = data.length;\n      const active = data.filter(u => u.status === UserStatus.ACTIVE).length;\n      const blocked = data.filter(u => u.status === UserStatus.BLOCKED).length;\n      const premium = data.filter(u => u.plan === UserPlan.PRO).length;\n\n      return {\n        total,\n        active,\n        blocked,\n        premium,\n        pending: stats['pending'] || 0,\n        inactive: stats[UserStatus.INACTIVE] || 0,\n        byStatus: stats\n      };\n    } catch (err) {\n      console.error('Erro ao obter estatísticas:', err);\n      return null;\n    }\n  };\n\n  // Efeito para carregar dados iniciais\n  useEffect(() => {\n    if (userId) {\n      loadUserProfile(userId);\n      loadStatusHistory(userId);\n    }\n  }, [userId]);\n\n  return {\n    // Estado\n    userProfile,\n    statusHistory,\n    loading,\n    error,\n    \n    // Ações\n    loadUserProfile,\n    loadStatusHistory,\n    changeUserStatus,\n    checkCurrentUserPermissions,\n    getUsersByStatus,\n    getStatusStats,\n    \n    // Utilitários\n    hasAccess: userProfile ? (userProfile.status === UserStatus.ACTIVE || userProfile.plan === UserPlan.PRO) : false,\n    isBlocked: userProfile ? userProfile.status === UserStatus.BLOCKED : false,\n    isPremium: userProfile ? userProfile.plan === UserPlan.PRO : false,\n    currentStatus: userProfile?.status || UserStatus.INACTIVE\n  };\n}\n\n// Hook para verificar status do usuário logado\nexport function useCurrentUserStatus() {\n  const [status, setStatus] = useState<{\n    hasAccess: boolean;\n    isBlocked: boolean;\n    isPremium: boolean;\n    isAdmin: boolean;\n    status: UserStatus;\n    permissions: Record<string, any>;\n  } | null>(null);\n  \n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    const checkStatus = async () => {\n      try {\n        const { data: { user } } = await supabase.auth.getUser();\n        if (!user) {\n          setStatus(null);\n          return;\n        }\n\n        const { data, error } = await supabase\n          .from('user_profiles')\n          .select('status, plan, role, permissions')\n          .eq('user_id', user.id)\n          .single();\n\n        if (error) throw error;\n\n        setStatus({\n          hasAccess: data.status === UserStatus.ACTIVE || data.plan === UserPlan.PRO,\n          isBlocked: data.status === UserStatus.BLOCKED,\n          isPremium: data.plan === UserPlan.PRO,\n          isAdmin: data.role === UserRole.ADMIN,\n          status: data.status,\n          permissions: data.permissions || {}\n        });\n      } catch (err) {\n        console.error('Erro ao verificar status:', err);\n        setStatus(null);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    checkStatus();\n\n    // Escutar mudanças de autenticação\n    const { data: { subscription } } = supabase.auth.onAuthStateChange(() => {\n      checkStatus();\n    });\n\n    return () => subscription.unsubscribe();\n  }, []);\n\n  return { status, loading };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/hooks/useWebSocket.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The ref value 'unsubscribeFunctionsRef.current' will likely have changed by the time this effect cleanup function runs. If this ref points to a node rendered by React, copy 'unsubscribeFunctionsRef.current' to a variable inside the effect, and use that variable in the cleanup function.","line":239,"column":31,"nodeType":"Identifier","endLine":239,"endColumn":38},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The ref value 'subscribersRef.current' will likely have changed by the time this effect cleanup function runs. If this ref points to a node rendered by React, copy 'subscribersRef.current' to a variable inside the effect, and use that variable in the cleanup function.","line":240,"column":22,"nodeType":"Identifier","endLine":240,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState, useCallback, useRef } from 'react';\r\nimport { \r\n  WebSocketClient, \r\n  WebSocketChannel, \r\n  ConnectionState, \r\n  WEBSOCKET_CHANNELS,\r\n  getWebSocketClient \r\n} from '@/lib/websocket-client';\r\nimport { logger } from '@/lib/logger';\r\n\r\n// Tipos para o hook\r\nexport interface UseWebSocketOptions {\r\n  token?: string;\r\n  autoConnect?: boolean;\r\n  channels?: WebSocketChannel[];\r\n}\r\n\r\nexport interface UseWebSocketReturn {\r\n  // Estado da conexão\r\n  connectionState: ConnectionState;\r\n  isConnected: boolean;\r\n  isAuthenticated: boolean;\r\n  \r\n  // Métodos de controle\r\n  connect: (token?: string) => Promise<void>;\r\n  disconnect: () => void;\r\n  // Comandos\r\n  sendAutomationCommand: (command: string, data?: any) => boolean;\r\n  \r\n  // Gerenciamento de canais\r\n  subscribe: (channel: WebSocketChannel, callback: (data: any) => void) => () => void;\r\n  unsubscribe: (channel: WebSocketChannel, callback?: (data: any) => void) => void;\r\n  \r\n  // Dados recebidos\r\n  lastMessage: any;\r\n  channelData: Record<string, any>;\r\n  \r\n  // Estatísticas\r\n  reconnectAttempts: number;\r\n  subscriptions: string[];\r\n}\r\n\r\n// Hook principal\r\nexport function useWebSocket(options: UseWebSocketOptions = {}): UseWebSocketReturn {\r\n  const { token, autoConnect = true, channels = [] } = options;\r\n  \r\n  // Estados\r\n  const [connectionState, setConnectionState] = useState<ConnectionState>(ConnectionState.DISCONNECTED);\r\n  const [lastMessage, setLastMessage] = useState<any>(null);\r\n  const [channelData, setChannelData] = useState<Record<string, any>>({});\r\n  const [reconnectAttempts, setReconnectAttempts] = useState(0);\r\n  const [subscriptions, setSubscriptions] = useState<string[]>([]);\r\n  \r\n  // Refs\r\n  const clientRef = useRef<WebSocketClient | null>(null);\r\n  const subscribersRef = useRef<Map<string, (data: any) => void>>(new Map());\r\n  const unsubscribeFunctionsRef = useRef<Map<string, () => void>>(new Map());\r\n\r\n  // Inicializar cliente\r\n  useEffect(() => {\r\n    if (!clientRef.current) {\r\n      clientRef.current = getWebSocketClient({ token });\r\n      \r\n      // Configurar listeners de eventos\r\n      const onStateChange = () => {\r\n        setConnectionState(clientRef.current!.getState());\r\n        setSubscriptions(clientRef.current!.getSubscriptions());\r\n      };\r\n\r\n      const onConnect = () => {\r\n        logger.info('WebSocket conectado via hook');\r\n        setReconnectAttempts(0);\r\n        onStateChange();\r\n      };\r\n\r\n      const onDisconnect = () => {\r\n        logger.info('WebSocket desconectado via hook');\r\n        onStateChange();\r\n      };\r\n\r\n      const onAuthenticated = () => {\r\n        logger.info('WebSocket autenticado via hook');\r\n        onStateChange();\r\n        \r\n        // Re-inscrever em canais após autenticação\r\n        subscribersRef.current.forEach((callback, channel) => {\r\n          const unsubscribe = clientRef.current!.subscribe(channel as WebSocketChannel, callback);\r\n          unsubscribeFunctionsRef.current.set(channel, unsubscribe);\r\n        });\r\n      };\r\n\r\n      const onError = (error: any) => {\r\n        logger.error('Erro no WebSocket via hook:', { metadata: { error } });\r\n        setReconnectAttempts(prev => prev + 1);\r\n      };\r\n\r\n      // Adicionar listeners\r\n      clientRef.current.on('connect', onConnect);\r\n      clientRef.current.on('disconnect', onDisconnect);\r\n      clientRef.current.on('authenticated', onAuthenticated);\r\n      clientRef.current.on('error', onError);\r\n\r\n      // Cleanup function\r\n      return () => {\r\n        if (clientRef.current) {\r\n          clientRef.current.off('connect', onConnect);\r\n          clientRef.current.off('disconnect', onDisconnect);\r\n          clientRef.current.off('authenticated', onAuthenticated);\r\n          clientRef.current.off('error', onError);\r\n        }\r\n      };\r\n    }\r\n  }, [token]);\r\n\r\n  // Auto-conectar se solicitado\r\n  useEffect(() => {\r\n    if (autoConnect && clientRef.current && connectionState === ConnectionState.DISCONNECTED) {\r\n      clientRef.current.connect(token).catch(error => {\r\n        logger.error('Erro na auto-conexão:', { metadata: { error } });\r\n      });\r\n    }\r\n  }, [autoConnect, token, connectionState]);\r\n\r\n  // Inscrever-se em canais iniciais\r\n  useEffect(() => {\r\n    if (channels.length > 0 && clientRef.current && connectionState === ConnectionState.AUTHENTICATED) {\r\n      channels.forEach(channel => {\r\n        if (!subscribersRef.current.has(channel)) {\r\n          const callback = (data: any) => {\r\n            setLastMessage({ channel, data, timestamp: Date.now() });\r\n            setChannelData(prev => ({ ...prev, [channel]: data }));\r\n          };\r\n          \r\n          subscribersRef.current.set(channel, callback);\r\n          const unsubscribe = clientRef.current!.subscribe(channel, callback);\r\n          unsubscribeFunctionsRef.current.set(channel, unsubscribe);\r\n        }\r\n      });\r\n    }\r\n  }, [channels, connectionState]);\r\n\r\n  // Métodos de controle\r\n  const connect = useCallback(async (connectToken?: string) => {\r\n    if (clientRef.current) {\r\n      try {\r\n        await clientRef.current.connect(connectToken || token);\r\n      } catch (error) {\r\n        logger.error('Erro ao conectar via hook:', { metadata: { error } });\r\n        throw error;\r\n      }\r\n    }\r\n  }, [token]);\r\n\r\n  const disconnect = useCallback(() => {\r\n    if (clientRef.current) {\r\n      // Limpar todas as inscrições\r\n      unsubscribeFunctionsRef.current.forEach(unsubscribe => unsubscribe());\r\n      unsubscribeFunctionsRef.current.clear();\r\n      subscribersRef.current.clear();\r\n      \r\n      clientRef.current.disconnect();\r\n      setChannelData({});\r\n      setLastMessage(null);\r\n    }\r\n  }, []);\r\n\r\n  // Enviar comandos de automação\r\n  const sendAutomationCommand = useCallback((command: string, data?: any) => {\r\n    if (!clientRef.current) {\r\n      return false;\r\n    }\r\n    return clientRef.current.sendAutomationCommand(command, data);\r\n  }, []);\r\n\r\n  // Gerenciamento de canais\r\n  const subscribe = useCallback((channel: WebSocketChannel, callback: (data: any) => void) => {\r\n    if (!clientRef.current) {\r\n      throw new Error('Cliente WebSocket não inicializado');\r\n    }\r\n\r\n    // Wrapper para callback que atualiza estados\r\n    const wrappedCallback = (data: any) => {\r\n      setLastMessage({ channel, data, timestamp: Date.now() });\r\n      setChannelData(prev => ({ ...prev, [channel]: data }));\r\n      callback(data);\r\n    };\r\n\r\n    subscribersRef.current.set(channel, wrappedCallback);\r\n    \r\n    let unsubscribe: (() => void) | null = null;\r\n    \r\n    if (connectionState === ConnectionState.AUTHENTICATED) {\r\n      unsubscribe = clientRef.current.subscribe(channel, wrappedCallback);\r\n      unsubscribeFunctionsRef.current.set(channel, unsubscribe);\r\n    }\r\n\r\n    // Retornar função de cleanup\r\n    return () => {\r\n      subscribersRef.current.delete(channel);\r\n      const existingUnsubscribe = unsubscribeFunctionsRef.current.get(channel);\r\n      if (existingUnsubscribe) {\r\n        existingUnsubscribe();\r\n        unsubscribeFunctionsRef.current.delete(channel);\r\n      }\r\n      \r\n      // Remover dados do canal\r\n      setChannelData(prev => {\r\n        const newData = { ...prev };\r\n        delete newData[channel];\r\n        return newData;\r\n      });\r\n    };\r\n  }, [connectionState]);\r\n\r\n  const unsubscribe = useCallback((channel: WebSocketChannel, callback?: (data: any) => void) => {\r\n    if (clientRef.current) {\r\n      const unsubscribeFunc = unsubscribeFunctionsRef.current.get(channel);\r\n      if (unsubscribeFunc) {\r\n        unsubscribeFunc();\r\n        unsubscribeFunctionsRef.current.delete(channel);\r\n      }\r\n      \r\n      subscribersRef.current.delete(channel);\r\n      \r\n      // Remover dados do canal\r\n      setChannelData(prev => {\r\n        const newData = { ...prev };\r\n        delete newData[channel];\r\n        return newData;\r\n      });\r\n    }\r\n  }, []);\r\n\r\n  // Cleanup ao desmontar\r\n  useEffect(() => {\r\n    return () => {\r\n      // Limpar todas as inscrições ao desmontar\r\n      unsubscribeFunctionsRef.current.forEach(unsubscribe => unsubscribe());\r\n      unsubscribeFunctionsRef.current.clear();\r\n      subscribersRef.current.clear();\r\n    };\r\n  }, []);\r\n\r\n  return {\r\n    // Estado da conexão\r\n    connectionState,\r\n    isConnected: connectionState === ConnectionState.CONNECTED || connectionState === ConnectionState.AUTHENTICATED,\r\n    isAuthenticated: connectionState === ConnectionState.AUTHENTICATED,\r\n    \r\n    // Métodos de controle\r\n    connect,\r\n    disconnect,\r\n    \r\n    // Comandos\r\n    sendAutomationCommand,\r\n    \r\n    // Gerenciamento de canais\r\n    subscribe,\r\n    unsubscribe,\r\n    \r\n    // Dados recebidos\r\n    lastMessage,\r\n    channelData,\r\n    \r\n    // Estatísticas\r\n    reconnectAttempts,\r\n    subscriptions\r\n  };\r\n}\r\n\r\n// Hook específico para dados de roleta\r\nexport function useRouletteData() {\r\n  const { subscribe, channelData, isAuthenticated } = useWebSocket();\r\n  const [rouletteResults, setRouletteResults] = useState<any[]>([]);\r\n\r\n  useEffect(() => {\r\n    if (isAuthenticated) {\r\n      const unsubscribe = subscribe(WEBSOCKET_CHANNELS.ROULETTE_RESULTS, (data) => {\r\n        setRouletteResults(prev => [data, ...prev.slice(0, 49)]); // Manter últimos 50 resultados\r\n      });\r\n\r\n      return unsubscribe;\r\n    }\r\n  }, [isAuthenticated, subscribe]);\r\n\r\n  return {\r\n    currentResult: channelData[WEBSOCKET_CHANNELS.ROULETTE_RESULTS],\r\n    recentResults: rouletteResults,\r\n    isConnected: isAuthenticated\r\n  };\r\n}\r\n\r\n// Hook específico para sinais de IA\r\nexport function useAISignals() {\r\n  const { subscribe, channelData, isAuthenticated } = useWebSocket();\r\n  const [signals, setSignals] = useState<any[]>([]);\r\n\r\n  useEffect(() => {\r\n    if (isAuthenticated) {\r\n      const unsubscribe = subscribe(WEBSOCKET_CHANNELS.AI_SIGNALS, (data) => {\r\n        setSignals(prev => [data, ...prev.slice(0, 19)]); // Manter últimos 20 sinais\r\n      });\r\n\r\n      return unsubscribe;\r\n    }\r\n  }, [isAuthenticated, subscribe]);\r\n\r\n  return {\r\n    currentSignal: channelData[WEBSOCKET_CHANNELS.AI_SIGNALS],\r\n    recentSignals: signals,\r\n    isConnected: isAuthenticated\r\n  };\r\n}\r\n\r\n// Hook específico para métricas em tempo real\r\nexport function useLiveMetrics() {\r\n  const { subscribe, channelData, isAuthenticated } = useWebSocket();\r\n\r\n  useEffect(() => {\r\n    if (isAuthenticated) {\r\n      const unsubscribe = subscribe(WEBSOCKET_CHANNELS.LIVE_METRICS, () => {\r\n        // Dados já são atualizados automaticamente em channelData\r\n      });\r\n\r\n      return unsubscribe;\r\n    }\r\n  }, [isAuthenticated, subscribe]);\r\n\r\n  return {\r\n    metrics: channelData[WEBSOCKET_CHANNELS.LIVE_METRICS],\r\n    isConnected: isAuthenticated\r\n  };\r\n}\r\n\r\n// Hook para notificações do usuário\r\nexport function useUserNotifications() {\r\n  const { subscribe, isAuthenticated } = useWebSocket();\r\n  const [notifications, setNotifications] = useState<any[]>([]);\r\n\r\n  useEffect(() => {\r\n    if (isAuthenticated) {\r\n      const unsubscribe = subscribe(WEBSOCKET_CHANNELS.USER_NOTIFICATIONS, (data) => {\r\n        setNotifications(prev => [data, ...prev]);\r\n      });\r\n\r\n      return unsubscribe;\r\n    }\r\n  }, [isAuthenticated, subscribe]);\r\n\r\n  const markAsRead = useCallback((notificationId: string) => {\r\n    setNotifications(prev => \r\n      prev.map(notif => \r\n        notif.id === notificationId \r\n          ? { ...notif, read: true }\r\n          : notif\r\n      )\r\n    );\r\n  }, []);\r\n\r\n  const clearAll = useCallback(() => {\r\n    setNotifications([]);\r\n  }, []);\r\n\r\n  return {\r\n    notifications,\r\n    unreadCount: notifications.filter(n => !n.read).length,\r\n    markAsRead,\r\n    clearAll,\r\n    isConnected: isAuthenticated\r\n  };\r\n}","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/alert-sound.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/analytics-client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/analytics-middleware.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/analytics.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/api-auth-server.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/api-cache.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/api-client-server.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/api-client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/api-error-handler.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/api-retry.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/api/betting-api.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/auth-middleware-enhanced.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/auth-middleware.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/auth-server.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/auth-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/backend-integration.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/backend-proxy.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/backend-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/betting-automation/automation-manager.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/betting-automation/base-provider.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/betting-automation/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/betting-automation/providers/iframe-provider.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/betting-automation/providers/web-automation-provider.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/betting-automation/smart-betting-engine.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/betting-automation/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/builder-compiler.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/builderApi.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/cache-middleware.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/cache.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook React.useEffect has missing dependencies: 'fetcher', 'options?.customTtl', and 'options?.staleWhileRevalidate'. Either include them or remove the dependency array.","line":445,"column":6,"nodeType":"ArrayExpression","endLine":445,"endColumn":35,"suggestions":[{"desc":"Update the dependencies array to be: [key, type, options?.enabled, options?.customTtl, options?.staleWhileRevalidate, fetcher]","fix":{"range":[11025,11054],"text":"[key, type, options?.enabled, options?.customTtl, options?.staleWhileRevalidate, fetcher]"}}]},{"ruleId":"react-hooks/rules-of-hooks","severity":1,"message":"React Hook \"React.useRef\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":607,"column":20,"nodeType":"MemberExpression","endLine":607,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { LRUCache } from 'lru-cache';\r\nimport React from 'react';\r\n\r\n// Configurações de cache\r\nconst CACHE_CONFIG = {\r\n  // Cache para dados de API\r\n  api: {\r\n    max: 500,\r\n    ttl: 1000 * 60 * 5, // 5 minutos\r\n  },\r\n  // Cache para dados em tempo real\r\n  realtime: {\r\n    max: 100,\r\n    ttl: 1000 * 30, // 30 segundos\r\n  },\r\n  // Cache para dados estáticos\r\n  static: {\r\n    max: 1000,\r\n    ttl: 1000 * 60 * 60, // 1 hora\r\n  },\r\n  // Cache para dados de usuário\r\n  user: {\r\n    max: 50,\r\n    ttl: 1000 * 60 * 15, // 15 minutos\r\n  },\r\n};\r\n\r\n// Instâncias de cache\r\nconst apiCache = new LRUCache<string, any>(CACHE_CONFIG.api);\r\nconst realtimeCache = new LRUCache<string, any>(CACHE_CONFIG.realtime);\r\nconst staticCache = new LRUCache<string, any>(CACHE_CONFIG.static);\r\nconst userCache = new LRUCache<string, any>(CACHE_CONFIG.user);\r\n\r\n// Tipos de cache\r\nexport type CacheType = 'api' | 'realtime' | 'static' | 'user';\r\n\r\n// Interface para dados em cache\r\ninterface CacheEntry<T = any> {\r\n  data: T;\r\n  timestamp: number;\r\n  etag?: string;\r\n  lastModified?: string;\r\n}\r\n\r\ntype SmartCacheInstanceEntry<T = any> = {\r\n  value: T;\r\n  timestamp: number;\r\n  ttl: number;\r\n};\r\n\r\n// Classe principal do sistema de cache\r\nexport class SmartCache {\r\n  private store: Map<string, SmartCacheInstanceEntry>;\r\n  private stats: { hits: number; misses: number };\r\n  private maxSize: number;\r\n  private defaultTtl: number;\r\n  private persistent: boolean;\r\n  private storageKey: string;\r\n\r\n  constructor(options?: {\r\n    maxSize?: number;\r\n    ttl?: number;\r\n    persistent?: boolean;\r\n    storageKey?: string;\r\n  }) {\r\n    this.store = new Map();\r\n    this.stats = { hits: 0, misses: 0 };\r\n    this.maxSize = options?.maxSize ?? 100;\r\n    this.defaultTtl = options?.ttl ?? 5 * 60 * 1000;\r\n    this.persistent = options?.persistent ?? false;\r\n    this.storageKey = options?.storageKey ?? 'smart-cache';\r\n\r\n    if (this.persistent) {\r\n      this.loadFromStorage();\r\n    }\r\n  }\r\n\r\n  private now() {\r\n    const perf = (globalThis as any)?.performance;\r\n    if (perf && typeof perf.now === 'function') {\r\n      return perf.now();\r\n    }\r\n    return Date.now();\r\n  }\r\n\r\n  private isExpired(entry: SmartCacheInstanceEntry, now: number) {\r\n    return now - entry.timestamp > entry.ttl;\r\n  }\r\n\r\n  private evictIfNeeded() {\r\n    while (this.store.size > this.maxSize) {\r\n      const lruKey = this.store.keys().next().value as string | undefined;\r\n      if (lruKey === undefined) break;\r\n      this.store.delete(lruKey);\r\n    }\r\n  }\r\n\r\n  private saveToStorage() {\r\n    const storage = (globalThis as any)?.localStorage;\r\n    if (!storage || typeof storage.setItem !== 'function') return;\r\n\r\n    const data: Record<string, SmartCacheInstanceEntry> = {};\r\n    for (const [key, entry] of Array.from(this.store.entries())) {\r\n      data[key] = entry;\r\n    }\r\n    storage.setItem(this.storageKey, JSON.stringify(data));\r\n  }\r\n\r\n  private loadFromStorage() {\r\n    const storage = (globalThis as any)?.localStorage;\r\n    if (!storage || typeof storage.getItem !== 'function') return;\r\n\r\n    const raw = storage.getItem(this.storageKey);\r\n    if (!raw) return;\r\n\r\n    try {\r\n      const parsed = JSON.parse(raw) as Record<string, SmartCacheInstanceEntry>;\r\n      const now = this.now();\r\n      for (const [key, entry] of Object.entries(parsed)) {\r\n        if (\r\n          entry &&\r\n          typeof entry === 'object' &&\r\n          typeof entry.timestamp === 'number' &&\r\n          typeof entry.ttl === 'number'\r\n        ) {\r\n          if (!this.isExpired(entry, now)) {\r\n            this.store.set(key, entry);\r\n          }\r\n        }\r\n      }\r\n      this.evictIfNeeded();\r\n    } catch {\r\n      return;\r\n    }\r\n  }\r\n\r\n  set<T>(key: string, value: T, ttl?: number) {\r\n    const now = this.now();\r\n    this.store.delete(key);\r\n    this.store.set(key, {\r\n      value,\r\n      timestamp: now,\r\n      ttl: ttl ?? this.defaultTtl\r\n    });\r\n    this.evictIfNeeded();\r\n    if (this.persistent) {\r\n      this.saveToStorage();\r\n    }\r\n  }\r\n\r\n  get<T>(key: string): T | undefined {\r\n    const entry = this.store.get(key) as SmartCacheInstanceEntry<T> | undefined;\r\n    const now = this.now();\r\n\r\n    if (!entry) {\r\n      this.stats.misses++;\r\n      return undefined;\r\n    }\r\n\r\n    if (this.isExpired(entry, now)) {\r\n      this.store.delete(key);\r\n      this.stats.misses++;\r\n      if (this.persistent) {\r\n        this.saveToStorage();\r\n      }\r\n      return undefined;\r\n    }\r\n\r\n    this.store.delete(key);\r\n    this.store.set(key, entry);\r\n    this.stats.hits++;\r\n    return entry.value;\r\n  }\r\n\r\n  has(key: string) {\r\n    const entry = this.store.get(key);\r\n    if (!entry) return false;\r\n    const now = this.now();\r\n    if (this.isExpired(entry, now)) {\r\n      this.store.delete(key);\r\n      if (this.persistent) {\r\n        this.saveToStorage();\r\n      }\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  delete(key: string) {\r\n    const existed = this.store.delete(key);\r\n    if (existed && this.persistent) {\r\n      this.saveToStorage();\r\n    }\r\n    return existed;\r\n  }\r\n\r\n  clear() {\r\n    this.store.clear();\r\n    if (this.persistent) {\r\n      this.saveToStorage();\r\n    }\r\n  }\r\n\r\n  size() {\r\n    return this.store.size;\r\n  }\r\n\r\n  getStats() {\r\n    const total = this.stats.hits + this.stats.misses;\r\n    return {\r\n      hits: this.stats.hits,\r\n      misses: this.stats.misses,\r\n      size: this.store.size,\r\n      hitRate: total > 0 ? this.stats.hits / total : 0\r\n    };\r\n  }\r\n\r\n  invalidatePattern(pattern: string) {\r\n    const regex = new RegExp(pattern);\r\n    let deleted = 0;\r\n    for (const key of Array.from(this.store.keys())) {\r\n      if (regex.test(key)) {\r\n        this.store.delete(key);\r\n        deleted++;\r\n      }\r\n    }\r\n    if (deleted > 0 && this.persistent) {\r\n      this.saveToStorage();\r\n    }\r\n    return deleted;\r\n  }\r\n\r\n  preload<T>(key: string, value: T, ttl?: number) {\r\n    this.set(key, value, ttl);\r\n  }\r\n\r\n  private static getCacheInstance(type: CacheType) {\r\n    switch (type) {\r\n      case 'api':\r\n        return apiCache;\r\n      case 'realtime':\r\n        return realtimeCache;\r\n      case 'static':\r\n        return staticCache;\r\n      case 'user':\r\n        return userCache;\r\n      default:\r\n        return apiCache;\r\n    }\r\n  }\r\n\r\n  // Armazenar dados no cache\r\n  static set<T>(\r\n    key: string,\r\n    data: T,\r\n    type: CacheType = 'api',\r\n    options?: {\r\n      etag?: string;\r\n      lastModified?: string;\r\n      customTtl?: number;\r\n    }\r\n  ): void {\r\n    const cache = this.getCacheInstance(type);\r\n    const entry: CacheEntry<T> = {\r\n      data,\r\n      timestamp: Date.now(),\r\n      etag: options?.etag,\r\n      lastModified: options?.lastModified,\r\n    };\r\n\r\n    if (options?.customTtl) {\r\n      cache.set(key, entry, { ttl: options.customTtl });\r\n    } else {\r\n      cache.set(key, entry);\r\n    }\r\n  }\r\n\r\n  // Recuperar dados do cache\r\n  static get<T>(key: string, type: CacheType = 'api'): T | null {\r\n    const cache = this.getCacheInstance(type);\r\n    const entry = cache.get(key) as CacheEntry<T> | undefined;\r\n    \r\n    if (!entry) {\r\n      return null;\r\n    }\r\n\r\n    return entry.data;\r\n  }\r\n\r\n  // Verificar se existe no cache\r\n  static has(key: string, type: CacheType = 'api'): boolean {\r\n    const cache = this.getCacheInstance(type);\r\n    return cache.has(key);\r\n  }\r\n\r\n  // Remover do cache\r\n  static delete(key: string, type: CacheType = 'api'): boolean {\r\n    const cache = this.getCacheInstance(type);\r\n    return cache.delete(key);\r\n  }\r\n\r\n  // Limpar cache específico\r\n  static clear(type: CacheType = 'api'): void {\r\n    const cache = this.getCacheInstance(type);\r\n    cache.clear();\r\n  }\r\n\r\n  // Limpar todos os caches\r\n  static clearAll(): void {\r\n    apiCache.clear();\r\n    realtimeCache.clear();\r\n    staticCache.clear();\r\n    userCache.clear();\r\n  }\r\n\r\n  // Obter estatísticas do cache\r\n  static getStats(type: CacheType = 'api') {\r\n    const cache = this.getCacheInstance(type);\r\n    return {\r\n      size: cache.size,\r\n      max: cache.max,\r\n      calculatedSize: cache.calculatedSize,\r\n      // Note: hits/misses não estão disponíveis nesta versão do LRUCache\r\n      hits: 0,\r\n      misses: 0,\r\n      hitRate: 0,\r\n    };\r\n  }\r\n\r\n  // Invalidar cache baseado em padrão\r\n  static invalidatePattern(pattern: string, type: CacheType = 'api'): number {\r\n    const cache = this.getCacheInstance(type);\r\n    const regex = new RegExp(pattern);\r\n    let deleted = 0;\r\n\r\n    for (const key of Array.from(cache.keys())) {\r\n      if (regex.test(key)) {\r\n        cache.delete(key);\r\n        deleted++;\r\n      }\r\n    }\r\n\r\n    return deleted;\r\n  }\r\n\r\n  // Pré-carregar dados no cache\r\n  static async preload<T>(\r\n    key: string,\r\n    fetcher: () => Promise<T>,\r\n    type: CacheType = 'api',\r\n    options?: {\r\n      force?: boolean;\r\n      customTtl?: number;\r\n    }\r\n  ): Promise<T> {\r\n    if (!options?.force && this.has(key, type)) {\r\n      return this.get<T>(key, type)!;\r\n    }\r\n\r\n    try {\r\n      const data = await fetcher();\r\n      this.set(key, data, type, { customTtl: options?.customTtl });\r\n      return data;\r\n    } catch (error) {\r\n      console.error(`Erro ao pré-carregar cache para ${key}:`, error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Cache com fallback\r\n  static async getOrFetch<T>(\r\n    key: string,\r\n    fetcher: () => Promise<T>,\r\n    type: CacheType = 'api',\r\n    options?: {\r\n      customTtl?: number;\r\n      staleWhileRevalidate?: boolean;\r\n    }\r\n  ): Promise<T> {\r\n    const cached = this.get<T>(key, type);\r\n    \r\n    if (cached && !options?.staleWhileRevalidate) {\r\n      return cached;\r\n    }\r\n\r\n    try {\r\n      const data = await fetcher();\r\n      this.set(key, data, type, { customTtl: options?.customTtl });\r\n      return data;\r\n    } catch (error) {\r\n      if (cached) {\r\n        console.warn(`Erro ao buscar dados, retornando cache: ${key}`, error);\r\n        return cached;\r\n      }\r\n      throw error;\r\n    }\r\n  }\r\n}\r\n\r\n// Hook para usar cache em componentes React\r\nexport function useCache<T>(\r\n  key: string,\r\n  fetcher: () => Promise<T>,\r\n  type: CacheType = 'api',\r\n  options?: {\r\n    enabled?: boolean;\r\n    customTtl?: number;\r\n    staleWhileRevalidate?: boolean;\r\n  }\r\n) {\r\n  const [data, setData] = React.useState<T | null>(null);\r\n  const [loading, setLoading] = React.useState(true);\r\n  const [error, setError] = React.useState<Error | null>(null);\r\n\r\n  React.useEffect(() => {\r\n    if (!options?.enabled) {\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    const loadData = async () => {\r\n      try {\r\n        setLoading(true);\r\n        setError(null);\r\n        \r\n        const result = await SmartCache.getOrFetch(\r\n          key,\r\n          fetcher,\r\n          type,\r\n          {\r\n            customTtl: options?.customTtl,\r\n            staleWhileRevalidate: options?.staleWhileRevalidate,\r\n          }\r\n        );\r\n        \r\n        setData(result);\r\n      } catch (err) {\r\n        setError(err instanceof Error ? err : new Error('Erro desconhecido'));\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    loadData();\r\n  }, [key, type, options?.enabled]);\r\n\r\n  const invalidate = React.useCallback(() => {\r\n    SmartCache.delete(key, type);\r\n  }, [key, type]);\r\n\r\n  const refresh = React.useCallback(async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n      \r\n      const result = await SmartCache.preload(key, fetcher, type, { force: true });\r\n      setData(result);\r\n    } catch (err) {\r\n      setError(err instanceof Error ? err : new Error('Erro desconhecido'));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [key, fetcher, type]);\r\n\r\n  return {\r\n    data,\r\n    loading,\r\n    error,\r\n    invalidate,\r\n    refresh,\r\n  };\r\n}\r\n\r\n// Utilitários para cache de API\r\nexport const ApiCache = {\r\n  // Cache para endpoints específicos\r\n  signals: {\r\n    live: (tableId?: string) => `signals:live${tableId ? `:${tableId}` : ''}`,\r\n    history: (tableId: string, limit: number) => `signals:history:${tableId}:${limit}`,\r\n    kpis: () => 'signals:kpis',\r\n  },\r\n  \r\n  roulette: {\r\n    latest: (tableId: string) => `roulette:latest:${tableId}`,\r\n    history: (tableId: string, limit: number) => `roulette:history:${tableId}:${limit}`,\r\n    status: (tableId: string) => `roulette:status:${tableId}`,\r\n  },\r\n  \r\n  user: {\r\n    profile: (userId: string) => `user:profile:${userId}`,\r\n    preferences: (userId: string) => `user:preferences:${userId}`,\r\n    notifications: (userId: string) => `user:notifications:${userId}`,\r\n  },\r\n};\r\n\r\n// Middleware para cache automático em fetch\r\nexport function createCachedFetch(type: CacheType = 'api') {\r\n  return async function cachedFetch(\r\n    url: string,\r\n    options?: RequestInit & {\r\n      cacheKey?: string;\r\n      cacheTtl?: number;\r\n      skipCache?: boolean;\r\n    }\r\n  ) {\r\n    const cacheKey = options?.cacheKey || url;\r\n    \r\n    if (!options?.skipCache && SmartCache.has(cacheKey, type)) {\r\n      return SmartCache.get(cacheKey, type);\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(url, options);\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n      }\r\n      \r\n      const data = await response.json();\r\n      \r\n      SmartCache.set(cacheKey, data, type, {\r\n        customTtl: options?.cacheTtl,\r\n        etag: response.headers.get('etag') || undefined,\r\n        lastModified: response.headers.get('last-modified') || undefined,\r\n      });\r\n      \r\n      return data;\r\n    } catch (error) {\r\n      // Tentar retornar dados em cache em caso de erro\r\n      const cached = SmartCache.get(cacheKey, type);\r\n      if (cached) {\r\n        console.warn(`Erro na requisição, retornando cache: ${url}`, error);\r\n        return cached;\r\n      }\r\n      throw error;\r\n    }\r\n  };\r\n}\r\n\r\n// Função para criar uma instância de cache de API\r\nexport function createApiCache(options?: { ttl?: number; maxSize?: number }) {\r\n  const cache = new SmartCache({\r\n    maxSize: options?.maxSize ?? 200,\r\n    ttl: options?.ttl ?? 5 * 60 * 1000\r\n  });\r\n\r\n  const cachedFetch = (async (url: string, requestInit?: RequestInit) => {\r\n    if (cache.has(url)) {\r\n      return cache.get(url);\r\n    }\r\n\r\n    const response = await fetch(url, requestInit);\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n    }\r\n    const data = await response.json();\r\n    cache.set(url, data);\r\n    return data;\r\n  }) as any;\r\n\r\n  cachedFetch.invalidatePattern = (pattern: string) => cache.invalidatePattern(pattern);\r\n  cachedFetch.cache = cache;\r\n\r\n  return cachedFetch;\r\n}\r\n\r\n// Middleware de cache para Next.js\r\nexport function cacheMiddleware(options: { patterns: string[]; ttl: number }) {\r\n  return function middleware(req: any, res: any, next: any) {\r\n    // Implementação básica do middleware\r\n    if (options.patterns.some(pattern => req.url?.includes(pattern))) {\r\n      // Aplicar cache\r\n      res.setHeader('Cache-Control', `public, max-age=${Math.floor(options.ttl / 1000)}`);\r\n    }\r\n    if (next) next();\r\n  };\r\n}\r\n\r\n// Hook para usar SmartCache\r\nexport function useSmartCache<T>(\r\n  key: string,\r\n  type?: CacheType\r\n): {\r\n  get: () => T | null;\r\n  set: (data: T, options?: any) => void;\r\n  has: () => boolean;\r\n  delete: () => boolean;\r\n};\r\nexport function useSmartCache(\r\n  key?: undefined,\r\n  type?: CacheType\r\n): {\r\n  cache: SmartCache;\r\n  invalidatePattern: (pattern: string) => number;\r\n  preload: <D>(preloadKey: string, data: D, ttl?: number) => void;\r\n};\r\nexport function useSmartCache<T>(key?: string, type: CacheType = 'api') {\r\n  if (typeof key === 'string') {\r\n    return {\r\n      get: () => SmartCache.get<T>(key, type),\r\n      set: (data: T, options?: any) => SmartCache.set(key, data, type, options),\r\n      has: () => SmartCache.has(key, type),\r\n      delete: () => SmartCache.delete(key, type),\r\n    };\r\n  }\r\n\r\n  const cacheRef = React.useRef<SmartCache | null>(null);\r\n  if (!cacheRef.current) {\r\n    cacheRef.current = new SmartCache({ maxSize: 200, ttl: 5 * 60 * 1000 });\r\n  }\r\n\r\n  return {\r\n    cache: cacheRef.current,\r\n    invalidatePattern: (pattern: string) => cacheRef.current!.invalidatePattern(pattern),\r\n    preload: <D>(preloadKey: string, data: D, ttl?: number) =>\r\n      cacheRef.current!.preload(preloadKey, data, ttl),\r\n  };\r\n}\r\n\r\n// Exportar instância padrão\r\nexport default SmartCache;\r\n","usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/cpf-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/email.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/error-handler.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/extension-detector.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/feature-flags.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/health-monitor.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/insights-data.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/loading-states.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/log-export.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/logger.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/ml-api-client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/mock-auth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/monitoring.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/pagarme-recipient-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/pagarme-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/push-notifications.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/rate-limit-middleware.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/rate-limiter.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/redis.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/roulette-cache.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/security.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/services/createRecipient.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/services/lessons.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/sofia-backend-client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/supabase-server.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/supabase.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/supabaseClient.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/user-profiles-integration.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/user-registration.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/user-status.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/websocket-client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/lib/websocket-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/middleware.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/playwright.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/register-page-backup.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/sentry.client.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/sentry.edge.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/sentry.server.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/src/lib/supabaseclient.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/tailwind.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/types/lessons.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/types/risk-metrics.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/brenoferreira/Downloads/SOFIA/Deploy_Schema_Sofia-Backend/Deploy_Vercel_Sofia-Frontend-v2/Deploy_Vercel_Sofia-Checkout/PROJETO SOFIA/sofia-frontend/types/session-management.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]